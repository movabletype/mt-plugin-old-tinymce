// 4.6.2 (2017-05-23)
!function(){var defs={},dem=function(id){var actual=defs[id];if(actual===undefined)throw"module ["+id+"] was undefined";return actual.instance===undefined&&function(id){for(var actual=defs[id],dependencies=actual.deps,definition=actual.defn,len=dependencies.length,instances=new Array(len),i=0;i<len;++i)instances[i]=dem(dependencies[i]);var defResult=definition.apply(null,instances);if(defResult===undefined)throw"module ["+id+"] returned undefined";actual.instance=defResult}(id),actual.instance},define=function(id,dependencies,definition){if("string"!=typeof id)throw"module id must be a string";if(dependencies===undefined)throw"no dependencies for "+id;if(definition===undefined)throw"no definition function for "+id;defs[id]={deps:dependencies,defn:definition,instance:undefined}},defineGlobal=function(id,ref){define(id,[],function(){return ref})};define("tinymce.core.geom.Rect",[],function(){"use strict";var min=Math.min,max=Math.max,round=Math.round;function relativePosition(rect,targetRect,rel){var x,y,w,h,targetW,targetH;return x=targetRect.x,y=targetRect.y,w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,"b"===(rel=(rel||"").split(""))[0]&&(y+=targetH),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=round(targetH/2)),"c"===rel[1]&&(x+=round(targetW/2)),"b"===rel[3]&&(y-=h),"r"===rel[4]&&(x-=w),"c"===rel[3]&&(y-=round(h/2)),"c"===rel[4]&&(x-=round(w/2)),create(x,y,w,h)}function create(x,y,w,h){return{x:x,y:y,w:w,h:h}}return{inflate:function inflate(rect,w,h){return create(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h)},relativePosition:relativePosition,findBestRelativePosition:function findBestRelativePosition(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++)if((pos=relativePosition(rect,targetRect,rels[i])).x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null},intersect:function intersect(rect,cropRect){var x1,y1,x2,y2;return x1=max(rect.x,cropRect.x),y1=max(rect.y,cropRect.y),x2=min(rect.x+rect.w,cropRect.x+cropRect.w),y2=min(rect.y+rect.h,cropRect.y+cropRect.h),x2-x1<0||y2-y1<0?null:create(x1,y1,x2-x1,y2-y1)},clamp:function clamp(rect,clampRect,fixedSize){var underflowX1,underflowY1,overflowX2,overflowY2,x1,y1,x2,y2,cx2,cy2;return x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max(0,clampRect.x-x1),underflowY1=max(0,clampRect.y-y1),overflowX2=max(0,x2-cx2),overflowY2=max(0,y2-cy2),x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),create(x1,y1,(x2-=overflowX2)-x1,(y2-=overflowY2)-y1)},create:create,fromClientRect:function fromClientRect(clientRect){return create(clientRect.left,clientRect.top,clientRect.width,clientRect.height)}}}),define("tinymce.core.util.Promise",[],function(){if(window.Promise)return window.Promise;var asap=Promise.immediateFn||"function"==typeof setImmediate&&setImmediate||function(fn){setTimeout(fn,1)};function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}var isArray=Array.isArray||function(value){return"[object Array]"===Object.prototype.toString.call(value)};function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],doResolve(fn,bind(resolve,this),bind(reject,this))}function handle(deferred){var me=this;null!==this._state?asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(me._value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)}else(me._state?deferred.resolve:deferred.reject)(me._value)}):this._deferreds.push(deferred)}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this))}this._state=!0,this._value=newValue,finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=!1,this._value=newValue,finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++)handle.call(this,this._deferreds[i]);this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){done||(done=!0,onFulfilled(value))},function(reason){done||(done=!0,onRejected(reason))})}catch(ex){if(done)return;done=!0,onRejected(ex)}}return Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))})},Promise.all=function(){var args=Array.prototype.slice.call(1===arguments.length&&isArray(arguments[0])?arguments[0]:arguments);return new Promise(function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise}),define("tinymce.core.util.Delay",["tinymce.core.util.Promise"],function(Promise){var requestAnimationFramePromise;function wrappedSetTimeout(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)}function wrappedSetInterval(callback,time){return"number"!=typeof time&&(time=1),setInterval(callback,time)}function debounce(callback,time){var timer,func;return(func=function(){var args=arguments;clearTimeout(timer),timer=wrappedSetTimeout(function(){callback.apply(this,args)},time)}).stop=function(){clearTimeout(timer)},func}return{requestAnimationFrame:function(callback,element){requestAnimationFramePromise?requestAnimationFramePromise.then(callback):requestAnimationFramePromise=new Promise(function(resolve){(function requestAnimationFrame(callback,element){var i,requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"];for(i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];(requestAnimationFrameFunc=requestAnimationFrameFunc||function featurefill(callback){window.setTimeout(callback,0)})(callback,element)})(resolve,element=element||document.body)}).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout(function(){editor.removed||callback()},time)},setEditorInterval:function(editor,callback,time){var timer;return timer=wrappedSetInterval(function(){editor.removed?clearInterval(timer):callback()},time)},debounce:debounce,throttle:debounce,clearInterval:function wrappedClearInterval(id){return clearInterval(id)},clearTimeout:function wrappedClearTimeout(id){return clearTimeout(id)}}}),define("tinymce.core.Env",[],function(){var opera,webkit,ie,ie11,ie12,gecko,mac,iDevice,android,fileApi,phone,tablet,windowsPhone,nav=navigator,userAgent=nav.userAgent;function matchMediaQuery(query){return"matchMedia"in window&&matchMedia(query).matches}return opera=window.opera&&window.opera.buildNumber,android=/Android/.test(userAgent),ie=(ie=!(webkit=/WebKit/.test(userAgent))&&!opera&&/MSIE/gi.test(userAgent)&&/Explorer/gi.test(nav.appName))&&/MSIE (\w+)\./.exec(userAgent)[1],ie11=-1!=userAgent.indexOf("Trident/")&&(-1!=userAgent.indexOf("rv:")||-1!=nav.appName.indexOf("Netscape"))&&11,ie12=-1!=userAgent.indexOf("Edge/")&&!ie&&!ie11&&12,ie=ie||ie11||ie12,gecko=!webkit&&!ie11&&/Gecko/.test(userAgent),mac=-1!=userAgent.indexOf("Mac"),iDevice=/(iPad|iPhone)/.test(userAgent),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,phone=matchMediaQuery("only screen and (max-device-width: 480px)")&&(android||iDevice),tablet=matchMediaQuery("only screen and (min-width: 800px)")&&(android||iDevice),windowsPhone=-1!=userAgent.indexOf("Windows Phone"),ie12&&(webkit=!1),{opera:opera,webkit:webkit,ie:ie,gecko:gecko,mac:mac,iOS:iDevice,android:android,contentEditable:!iDevice||fileApi||534<=userAgent.match(/AppleWebKit\/(\d*)/)[1],transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!=ie,range:window.getSelection&&"Range"in window,documentMode:ie&&!ie12?document.documentMode||7:10,fileApi:fileApi,ceFalse:!1===ie||8<ie,canHaveCSP:!1===ie||11<ie,desktop:!phone&&!tablet,windowsPhone:windowsPhone}}),define("tinymce.core.dom.EventUtils",["tinymce.core.util.Delay","tinymce.core.Env"],function(Delay,Env){"use strict";var mouseEventRe=/^(?:mouse|contextmenu)|click/,deprecated={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1},hasIsDefaultPrevented=function(event){return event.isDefaultPrevented===returnTrue||event.isDefaultPrevented===returnFalse},returnFalse=function(){return!1},returnTrue=function(){return!0};function addEvent(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)}function removeEvent(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)}function fix(originalEvent,data){var name,event=data||{};for(name in originalEvent)deprecated[name]||(event[name]=originalEvent[name]);if(event.target||(event.target=event.srcElement||document),Env.experimentalShadowDom&&(event.target=function getTargetFromShadowDom(event,defaultTarget){var path,target=defaultTarget;return(path=event.path)&&0<path.length&&(target=path[0]),event.deepPath&&(path=event.deepPath())&&0<path.length&&(target=path[0]),target}(originalEvent,event.target)),originalEvent&&mouseEventRe.test(originalEvent.type)&&void 0===originalEvent.pageX&&void 0!==originalEvent.clientX){var eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;event.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return event.preventDefault=function(){event.isDefaultPrevented=returnTrue,originalEvent&&(originalEvent.preventDefault?originalEvent.preventDefault():originalEvent.returnValue=!1)},event.stopPropagation=function(){event.isPropagationStopped=returnTrue,originalEvent&&(originalEvent.stopPropagation?originalEvent.stopPropagation():originalEvent.cancelBubble=!0)},!(event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=returnTrue,event.stopPropagation()})===hasIsDefaultPrevented(event)&&(event.isDefaultPrevented=returnFalse,event.isPropagationStopped=returnFalse,event.isImmediatePropagationStopped=returnFalse),"undefined"==typeof event.metaKey&&(event.metaKey=!1),event}function bindOnReady(win,callback,eventUtils){var doc=win.document,event={type:"ready"};function isDocReady(){return"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body}function readyHandler(){eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event))}eventUtils.domLoaded?callback(event):(!doc.addEventListener||Env.ie&&Env.ie<11?(addEvent(doc,"readystatechange",function waitForDomLoaded(){isDocReady()&&(removeEvent(doc,"readystatechange",waitForDomLoaded),readyHandler())}),doc.documentElement.doScroll&&win.self===win.top&&function tryScroll(){try{doc.documentElement.doScroll("left")}catch(ex){return void Delay.setTimeout(tryScroll)}readyHandler()}()):isDocReady()?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),addEvent(win,"load",readyHandler))}function EventUtils(){var count,expando,hasFocusIn,hasMouseEnterLeave,mouseEnterLeave,self=this,events={};function executeHandlers(evt,id){var callbackList,i,l,callback,container=events[id];if(callbackList=container&&container[evt.type])for(i=0,l=callbackList.length;i<l;i++)if((callback=callbackList[i])&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}expando="mce-data-"+(+new Date).toString(32),hasMouseEnterLeave="onmouseenter"in document.documentElement,hasFocusIn="onfocusin"in document.documentElement,mouseEnterLeave={mouseenter:"mouseover",mouseleave:"mouseout"},count=1,self.domLoaded=!1,self.events=events,self.bind=function(target,names,callback,scope){var id,callbackList,i,name,fakeName,nativeHandler,capture,win=window;function defaultNativeHandler(evt){executeHandlers(fix(evt||win.event),id)}if(target&&3!==target.nodeType&&8!==target.nodeType){for(target[expando]?id=target[expando]:(id=count++,target[expando]=id,events[id]={}),scope=scope||target,i=(names=names.split(" ")).length;i--;)nativeHandler=defaultNativeHandler,fakeName=capture=!1,"DOMContentLoaded"===(name=names[i])&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"==target.readyState?callback.call(scope,fix({type:name})):(hasMouseEnterLeave||(fakeName=mouseEnterLeave[name])&&(nativeHandler=function(evt){var current,related;if(current=evt.currentTarget,(related=evt.relatedTarget)&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||((evt=fix(evt||win.event)).type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,executeHandlers(evt,id))}),hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){(evt=fix(evt||win.event)).type="focus"===evt.type?"focusin":"focusout",executeHandlers(evt,id)}),(callbackList=events[id][name])?"ready"===name&&self.domLoaded?callback({type:name}):callbackList.push({func:callback,scope:scope}):(events[id][name]=callbackList=[{func:callback,scope:scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=0,callback}},self.unbind=function(target,names,callback){var id,callbackList,i,ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return self;if(id=target[expando]){if(eventMap=events[id],names){for(i=(names=names.split(" ")).length;i--;)if(callbackList=eventMap[name=names[i]]){if(callback)for(ci=callbackList.length;ci--;)if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture;(callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1))).nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else{for(name in eventMap)removeEvent(target,(callbackList=eventMap[name]).fakeName||name,callbackList.nativeHandler,callbackList.capture);eventMap={}}for(name in eventMap)return self;delete events[id];try{delete target[expando]}catch(ex){target[expando]=null}}return self},self.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return self;for((args=fix(null,args)).type=name,args.target=target;(id=target[expando])&&executeHandlers(args,id),(target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow)&&!args.isPropagationStopped(););return self},self.clean=function(target){var i,children,unbind=self.unbind;if(!target||3===target.nodeType||8===target.nodeType)return self;if(target[expando]&&unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName)for(unbind(target),i=(children=target.getElementsByTagName("*")).length;i--;)(target=children[i])[expando]&&unbind(target);return self},self.destroy=function(){events={}},self.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}}return(EventUtils.Event=new EventUtils).bind(window,"ready",function(){}),EventUtils}),define("tinymce.core.dom.Sizzle",[],function(){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined=typeof undefined,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(65536+high):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=(context=context||document).nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||1<<31)-(~a.sourceIndex||1<<31);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(docElem=(document=doc).documentElement,documentIsHTML=!isXML(doc),parent&&parent!==function getTop(win){try{return win.top}catch(ex){}return null}(parent)&&(parent.addEventListener?parent.addEventListener("unload",function(){setDocument()},!1):parent.attachEvent&&parent.attachEvent("onunload",function(){setDocument()})),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"!==tag)return results;for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){div.innerHTML="<select msallowcapture=''><option selected=''></option></select>",div.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return 0<Sizzle(expr,document,null,[elem]).length},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&-1<result.indexOf(check):"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?-1<(" "+result+" ").indexOf(check):"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!=forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&0<=diff/first}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):1<fn.length?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf.call(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return 0<Sizzle(selector,elem).length}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return-1<(elem.textContent||elem.innerText||getText(elem)).indexOf(text)}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;0<=--i;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if((oldCache=(outerCache=elem[expando]||(elem[expando]={}))[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if((outerCache[dir]=newCache)[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return 1<matchers.length?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&-1<(temp=postFinder?indexOf.call(seed,elem):preMap[i])&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return-1<indexOf.call(checkContext,elem)},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(1<i&&elementMatcher(matchers),1<i&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(i=(match=match||tokenize(selector)).length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=0<setMatchers.length,byElement=0<elementMatchers.length,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(0<matchedCount)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&0<setMatched.length&&1<matchedCount+setMatchers.length&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(2<(tokens=match[0]=match[0].slice(0)).length&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}),define("tinymce.core.util.Arr",[],function(){var isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)};function each(o,cb,s){var n,l;if(!o)return 0;if(s=s||o,o.length!==undefined){for(n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return 0}else for(n in o)if(o.hasOwnProperty(n)&&!1===cb.call(s,o[n],n,o))return 0;return 1}function findIndex(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1}return{isArray:isArray,toArray:function toArray(obj){var i,l,array=obj;if(!isArray(obj))for(array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array},each:each,map:function map(array,callback){var out=[];return each(array,function(item,index){out.push(callback(item,index,array))}),out},filter:function filter(a,f){var o=[];return each(a,function(v,index){f&&!f(v,index,a)||o.push(v)}),o},indexOf:function indexOf(a,v){var i,l;if(a)for(i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1},reduce:function reduce(collection,iteratee,accumulator,thisArg){var i=0;for(arguments.length<3&&(accumulator=collection[0]);i<collection.length;i++)accumulator=iteratee.call(thisArg,accumulator,collection[i],i);return accumulator},findIndex:findIndex,find:function find(array,predicate,thisArg){var idx=findIndex(array,predicate,thisArg);return-1!==idx?array[idx]:undefined},last:function last(collection){return collection[collection.length-1]}}}),define("tinymce.core.util.Tools",["tinymce.core.Env","tinymce.core.util.Arr"],function(Env,Arr){var whiteSpaceRegExp=/^\s*|\s*$/g;function trim(str){return null===str||str===undefined?"":(""+str).replace(whiteSpaceRegExp,"")}function is(obj,type){return type?!("array"!=type||!Arr.isArray(obj))||typeof obj==type:obj!==undefined}return{trim:trim,isArray:Arr.isArray,is:is,toArray:Arr.toArray,makeMap:function makeMap(items,delim,map){var i;for(delim=delim||",","string"==typeof(items=items||[])&&(items=items.split(delim)),map=map||{},i=items.length;i--;)map[items[i]]={};return map},each:Arr.each,map:Arr.map,grep:Arr.filter,inArray:Arr.indexOf,hasOwn:function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)},extend:function extend(obj,ext){var i,l,name,value,args=arguments;for(i=1,l=args.length;i<l;i++)for(name in ext=args[i])ext.hasOwnProperty(name)&&(value=ext[name])!==undefined&&(obj[name]=value);return obj},create:function create(s,p,root){var sp,ns,cn,scn,c,de=0;if(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s),cn=s[3].match(/(^|\.)(\w+)$/i)[2],!(ns=this.createNS(s[3].replace(/\.\w+$/,""),root))[cn]){if("static"==s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=function(){},de=1),ns[cn]=p[cn],this.extend(ns[cn].prototype,p),s[5]&&(sp=this.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],ns[cn]=de?function(){return sp[scn].apply(this,arguments)}:function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],this.each(sp,function(f,n){ns[cn].prototype[n]=sp[n]}),this.each(p,function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!=cn&&(ns[cn].prototype[n]=f)})),this.each(p["static"],function(f,n){ns[cn][n]=f})}},walk:function walk(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),Arr.each(o,function(o,i){if(!1===f.call(s,o,i,n))return!1;walk(o,f,n,s)}))},createNS:function createNS(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)o[v=n[i]]||(o[v]={}),o=o[v];return o},resolve:function resolve(n,o){var i,l;for(o=o||window,i=0,l=(n=n.split(".")).length;i<l&&(o=o[n[i]]);i++);return o},explode:function explode(s,d){return!s||is(s,"array")?s:Arr.map(s.split(d||","),trim)},_addCacheSuffix:function _addCacheSuffix(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}}}),define("tinymce.core.dom.DomQuery",["tinymce.core.dom.EventUtils","tinymce.core.dom.Sizzle","tinymce.core.util.Tools","tinymce.core.Env"],function(EventUtils,Sizzle,Tools,Env){var doc=document,push=Array.prototype.push,slice=Array.prototype.slice,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev");function isDefined(obj){return void 0!==obj}function isString(obj){return"string"==typeof obj}function createFragment(html,fragDoc){var frag,node,container;for(container=(fragDoc=fragDoc||doc).createElement("div"),frag=fragDoc.createDocumentFragment(),container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag}function domManipulate(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem))sourceItem=createFragment(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;0<=i;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes}function hasClass(node,className){return node&&className&&-1!==(" "+node.className+" ").indexOf(" "+className+" ")}function wrap(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each(function(){all&&lastParent==this.parentNode||(lastParent=this.parentNode,newWrapper=wrapper.cloneNode(!1),this.parentNode.insertBefore(newWrapper,this)),newWrapper.appendChild(this)}),elements}var numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={"for":"htmlFor","class":"className",readonly:"readOnly"},cssFix={"float":"cssFloat"},attrHooks={},cssHooks={};function DomQuery(selector,context){return new DomQuery.fn.init(selector,context)}var whiteSpaceRegExp=/^\s*|\s*$/g;function trim(str){return null==str?"":(""+str).replace(whiteSpaceRegExp,"")}function each(obj,callback){var length,key,i,value;if(obj)if(void 0===(length=obj.length)){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],!1===callback.call(value,key,value)))break}else for(i=0;i<length&&(value=obj[i],!1!==callback.call(value,i,value));i++);return obj}function grep(array,callback){var out=[];return each(array,function(i,item){callback(item,i)&&out.push(item)}),out}function getElementDocument(element){return element?9==element.nodeType?element:element.ownerDocument:doc}function dir(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(until!==undefined){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched}function sibling(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(until!==undefined){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result}function firstSibling(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType==nodeType)return node;return null}function appendHooks(targetHooks,prop,hooks){each(hooks,function(name,func){targetHooks[name]=targetHooks[name]||{},targetHooks[name][prop]=func})}return DomQuery.fn=DomQuery.prototype={constructor:DomQuery,selector:"",context:null,length:0,init:function(selector,context){var match,node;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(context&&context.nodeType)this.context=context;else{if(context)return DomQuery(selector).attr(context);this.context=context=document}if(isString(selector)){if(!(match="<"===(this.selector=selector).charAt(0)&&">"===selector.charAt(selector.length-1)&&3<=selector.length?[null,selector,null]:rquickExpr.exec(selector)))return DomQuery(context).find(selector);if(match[1])for(node=createFragment(selector,getElementDocument(context)).firstChild;node;)push.call(this,node),node=node.nextSibling;else{if(!(node=getElementDocument(context).getElementById(match[2])))return this;if(node.id!==match[2])return this.find(selector);this.length=1,this[0]=node}}else this.add(selector,!1);return this},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var nodes,i;if(isString(items))return this.add(DomQuery(items));if(!1!==sort)for(nodes=DomQuery.unique(this.toArray().concat(DomQuery.makeArray(items))),this.length=nodes.length,i=0;i<nodes.length;i++)this[i]=nodes[i];else push.apply(this,DomQuery.makeArray(items));return this},attr:function(name,value){var hook,self=this;if("object"==typeof name)each(name,function(name,value){self.attr(name,value)});else{if(!isDefined(value)){if(self[0]&&1===self[0].nodeType){if((hook=attrHooks[name])&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:void 0;null===(value=self[0].getAttribute(name,2))&&(value=void 0)}return value}this.each(function(){var hook;if(1===this.nodeType){if((hook=attrHooks[name])&&hook.set)return void hook.set(this,value);null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2)}})}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if("object"==typeof(name=propFix[name]||name))each(name,function(name,value){self.prop(name,value)});else{if(!isDefined(value))return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each(function(){1==this.nodeType&&(this[name]=value)})}return self},css:function(name,value){var elm,hook,self=this;function camel(name){return name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()})}function dashed(name){return name.replace(/[A-Z]/g,function(a){return"-"+a})}if("object"==typeof name)each(name,function(name,value){self.css(name,value)});else if(isDefined(value))name=camel(name),"number"!=typeof value||numericCssMap[name]||(value+="px"),self.each(function(){var style=this.style;if((hook=cssHooks[name])&&hook.set)hook.set(this,value);else{try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))}});else{if(elm=self[0],(hook=cssHooks[name])&&hook.get)return hook.get(elm);if(elm.ownerDocument.defaultView)try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return}else if(elm.currentStyle)return elm.currentStyle[camel(name)]}return self},remove:function(){for(var node,i=this.length;i--;)node=this[i],Event.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var node,i=this.length;i--;)for(node=this[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var i;if(isDefined(value)){i=this.length;try{for(;i--;)this[i].innerHTML=value}catch(ex){DomQuery(this[i]).empty().append(value)}return this}return this[0]?this[0].innerHTML:""},text:function(value){var i;if(isDefined(value)){for(i=this.length;i--;)"innerText"in this[i]?this[i].innerText=value:this[0].textContent=value;return this}return this[0]?this[0].innerText||this[0].textContent:""},append:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)})},prepend:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)},!0)},before:function(){return this[0]&&this[0].parentNode?domManipulate(this,arguments,function(node){this.parentNode.insertBefore(node,this)}):this},after:function(){return this[0]&&this[0].parentNode?domManipulate(this,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling)},!0):this},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap(this,content)},wrapAll:function(content){return wrap(this,content,!0)},wrapInner:function(content){return this.each(function(){DomQuery(this).contents().wrapAll(content)}),this},unwrap:function(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes)})},clone:function(){var result=[];return this.each(function(){result.push(this.cloneNode(!0))}),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className||(-1!==className.indexOf(" ")?each(className.split(" "),function(){self.toggleClass(this,state)}):self.each(function(index,node){var existingClassName,classState;(classState=hasClass(node,className))!==state&&(existingClassName=node.className,classState?node.className=trim((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className)})),self},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each(this,callback)},on:function(name,callback){return this.each(function(){Event.bind(this,name,callback)})},off:function(name,callback){return this.each(function(){Event.unbind(this,name,callback)})},trigger:function(name){return this.each(function(){"object"==typeof name?Event.fire(this,name.type,name):Event.fire(this,name)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new DomQuery(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep(this.toArray(),function(item,i){return selector(i,item)}):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each(function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node==selector){result.push(node);break}node=node.parentNode}}),DomQuery(result)},offset:function(offset){var elm,doc,docElm,pos,x=0,y=0;return offset?this.css(offset):((elm=this[0])&&(docElm=(doc=elm.ownerDocument).documentElement,elm.getBoundingClientRect&&(x=(pos=elm.getBoundingClientRect()).left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push:push,sort:[].sort,splice:[].splice},Tools.extend(DomQuery,{extend:Tools.extend,makeArray:function(object){return function isWindow(obj){return obj&&obj==obj.window}(object)||object.nodeType?[object]:Tools.toArray(object)},inArray:function inArray(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1},isArray:Tools.isArray,each:each,trim:trim,grep:grep,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!=elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}}),each({parent:function(node){var parent=node.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},function(name,fn){DomQuery.fn[name]=function(selector){var result=[];return this.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),1<this.length&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse())),result=DomQuery(result),selector?result.filter(selector):result}}),each({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling(node,"previousSibling",1,until).slice(1)}},function(name,fn){DomQuery.fn[name]=function(selector,filter){var result=[];return this.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),1<this.length&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse())),result=DomQuery(result),filter?result.filter(filter):result}}),DomQuery.fn.is=function(selector){return!!selector&&0<this.filter(selector).length},DomQuery.fn.init.prototype=DomQuery.fn,DomQuery.overrideDefaults=function(callback){var defaults;function sub(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context=context||defaults.context,new sub.fn.init(selector,context)}return DomQuery.extend(sub,this),sub},Env.ie&&Env.ie<8&&(appendHooks(attrHooks,"get",{maxlength:function(elm){var value=elm.maxLength;if(2147483647!==value)return value},size:function(elm){var value=elm.size;if(20!==value)return value},"class":function(elm){return elm.className},style:function(elm){var value=elm.style.cssText;if(0!==value.length)return value}}),appendHooks(attrHooks,"set",{"class":function(elm,value){elm.className=value},style:function(elm,value){elm.style.cssText=value}})),Env.ie&&Env.ie<9&&(cssFix["float"]="styleFloat",appendHooks(cssHooks,"set",{opacity:function(elm,value){var style=elm.style;null===value||""===value?style.removeAttribute("filter"):(style.zoom=1,style.filter="alpha(opacity="+100*value+")")}})),DomQuery.attrHooks=attrHooks,DomQuery.cssHooks=cssHooks,DomQuery}),define("tinymce.core.html.Styles",[],function(){return function(settings,schema){var i,encodingItems,validStyles,invalidStyles,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={};for(settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles()),encodingItems="\\\" \\' \\; \\: ; : \ufeff".split(" "),i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]="\ufeff"+i,encodingLookup["\ufeff"+i]=encodingItems[i];function toHex(match,r,g,b){function hex(val){return 1<(val=parseInt(val,10).toString(16)).length?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)}return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){var matches,name,value,isEncoded,styles={},urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||this;function compress(prefix,suffix,noJoin){var top,right,bottom,left;if((top=styles[prefix+"-top"+suffix])&&(right=styles[prefix+"-right"+suffix])&&(bottom=styles[prefix+"-bottom"+suffix])&&(left=styles[prefix+"-left"+suffix])){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);-1<i&&noJoin||(styles[prefix+suffix]=-1==i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}function canCompress(key){var i,value=styles[key];if(value){for(i=(value=value.split(" ")).length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}}function encode(str){return isEncoded=!0,encodingLookup[str]}function decode(str,keepSlashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str]})),keepSlashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str}function decodeSingleHexSequence(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16))}function decodeHexSequences(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence)}function processUrl(match,url,url2,url3,str,str2){if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"}if(css){for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode)});matches=styleRegExp.exec(css);)if(styleRegExp.lastIndex=matches.index+matches[0].length,name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,""),name&&value){if(name=decodeHexSequences(name),value=decodeHexSequences(value),-1!==name.indexOf("\ufeff")||-1!==name.indexOf('"'))continue;if(!settings.allow_script_urls&&("behavior"==name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),value=(value=value.replace(rgbRegExp,toHex)).replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(value,!0):value}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),function compress2(target,a,b,c){canCompress(a)&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c])}("border","border-width","border-style","border-color"),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){var name,value,css="";function serializeStyles(name){var styleList,i,l,value;if(styleList=validStyles[name])for(i=0,l=styleList.length;i<l;i++)name=styleList[i],(value=styles[name])&&(css+=(0<css.length?" ":"")+name+": "+value+";")}function isValid(name,elementName){var styleMap;return(!(styleMap=invalidStyles["*"])||!styleMap[name])&&(!(styleMap=invalidStyles[elementName])||!styleMap[name])}if(elementName&&validStyles)serializeStyles("*"),serializeStyles(elementName);else for(name in styles)!(value=styles[name])||invalidStyles&&!isValid(name,elementName)||(css+=(0<css.length?" ":"")+name+": "+value+";");return css}}}}),define("tinymce.core.dom.TreeWalker",[],function(){return function(startNode,rootNode){var node=startNode;function findSibling(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!=rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!=rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}}this.current=function(){return node},this.next=function(shallow){return node=findSibling(node,"firstChild","nextSibling",shallow)},this.prev=function(shallow){return node=findSibling(node,"lastChild","previousSibling",shallow)},this.prev2=function(shallow){return node=function findPreviousNode(node,startName,siblingName,shallow){var sibling,parent,child;if(node){if(sibling=node[siblingName],rootNode&&sibling===rootNode)return;if(sibling){if(!shallow)for(child=sibling[startName];child;child=child[startName])if(!child[startName])return child;return sibling}if((parent=node.parentNode)&&parent!==rootNode)return parent}}(node,"lastChild","previousSibling",shallow)}}}),define("tinymce.core.html.Entities",["tinymce.core.util.Tools"],function(Tools){var namedEntities,baseEntities,reverseEntities,makeMap=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"};function buildEntitiesLookup(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}}baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var Entities={encodeRaw:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeNumeric:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return 1<chr.length?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"})},encodeNamed:function(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr})},getEncodeFunc:function(name,entities){return entities=buildEntitiesLookup(entities)||namedEntities,(name=makeMap(name.replace(/\+/g,","))).named&&name.numeric?function encodeNamedAndNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]!==undefined?baseEntities[chr]:entities[chr]!==undefined?entities[chr]:1<chr.length?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";"})}:name.named?entities?function encodeCustomNamed(text,attr){return Entities.encodeNamed(text,attr,entities)}:Entities.encodeNamed:name.numeric?Entities.encodeNumeric:Entities.encodeRaw},decode:function(text){return text.replace(entityRegExp,function(all,numeric){return numeric?65535<(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||function nativeDecode(text){var elm;return(elm=document.createElement("div")).innerHTML=text,elm.textContent||elm.innerText||text}(all)})}};return Entities}),define("tinymce.core.dom.Range",["tinymce.core.util.Tools"],function(Tools){function Range(dom){var self=this,doc=dom.doc,EXTRACT=0,CLONE=1,DELETE=2,TRUE=!0,FALSE=!1,START_OFFSET="startOffset",START_CONTAINER="startContainer",END_CONTAINER="endContainer",END_OFFSET="endOffset",extend=Tools.extend,nodeIndex=dom.nodeIndex;function createDocumentFragment(){return doc.createDocumentFragment()}function setStart(n,o){_setEndPoint(TRUE,n,o)}function setEnd(n,o){_setEndPoint(FALSE,n,o)}function setStartBefore(n){setStart(n.parentNode,nodeIndex(n))}function setEndAfter(n){setEnd(n.parentNode,nodeIndex(n)+1)}function cloneContents(){return _traverse(CLONE)}function _getSelectedNode(container,offset){var child;if(3==container.nodeType)return container;if(offset<0)return container;for(child=container.firstChild;child&&0<offset;)--offset,child=child.nextSibling;return child||container}function _compareBoundaryPoints(containerA,offsetA,containerB,offsetB){var c,offsetC,n,cmnRoot,childA,childB;if(containerA==containerB)return offsetA==offsetB?0:offsetA<offsetB?-1:1;for(c=containerB;c&&c.parentNode!=containerA;)c=c.parentNode;if(c){for(offsetC=0,n=containerA.firstChild;n!=c&&offsetC<offsetA;)offsetC++,n=n.nextSibling;return offsetA<=offsetC?-1:1}for(c=containerA;c&&c.parentNode!=containerB;)c=c.parentNode;if(c){for(offsetC=0,n=containerB.firstChild;n!=c&&offsetC<offsetB;)offsetC++,n=n.nextSibling;return offsetC<offsetB?-1:1}for(cmnRoot=dom.findCommonAncestor(containerA,containerB),childA=containerA;childA&&childA.parentNode!=cmnRoot;)childA=childA.parentNode;for(childA=childA||cmnRoot,childB=containerB;childB&&childB.parentNode!=cmnRoot;)childB=childB.parentNode;if(childA==(childB=childB||cmnRoot))return 0;for(n=cmnRoot.firstChild;n;){if(n==childA)return-1;if(n==childB)return 1;n=n.nextSibling}}function _setEndPoint(st,n,o){var ec,sc;for(st?(self[START_CONTAINER]=n,self[START_OFFSET]=o):(self[END_CONTAINER]=n,self[END_OFFSET]=o),ec=self[END_CONTAINER];ec.parentNode;)ec=ec.parentNode;for(sc=self[START_CONTAINER];sc.parentNode;)sc=sc.parentNode;sc==ec?0<_compareBoundaryPoints(self[START_CONTAINER],self[START_OFFSET],self[END_CONTAINER],self[END_OFFSET])&&self.collapse(st):self.collapse(st),self.collapsed=function _isCollapsed(){return self[START_CONTAINER]==self[END_CONTAINER]&&self[START_OFFSET]==self[END_OFFSET]}(),self.commonAncestorContainer=dom.findCommonAncestor(self[START_CONTAINER],self[END_CONTAINER])}function _traverse(how){var c,p,depthDiff,startNode,endNode,sp,ep,endContainerDepth=0,startContainerDepth=0;if(self[START_CONTAINER]==self[END_CONTAINER])return function _traverseSameContainer(how){var frag,s,sub,n,cnt,sibling,xferNode,start,len;how!=DELETE&&(frag=createDocumentFragment());if(self[START_OFFSET]==self[END_OFFSET])return frag;if(3==self[START_CONTAINER].nodeType){if(s=self[START_CONTAINER].nodeValue,sub=s.substring(self[START_OFFSET],self[END_OFFSET]),how!=CLONE&&(n=self[START_CONTAINER],start=self[START_OFFSET],len=self[END_OFFSET]-self[START_OFFSET],0===start&&len>=n.nodeValue.length-1?n.parentNode.removeChild(n):n.deleteData(start,len),self.collapse(TRUE)),how==DELETE)return;return 0<sub.length&&frag.appendChild(doc.createTextNode(sub)),frag}n=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),cnt=self[END_OFFSET]-self[START_OFFSET];for(;n&&0<cnt;)sibling=n.nextSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.appendChild(xferNode),--cnt,n=sibling;how!=CLONE&&self.collapse(TRUE);return frag}(how);for(p=(c=self[END_CONTAINER]).parentNode;p;p=(c=p).parentNode){if(p==self[START_CONTAINER])return _traverseCommonStartContainer(c,how);++endContainerDepth}for(p=(c=self[START_CONTAINER]).parentNode;p;p=(c=p).parentNode){if(p==self[END_CONTAINER])return _traverseCommonEndContainer(c,how);++startContainerDepth}for(depthDiff=startContainerDepth-endContainerDepth,startNode=self[START_CONTAINER];0<depthDiff;)startNode=startNode.parentNode,depthDiff--;for(endNode=self[END_CONTAINER];depthDiff<0;)endNode=endNode.parentNode,depthDiff++;for(sp=startNode.parentNode,ep=endNode.parentNode;sp!=ep;sp=sp.parentNode,ep=ep.parentNode)startNode=sp,endNode=ep;return function _traverseCommonAncestors(startAncestor,endAncestor,how){var n,frag,startOffset,endOffset,cnt,sibling,nextSibling;how!=DELETE&&(frag=createDocumentFragment());n=_traverseLeftBoundary(startAncestor,how),frag&&frag.appendChild(n);startOffset=nodeIndex(startAncestor),endOffset=nodeIndex(endAncestor),cnt=endOffset-++startOffset,sibling=startAncestor.nextSibling;for(;0<cnt;)nextSibling=sibling.nextSibling,n=_traverseFullySelected(sibling,how),frag&&frag.appendChild(n),sibling=nextSibling,--cnt;n=_traverseRightBoundary(endAncestor,how),frag&&frag.appendChild(n);how!=CLONE&&(self.setStartAfter(startAncestor),self.collapse(TRUE));return frag}(startNode,endNode,how)}function _traverseCommonStartContainer(endAncestor,how){var frag,n,cnt,sibling,xferNode;if(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseRightBoundary(endAncestor,how),frag&&frag.appendChild(n),(cnt=nodeIndex(endAncestor)-self[START_OFFSET])<=0)return how!=CLONE&&(self.setEndBefore(endAncestor),self.collapse(FALSE)),frag;for(n=endAncestor.previousSibling;0<cnt;)sibling=n.previousSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.insertBefore(xferNode,frag.firstChild),--cnt,n=sibling;return how!=CLONE&&(self.setEndBefore(endAncestor),self.collapse(FALSE)),frag}function _traverseCommonEndContainer(startAncestor,how){var frag,startIdx,n,cnt,sibling,xferNode;for(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseLeftBoundary(startAncestor,how),frag&&frag.appendChild(n),startIdx=nodeIndex(startAncestor),++startIdx,cnt=self[END_OFFSET]-startIdx,n=startAncestor.nextSibling;n&&0<cnt;)sibling=n.nextSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.appendChild(xferNode),--cnt,n=sibling;return how!=CLONE&&(self.setStartAfter(startAncestor),self.collapse(TRUE)),frag}function _traverseRightBoundary(root,how){var parent,clonedParent,prevSibling,clonedChild,clonedGrandParent,next=_getSelectedNode(self[END_CONTAINER],self[END_OFFSET]-1),isFullySelected=next!=self[END_CONTAINER];if(next==root)return _traverseNode(next,isFullySelected,FALSE,how);for(clonedParent=_traverseNode(parent=next.parentNode,FALSE,FALSE,how);parent;){for(;next;)prevSibling=next.previousSibling,clonedChild=_traverseNode(next,isFullySelected,FALSE,how),how!=DELETE&&clonedParent.insertBefore(clonedChild,clonedParent.firstChild),isFullySelected=TRUE,next=prevSibling;if(parent==root)return clonedParent;next=parent.previousSibling,clonedGrandParent=_traverseNode(parent=parent.parentNode,FALSE,FALSE,how),how!=DELETE&&clonedGrandParent.appendChild(clonedParent),clonedParent=clonedGrandParent}}function _traverseLeftBoundary(root,how){var parent,clonedParent,nextSibling,clonedChild,clonedGrandParent,next=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),isFullySelected=next!=self[START_CONTAINER];if(next==root)return _traverseNode(next,isFullySelected,TRUE,how);for(clonedParent=_traverseNode(parent=next.parentNode,FALSE,TRUE,how);parent;){for(;next;)nextSibling=next.nextSibling,clonedChild=_traverseNode(next,isFullySelected,TRUE,how),how!=DELETE&&clonedParent.appendChild(clonedChild),isFullySelected=TRUE,next=nextSibling;if(parent==root)return clonedParent;next=parent.nextSibling,clonedGrandParent=_traverseNode(parent=parent.parentNode,FALSE,TRUE,how),how!=DELETE&&clonedGrandParent.appendChild(clonedParent),clonedParent=clonedGrandParent}}function _traverseNode(n,isFullySelected,isLeft,how){var txtValue,newNodeValue,oldNodeValue,offset,newNode;return isFullySelected?_traverseFullySelected(n,how):3!=n.nodeType?how!=DELETE?dom.clone(n,FALSE):void 0:(txtValue=n.nodeValue,oldNodeValue=isLeft?(offset=self[START_OFFSET],newNodeValue=txtValue.substring(offset),txtValue.substring(0,offset)):(offset=self[END_OFFSET],newNodeValue=txtValue.substring(0,offset),txtValue.substring(offset)),how!=CLONE&&(n.nodeValue=oldNodeValue),how!=DELETE?((newNode=dom.clone(n,FALSE)).nodeValue=newNodeValue,newNode):void 0)}function _traverseFullySelected(n,how){if(how!=DELETE)return how==CLONE?dom.clone(n,TRUE):n;n.parentNode.removeChild(n)}return extend(self,{startContainer:doc,startOffset:0,endContainer:doc,endOffset:0,collapsed:TRUE,commonAncestorContainer:doc,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:setStart,setEnd:setEnd,setStartBefore:setStartBefore,setStartAfter:function setStartAfter(n){setStart(n.parentNode,nodeIndex(n)+1)},setEndBefore:function setEndBefore(n){setEnd(n.parentNode,nodeIndex(n))},setEndAfter:setEndAfter,collapse:function collapse(ts){ts?(self[END_CONTAINER]=self[START_CONTAINER],self[END_OFFSET]=self[START_OFFSET]):(self[START_CONTAINER]=self[END_CONTAINER],self[START_OFFSET]=self[END_OFFSET]),self.collapsed=TRUE},selectNode:function selectNode(n){setStartBefore(n),setEndAfter(n)},selectNodeContents:function selectNodeContents(n){setStart(n,0),setEnd(n,1===n.nodeType?n.childNodes.length:n.nodeValue.length)},compareBoundaryPoints:function compareBoundaryPoints(h,r){var sc=self[START_CONTAINER],so=self[START_OFFSET],ec=self[END_CONTAINER],eo=self[END_OFFSET],rsc=r.startContainer,rso=r.startOffset,rec=r.endContainer,reo=r.endOffset;return 0===h?_compareBoundaryPoints(sc,so,rsc,rso):1===h?_compareBoundaryPoints(ec,eo,rsc,rso):2===h?_compareBoundaryPoints(ec,eo,rec,reo):3===h?_compareBoundaryPoints(sc,so,rec,reo):void 0},deleteContents:function deleteContents(){_traverse(DELETE)},extractContents:function extractContents(){return _traverse(EXTRACT)},cloneContents:cloneContents,insertNode:function insertNode(n){var nn,o,startContainer=this[START_CONTAINER],startOffset=this[START_OFFSET];3!==startContainer.nodeType&&4!==startContainer.nodeType||!startContainer.nodeValue?(0<startContainer.childNodes.length&&(o=startContainer.childNodes[startOffset]),o?startContainer.insertBefore(n,o):3==startContainer.nodeType?dom.insertAfter(n,startContainer):startContainer.appendChild(n)):startOffset?startOffset>=startContainer.nodeValue.length?dom.insertAfter(n,startContainer):(nn=startContainer.splitText(startOffset),startContainer.parentNode.insertBefore(n,nn)):startContainer.parentNode.insertBefore(n,startContainer)},surroundContents:function surroundContents(n){var f=self.extractContents();self.insertNode(n),n.appendChild(f),self.selectNode(n)},cloneRange:function cloneRange(){return extend(new Range(dom),{startContainer:self[START_CONTAINER],startOffset:self[START_OFFSET],endContainer:self[END_CONTAINER],endOffset:self[END_OFFSET],collapsed:self.collapsed,commonAncestorContainer:self.commonAncestorContainer})},toStringIE:function toStringIE(){return dom.create("body",null,cloneContents()).outerText}}),self}return Range.prototype.toString=function(){return this.toStringIE()},Range}),defineGlobal("global!Array",Array),defineGlobal("global!Error",Error),define("ephox.katamari.api.Fun",["global!Array","global!Error"],function(Array,Error){var constant=function(value){return function(){return value}};return{noop:function(){},compose:function(fa,fb){return function(){return fa(fb.apply(null,arguments))}},constant:constant,identity:function(x){return x},tripleEquals:function(a,b){return a===b},curry:function(f){for(var args=new Array(arguments.length-1),i=1;i<arguments.length;i++)args[i-1]=arguments[i];return function(){for(var newArgs=new Array(arguments.length),j=0;j<newArgs.length;j++)newArgs[j]=arguments[j];var all=args.concat(newArgs);return f.apply(null,all)}},not:function(f){return function(){return!f.apply(null,arguments)}},die:function(msg){return function(){throw new Error(msg)}},apply:function(f){return f()},call:function(f){f()},never:constant(!1),always:constant(!0)}}),defineGlobal("global!Object",Object),define("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(Fun,Object){var eq,call,id,me,never=Fun.never,always=Fun.always,none=function(){return NONE},NONE=(me={fold:function(n,s){return n()},is:never,isSome:never,isNone:always,getOr:id=function(n){return n},getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},or:id,orThunk:call,map:none,ap:none,each:function(){},bind:none,flatten:none,exists:never,forall:always,filter:none,equals:eq=function(o){return o.isNone()},equals_:eq,toArray:function(){return[]},toString:Fun.constant("none()")},Object.freeze&&Object.freeze(me),me),some=function(a){var constant_a=function(){return a},self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},is:function(v){return a===v},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},ap:function(optfab){return optfab.fold(none,function(fab){return some(fab(a))})},each:function(f){f(a)},bind:bind,flatten:constant_a,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},equals:function(o){return o.is(a)},equals_:function(o,elementEq){return o.fold(never,function(b){return elementEq(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me};return{some:some,none:none,from:function(value){return null===value||value===undefined?NONE:some(value)}}}),defineGlobal("global!String",String),define("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(Option,Array,Error,String){var pIndexOf,rawIndexOf=(pIndexOf=Array.prototype.indexOf)===undefined?function(xs,x){return slowIndexOf(xs,x)}:function(xs,x){return pIndexOf.call(xs,x)},contains=function(xs,x){return-1<rawIndexOf(xs,x)},map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i,xs)}return r},each=function(xs,f){for(var i=0,len=xs.length;i<len;i++){f(xs[i],i,xs)}},eachr=function(xs,f){for(var i=xs.length-1;0<=i;i--){f(xs[i],i,xs)}},filter=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i,xs)&&r.push(x)}return r},findIndex=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){if(pred(xs[i],i,xs))return Option.some(i)}return Option.none()},slowIndexOf=function(xs,x){for(var i=0,len=xs.length;i<len;++i)if(xs[i]===x)return i;return-1},push=Array.prototype.push,flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!Array.prototype.isPrototypeOf(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);push.apply(r,xs[i])}return r},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){if(!0!==pred(xs[i],i,xs))return!1}return!0},slice=Array.prototype.slice;return{map:map,each:each,eachr:eachr,partition:function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i,xs)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter:filter,groupBy:function(xs,f){if(0===xs.length)return[];for(var wasType=f(xs[0]),r=[],group=[],i=0,len=xs.length;i<len;i++){var x=xs[i],type=f(x);type!==wasType&&(r.push(group),group=[]),wasType=type,group.push(x)}return 0!==group.length&&r.push(group),r},indexOf:function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Option.none():Option.some(r)},foldr:function(xs,f,acc){return eachr(xs,function(x){acc=f(acc,x)}),acc},foldl:function(xs,f,acc){return each(xs,function(x){acc=f(acc,x)}),acc},find:function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i,xs))return Option.some(x)}return Option.none()},findIndex:findIndex,flatten:flatten,bind:function(xs,f){var output=map(xs,f);return flatten(output)},forall:forall,exists:function(xs,pred){return findIndex(xs,pred).isSome()},contains:contains,equal:function(a1,a2){return a1.length===a2.length&&forall(a1,function(x,i){return x===a2[i]})},reverse:function(xs){var r=slice.call(xs,0);return r.reverse(),r},chunk:function(array,size){for(var r=[],i=0;i<array.length;i+=size){var s=array.slice(i,i+size);r.push(s)}return r},difference:function(a1,a2){return filter(a1,function(x){return!contains(a2,x)})},mapToObject:function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},pure:function(x){return[x]},sort:function(xs,comparator){var copy=slice.call(xs,0);return copy.sort(comparator),copy},range:function(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r}}}),defineGlobal("global!setTimeout",setTimeout),define("ephox.katamari.api.LazyValue",["ephox.katamari.api.Arr","ephox.katamari.api.Option","global!setTimeout"],function(Arr,Option,setTimeout){var nu=function(baseFn){var data=Option.none(),callbacks=[],get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},isReady=function(){return data.isSome()},run=function(cbs){Arr.each(cbs,call)},call=function(cb){data.each(function(x){setTimeout(function(){cb(x)},0)})};return baseFn(function(x){data=Option.some(x),run(callbacks),callbacks=[]}),{get:get,map:function(f){return nu(function(nCallback){get(function(data){nCallback(f(data))})})},isReady:isReady}};return{nu:nu,pure:function(a){return nu(function(callback){callback(a)})}}}),define("ephox.katamari.async.Bounce",["global!Array","global!setTimeout"],function(Array,setTimeout){return{bounce:function(f){return function(){var args=Array.prototype.slice.call(arguments),me=this;setTimeout(function(){f.apply(me,args)},0)}}}}),define("ephox.katamari.api.Future",["ephox.katamari.api.LazyValue","ephox.katamari.async.Bounce"],function(LazyValue,Bounce){var nu=function(baseFn){var get=function(callback){baseFn(Bounce.bounce(callback))};return{map:function(fab){return nu(function(callback){get(function(a){var value=fab(a);callback(value)})})},bind:function(aFutureB){return nu(function(callback){get(function(a){aFutureB(a).get(callback)})})},anonBind:function(futureB){return nu(function(callback){get(function(a){futureB.get(callback)})})},toLazy:function(){return LazyValue.nu(get)},get:get}};return{nu:nu,pure:function(a){return nu(function(callback){callback(a)})}}}),define("ephox.katamari.async.AsyncValues",["ephox.katamari.api.Arr"],function(Arr){return{par:function(asyncValues,nu){return nu(function(callback){var r=[],count=0;0===asyncValues.length?callback([]):Arr.each(asyncValues,function(asyncValue,i){asyncValue.get(function(i){return function(value){r[i]=value,++count>=asyncValues.length&&callback(r)}}(i))})})}}}),define("ephox.katamari.api.Futures",["ephox.katamari.api.Arr","ephox.katamari.api.Future","ephox.katamari.async.AsyncValues"],function(Arr,Future,AsyncValues){var par=function(futures){return AsyncValues.par(futures,Future.nu)};return{par:par,mapM:function(array,fn){var futures=Arr.map(array,fn);return par(futures)},compose:function(f,g){return function(a){return g(a).bind(f)}}}}),define("ephox.katamari.api.Result",["ephox.katamari.api.Fun","ephox.katamari.api.Option"],function(Fun,Option){var value=function(o){return{is:function(v){return o===v},isValue:Fun.constant(!0),isError:Fun.constant(!1),getOr:Fun.constant(o),getOrThunk:Fun.constant(o),getOrDie:Fun.constant(o),or:function(opt){return value(o)},orThunk:function(f){return value(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value(f(o))},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOption:function(){return Option.some(o)}}},error=function(message){return{is:Fun.constant(!1),isValue:Fun.constant(!1),isError:Fun.constant(!0),getOr:Fun.identity,getOrThunk:function(f){return f()},getOrDie:function(){return Fun.die(message)()},or:function(opt){return opt},orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(f){return error(message)},each:Fun.noop,bind:function(f){return error(message)},exists:Fun.constant(!1),forall:Fun.constant(!0),toOption:Option.none}};return{value:value,error:error}}),define("tinymce.core.dom.StyleSheetLoader",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Future","ephox.katamari.api.Futures","ephox.katamari.api.Result","tinymce.core.util.Delay","tinymce.core.util.Tools"],function(Arr,Fun,Future,Futures,Result,Delay,Tools){"use strict";return function(document,settings){var maxLoadTime,idCount=0,loadedStates={};function appendToHead(node){document.getElementsByTagName("head")[0].appendChild(node)}function load(url,loadedCallback,errorCallback){var link,style,startTime,state;function passed(){for(var callbacks=state.passed,i=callbacks.length;i--;)callbacks[i]();state.status=2,state.passed=[],state.failed=[]}function failed(){for(var callbacks=state.failed,i=callbacks.length;i--;)callbacks[i]();state.status=3,state.passed=[],state.failed=[]}function wait(testCallback,waitCallback){testCallback()||((new Date).getTime()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())}function waitForWebKitLinkLoaded(){wait(function(){for(var styleSheet,owner,styleSheets=document.styleSheets,i=styleSheets.length;i--;)if((owner=(styleSheet=styleSheets[i]).ownerNode?styleSheet.ownerNode:styleSheet.owningElement)&&owner.id===link.id)return passed(),!0},waitForWebKitLinkLoaded)}if(url=Tools._addCacheSuffix(url),loadedStates[url]?state=loadedStates[url]:(state={passed:[],failed:[]},loadedStates[url]=state),loadedCallback&&state.passed.push(loadedCallback),errorCallback&&state.failed.push(errorCallback),1!=state.status)if(2!=state.status)if(3!=state.status){if(state.status=1,(link=document.createElement("link")).rel="stylesheet",link.type="text/css",link.id="u"+idCount++,link.async=!1,link.defer=!1,startTime=(new Date).getTime(),"onload"in link&&!function isOldWebKit(){var webKitChunks=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(webKitChunks&&webKitChunks[1]<536)}())link.onload=waitForWebKitLinkLoaded,link.onerror=failed;else{if(0<navigator.userAgent.indexOf("Firefox"))return(style=document.createElement("style")).textContent='@import "'+url+'"',function waitForGeckoLinkLoaded(){wait(function(){try{var cssRules=style.sheet.cssRules;return passed(),!!cssRules}catch(ex){}},waitForGeckoLinkLoaded)}(),void appendToHead(style);waitForWebKitLinkLoaded()}appendToHead(link),link.href=url}else failed();else passed()}maxLoadTime=(settings=settings||{}).maxLoadTime||5e3;var loadF=function(url){return Future.nu(function(resolve){load(url,Fun.compose(resolve,Fun.constant(Result.value(url))),Fun.compose(resolve,Fun.constant(Result.error(url))))})},unbox=function(result){return result.fold(Fun.identity,Fun.identity)};return{load:load,loadAll:function(urls,success,failure){Futures.par(Arr.map(urls,loadF)).get(function(result){var parts=Arr.partition(result,function(r){return r.isValue()});0<parts.fail.length?failure(parts.fail.map(unbox)):success(parts.pass.map(unbox))})}}}}),define("tinymce.core.html.Schema",["tinymce.core.util.Tools"],function(Tools){var mapCache={},dummyObj={},makeMap=Tools.makeMap,each=Tools.each,extend=Tools.extend,explode=Tools.explode,inArray=Tools.inArray;function split(items,delim){return(items=Tools.trim(items))?items.split(delim||" "):[]}function compileElementMap(value,mode){var styles;return value&&(styles={},"string"==typeof value&&(value={"*":value}),each(value,function(value,key){styles[key]=styles[key.toUpperCase()]="map"==mode?makeMap(value,/[, ]/):explode(value,/[, ]/)})),styles}return function(settings){var validStyles,invalidStyles,schemaItems,whiteSpaceElementsMap,selfClosingElementsMap,shortEndedElementsMap,boolAttrMap,validClasses,blockElementsMap,nonEmptyElementsMap,moveCaretBeforeOnEnterElementsMap,textBlockElementsMap,textInlineElementsMap,elements={},children={},patternElements=[],customElementsMap={},specialElements={};function createLookupTable(option,defaultValue,extendWith){var value=settings[option];return value?value=makeMap(value,/[, ]/,makeMap(value.toUpperCase(),/[, ]/)):(value=mapCache[option])||(value=makeMap(defaultValue," ",makeMap(defaultValue.toUpperCase()," ")),value=extend(value,extendWith),mapCache[option]=value),value}function patternToRegExp(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")}function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,key,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,attrRuleRegExp=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements)for(validElements=split(validElements,","),elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElements.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElements[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],element={attributes:attributes={},attributesOrder:attributesOrder=[]},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes){for(key in globalAttributes)attributes[key]=globalAttributes[key];attributesOrder.push.apply(attributesOrder,globalAttributesOrder)}if(attrData)for(ai=0,al=(attrData=split(attrData,"|")).length;ai<al;ai++)if(matches=attrRuleRegExp.exec(attrData[ai])){if(attr={},attrType=matches[1],attrName=matches[2].replace(/::/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType){delete attributes[attrName],attributesOrder.splice(inArray(attributesOrder,attrName),1);continue}prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value:value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value:value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)}globalAttributes||"@"!=elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}function setValidElements(validElements){elements={},patternElements=[],addValidElements(validElements),each(schemaItems,function(element,name){children[name]=element.children})}function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each(split(customElements,","),function(rule){var matches=customElementRegExp.exec(rule),inline="~"===matches[1],cloneName=inline?"span":"div",name=matches[2];if(children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){var customRule=elements[cloneName];delete(customRule=extend({},customRule)).removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each(children,function(element,elmName){element[cloneName]&&(children[elmName]=element=extend({},children[elmName]),element[name]=element[cloneName])})}))}function addValidChildren(validChildren){var childRuleRegExp=/^([+\-]?)(\w+)\[([^\]]+)\]$/;mapCache[settings.schema]=null,validChildren&&each(split(validChildren,","),function(rule){var parent,prefix,matches=childRuleRegExp.exec(rule);matches&&(prefix=matches[1],parent=prefix?children[matches[2]]:children[matches[2]]={"#comment":{}},parent=children[matches[2]],each(split(matches[3],"|"),function(child){"-"===prefix?delete parent[child]:parent[child]={}}))})}function getElementRule(name){var i,element=elements[name];if(element)return element;for(i=patternElements.length;i--;)if((element=patternElements[i]).pattern.test(name))return element}schemaItems=function compileSchema(type){var globalAttributes,blockContent,phrasingContent,flowContent,html4BlockContent,html4PhrasingContent,schema={};function add(name,attributes,children){var ni,attributesOrder,element;function arrayToMap(array,obj){var i,l,map={};for(i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map}for(attributes=attributes||"","string"==typeof(children=children||[])&&(children=split(children)),ni=(name=split(name)).length;ni--;)element={attributes:arrayToMap(attributesOrder=split([globalAttributes,attributes].join(" "))),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)},schema[name[ni]]=element}function addAttrs(name,attributes){var ni,schemaItem,i,l;for(ni=(name=split(name)).length,attributes=split(attributes);ni--;)for(schemaItem=schema[name[ni]],i=0,l=attributes.length;i<l;i++)schemaItem.attributes[attributes[i]]={},schemaItem.attributesOrder.push(attributes[i])}return mapCache[type]?mapCache[type]:(globalAttributes="id accesskey class dir lang style tabindex title role",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!=type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure header footer hgroup section nav",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!=type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,html4PhrasingContent="acronym applet basefont big font strike tt"].join(" "),each(split(html4PhrasingContent),function(name){add(name,"",phrasingContent)}),blockContent=[blockContent,html4BlockContent="center dir isindex noframes"].join(" "),flowContent=[blockContent,phrasingContent].join(" "),each(split(html4BlockContent),function(name){add(name,"",flowContent)})),flowContent=flowContent||[blockContent,phrasingContent].join(" "),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"==type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"==type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!=type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!=type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select","onchange"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!=type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("iframe","sandbox seamless allowfullscreen")),each(split("a form meter progress dfn"),function(name){schema[name]&&delete schema[name].children[name]}),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema)}((settings=settings||{}).schema),!1===settings.verify_html&&(settings.valid_elements="*[*]"),validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script pre code",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","table",nonEmptyElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),each((settings.special||"script noscript style textarea").split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}),settings.valid_elements?setValidElements(settings.valid_elements):(each(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children}),"html5"!=settings.schema&&each(split("strong/b em/i"),function(item){item=split(item,"/"),elements[item[1]].outputName=item[0]}),each(split("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(name){elements[name]&&(elements[name].removeEmpty=!0)}),each(split("p h1 h2 h3 h4 h5 h6 th td pre div address caption"),function(name){elements[name].paddEmpty=!0}),each(split("span"),function(name){elements[name].removeEmptyAttrs=!0})),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},function(parents,item){elements[item]&&(elements[item].parentsRequired=split(parents))}),settings.invalid_elements&&each(explode(settings.invalid_elements),function(item){elements[item]&&delete elements[item]}),getElementRule("span")||addValidElements("span[!data-mce-type|*]"),this.children=children,this.getValidStyles=function(){return validStyles},this.getInvalidStyles=function(){return invalidStyles},this.getValidClasses=function(){return validClasses},this.getBoolAttrs=function(){return boolAttrMap},this.getBlockElements=function(){return blockElementsMap},this.getTextBlockElements=function(){return textBlockElementsMap},this.getTextInlineElements=function(){return textInlineElementsMap},this.getShortEndedElements=function(){return shortEndedElementsMap},this.getSelfClosingElements=function(){return selfClosingElementsMap},this.getNonEmptyElements=function(){return nonEmptyElementsMap},this.getMoveCaretBeforeOnEnterElements=function(){return moveCaretBeforeOnEnterElementsMap},this.getWhiteSpaceElements=function(){return whiteSpaceElementsMap},this.getSpecialElements=function(){return specialElements},this.isValidChild=function(name,child){var parent=children[name.toLowerCase()];return!(!parent||!parent[child.toLowerCase()])},this.isValid=function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},this.getElementRule=getElementRule,this.getCustomElements=function(){return customElementsMap},this.addValidElements=addValidElements,this.setValidElements=setValidElements,this.addCustomElements=addCustomElements,this.addValidChildren=addValidChildren,this.elements=elements}}),define("tinymce.core.dom.DOMUtils",["tinymce.core.dom.DomQuery","tinymce.core.dom.EventUtils","tinymce.core.dom.Range","tinymce.core.dom.Sizzle","tinymce.core.dom.StyleSheetLoader","tinymce.core.dom.TreeWalker","tinymce.core.Env","tinymce.core.html.Entities","tinymce.core.html.Schema","tinymce.core.html.Styles","tinymce.core.util.Tools"],function(DomQuery,EventUtils,Range,Sizzle,StyleSheetLoader,TreeWalker,Env,Entities,Schema,Styles,Tools){var each=Tools.each,is=Tools.is,grep=Tools.grep,trim=Tools.trim,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,whiteSpaceRegExp=/^[ \t\r\n]*$/;function updateInternalStyleAttr(domUtils,$elm){var value=$elm.attr("style");value=(value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName))||null,$elm.attr("data-mce-style",value)}function nodeIndex(node,normalized){var lastNodeType,nodeType,idx=0;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!=nodeType||nodeType!=lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx}function DOMUtils(doc,settings){var blockElementsMap,self=this;self.doc=doc,self.win=window,self.files={},self.counter=0,self.stdMode=!isIE||8<=doc.documentMode,self.boxModel=!isIE||"CSS1Compat"==doc.compatMode||self.stdMode,self.styleSheetLoader=new StyleSheetLoader(doc),self.boundEvents=[],self.settings=settings=settings||{},self.schema=settings.schema?settings.schema:new Schema({}),self.styles=new Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),self.fixDoc(doc),self.events=settings.ownEvents?new EventUtils(settings.proxy):EventUtils.Event,self.attrHooks=function setupAttrHooks(domUtils,settings){var keepUrlHook,attrHooks={},keepValues=settings.keep_values;return keepUrlHook={set:function($elm,value,name){settings.url_converter&&(value=settings.url_converter.call(settings.url_converter_scope||domUtils,value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}},attrHooks={style:{set:function($elm,value){null===value||"object"!=typeof value?(keepValues&&$elm.attr("data-mce-style",value),$elm.attr("style",value)):$elm.css(value)},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName)}}},keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks}(self,settings),blockElementsMap=settings.schema?settings.schema.getBlockElements():{},self.$=DomQuery.overrideDefaults(function(){return{context:doc,element:self.getRoot()}}),self.isBlock=function(node){if(!node)return!1;var type=node.nodeType;return type?!(1!==type||!blockElementsMap[node.nodeName]):!!blockElementsMap[node]}}return DOMUtils.prototype={$$:function(elm){return"string"==typeof elm&&(elm=this.get(elm)),this.$(elm)},root:null,fixDoc:function(doc){var name,settings=this.settings;if(isIE&&settings.schema)for(name in"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(name){doc.createElement(name)}),settings.schema.getCustomElements())doc.createElement(name)},clone:function(node,deep){var clone,doc,self=this;return!isIE||1!==node.nodeType||deep?node.cloneNode(deep):(doc=self.doc,deep?clone.firstChild:(clone=doc.createElement(node.nodeName),each(self.getAttribs(node),function(attr){self.setAttrib(clone,attr.nodeName,self.getAttrib(node,attr.nodeName))}),clone))},getRoot:function(){return this.settings.root_element||this.doc.body},getViewPort:function(win){var doc,rootElm;return doc=(win=win||this.win).document,rootElm=this.boxModel?doc.documentElement:doc.body,{x:win.pageXOffset||rootElm.scrollLeft,y:win.pageYOffset||rootElm.scrollTop,w:win.innerWidth||rootElm.clientWidth,h:win.innerHeight||rootElm.clientHeight}},getRect:function(elm){var pos,size;return elm=this.get(elm),pos=this.getPos(elm),size=this.getSize(elm),{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize:function(elm){var w,h;return elm=this.get(elm),w=this.getStyle(elm,"width"),h=this.getStyle(elm,"height"),-1===w.indexOf("px")&&(w=0),-1===h.indexOf("px")&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},getParent:function(node,selector,root){return this.getParents(node,selector,root,!1)},getParents:function(node,selector,root,collect){var selectorVal,self=this,result=[];for(node=self.get(node),collect=collect===undefined,root=root||("BODY"!=self.getRoot().nodeName?self.getRoot().parentNode:null),is(selector,"string")&&(selector="*"===(selectorVal=selector)?function(node){return 1==node.nodeType}:function(node){return self.is(node,selectorVal)});node&&node!=root&&node.nodeType&&9!==node.nodeType;){if(!selector||selector(node)){if(!collect)return node;result.push(node)}node=node.parentNode}return collect?result:null},get:function(elm){var name;return elm&&this.doc&&"string"==typeof elm&&(name=elm,(elm=this.doc.getElementById(elm))&&elm.id!==name)?this.doc.getElementsByName(name)[1]:elm},getNext:function(node,selector){return this._findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return this._findSib(node,selector,"previousSibling")},select:function(selector,scope){return Sizzle(selector,this.get(scope)||this.settings.root_element||this.doc,[])},is:function(elm,selector){var i;if(!elm)return!1;if(elm.length===undefined){if("*"===selector)return 1==elm.nodeType;if(simpleSelectorRe.test(selector)){for(selector=selector.toLowerCase().split(/,/),elm=elm.nodeName.toLowerCase(),i=selector.length-1;0<=i;i--)if(selector[i]==elm)return!0;return!1}}if(elm.nodeType&&1!=elm.nodeType)return!1;var elms=elm.nodeType?[elm]:elm;return 0<Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length},add:function(parentElm,name,attrs,html,create){var self=this;return this.run(parentElm,function(parentElm){var newElm;return newElm=is(name,"string")?self.doc.createElement(name):name,self.setAttribs(newElm,attrs),html&&(html.nodeType?newElm.appendChild(html):self.setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)})},create:function(name,attrs,html){return this.add(this.doc.createElement(name),name,attrs,html,1)},createHTML:function(name,attrs,html){var key,outHtml="";for(key in outHtml+="<"+name,attrs)attrs.hasOwnProperty(key)&&null!==attrs[key]&&"undefined"!=typeof attrs[key]&&(outHtml+=" "+key+'="'+this.encode(attrs[key])+'"');return void 0!==html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:function(html){var frag,node,container,doc=this.doc;for(container=doc.createElement("div"),frag=doc.createDocumentFragment(),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag},remove:function(node,keepChildren){return node=this.$$(node),keepChildren?node.each(function(){for(var child;child=this.firstChild;)3==child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)}).remove():node.remove(),1<node.length?node.toArray():node[0]},setStyle:function(elm,name,value){elm=this.$$(elm).css(name,value),this.settings.update_styles&&updateInternalStyleAttr(this,elm)},getStyle:function(elm,name,computed){return elm=this.$$(elm),computed?elm.css(name):("float"==(name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}))&&(name=Env.ie&&Env.ie<12?"styleFloat":"cssFloat"),elm[0]&&elm[0].style?elm[0].style[name]:undefined)},setStyles:function(elm,styles){elm=this.$$(elm).css(styles),this.settings.update_styles&&updateInternalStyleAttr(this,elm)},removeAllAttribs:function(e){return this.run(e,function(e){var i,attrs=e.attributes;for(i=attrs.length-1;0<=i;i--)e.removeAttributeNode(attrs.item(i))})},setAttrib:function(elm,name,value){var originalValue,hook,settings=this.settings;""===value&&(value=null),originalValue=(elm=this.$$(elm)).attr(name),elm.length&&((hook=this.attrHooks[name])&&hook.set?hook.set(elm,value,name):elm.attr(name,value),originalValue!=value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value}))},setAttribs:function(elm,attrs){var self=this;self.$$(elm).each(function(i,node){each(attrs,function(value,name){self.setAttrib(node,name,value)})})},getAttrib:function(elm,name,defaultVal){var hook,value;return(elm=this.$$(elm)).length&&(value=(hook=this.attrHooks[name])&&hook.get?hook.get(elm,name):elm.attr(name)),void 0===value&&(value=defaultVal||""),value},getPos:function(elm,rootElm){var offsetParent,pos,x=0,y=0,doc=this.doc,body=doc.body;if(rootElm=rootElm||body,elm=this.get(elm)){if(rootElm===body&&elm.getBoundingClientRect&&"static"===DomQuery(body).css("position"))return pos=elm.getBoundingClientRect(),rootElm=this.boxModel?doc.documentElement:body,{x:x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-rootElm.clientLeft,y:y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-rootElm.clientTop};for(offsetParent=elm;offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType;)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;for(offsetParent=elm.parentNode;offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType;)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode}return{x:x,y:y}},parseStyle:function(cssText){return this.styles.parse(cssText)},serializeStyle:function(styles,name){return this.styles.serialize(styles,name)},addStyle:function(cssText){var head,styleElm,doc=this.doc;if(this!==DOMUtils.DOM&&doc===document){var addedStyles=DOMUtils.DOM.addedStyles;if((addedStyles=addedStyles||[])[cssText])return;addedStyles[cssText]=!0,DOMUtils.DOM.addedStyles=addedStyles}(styleElm=doc.getElementById("mceDefaultStyles"))||((styleElm=doc.createElement("style")).id="mceDefaultStyles",styleElm.type="text/css",(head=doc.getElementsByTagName("head")[0]).firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:function(url){var head,self=this,doc=self.doc;self===DOMUtils.DOM||doc!==document?(url=url||"",head=doc.getElementsByTagName("head")[0],each(url.split(","),function(url){var link;url=Tools._addCacheSuffix(url),self.files[url]||(self.files[url]=!0,link=self.create("link",{rel:"stylesheet",href:url}),isIE&&doc.documentMode&&doc.recalc&&(link.onload=function(){doc.recalc&&doc.recalc(),link.onload=null}),head.appendChild(link))})):DOMUtils.DOM.loadCSS(url)},addClass:function(elm,cls){this.$$(elm).addClass(cls)},removeClass:function(elm,cls){this.toggleClass(elm,cls,!1)},hasClass:function(elm,cls){return this.$$(elm).hasClass(cls)},toggleClass:function(elm,cls,state){this.$$(elm).toggleClass(cls,state).each(function(){""===this.className&&DomQuery(this).attr("class",null)})},show:function(elm){this.$$(elm).show()},hide:function(elm){this.$$(elm).hide()},isHidden:function(elm){return"none"==this.$$(elm).css("display")},uniqueId:function(prefix){return(prefix||"mce_")+this.counter++},setHTML:function(elm,html){elm=this.$$(elm),isIE?elm.each(function(i,target){if(!1!==target.canHaveHTML){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){DomQuery("<div></div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}}):elm.html(html)},getOuterHTML:function(elm){return 1==(elm=this.get(elm)).nodeType&&"outerHTML"in elm?elm.outerHTML:DomQuery("<div></div>").append(DomQuery(elm).clone()).html()},setOuterHTML:function(elm,html){var self=this;self.$$(elm).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}self.remove(DomQuery(this).html(html),!0)})},decode:Entities.decode,encode:Entities.encodeAllRaw,insertAfter:function(node,referenceNode){return referenceNode=this.get(referenceNode),this.run(node,function(node){var parent,nextSibling;return parent=referenceNode.parentNode,(nextSibling=referenceNode.nextSibling)?parent.insertBefore(node,nextSibling):parent.appendChild(node),node})},replace:function(newElm,oldElm,keepChildren){return this.run(oldElm,function(oldElm){return is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each(grep(oldElm.childNodes),function(node){newElm.appendChild(node)}),oldElm.parentNode.replaceChild(newElm,oldElm)})},rename:function(elm,name){var newElm,self=this;return elm.nodeName!=name.toUpperCase()&&(newElm=self.create(name),each(self.getAttribs(elm),function(attrNode){self.setAttrib(newElm,attrNode.nodeName,self.getAttrib(elm,attrNode.nodeName))}),self.replace(newElm,elm,1)),newElm||elm},findCommonAncestor:function(a,b){for(var pe,ps=a;ps;){for(pe=b;pe&&ps!=pe;)pe=pe.parentNode;if(ps==pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:function(rgbVal){return this.styles.toHex(Tools.trim(rgbVal))},run:function(elm,func,scope){var result,self=this;return"string"==typeof elm&&(elm=self.get(elm)),!!elm&&(scope=scope||this,elm.nodeType||!elm.length&&0!==elm.length?func.call(scope,elm):(result=[],each(elm,function(elm,i){elm&&("string"==typeof elm&&(elm=self.get(elm)),result.push(func.call(scope,elm,i)))}),result))},getAttribs:function(elm){var attrs;if(!(elm=this.get(elm)))return[];if(isIE){if(attrs=[],"OBJECT"==elm.nodeName)return elm.attributes;"OPTION"===elm.nodeName&&this.getAttrib(elm,"selected")&&attrs.push({specified:1,nodeName:"selected"});return elm.cloneNode(!1).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(a){attrs.push({specified:1,nodeName:a})}),attrs}return elm.attributes},isEmpty:function(node,elements){var i,attributes,type,whitespace,walker,name,brCount=0;if(node=node.firstChild){walker=new TreeWalker(node,node.parentNode),elements=elements||(this.schema?this.schema.getNonEmptyElements():null),whitespace=this.schema?this.schema.getWhiteSpaceElements():{};do{if(1===(type=node.nodeType)){var bogusVal=node.getAttribute("data-mce-bogus");if(bogusVal){node=walker.next("all"===bogusVal);continue}if(name=node.nodeName.toLowerCase(),elements&&elements[name]){if("br"!==name)return!1;brCount++,node=walker.next();continue}for(i=(attributes=this.getAttribs(node)).length;i--;)if("name"===(name=attributes[i].nodeName)||"data-mce-bookmark"===name)return!1}if(8==type)return!1;if(3===type&&!whiteSpaceRegExp.test(node.nodeValue))return!1;if(3===type&&node.parentNode&&whitespace[node.parentNode.nodeName]&&whiteSpaceRegExp.test(node.nodeValue))return!1;node=walker.next()}while(node)}return brCount<=1},createRng:function(){var doc=this.doc;return doc.createRange?doc.createRange():new Range(this)},nodeIndex:nodeIndex,split:function(parentElm,splitElm,replacementElm){var bef,aft,pa,self=this,r=self.createRng();function trimNode(node){var i,children=node.childNodes,type=node.nodeType;if(1!=type||"bookmark"!=node.getAttribute("data-mce-type")){for(i=children.length-1;0<=i;i--)trimNode(children[i]);if(9!=type){if(3==type&&0<node.nodeValue.length){var trimmedLength=trim(node.nodeValue).length;if(!self.isBlock(node.parentNode)||0<trimmedLength||0===trimmedLength&&function surroundedBySpans(node){var previousIsSpan=node.previousSibling&&"SPAN"==node.previousSibling.nodeName,nextIsSpan=node.nextSibling&&"SPAN"==node.nextSibling.nodeName;return previousIsSpan&&nextIsSpan}(node))return}else if(1==type&&(1==(children=node.childNodes).length&&children[0]&&1==children[0].nodeType&&"bookmark"==children[0].getAttribute("data-mce-type")&&node.parentNode.insertBefore(children[0],node),children.length||/^(br|hr|input|img)$/i.test(node.nodeName)))return;self.remove(node)}return node}}if(parentElm&&splitElm)return r.setStart(parentElm.parentNode,self.nodeIndex(parentElm)),r.setEnd(splitElm.parentNode,self.nodeIndex(splitElm)),bef=r.extractContents(),(r=self.createRng()).setStart(splitElm.parentNode,self.nodeIndex(splitElm)+1),r.setEnd(parentElm.parentNode,self.nodeIndex(parentElm)+1),aft=r.extractContents(),(pa=parentElm.parentNode).insertBefore(trimNode(bef),parentElm),replacementElm?pa.insertBefore(replacementElm,parentElm):pa.insertBefore(splitElm,parentElm),pa.insertBefore(trimNode(aft),parentElm),self.remove(parentElm),replacementElm||splitElm},bind:function(target,name,func,scope){if(Tools.isArray(target)){for(var i=target.length;i--;)target[i]=this.bind(target[i],name,func,scope);return target}return!this.settings.collect||target!==this.doc&&target!==this.win||this.boundEvents.push([target,name,func,scope]),this.events.bind(target,name,func,scope||this)},unbind:function(target,name,func){var i;if(Tools.isArray(target)){for(i=target.length;i--;)target[i]=this.unbind(target[i],name,func);return target}if(this.boundEvents&&(target===this.doc||target===this.win))for(i=this.boundEvents.length;i--;){var item=this.boundEvents[i];target!=item[0]||name&&name!=item[1]||func&&func!=item[2]||this.events.unbind(item[0],item[1],item[2])}return this.events.unbind(target,name,func)},fire:function(target,name,evt){return this.events.fire(target,name,evt)},getContentEditable:function(node){var contentEditable;return node&&1==node.nodeType?(contentEditable=node.getAttribute("data-mce-contenteditable"))&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null:null},getContentEditableParent:function(node){for(var root=this.getRoot(),state=null;node&&node!==root&&null===(state=this.getContentEditable(node));node=node.parentNode);return state},destroy:function(){if(this.boundEvents){for(var i=this.boundEvents.length;i--;){var item=this.boundEvents[i];this.events.unbind(item[0],item[1],item[2])}this.boundEvents=null}Sizzle.setDocument&&Sizzle.setDocument(),this.win=this.doc=this.root=this.events=this.frag=null},isChildOf:function(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset},_findSib:function(node,selector,name){var self=this,func=selector;if(node)for("string"==typeof func&&(func=function(node){return self.is(node,selector)}),node=node[name];node;node=node[name])if(func(node))return node;return null}},DOMUtils.DOM=new DOMUtils(document),DOMUtils.nodeIndex=nodeIndex,DOMUtils}),define("tinymce.core.dom.ScriptLoader",["tinymce.core.dom.DOMUtils","tinymce.core.util.Tools"],function(DOMUtils,Tools){var DOM=DOMUtils.DOM,each=Tools.each,grep=Tools.grep,isFunction=function(f){return"function"==typeof f};function ScriptLoader(){var states={},queue=[],scriptLoadedCallbacks={},queueLoadedCallbacks=[],loading=0;this.isDone=function(url){return 2==states[url]},this.markDone=function(url){states[url]=2},this.add=this.load=function(url,success,scope,failure){null==states[url]&&(queue.push(url),states[url]=0),success&&(scriptLoadedCallbacks[url]||(scriptLoadedCallbacks[url]=[]),scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this}))},this.remove=function(url){delete states[url],delete scriptLoadedCallbacks[url]},this.loadQueue=function(success,scope,failure){this.loadScripts(queue,success,scope,failure)},this.loadScripts=function(scripts,success,scope,failure){var loadScripts,failures=[];function execCallbacks(name,url){each(scriptLoadedCallbacks[url],function(callback){isFunction(callback[name])&&callback[name].call(callback.scope)}),scriptLoadedCallbacks[url]=void 0}queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this}),(loadScripts=function(){var loadingScripts=grep(scripts);scripts.length=0,each(loadingScripts,function(url){2!==states[url]?3!==states[url]?1!==states[url]&&(states[url]=1,loading++,function loadScript(url,success,failure){var elm,id,dom=DOM;function done(){dom.remove(id),elm&&(elm.onreadystatechange=elm.onload=elm=null),success()}id=dom.uniqueId(),(elm=document.createElement("script")).id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),"onreadystatechange"in elm?elm.onreadystatechange=function(){/loaded|complete/.test(elm.readyState)&&done()}:elm.onload=done,elm.onerror=function error(){isFunction(failure)?failure():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+url)},(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)}(url,function(){states[url]=2,loading--,execCallbacks("success",url),loadScripts()},function(){states[url]=3,loading--,failures.push(url),execCallbacks("failure",url),loadScripts()})):execCallbacks("failure",url):execCallbacks("success",url)}),loading||(each(queueLoadedCallbacks,function(callback){0===failures.length?isFunction(callback.success)&&callback.success.call(callback.scope):isFunction(callback.failure)&&callback.failure.call(callback.scope,failures)}),queueLoadedCallbacks.length=0)})()}}return ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}),define("tinymce.core.AddOnManager",["tinymce.core.dom.ScriptLoader","tinymce.core.util.Tools"],function(ScriptLoader,Tools){var each=Tools.each;function AddOnManager(){this.items=[],this.urls={},this.lookup={}}return AddOnManager.prototype={get:function(name){return this.lookup[name]?this.lookup[name].instance:undefined},dependencies:function(name){var result;return this.lookup[name]&&(result=this.lookup[name].dependencies),result||[]},requireLangPack:function(name,languages){var language=AddOnManager.language;if(language&&!1!==AddOnManager.languageLoad){if(languages)if(-1!=(languages=","+languages+",").indexOf(","+language.substr(0,2)+","))language=language.substr(0,2);else if(-1==languages.indexOf(","+language+","))return;ScriptLoader.ScriptLoader.add(this.urls[name]+"/langs/"+language+".js")}},add:function(id,addOn,dependencies){return this.items.push(addOn),this.lookup[id]={instance:addOn,dependencies:dependencies},addOn},remove:function(name){delete this.urls[name],delete this.lookup[name]},createUrl:function(baseUrl,dep){return"object"==typeof dep?dep:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},addComponents:function(pluginName,scripts){var pluginUrl=this.urls[pluginName];each(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)})},load:function(name,addOnUrl,success,scope,failure){var self=this,url=addOnUrl;function loadDependencies(){var dependencies=self.dependencies(name);each(dependencies,function(dep){var newUrl=self.createUrl(addOnUrl,dep);self.load(newUrl.resource,newUrl,undefined,undefined)}),success&&(scope?success.call(scope):success.call(ScriptLoader))}self.urls[name]||("object"==typeof addOnUrl&&(url=addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix),0!==url.indexOf("/")&&-1==url.indexOf("://")&&(url=AddOnManager.baseURL+"/"+url),self.urls[name]=url.substring(0,url.lastIndexOf("/")),self.lookup[name]?loadDependencies():ScriptLoader.ScriptLoader.add(url,loadDependencies,scope,failure))}},AddOnManager.PluginManager=new AddOnManager,AddOnManager.ThemeManager=new AddOnManager,AddOnManager}),define("tinymce.core.dom.NodeType",[],function(){function isNodeType(type){return function(node){return!!node&&node.nodeType==type}}var isElement=isNodeType(1);function matchNodeNames(names){return names=names.toLowerCase().split(" "),function(node){var i,name;if(node&&node.nodeType)for(name=node.nodeName.toLowerCase(),i=0;i<names.length;i++)if(name===names[i])return!0;return!1}}function hasContentEditableState(value){return function(node){if(isElement(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}}return{isText:isNodeType(3),isElement:isElement,isComment:isNodeType(8),isBr:matchNodeNames("br"),isContentEditableTrue:hasContentEditableState("true"),isContentEditableFalse:hasContentEditableState("false"),matchNodeNames:matchNodeNames,hasPropValue:function hasPropValue(propName,propValue){return function(node){return isElement(node)&&node[propName]===propValue}},hasAttribute:function hasAttribute(attrName,attrValue){return function(node){return isElement(node)&&node.hasAttribute(attrName)}},hasAttributeValue:function hasAttributeValue(attrName,attrValue){return function(node){return isElement(node)&&node.getAttribute(attrName)===attrValue}},matchStyleValues:function matchStyleValues(name,values){return values=values.toLowerCase().split(" "),function(node){var i;if(isElement(node))for(i=0;i<values.length;i++)if(node.ownerDocument.defaultView.getComputedStyle(node,null).getPropertyValue(name)===values[i])return!0;return!1}},isBogus:function isBogus(node){return isElement(node)&&node.hasAttribute("data-mce-bogus")}}}),define("tinymce.core.text.Zwsp",[],function(){return{isZwsp:function(chr){return"\ufeff"===chr},ZWSP:"\ufeff",trim:function(text){return text.replace(new RegExp("\ufeff","g"),"")}}}),define("tinymce.core.caret.CaretContainer",["tinymce.core.dom.NodeType","tinymce.core.text.Zwsp"],function(NodeType,Zwsp){var isElement=NodeType.isElement,isText=NodeType.isText;function isCaretContainerBlock(node){return isText(node)&&(node=node.parentNode),isElement(node)&&node.hasAttribute("data-mce-caret")}function isCaretContainerInline(node){return isText(node)&&Zwsp.isZwsp(node.data)}function isCaretContainer(node){return isCaretContainerBlock(node)||isCaretContainerInline(node)}function startsWithCaretContainer(node){return isText(node)&&node.data[0]==Zwsp.ZWSP}function endsWithCaretContainer(node){return isText(node)&&node.data[node.data.length-1]==Zwsp.ZWSP}return{isCaretContainer:isCaretContainer,isCaretContainerBlock:isCaretContainerBlock,isCaretContainerInline:isCaretContainerInline,showCaretContainerBlock:function showCaretContainerBlock(caretContainer){return caretContainer&&caretContainer.hasAttribute("data-mce-caret")?(function trimBogusBr(elm){var brs=elm.getElementsByTagName("br"),lastBr=brs[brs.length-1];NodeType.isBogus(lastBr)&&lastBr.parentNode.removeChild(lastBr)}(caretContainer),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null},insertInline:function insertInline(node,before){var sibling,textNode,parentNode;if(textNode=node.ownerDocument.createTextNode(Zwsp.ZWSP),parentNode=node.parentNode,before){if(sibling=node.previousSibling,isText(sibling)){if(isCaretContainer(sibling))return sibling;if(endsWithCaretContainer(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{if(sibling=node.nextSibling,isText(sibling)){if(isCaretContainer(sibling))return sibling;if(startsWithCaretContainer(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode},prependInline:function(node){if(NodeType.isText(node)){var data=node.data;return 0<data.length&&data.charAt(0)!==Zwsp.ZWSP&&node.insertData(0,Zwsp.ZWSP),node}return null},appendInline:function(node){if(NodeType.isText(node)){var data=node.data;return 0<data.length&&data.charAt(data.length-1)!==Zwsp.ZWSP&&node.insertData(data.length,Zwsp.ZWSP),node}return null},isBeforeInline:function(pos){return pos&&NodeType.isText(pos.container())&&pos.container().data.charAt(pos.offset())===Zwsp.ZWSP},isAfterInline:function(pos){return pos&&NodeType.isText(pos.container())&&pos.container().data.charAt(pos.offset()-1)===Zwsp.ZWSP},insertBlock:function insertBlock(blockName,node,before){var blockNode,parentNode;return(blockNode=node.ownerDocument.createElement(blockName)).setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(function createBogusBr(){var br=document.createElement("br");return br.setAttribute("data-mce-bogus","1"),br}()),parentNode=node.parentNode,before?parentNode.insertBefore(blockNode,node):node.nextSibling?parentNode.insertBefore(blockNode,node.nextSibling):parentNode.appendChild(blockNode),blockNode},hasContent:function(node){return node.firstChild!==node.lastChild||!NodeType.isBr(node.firstChild)},startsWithCaretContainer:startsWithCaretContainer,endsWithCaretContainer:endsWithCaretContainer}}),define("tinymce.core.dom.RangeUtils",["tinymce.core.util.Tools","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodeType","tinymce.core.dom.Range","tinymce.core.caret.CaretContainer"],function(Tools,TreeWalker,NodeType,Range,CaretContainer){var each=Tools.each,isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isCaretContainer=CaretContainer.isCaretContainer;function hasCeProperty(node){return isContentEditableTrue(node)||isContentEditableFalse(node)}function findParent(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}function hasParent(node,rootNode,predicate){return null!==findParent(node,rootNode,predicate)}function hasParentWithName(node,rootNode,name){return hasParent(node,rootNode,function(node){return node.nodeName===name})}function isFormatterCaret(node){return"_mce_caret"===node.id}function isCeFalseCaretContainer(node,rootNode){return isCaretContainer(node)&&!1===hasParent(node,rootNode,isFormatterCaret)}function RangeUtils(dom){this.walk=function(rng,callback){var ancestor,startPoint,endPoint,node,parent,siblings,nodes,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(0<(nodes=dom.select("td[data-mce-selected],th[data-mce-selected]")).length)each(nodes,function(node){callback([node])});else{if(1==startContainer.nodeType&&startContainer.hasChildNodes()&&(startContainer=startContainer.childNodes[startOffset]),1==endContainer.nodeType&&endContainer.hasChildNodes()&&(endContainer=function getEndChild(container,index){var childNodes=container.childNodes;return--index>childNodes.length-1?index=childNodes.length-1:index<0&&(index=0),childNodes[index]||container}(endContainer,endOffset)),startContainer==endContainer)return callback(exclude([startContainer]));for(ancestor=dom.findCommonAncestor(startContainer,endContainer),node=startContainer;node;node=node.parentNode){if(node===endContainer)return walkBoundary(startContainer,ancestor,!0);if(node===ancestor)break}for(node=endContainer;node;node=node.parentNode){if(node===startContainer)return walkBoundary(endContainer,ancestor);if(node===ancestor)break}startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer,walkBoundary(startContainer,startPoint,!0),(siblings=collectSiblings(startPoint==startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint==endContainer?endPoint.nextSibling:endPoint)).length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)}function exclude(nodes){var node;return 3===(node=nodes[0]).nodeType&&node===startContainer&&startOffset>=node.nodeValue.length&&nodes.splice(0,1),node=nodes[nodes.length-1],0===endOffset&&0<nodes.length&&node===endContainer&&3===node.nodeType&&nodes.splice(nodes.length-1,1),nodes}function collectSiblings(node,name,endNode){for(var siblings=[];node&&node!=endNode;node=node[name])siblings.push(node);return siblings}function findEndPoint(node,root){do{if(node.parentNode==root)return node;node=node.parentNode}while(node)}function walkBoundary(startNode,endNode,next){var siblingName=next?"nextSibling":"previousSibling";for(parent=(node=startNode).parentNode;node&&node!=endNode;node=parent)parent=node.parentNode,(siblings=collectSiblings(node==startNode?node:node[siblingName],siblingName)).length&&(next||siblings.reverse(),callback(exclude(siblings)))}},this.split=function(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;function splitText(node,offset){return node.splitText(offset)}return startContainer==endContainer&&3==startContainer.nodeType?0<startOffset&&startOffset<startContainer.nodeValue.length&&(startContainer=(endContainer=splitText(startContainer,startOffset)).previousSibling,startOffset<endOffset?(startContainer=endContainer=splitText(endContainer,endOffset-=startOffset).previousSibling,endOffset=endContainer.nodeValue.length,startOffset=0):endOffset=0):(3==startContainer.nodeType&&0<startOffset&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),3==endContainer.nodeType&&0<endOffset&&endOffset<endContainer.nodeValue.length&&(endOffset=(endContainer=splitText(endContainer,endOffset).previousSibling).nodeValue.length)),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},this.normalize=function(rng){var collapsed,normalized=!1;function normalizeEndPoint(start){var container,offset,walker,node,nonEmptyElementsMap,directionLeft,isAfterNode,body=dom.getRoot();function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}function hasBrBeforeAfter(node,left){for(var walker=new TreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||body);node=walker[left?"prev":"next"]();)if("BR"===node.nodeName)return!0}function findTextNodeRelative(left,startNode){var walker,lastInlineElement,parentBlockContainer;if(startNode=startNode||container,parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body,left&&"BR"==startNode.nodeName&&isAfterNode&&dom.isEmpty(parentBlockContainer))return container=startNode.parentNode,offset=dom.nodeIndex(startNode),void(normalized=!0);for(walker=new TreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCeFalseCaretContainer(node,dom.getRoot()))return;if(3===node.nodeType&&0<node.nodeValue.length)return void(!1===hasParentWithName(node,body,"A")&&(container=node,offset=left?node.nodeValue.length:0,normalized=!0));if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return;lastInlineElement=node}collapsed&&lastInlineElement&&(container=lastInlineElement,normalized=!0,offset=0)}if(container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"],isAfterNode=1==container.nodeType&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements(),directionLeft=start,!isCaretContainer(container)){if(1==container.nodeType&&offset>container.childNodes.length-1&&(directionLeft=!1),9===container.nodeType&&(container=dom.getRoot(),offset=0),container===body){if(directionLeft&&(node=container.childNodes[0<offset?offset-1:0])){if(isCaretContainer(node))return;if(nonEmptyElementsMap[node.nodeName]||"TABLE"==node.nodeName)return}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&0<offset?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=0,!collapsed&&container===body.lastChild&&"TABLE"===container.nodeName)return;if(function hasContentEditableFalseParent(node){for(;node&&node!=body;){if(isContentEditableFalse(node))return!0;node=node.parentNode}return!1}(container)||isCaretContainer(container))return;if(container.hasChildNodes()&&!/TABLE/.test(container.nodeName)){walker=new TreeWalker(node=container,body);do{if(isContentEditableFalse(node)||isCaretContainer(node)){normalized=!1;break}if(3===node.nodeType&&0<node.nodeValue.length){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell(node)){offset=dom.nodeIndex(node),container=node.parentNode,"IMG"!=node.nodeName||directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}collapsed&&(3===container.nodeType&&0===offset&&findTextNodeRelative(!0),1===container.nodeType&&(!(node=(node=container.childNodes[offset])||container.childNodes[offset-1])||"BR"!==node.nodeName||function isPrevNode(node,name){return node.previousSibling&&node.previousSibling.nodeName==name}(node,"A")||hasBrBeforeAfter(node)||hasBrBeforeAfter(node,!0)||findTextNodeRelative(!0,node))),directionLeft&&!collapsed&&3===container.nodeType&&offset===container.nodeValue.length&&findTextNodeRelative(!1),normalized&&rng["set"+(start?"Start":"End")](container,offset)}}return collapsed=rng.collapsed,normalizeEndPoint(!0),collapsed||normalizeEndPoint(),normalized&&collapsed&&rng.collapse(!0),normalized}}return RangeUtils.compareRanges=function(rng1,rng2){if(rng1&&rng2){if(!rng1.item&&!rng1.duplicate)return rng1.startContainer==rng2.startContainer&&rng1.startOffset==rng2.startOffset;if(rng1.item&&rng2.item&&rng1.item(0)===rng2.item(0))return!0;if(rng1.isEqual&&rng2.isEqual&&rng2.isEqual(rng1))return!0}return!1},RangeUtils.getCaretRangeFromPoint=function(clientX,clientY,doc){var rng,point;if(doc.caretPositionFromPoint)point=doc.caretPositionFromPoint(clientX,clientY),(rng=doc.createRange()).setStart(point.offsetNode,point.offset),rng.collapse(!0);else if(doc.caretRangeFromPoint)rng=doc.caretRangeFromPoint(clientX,clientY);else if(doc.body.createTextRange){rng=doc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=function findClosestIeRange(clientX,clientY,doc){var element,rng,rects;if(element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange(),element&&"HTML"!=element.tagName||(element=doc.body),rng.moveToElementText(element),0<(rects=(rects=Tools.toArray(rng.getClientRects())).sort(function(a,b){return(a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)))-(b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY)))})).length){clientY=(rects[0].bottom+rects[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null}(clientX,clientY,doc)}return function moveOutOfContentEditableFalse(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse(findParent(parentElement,rootNode,hasCeProperty))?null:rng}(rng,doc.body)}return rng},RangeUtils.getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset==startOffset+1?startContainer.childNodes[startOffset]:null},RangeUtils.getNode=function(container,offset){return 1==container.nodeType&&container.hasChildNodes()&&(offset>=container.childNodes.length&&(offset=container.childNodes.length-1),container=container.childNodes[offset]),container},RangeUtils}),define("tinymce.core.html.Node",[],function(){var whiteSpaceRegExp=/^[ \t\r\n]*$/,typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};function walk(node,rootNode,prev){var sibling,parent,startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parent;parent&&parent!==rootNode;parent=parent.parent)if(sibling=parent[siblingName])return sibling}}function Node(name,type){this.name=name,1===(this.type=type)&&(this.attributes=[],this.attributes.map={})}return Node.prototype={replace:function(node){return node.parent&&node.remove(),this.insert(node,this),this.remove(),this},attr:function(name,value){var attrs,i;if("string"!=typeof name){for(i in name)this.attr(i,name[i]);return this}if(attrs=this.attributes){if(void 0===value)return attrs.map[name];if(null===value){if(name in attrs.map)for(delete attrs.map[name],i=attrs.length;i--;)if(attrs[i].name===name)return attrs=attrs.splice(i,1),this;return this}if(name in attrs.map){for(i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name:name,value:value});return attrs.map[name]=value,this}},clone:function(){var i,l,selfAttrs,selfAttr,cloneAttrs,clone=new Node(this.name,this.type);if(selfAttrs=this.attributes){for((cloneAttrs=[]).map={},i=0,l=selfAttrs.length;i<l;i++)"id"!==(selfAttr=selfAttrs[i]).name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value);clone.attributes=cloneAttrs}return clone.value=this.value,clone.shortEnded=this.shortEnded,clone},wrap:function(wrapper){return this.parent.insert(wrapper,this),wrapper.append(this),this},unwrap:function(){var node,next;for(node=this.firstChild;node;)next=node.next,this.insert(node,this,!0),node=next;this.remove()},remove:function(){var parent=this.parent,next=this.next,prev=this.prev;return parent&&(parent.firstChild===this?(parent.firstChild=next)&&(next.prev=null):prev.next=next,parent.lastChild===this?(parent.lastChild=prev)&&(prev.next=null):next.prev=prev,this.parent=this.next=this.prev=null),this},append:function(node){var last;return node.parent&&node.remove(),(last=this.lastChild)?((last.next=node).prev=last,this.lastChild=node):this.lastChild=this.firstChild=node,node.parent=this,node},insert:function(node,refNode,before){var parent;return node.parent&&node.remove(),parent=refNode.parent||this,before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev.next=node,node.prev=refNode.prev,(node.next=refNode).prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next.prev=node,node.next=refNode.next,(node.prev=refNode).next=node),node.parent=parent,node},getAll:function(name){var node,collection=[];for(node=this.firstChild;node;node=walk(node,this))node.name===name&&collection.push(node);return collection},empty:function(){var nodes,i,node;if(this.firstChild){for(nodes=[],node=this.firstChild;node;node=walk(node,this))nodes.push(node);for(i=nodes.length;i--;)(node=nodes[i]).parent=node.firstChild=node.lastChild=node.next=node.prev=null}return this.firstChild=this.lastChild=null,this},isEmpty:function(elements,whitespace){var i,name,node=this.firstChild;if(whitespace=whitespace||{},node)do{if(1===node.type){if(node.attributes.map["data-mce-bogus"])continue;if(elements[node.name])return!1;for(i=node.attributes.length;i--;)if("name"===(name=node.attributes[i].name)||0===name.indexOf("data-mce-bookmark"))return!1}if(8===node.type)return!1;if(3===node.type&&!whiteSpaceRegExp.test(node.value))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&whiteSpaceRegExp.test(node.value))return!1}while(node=walk(node,this));return!0},walk:function(prev){return walk(this,null,prev)}},Node.create=function(name,attrs){var node,attrName;if(node=new Node(name,typeLookup[name]||1),attrs)for(attrName in attrs)node.attr(attrName,attrs[attrName]);return node},Node}),define("tinymce.core.html.SaxParser",["tinymce.core.html.Schema","tinymce.core.html.Entities","tinymce.core.util.Tools"],function(Schema,Entities,Tools){var each=Tools.each;function findEndTag(schema,html,startIndex){var index,matches,tokenRegExp,shortEndedElements,count=1;for(shortEndedElements=schema.getShortEndedElements(),(tokenRegExp=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g).lastIndex=index=startIndex;matches=tokenRegExp.exec(html);){if(index=tokenRegExp.lastIndex,"/"===matches[1])count--;else if(!matches[1]){if(matches[2]in shortEndedElements)continue;count++}if(0===count)break}return index}function SaxParser(settings,schema){var self=this;function noop(){}settings=settings||{},self.schema=schema=schema||new Schema,!1!==settings.fix_self_closing&&(settings.fix_self_closing=!0),each("comment cdata text start end pi doctype".split(" "),function(name){name&&(self[name]=settings[name]||noop)}),self.parse=function(html){var matches,value,endRegExp,attrList,i,text,name,isInternalElement,removeInternalElements,shortEndedElements,fillAttrsMap,isShortEnded,validate,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,processHtml,selfClosing,tokenRegExp,attrRegExp,specialElements,attrValue,fixSelfClosing,self=this,index=0,stack=[],idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,formaction,poster"),scriptUriRegExp=/((java|vb)script|mhtml):/i,dataUriRegExp=/^data:/i;function processEndTag(name){var pos,i;for(pos=stack.length;pos--&&stack[pos].name!==name;);if(0<=pos){for(i=stack.length-1;pos<=i;i--)(name=stack[i]).valid&&self.end(name.name);stack.length=pos}}function parseAttribute(match,name,value,val2,val3){var attrRule,i;if(value=(name=name.toLowerCase())in fillAttrsMap?name:decode(value||val2||val3||""),validate&&!isInternalElement&&!1===function(name){return 0===name.indexOf("data-")||0===name.indexOf("aria-")}(name)){if(!(attrRule=validAttributesMap[name])&&validAttributePatterns){for(i=validAttributePatterns.length;i--&&!(attrRule=validAttributePatterns[i]).pattern.test(name););-1===i&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}if(filteredUrlAttrs[name]&&!settings.allow_script_urls){var uri=value.replace(/[\s\u0000-\u001F]+/g,"");try{uri=decodeURIComponent(uri)}catch(ex){uri=unescape(uri)}if(scriptUriRegExp.test(uri))return;if(!settings.allow_html_data_urls&&dataUriRegExp.test(uri)&&!/^data:image\//i.test(uri))return}attrList.map[name]=value,attrList.push({name:name,value:value})}for(tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)--\x3e)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements(),processHtml=html+">";matches=tokenRegExp.exec(processHtml);){if(index<matches.index&&self.text(decode(html.substr(index,matches.index-index))),value=matches[6])":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),processEndTag(value);else if(value=matches[7]){if(matches.index+matches[0].length>html.length){self.text(decode(html.substr(matches.index))),index=matches.index+matches[0].length;continue}if(":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),isShortEnded=value in shortEndedElements,fixSelfClosing&&selfClosing[value]&&0<stack.length&&stack[stack.length-1].name===value&&processEndTag(value),!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[8])?((isInternalElement=-1!==attribsValue.indexOf("data-mce-type"))&&removeInternalElements&&(isValidElement=!1),(attrList=[]).map={},attribsValue.replace(attrRegExp,parseAttribute)):(attrList=[]).map={},validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,elementRule.removeEmptyAttrs&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)name=(attr=attributesForced[i]).name,"{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)(name=(attr=attributesDefault[i]).name)in attrList.map||("{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););-1===i&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findEndTag(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&self.start(value,attrList,isShortEnded)}else isValidElement=!1;if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matches[0].length,index=(matches=endRegExp.exec(html))?(isValidElement&&(text=html.substr(index,matches.index-index)),matches.index+matches[0].length):(text=html.substr(index),html.length),isValidElement&&(0<text.length&&self.text(text,!0),self.end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")==attribsValue.length-1?isValidElement&&self.end(value):stack.push({name:value,valid:isValidElement}))}else(value=matches[1])?(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3).toLowerCase()||(value=" "+value),self.comment(value)):(value=matches[2])?self.cdata(value):(value=matches[3])?self.doctype(value):(value=matches[4])&&self.pi(value,matches[5]);index=matches.index+matches[0].length}for(index<html.length&&self.text(decode(html.substr(index))),i=stack.length-1;0<=i;i--)(value=stack[i]).valid&&self.end(value.name)}}return SaxParser.findEndTag=findEndTag,SaxParser}),define("tinymce.core.html.DomParser",["tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.html.SaxParser","tinymce.core.util.Tools"],function(Node,Schema,SaxParser,Tools){var makeMap=Tools.makeMap,each=Tools.each,explode=Tools.explode,extend=Tools.extend,paddEmptyNode=function(settings,node){settings.padd_empty_with_br?node.empty().append(new Node("br","1")).shortEnded=!0:node.empty().append(new Node("#text","3")).value=" "},hasOnlyChild=function(node,name){return node&&node.firstChild===node.lastChild&&node.firstChild.name===name};return function(settings,schema){var self=this,nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};(settings=settings||{}).validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body",self.schema=schema=schema||new Schema,self.filterNode=function(node){var i,name,list;name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),i=attributeFilters.length;for(;i--;)(name=attributeFilters[i].name)in node.attributes.map&&((list=matchedAttributes[name])?list.push(node):matchedAttributes[name]=[node]);return node},self.addNodeFilter=function(name,callback){each(explode(name),function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)})},self.addAttributeFilter=function(name,callback){each(explode(name),function(name){var i;for(i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name:name,callbacks:[callback]})})},self.parse=function(html,args){var parser,rootNode,node,nodes,i,l,fi,fl,list,name,validate,blockElements,startWhiteSpaceRegExp,isInWhiteSpacePreservedElement,endWhiteSpaceRegExp,allWhiteSpaceRegExp,isAllWhiteSpaceRegExp,whiteSpaceElements,children,nonEmptyElements,rootBlockName,invalidChildren=[];function createNode(name,type){var list,node=new Node(name,type);return name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),node}function removeWhitespaceBefore(node){var textNode,textNodeNext,textVal,sibling,blockElements=schema.getBlockElements();for(textNode=node.prev;textNode&&3===textNode.type;){if(0<(textVal=textNode.value.replace(endWhiteSpaceRegExp,"")).length)return void(textNode.value=textVal);if(textNodeNext=textNode.next){if(3==textNodeNext.type&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&"script"!=textNodeNext.name&&"style"!=textNodeNext.name){textNode=textNode.prev;continue}}sibling=textNode.prev,textNode.remove(),textNode=sibling}}if(args=args||{},matchedNodes={},matchedAttributes={},blockElements=extend(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,rootBlockName="forced_root_block"in args?args.forced_root_block:settings.forced_root_block,whiteSpaceElements=schema.getWhiteSpaceElements(),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/,parser=new SaxParser({validate:validate,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,self_closing_elements:function cloneAndExcludeBlocks(input){var name,output={};for(name in input)"li"!==name&&"p"!=name&&(output[name]=input[name]);return output}(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;isInWhiteSpacePreservedElement||(text=text.replace(allWhiteSpaceRegExp," "),node.lastChild&&blockElements[node.lastChild.name]&&(text=text.replace(startWhiteSpaceRegExp,""))),0!==text.length&&((textNode=createNode("#text",3)).raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){node.append(createNode("#doctype",10)).value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var newNode,attrFiltersLen,elementRule,attrName,parent;function addNodeToMatchedAttributes(name,node){var list=matchedAttributes[name];list?list[list.length-1]!==node&&list.push(node):matchedAttributes[name]=[newNode]}if(elementRule=validate?schema.getElementRule(name):{}){for((newNode=createNode(elementRule.outputName||name,1)).attributes=attrs,newNode.shortEnded=empty,node.append(newNode),(parent=children[node.name])&&children[newNode.name]&&!parent[newNode.name]&&invalidChildren.push(newNode),attrFiltersLen=attributeFilters.length;attrFiltersLen--;)(attrName=attributeFilters[attrFiltersLen].name)instanceof RegExp?tinymce.each(attrs.map,function(v,k){attrName.test(k)&&addNodeToMatchedAttributes(k,newNode)}):attrName in attrs.map&&addNodeToMatchedAttributes(attrName,newNode);blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,elementRule,text,sibling,tempNode;if(elementRule=validate?schema.getElementRule(name):{}){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if((textNode=node.firstChild)&&3===textNode.type)if(0<(text=textNode.value.replace(startWhiteSpaceRegExp,"")).length)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,0!==text.length&&!isAllWhiteSpaceRegExp.test(text)||(textNode.remove(),textNode=sibling),textNode=sibling;if((textNode=node.lastChild)&&3===textNode.type)if(0<(text=textNode.value.replace(endWhiteSpaceRegExp,"")).length)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,0!==text.length&&!isAllWhiteSpaceRegExp.test(text)||(textNode.remove(),textNode=sibling),textNode=sibling}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1),(elementRule.removeEmpty||elementRule.paddEmpty)&&node.isEmpty(nonEmptyElements,whiteSpaceElements))if(elementRule.paddEmpty)paddEmptyNode(settings,node);else if(!node.attributes.map.name&&!node.attributes.map.id)return tempNode=node.parent,blockElements[node.name]?node.empty().remove():node.unwrap(),void(node=tempNode);node=node.parent}}},schema),rootNode=node=new Node(args.context||settings.root_name,11),parser.parse(html),validate&&invalidChildren.length&&(args.context?args.invalid=!0:function fixInvalidChildren(nodes){var ni,node,parent,parents,newParent,currentNode,tempNode,childNode,i,nonEmptyElements,whitespaceElements,nonSplitableElements,textBlockElements,specialElements,sibling,nextNode;for(nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhiteSpaceElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements(),ni=0;ni<nodes.length;ni++)if((node=nodes[ni]).parent&&!node.fixed)if(textBlockElements[node.name]&&"li"==node.parent.name){for(sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap(node)}else{for(parents=[node],parent=node.parent;parent&&!schema.isValidChild(parent.name,node.name)&&!nonSplitableElements[parent.name];parent=parent.parent)parents.push(parent);if(parent&&1<parents.length){for(parents.reverse(),newParent=currentNode=self.filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){for(schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=self.filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode,childNode=parents[i].firstChild;childNode&&childNode!=parents[i+1];)nextNode=childNode.next,tempNode.append(childNode),childNode=nextNode;currentNode=tempNode}newParent.isEmpty(nonEmptyElements,whitespaceElements)?parent.insert(node,parents[0],!0):(parent.insert(newParent,parents[0],!0),parent.insert(node,newParent)),((parent=parents[0]).isEmpty(nonEmptyElements,whitespaceElements)||hasOnlyChild(parent,"br"))&&parent.empty().remove()}else if(node.parent){if("li"===node.name){if((sibling=node.prev)&&("ul"===sibling.name||"ul"===sibling.name)){sibling.append(node);continue}if((sibling=node.next)&&("ul"===sibling.name||"ul"===sibling.name)){sibling.insert(node,sibling.firstChild,!0);continue}node.wrap(self.filterNode(new Node("ul",1)));continue}schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(self.filterNode(new Node("div",1))):specialElements[node.name]?node.empty().remove():node.unwrap()}}}(invalidChildren)),rootBlockName&&("body"==rootNode.name||args.isRootContent)&&function addRootBlocks(){var next,rootBlockNode,node=rootNode.firstChild;function trim(rootBlockNode){rootBlockNode&&((node=rootBlockNode.firstChild)&&3==node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),(node=rootBlockNode.lastChild)&&3==node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))}if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;)next=node.next,3==node.type||1==node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?(rootBlockNode||((rootBlockNode=createNode(rootBlockName,1)).attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node)),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next;trim(rootBlockNode)}}(),!args.invalid){for(name in matchedNodes){for(list=nodeFilters[name],nodes=matchedNodes[name],fi=nodes.length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if((list=attributeFilters[i]).name instanceof RegExp)tinymce.each(matchedAttributes,function(v,k){if(list.name.test(k)){var l=tinymce.extend({},list,{name:k});for(nodes=matchedAttributes[l.name],fi=nodes.length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=l.callbacks.length;fi<fl;fi++)l.callbacks[fi](nodes,l.name,args)}});else if(list.name in matchedAttributes){for(nodes=matchedAttributes[list.name],fi=nodes.length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode},settings.remove_trailing_brs&&self.addNodeFilter("br",function(nodes){var i,node,parent,lastParent,prev,prevName,elementRule,textNode,l=nodes.length,blockElements=extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),whiteSpaceElements=schema.getNonEmptyElements();for(blockElements.body=1,i=0;i<l;i++)if(parent=(node=nodes[i]).parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if("span"!==(prevName=prev.name)||"bookmark"!==prev.attr("data-mce-type")){if("br"!==prevName)break;if("br"===prevName){node=null;break}}prev=prev.prev}node&&(node.remove(),parent.isEmpty(nonEmptyElements,whiteSpaceElements)&&(elementRule=schema.getElementRule(parent.name))&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,parent)))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&!blockElements[(lastParent=parent).name];)parent=parent.parent;lastParent===parent&&!0!==settings.padd_empty_with_br&&((textNode=new Node("#text",3)).value=" ",node.replace(textNode))}}),settings.allow_unsafe_link_target||self.addAttributeFilter("href",function(nodes){var node,rel,i=nodes.length,rules="noopener noreferrer";function removeTargetRules(rel){var regExp=new RegExp("("+rules.replace(" ","|")+")","g");return(rel=rel&&Tools.trim(rel.replace(regExp,"")))||null}function toggleTargetRules(rel,isUnsafe){return isUnsafe?function addTargetRules(rel){return(rel=removeTargetRules(rel))?[rel,rules].join(" "):rules}(rel):removeTargetRules(rel)}for(;i--;)rel=(node=nodes[i]).attr("rel"),"a"===node.name&&node.attr("rel",toggleTargetRules(rel,"_blank"==node.attr("target")))}),settings.allow_html_in_named_anchor||self.addAttributeFilter("id,name",function(nodes){for(var sibling,prevSibling,parent,node,i=nodes.length;i--;)if("a"===(node=nodes[i]).name&&node.firstChild&&!node.attr("href"))for(parent=node.parent,sibling=node.lastChild;prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling;);}),settings.fix_list_elements&&self.addNodeFilter("ul,ol",function(nodes){for(var node,parentNode,i=nodes.length;i--;)if("ul"===(parentNode=(node=nodes[i]).parent).name||"ol"===parentNode.name)if(node.prev&&"li"===node.prev.name)node.prev.append(node);else{var li=new Node("li",1);li.attr("style","list-style-type: none"),node.wrap(li)}}),settings.validate&&schema.getValidClasses()&&self.addAttributeFilter("class",function(nodes){for(var node,classList,ci,className,classValue,validClassesMap,valid,i=nodes.length,validClasses=schema.getValidClasses();i--;){for(classList=(node=nodes[i]).attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++)className=classList[ci],valid=!1,(validClassesMap=validClasses["*"])&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className);classValue.length||(classValue=null),node.attr("class",classValue)}})}}),define("tinymce.core.html.Writer",["tinymce.core.html.Entities","tinymce.core.util.Tools"],function(Entities,Tools){var makeMap=Tools.makeMap;return function(settings){var indent,indentBefore,indentAfter,encode,htmlOutput,html=[];return indent=(settings=settings||{}).indent,indentBefore=makeMap(settings.indent_before||""),indentAfter=makeMap(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"==settings.element_format,{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&0<html.length&&0<(value=html[html.length-1]).length&&"\n"!==value&&html.push("\n"),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&0<html.length&&0<(value=html[html.length-1]).length&&"\n"!==value&&html.push("\n")},end:function(name){var value;html.push("</",name,">"),indent&&indentAfter[name]&&0<html.length&&0<(value=html[html.length-1]).length&&"\n"!==value&&html.push("\n")},text:function(text,raw){0<text.length&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("\x3c!--",text,"--\x3e")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}}}),define("tinymce.core.html.Serializer",["tinymce.core.html.Writer","tinymce.core.html.Schema"],function(Writer,Schema){return function(settings,schema){var writer=new Writer(settings);(settings=settings||{}).validate=!("validate"in settings)||settings.validate,this.schema=schema=schema||new Schema,this.writer=writer,this.serialize=function(node){var handlers,validate;function walk(node){var name,isEmpty,attrs,attrName,attrValue,sortedAttrs,i,l,elementRule,handler=handlers[node.type];if(handler)handler(node);else{if(name=node.name,isEmpty=node.shortEnded,attrs=node.attributes,validate&&attrs&&1<attrs.length&&((sortedAttrs=[]).map={},elementRule=schema.getElementRule(node.name))){for(i=0,l=elementRule.attributesOrder.length;i<l;i++)(attrName=elementRule.attributesOrder[i])in attrs.map&&(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));for(i=0,l=attrs.length;i<l;i++)(attrName=attrs[i].name)in sortedAttrs.map||(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));attrs=sortedAttrs}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)for(;walk(node),node=node.next;);writer.end(name)}}}return validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)for(;walk(node),node=node.next;);}},writer.reset(),1!=node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}}),define("tinymce.core.dom.Serializer",["tinymce.core.dom.DOMUtils","tinymce.core.html.DomParser","tinymce.core.html.SaxParser","tinymce.core.html.Entities","tinymce.core.html.Serializer","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.Env","tinymce.core.util.Tools","tinymce.core.text.Zwsp"],function(DOMUtils,DomParser,SaxParser,Entities,Serializer,Node,Schema,Env,Tools,Zwsp){var each=Tools.each,trim=Tools.trim,DOM=DOMUtils.DOM;return function(settings,editor){var dom,schema,htmlParser,tempAttrs=["data-mce-selected"];function trimHtml(html){var trimContentRegExp=new RegExp(["<span[^>]+data-mce-bogus[^>]+>[​\ufeff]+<\\/span>","\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html=Zwsp.trim(html.replace(trimContentRegExp,""))}function trimContent(html){var endTagIndex,index,matchLength,matches,shortEndedElements,content=html,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,schema=editor.schema;for(content=trimHtml(content),shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);)index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex),bogusAllRegExp.lastIndex=index-matchLength;return content}return editor&&(dom=editor.dom,schema=editor.schema),dom=dom||DOM,schema=schema||new Schema(settings),settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs,(htmlParser=new DomParser(settings,schema)).addAttributeFilter("data-mce-tabindex",function(nodes,name){for(var node,i=nodes.length;i--;)(node=nodes[i]).attr("tabindex",node.attributes.map["data-mce-tabindex"]),node.attr(name,null)}),htmlParser.addAttributeFilter("src,href,style",function(nodes,name){for(var node,value,i=nodes.length,internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope;i--;)void 0!==(value=(node=nodes[i]).attributes.map[internalName])?(node.attr(name,0<value.length?value:null),node.attr(internalName,null)):(value=node.attributes.map[name],"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,0<value.length?value:null))}),htmlParser.addAttributeFilter("class",function(nodes){for(var node,value,i=nodes.length;i--;)(value=(node=nodes[i]).attr("class"))&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",0<value.length?value:null))}),htmlParser.addAttributeFilter("data-mce-type",function(nodes,name,args){for(var node,i=nodes.length;i--;)"bookmark"!==(node=nodes[i]).attributes.map["data-mce-type"]||args.cleanup||node.remove()}),htmlParser.addNodeFilter("noscript",function(nodes){for(var node,i=nodes.length;i--;)(node=nodes[i].firstChild)&&(node.value=Entities.decode(node.value))}),htmlParser.addNodeFilter("script,style",function(nodes,name){var node,value,type,i=nodes.length;function trim(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}for(;i--;)value=(node=nodes[i]).firstChild?node.firstChild.value:"","script"===name?((type=node.attr("type"))&&node.attr("type","mce-no/type"==type?null:type.replace(/^mce\-/,"")),0<value.length&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")):0<value.length&&(node.firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")}),htmlParser.addNodeFilter("#comment",function(nodes){for(var node,i=nodes.length;i--;)0===(node=nodes[i]).value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=node.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))}),htmlParser.addNodeFilter("xml:namespace,input",function(nodes,name){for(var node,i=nodes.length;i--;)7===(node=nodes[i]).type?node.remove():1===node.type&&("input"!==name||"type"in node.attributes.map||node.attr("type","text"))}),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,args){var impl,doc,oldDoc,htmlSerializer,content,rootNode;return Env.ie&&0<dom.select("script,style,select,map").length?(content=node.innerHTML,node=node.cloneNode(!1),dom.setHTML(node,content)):node=node.cloneNode(!0),(impl=document.implementation).createHTMLDocument&&(doc=impl.createHTMLDocument(""),each("BODY"==node.nodeName?node.childNodes:[node],function(node){doc.body.appendChild(doc.importNode(node,!0))}),node="BODY"!=node.nodeName?doc.body.firstChild:doc.body,oldDoc=dom.doc,dom.doc=doc),(args=args||{}).format=args.format||"html",args.selection&&(args.forced_root_block=""),args.no_events||(args.node=node,this.onPreProcess(args)),function trimTrailingBr(rootNode){var brNode1,brNode2;function isBr(node){return node&&"br"===node.name}isBr(brNode1=rootNode.lastChild)&&isBr(brNode2=brNode1.prev)&&(brNode1.remove(),brNode2.remove())}(rootNode=htmlParser.parse(trim(args.getInner?node.innerHTML:dom.getOuterHTML(node)),args)),htmlSerializer=new Serializer(settings,schema),args.content=htmlSerializer.serialize(rootNode),args.cleanup||(args.content=Zwsp.trim(args.content),args.content=args.content.replace(/\uFEFF/g,"")),args.no_events||this.onPostProcess(args),oldDoc&&(dom.doc=oldDoc),args.node=null,args.content},addRules:function(rules){schema.addValidElements(rules)},setRules:function(rules){schema.setValidElements(rules)},onPreProcess:function(args){editor&&editor.fire("PreProcess",args)},onPostProcess:function(args){editor&&editor.fire("PostProcess",args)},addTempAttr:function addTempAttr(name){-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),tempAttrs.push(name))},trimHtml:trimHtml,getTrimmedContent:function getTrimmedContent(){return trimContent(editor.getBody().innerHTML)},trimContent:trimContent}}}),define("tinymce.core.util.VK",["tinymce.core.Env"],function(Env){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}}}),define("tinymce.core.dom.ControlSelection",["tinymce.core.util.VK","tinymce.core.util.Tools","tinymce.core.util.Delay","tinymce.core.Env","tinymce.core.dom.NodeType"],function(VK,Tools,Delay,Env,NodeType){var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue;return function(selection,editor){var selectedElm,selectedElmGhost,resizeHelper,resizeHandles,selectedHandle,lastMouseDownEvent,startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight,dom=editor.dom,each=Tools.each,editableDoc=editor.getDoc(),rootDocument=document,isIE=Env.ie&&Env.ie<11,abs=Math.abs,round=Math.round,rootElement=editor.getBody();resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var rootClass=".mce-content-body";function isResizable(elm){var selector=editor.settings.object_resizing;return!1!==selector&&!Env.iOS&&("string"!=typeof selector&&(selector="table,img,div"),"false"!==elm.getAttribute("data-mce-resize")&&(elm!=editor.getBody()&&editor.dom.is(elm,selector)))}function resizeGhostElement(e){var deltaX,deltaY,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,("IMG"==selectedElm.nodeName&&!1!==editor.settings.resize_img_proportional?!VK.modifierPressed(e):VK.modifierPressed(e)||"IMG"==selectedElm.nodeName&&selectedHandle[2]*selectedHandle[3]!=0)&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),dom.setStyles(selectedElmGhost,{width:width,height:height}),resizeHelperX=0<(resizeHelperX=selectedHandle.startPos.x+deltaX)?resizeHelperX:0,resizeHelperY=0<(resizeHelperY=selectedHandle.startPos.y+deltaY)?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",selectedElmX+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",selectedElmY+(startH-height)),(deltaX=rootElement.scrollWidth-startScrollWidth)+(deltaY=rootElement.scrollHeight-startScrollHeight)!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(editor.fire("ObjectResizeStart",{target:selectedElm,width:startW,height:startH}),resizeStarted=!0)}function endGhostResize(){function setSizeProp(name,value){value&&(selectedElm.style[name]||!editor.schema.isValid(selectedElm.nodeName.toLowerCase(),name)?dom.setStyle(selectedElm,name,value):dom.setAttrib(selectedElm,name,value))}resizeStarted=!1,setSizeProp("width",width),setSizeProp("height",height),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!=editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),isIE&&"TABLE"!=selectedElm.nodeName||showResizeRect(selectedElm),editor.fire("ObjectResized",{target:selectedElm,width:width,height:height}),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style")),editor.nodeChanged()}function showResizeRect(targetElm,mouseDownHandleName,mouseDownEvent){var position,targetWidth,targetHeight,e,rect;hideResizeRect(),unbindResizeHandleEvents(),position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top,selectedElm!=targetElm&&(detachResizeStartListener(),selectedElm=targetElm,width=height=0),e=editor.fire("ObjectSelected",{target:targetElm}),isResizable(targetElm)&&!e.isDefaultPrevented()?each(resizeHandles,function(handle,name){var handleElm;function startDrag(e){startX=e.screenX,startY=e.screenY,startW=selectedElm.clientWidth,startH=selectedElm.clientHeight,ratio=startH/startW,(selectedHandle=handle).startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,selectedElmGhost=selectedElm.cloneNode(!0),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable=!1,selectedElmGhost.unSelectabe=!0,dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!=editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{"class":"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)}mouseDownHandleName?name==mouseDownHandleName&&startDrag(mouseDownEvent):((handleElm=dom.get("mceResizeHandle"+name))&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all","class":"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",function(e){e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)}),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2}))}):hideResizeRect(),selectedElm.setAttribute("data-mce-selected","1")}function hideResizeRect(){var name,handleElm;for(name in unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute("data-mce-selected"),resizeHandles)(handleElm=dom.get("mceResizeHandle"+name))&&(dom.unbind(handleElm),dom.remove(handleElm))}function updateResizeRect(e){var startElm,controlElm;function isChildOrEqual(node,parent){if(node)do{if(node===parent)return!0}while(node=node.parentNode)}resizeStarted||editor.removed||(each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),function(img){img.removeAttribute("data-mce-selected")}),controlElm="mousedown"==e.type?e.target:selection.getNode(),isChildOrEqual(controlElm=dom.$(controlElm).closest(isIE?"table":"table,img,hr")[0],rootElement)&&(disableGeckoResize(),isChildOrEqual(startElm=selection.getStart(!0),controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm)&&(!isIE||controlElm!=startElm&&"IMG"!==startElm.nodeName))?showResizeRect(controlElm):hideResizeRect())}function attachEvent(elm,name,func){elm&&elm.attachEvent&&elm.attachEvent("on"+name,func)}function detachEvent(elm,name,func){elm&&elm.detachEvent&&elm.detachEvent("on"+name,func)}function resizeNativeStart(e){var pos,name,corner,cornerX,cornerY,relativeX,relativeY,target=e.srcElement;for(name in pos=target.getBoundingClientRect(),relativeX=lastMouseDownEvent.clientX-pos.left,relativeY=lastMouseDownEvent.clientY-pos.top,resizeHandles)if(corner=resizeHandles[name],cornerX=target.offsetWidth*corner[0],cornerY=target.offsetHeight*corner[1],abs(cornerX-relativeX)<8&&abs(cornerY-relativeY)<8){selectedHandle=corner;break}resizeStarted=!0,editor.fire("ObjectResizeStart",{target:selectedElm,width:selectedElm.clientWidth,height:selectedElm.clientHeight}),editor.getDoc().selection.empty(),showResizeRect(target,name,lastMouseDownEvent)}function isWithinContentEditableFalse(elm){return isContentEditableFalse(function getContentEditableRoot(root,node){for(;node&&node!=root;){if(isContentEditableTrue(node)||isContentEditableFalse(node))return node;node=node.parentNode}return null}(editor.getBody(),elm))}function nativeControlSelect(e){var target=e.srcElement;if(isWithinContentEditableFalse(target))(function preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1})(e);else if(target!=selectedElm){if(editor.fire("ObjectSelected",{target:target}),detachResizeStartListener(),0===target.id.indexOf("mceResizeHandle"))return void(e.returnValue=!1);"IMG"!=target.nodeName&&"TABLE"!=target.nodeName||(hideResizeRect(),attachEvent(selectedElm=target,"resizestart",resizeNativeStart))}}function detachResizeStartListener(){detachEvent(selectedElm,"resizestart",resizeNativeStart)}function unbindResizeHandleEvents(){for(var name in resizeHandles){var handle=resizeHandles[name];handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}}function disableGeckoResize(){try{editor.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(ex){}}function controlSelect(elm){var ctrlRng;if(isIE){ctrlRng=editableDoc.body.createControlRange();try{return ctrlRng.addElement(elm),ctrlRng.select(),!0}catch(ex){}}}return editor.contentStyles.push(rootClass+" div.mce-resizehandle {position: absolute;border: 1px solid black;box-sizing: box-sizing;background: #FFF;width: 7px;height: 7px;z-index: 10000}"+rootClass+" .mce-resizehandle:hover {background: #000}"+rootClass+" img[data-mce-selected],"+rootClass+" hr[data-mce-selected] {outline: 1px solid black;resize: none}"+rootClass+" .mce-clonedresizable {position: absolute;"+(Env.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}"+rootClass+" .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}"),editor.on("init",function(){isIE?(editor.on("ObjectResized",function(e){"TABLE"!=e.target.nodeName&&(hideResizeRect(),controlSelect(e.target))}),attachEvent(rootElement,"controlselect",nativeControlSelect),editor.on("mousedown",function(e){lastMouseDownEvent=e})):(disableGeckoResize(),11<=Env.ie&&(editor.on("mousedown click",function(e){var target=e.target,nodeName=target.nodeName;resizeStarted||!/^(TABLE|IMG|HR)$/.test(nodeName)||isWithinContentEditableFalse(target)||(editor.selection.select(target,"TABLE"==nodeName),"mousedown"==e.type&&editor.nodeChanged())}),editor.dom.bind(rootElement,"mscontrolselect",function(e){function delayedSelect(node){Delay.setEditorTimeout(editor,function(){editor.selection.select(node)})}if(isWithinContentEditableFalse(e.target))return e.preventDefault(),void delayedSelect(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"==e.target.tagName&&delayedSelect(e.target))})));var throttledUpdateResizeRect=Delay.throttle(function(e){editor.composing||updateResizeRect(e)});editor.on("nodechange ResizeEditor ResizeWindow drop",throttledUpdateResizeRect),editor.on("keyup compositionend",function(e){selectedElm&&"TABLE"==selectedElm.nodeName&&throttledUpdateResizeRect(e)}),editor.on("hide blur",hideResizeRect)}),editor.on("remove",unbindResizeHandleEvents),{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,controlSelect:controlSelect,destroy:function destroy(){selectedElm=selectedElmGhost=null,isIE&&(detachResizeStartListener(),detachEvent(rootElement,"controlselect",nativeControlSelect))}}}}),define("tinymce.core.util.Fun",[],function(){var slice=[].slice;return{constant:function constant(value){return function(){return value}},negate:function negate(predicate){return function(x){return!predicate(x)}},and:function and(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}},or:function or(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}},curry:function curry(fn){var args=slice.call(arguments);return args.length-1>=fn.length?fn.apply(this,args.slice(1)):function(){var tempArgs=args.concat([].slice.call(arguments));return curry.apply(this,tempArgs)}},compose:function compose(f,g){return function(x){return f(g(x))}},noop:function noop(){}}}),define("tinymce.core.caret.CaretCandidate",["tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.caret.CaretContainer"],function(NodeType,Arr,CaretContainer){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBr=NodeType.isBr,isText=NodeType.isText,isInvalidTextElement=NodeType.matchNodeNames("script style textarea"),isAtomicInline=NodeType.matchNodeNames("img input textarea hr iframe video audio object"),isTable=NodeType.matchNodeNames("table"),isCaretContainer=CaretContainer.isCaretContainer;function isCaretCandidate(node){return!isCaretContainer(node)&&(isText(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr(node)||isTable(node)||isContentEditableFalse(node))}function isInEditable(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode){if(isContentEditableFalse(node))return!1;if(isContentEditableTrue(node))return!0}return!0}return{isCaretCandidate:isCaretCandidate,isInEditable:isInEditable,isAtomic:function isAtomic(node){return isAtomicInline(node)||function isAtomicContentEditableFalse(node){return!!isContentEditableFalse(node)&&!0!==Arr.reduce(node.getElementsByTagName("*"),function(result,elm){return result||isContentEditableTrue(elm)},!1)}(node)},isEditableCaretCandidate:function isEditableCaretCandidate(node,rootNode){return isCaretCandidate(node)&&isInEditable(node,rootNode)}}}),define("tinymce.core.geom.ClientRect",[],function(){var round=Math.round;function clone(rect){return rect?{left:round(rect.left),top:round(rect.top),bottom:round(rect.bottom),right:round(rect.right),width:round(rect.width),height:round(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}}function isValidOverflow(overflowY,clientRect1,clientRect2){return 0<=overflowY&&overflowY<=Math.min(clientRect1.height,clientRect2.height)/2}function isAbove(clientRect1,clientRect2){return clientRect1.bottom-clientRect1.height/2<clientRect2.top||!(clientRect1.top>clientRect2.bottom)&&isValidOverflow(clientRect2.top-clientRect1.bottom,clientRect1,clientRect2)}function isBelow(clientRect1,clientRect2){return clientRect1.top>clientRect2.bottom||!(clientRect1.bottom<clientRect2.top)&&isValidOverflow(clientRect2.bottom-clientRect1.top,clientRect1,clientRect2)}function isLeft(clientRect1,clientRect2){return clientRect1.left<clientRect2.left}function isRight(clientRect1,clientRect2){return clientRect1.right>clientRect2.right}return{clone:clone,collapse:function collapse(clientRect,toStart){return clientRect=clone(clientRect),toStart||(clientRect.left=clientRect.left+clientRect.width),clientRect.right=clientRect.left,clientRect.width=0,clientRect},isEqual:function isEqual(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right},isAbove:isAbove,isBelow:isBelow,isLeft:isLeft,isRight:isRight,compare:function compare(clientRect1,clientRect2){return isAbove(clientRect1,clientRect2)?-1:isBelow(clientRect1,clientRect2)?1:isLeft(clientRect1,clientRect2)?-1:isRight(clientRect1,clientRect2)?1:0},containsXY:function containsXY(clientRect,clientX,clientY){return clientX>=clientRect.left&&clientX<=clientRect.right&&clientY>=clientRect.top&&clientY<=clientRect.bottom}}}),define("tinymce.core.text.ExtendingChar",[],function(){var extendingChars=new RegExp("[̀-ͯ҃-҇҈-҉֑-ֽֿׁ-ׂׄ-ׇׅؐ-ًؚ-ٰٟۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣣ-ंऺ़ु-ै्॑-ॗॢ-ॣঁ়াু-ৄ্ৗৢ-ৣਁ-ਂ਼ੁ-ੂੇ-ੈੋ-੍ੑੰ-ੱੵઁ-ં઼ુ-ૅે-ૈ્ૢ-ૣଁ଼ାିୁ-ୄ୍ୖୗୢ-ୣஂாீ்ௗఀా-ీె-ైొ-్ౕ-ౖౢ-ౣಁ಼ಿೂೆೌ-್ೕ-ೖೢ-ೣഁാു-ൄ്ൗൢ-ൣ්ාි-ුූෟัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-ཱ༹༙༵༷-ཾྀ-྄྆-྇ྍ-ྗྙ-ྼ࿆ိ-ူဲ-့္-်ွ-ှၘ-ၙၞ-ၠၱ-ၴႂႅ-ႆႍႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳ឴-឵ិ-ួំ៉-៓៝᠋-᠍ᢩᤠ-ᤢᤧ-ᤨᤲ᤹-᤻ᨗ-ᨘᨛᩖᩘ-ᩞ᩠ᩢᩥ-ᩬᩳ-᩿᩼᪰-᪽᪾ᬀ-ᬃ᬴ᬶ-ᬺᬼᭂ᭫-᭳ᮀ-ᮁᮢ-ᮥᮨ-ᮩ᮫-ᮭ᯦ᯨ-ᯩᯭᯯ-ᯱᰬ-ᰳᰶ-᰷᳐-᳔᳒-᳢᳠-᳨᳭᳴᳸-᳹᷀-᷵᷼-᷿‌-‍⃐-⃜⃝-⃠⃡⃢-⃤⃥-⃰⳯-⵿⳱ⷠ-〪ⷿ-〭〮-゙〯-゚꙯꙰-꙲ꙴ-꙽ꚞ-ꚟ꛰-꛱ꠂ꠆ꠋꠥ-ꠦ꣄꣠-꣱ꤦ-꤭ꥇ-ꥑꦀ-ꦂ꦳ꦶ-ꦹꦼꧥꨩ-ꨮꨱ-ꨲꨵ-ꨶꩃꩌꩼꪰꪲ-ꪴꪷ-ꪸꪾ-꪿꫁ꫬ-ꫭ꫶ꯥꯨ꯭ﬞ︀-️︠-︯ﾞ-ﾟ]");return{isExtendingChar:function isExtendingChar(ch){return"string"==typeof ch&&768<=ch.charCodeAt(0)&&extendingChars.test(ch)}}}),define("tinymce.core.caret.CaretPosition",["tinymce.core.util.Fun","tinymce.core.dom.NodeType","tinymce.core.dom.DOMUtils","tinymce.core.dom.RangeUtils","tinymce.core.caret.CaretCandidate","tinymce.core.geom.ClientRect","tinymce.core.text.ExtendingChar"],function(Fun,NodeType,DOMUtils,RangeUtils,CaretCandidate,ClientRect,ExtendingChar){var isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,isBlock=NodeType.matchStyleValues("display","block table"),isFloated=NodeType.matchStyleValues("float","left right"),isValidElementCaretCandidate=Fun.and(isElement,isCaretCandidate,Fun.negate(isFloated)),isNotPre=Fun.negate(NodeType.matchStyleValues("white-space","pre pre-line pre-wrap")),isText=NodeType.isText,isBr=NodeType.isBr,nodeIndex=DOMUtils.nodeIndex,resolveIndex=RangeUtils.getNode;function createRange(doc){return"createRange"in doc?doc.createRange():DOMUtils.DOM.createRng()}function isWhiteSpace(chr){return chr&&/[\r\n\t ]/.test(chr)}function isHiddenWhiteSpaceRange(range){var text,container=range.startContainer,offset=range.startOffset;return!(!isWhiteSpace(range.toString())||!isNotPre(container.parentNode)||!isWhiteSpace((text=container.data)[offset-1])&&!isWhiteSpace(text[offset+1]))}function getCaretPositionClientRects(caretPosition){var beforeNode,node,clientRects=[];function getBoundingClientRect(item){var clientRect,clientRects;return clientRect=0<(clientRects=item.getClientRects()).length?ClientRect.clone(clientRects[0]):ClientRect.clone(item.getBoundingClientRect()),isBr(item)&&0===clientRect.left?function getBrClientRect(brNode){var clientRect,doc=brNode.ownerDocument,rng=createRange(doc),nbsp=doc.createTextNode(" "),parentNode=brNode.parentNode;return parentNode.insertBefore(nbsp,brNode),rng.setStart(nbsp,0),rng.setEnd(nbsp,1),clientRect=ClientRect.clone(rng.getBoundingClientRect()),parentNode.removeChild(nbsp),clientRect}(item):clientRect}function collapseAndInflateWidth(clientRect,toStart){return(clientRect=ClientRect.collapse(clientRect,toStart)).width=1,clientRect.right=clientRect.left+1,clientRect}function addUniqueAndValidRect(clientRect){0!==clientRect.height&&(0<clientRects.length&&ClientRect.isEqual(clientRect,clientRects[clientRects.length-1])||clientRects.push(clientRect))}function addCharacterOffset(container,offset){var range=createRange(container.ownerDocument);if(offset<container.data.length){if(ExtendingChar.isExtendingChar(container.data[offset]))return clientRects;if(ExtendingChar.isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1)),clientRects}0<offset&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!0)))}if(isText(caretPosition.container()))return addCharacterOffset(caretPosition.container(),caretPosition.offset()),clientRects;if(isElement(caretPosition.container()))if(caretPosition.isAtEnd())node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1));else{if(node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1)),clientRects;beforeNode=resolveIndex(caretPosition.container(),caretPosition.offset()-1),isValidElementCaretCandidate(beforeNode)&&!isBr(beforeNode)&&(!isBlock(beforeNode)&&!isBlock(node)&&isValidElementCaretCandidate(node)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode),!1))),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!0))}return clientRects}function CaretPosition(container,offset,clientRects){function getClientRects(){return clientRects=clientRects||getCaretPositionClientRects(new CaretPosition(container,offset))}return{container:Fun.constant(container),offset:Fun.constant(offset),toRange:function toRange(){var range;return(range=createRange(container.ownerDocument)).setStart(container,offset),range.setEnd(container,offset),range},getClientRects:getClientRects,isVisible:function isVisible(){return 0<getClientRects().length},isAtStart:function isAtStart(){return isText(container),0===offset},isAtEnd:function isAtEnd(){return isText(container)?offset>=container.data.length:offset>=container.childNodes.length},isEqual:function isEqual(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()},getNode:function getNode(before){return resolveIndex(container,before?offset-1:offset)}}}return CaretPosition.fromRangeStart=function(range){return new CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return new CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return new CaretPosition(node.parentNode,nodeIndex(node)+1)},CaretPosition.before=function(node){return new CaretPosition(node.parentNode,nodeIndex(node))},CaretPosition.isAtStart=function(pos){return!!pos&&pos.isAtStart()},CaretPosition.isAtEnd=function(pos){return!!pos&&pos.isAtEnd()},CaretPosition.isTextPosition=function(pos){return!!pos&&NodeType.isText(pos.container())},CaretPosition}),define("tinymce.core.caret.CaretBookmark",["tinymce.core.dom.NodeType","tinymce.core.dom.DOMUtils","tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.caret.CaretPosition"],function(NodeType,DomUtils,Fun,Arr,CaretPosition){var isText=NodeType.isText,isBogus=NodeType.isBogus,nodeIndex=DomUtils.nodeIndex;function getChildNodes(node){return node?Arr.reduce(node.childNodes,function(result,node){return isBogus(node)&&"BR"!=node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result},[]):[]}function equal(targetValue){return function(value){return targetValue===value}}function normalizedNodeIndex(node){var nodes,index,numTextFragments;return nodes=getChildNodes(function normalizedParent(node){var parentNode=node.parentNode;return isBogus(parentNode)?normalizedParent(parentNode):parentNode}(node)),index=Arr.findIndex(nodes,equal(node),node),nodes=nodes.slice(0,index+1),numTextFragments=Arr.reduce(nodes,function(result,node,i){return isText(node)&&isText(nodes[i-1])&&result++,result},0),nodes=Arr.filter(nodes,NodeType.matchNodeNames(node.nodeName)),(index=Arr.findIndex(nodes,equal(node),node))-numTextFragments}function createPathItem(node){return(isText(node)?"text()":node.nodeName.toLowerCase())+"["+normalizedNodeIndex(node)+"]"}return{create:function create(rootNode,caretPosition){var container,offset,outputOffset,childNodes,parents,path=[];return container=caretPosition.container(),offset=caretPosition.offset(),isText(container)?outputOffset=function normalizedTextOffset(textNode,offset){for(;(textNode=textNode.previousSibling)&&isText(textNode);)offset+=textNode.data.length;return offset}(container,offset):(offset>=(childNodes=container.childNodes).length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]),path.push(createPathItem(container)),parents=function parentsUntil(rootNode,node,predicate){var parents=[];for(node=node.parentNode;node!=rootNode&&(!predicate||!predicate(node));node=node.parentNode)parents.push(node);return parents}(rootNode,container),parents=Arr.filter(parents,Fun.negate(NodeType.isBogus)),(path=path.concat(Arr.map(parents,function(node){return createPathItem(node)}))).reverse().join("/")+","+outputOffset},resolve:function resolve(rootNode,path){var parts,container,offset;return path?(path=(parts=path.split(","))[0].split("/"),offset=1<parts.length?parts[1]:"before",(container=Arr.reduce(path,function(result,value){return(value=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value))?("text()"===value[1]&&(value[1]="#text"),function resolvePathItem(node,name,index){var nodes=getChildNodes(node);return nodes=Arr.filter(nodes,function(node,index){return!isText(node)||!isText(nodes[index-1])}),(nodes=Arr.filter(nodes,NodeType.matchNodeNames(name)))[index]}(result,value[1],parseInt(value[2],10))):null},rootNode))?isText(container)?function findTextPosition(container,offset){for(var dataLen,node=container,targetOffset=0;isText(node);){if(dataLen=node.data.length,targetOffset<=offset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return offset>container.data.length&&(offset=container.data.length),new CaretPosition(container,offset)}(container,parseInt(offset,10)):(offset="after"===offset?nodeIndex(container)+1:nodeIndex(container),new CaretPosition(container.parentNode,offset)):null):null}}}),define("tinymce.core.dom.BookmarkManager",["tinymce.core.caret.CaretBookmark","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.Env","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(CaretBookmark,CaretContainer,CaretPosition,NodeType,RangeUtils,Env,Zwsp,Tools){var isContentEditableFalse=NodeType.isContentEditableFalse;function BookmarkManager(selection){var dom=selection.dom;this.getBookmark=function(type,normalized){var rng,rng2,id,collapsed,name,element,styles,chr="&#xFEFF;";function findIndex(name,element){var count=0;return Tools.each(dom.select(name),function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!=element&&void count++}),count}function normalizeTableCellSelection(rng){function moveEndPoint(start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"],offset=rng[prefix+"Offset"],1==container.nodeType&&"TR"==container.nodeName&&(container=(childNodes=container.childNodes)[Math.min(start?offset:offset-1,childNodes.length-1)])&&(offset=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,offset))}return moveEndPoint(!0),moveEndPoint(),rng}if(2==type)return name=(element=selection.getNode())?element.nodeName:null,rng=selection.getRng(),isContentEditableFalse(element)||"IMG"==name?{name:name,index:findIndex(name,element)}:selection.tridentSel?selection.tridentSel.getBookmark(type):(element=function findAdjacentContentEditableFalseElm(rng){function findSibling(node,offset){var sibling;if(NodeType.isElement(node)&&(node=RangeUtils.getNode(node,offset),isContentEditableFalse(node)))return node;if(CaretContainer.isCaretContainer(node)){if(NodeType.isText(node)&&CaretContainer.isCaretContainerBlock(node)&&(node=node.parentNode),sibling=node.previousSibling,isContentEditableFalse(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse(sibling))return sibling}}return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset)}(rng))?{name:name=element.tagName,index:findIndex(name,element)}:function getLocation(rng){var root=dom.getRoot(),bookmark={};function getPoint(rng,start){var childNodes,container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],after=0;for(3===container.nodeType?point.push(normalized?function(container,offset){var node,trimmedOffset;for(trimmedOffset=Zwsp.trim(container.data.slice(0,offset)).length,node=container.previousSibling;node&&3===node.nodeType;node=node.previousSibling)trimmedOffset+=Zwsp.trim(node.data).length;return trimmedOffset}(container,offset):offset):(offset>=(childNodes=container.childNodes).length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after));container&&container!=root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point}return bookmark.start=getPoint(rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(rng)),bookmark}(rng);if(3==type)return rng=selection.getRng(),{start:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeEnd(rng))};if(type)return{rng:selection.getRng()};if(rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),styles="overflow:hidden;line-height:0px",rng.duplicate||rng.item){if(rng.item)return{name:name=(element=rng.item(0)).nodeName,index:findIndex(name,element)};rng2=rng.duplicate();try{rng.collapse(),rng.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_start" style="'+styles+'">'+chr+"</span>"),collapsed||(rng2.collapse(!1),rng.moveToElementText(rng2.parentElement()),0===rng.compareEndPoints("StartToEnd",rng2)&&rng2.move("character",-1),rng2.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_end" style="'+styles+'">'+chr+"</span>"))}catch(ex){return null}}else{if("IMG"==(name=(element=selection.getNode()).nodeName))return{name:name,index:findIndex(name,element)};rng2=normalizeTableCellSelection(rng.cloneRange()),collapsed||(rng2.collapse(!1),rng2.insertNode(dom.create("span",{"data-mce-type":"bookmark",id:id+"_end",style:styles},chr))),(rng=normalizeTableCellSelection(rng)).collapse(!0),rng.insertNode(dom.create("span",{"data-mce-type":"bookmark",id:id+"_start",style:styles},chr))}return selection.moveToBookmark({id:id,keep:1}),{id:id}},this.moveToBookmark=function(bookmark){var rng,root,startContainer,endContainer,startOffset,endOffset;function setEndPoint(start){var i,node,offset,children,point=bookmark[start?"start":"end"];if(point){for(offset=point[0],node=root,i=point.length-1;1<=i;i--){if(children=node.childNodes,point[i]>children.length-1)return;node=children[point[i]]}3===node.nodeType&&(offset=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0}function restoreEndPoint(suffix){var node,idx,next,prev,marker=dom.get(bookmark.id+"_"+suffix),keep=bookmark.keep;if(marker&&(node=marker.parentNode,"start"==suffix?(idx=keep?(node=marker.firstChild,1):dom.nodeIndex(marker),startContainer=endContainer=node,startOffset=endOffset=idx):(idx=keep?(node=marker.firstChild,1):dom.nodeIndex(marker),endContainer=node,endOffset=idx),!keep)){for(prev=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),function(node){3==node.nodeType&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))});marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,1);prev&&next&&prev.nodeType==next.nodeType&&3==prev.nodeType&&!Env.opera&&(idx=prev.nodeValue.length,prev.appendData(next.nodeValue),dom.remove(next),"start"==suffix?(startContainer=endContainer=prev,startOffset=endOffset=idx):(endContainer=prev,endOffset=idx))}}function addBogus(node){return!dom.isBlock(node)||node.innerHTML||Env.ie||(node.innerHTML='<br data-mce-bogus="1" />'),node}if(bookmark)if(Tools.isArray(bookmark.start)){if(rng=dom.createRng(),root=dom.getRoot(),selection.tridentSel)return selection.tridentSel.moveToBookmark(bookmark);setEndPoint(!0)&&setEndPoint()&&selection.setRng(rng)}else"string"==typeof bookmark.start?selection.setRng(function resolveCaretPositionBookmark(){var rng,pos;return rng=dom.createRng(),pos=CaretBookmark.resolve(dom.getRoot(),bookmark.start),rng.setStart(pos.container(),pos.offset()),pos=CaretBookmark.resolve(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng}()):bookmark.id?(restoreEndPoint("start"),restoreEndPoint("end"),startContainer&&((rng=dom.createRng()).setStart(addBogus(startContainer),startOffset),rng.setEnd(addBogus(endContainer),endOffset),selection.setRng(rng))):bookmark.name?selection.select(dom.select(bookmark.name)[bookmark.index]):bookmark.rng&&selection.setRng(bookmark.rng)}}return BookmarkManager.isBookmarkNode=function(node){return node&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},BookmarkManager}),define("tinymce.core.dom.ScrollIntoView",["tinymce.core.dom.NodeType"],function(NodeType){var getPos=function(elm){for(var x=0,y=0,offsetParent=elm;offsetParent&&offsetParent.nodeType;)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;return{x:x,y:y}};return{scrollIntoView:function(editor,elm,alignToTop){var y,viewPort,viewPortY,viewPortH,dom=editor.dom,root=dom.getRoot(),offsetY=0;if(!function(editor,elm,alignToTop){var scrollEvent={elm:elm,alignToTop:alignToTop};return editor.fire("scrollIntoView",scrollEvent),scrollEvent.isDefaultPrevented()}(editor,elm,alignToTop)&&NodeType.isElement(elm)){if(!1===alignToTop&&(offsetY=elm.offsetHeight),"BODY"!==root.nodeName){var scrollContainer=editor.selection.getScrollContainer();if(scrollContainer)return y=getPos(elm).y-getPos(scrollContainer).y+offsetY,viewPortH=scrollContainer.clientHeight,void((y<(viewPortY=scrollContainer.scrollTop)||viewPortY+viewPortH<y+25)&&(scrollContainer.scrollTop=y<viewPortY?y:y-viewPortH+25))}viewPort=dom.getViewPort(editor.getWin()),y=dom.getPos(elm).y+offsetY,viewPortY=viewPort.y,viewPortH=viewPort.h,(y<viewPort.y||viewPortY+viewPortH<y+25)&&editor.getWin().scrollTo(0,y<viewPortY?y:y-viewPortH+25)}}}}),define("tinymce.core.dom.TridentSelection",[],function(){return function Selection(selection){var self=this,dom=selection.dom;function getPosition(rng,start){var checkRng,endIndex,inside,children,child,offset,index,parent,startIndex=0,position=-1;if((checkRng=rng.duplicate()).collapse(start),(parent=checkRng.parentElement()).ownerDocument===selection.dom.doc){for(;"false"===parent.contentEditable;)parent=parent.parentNode;if(!parent.hasChildNodes())return{node:parent,inside:1};for(endIndex=(children=parent.children).length-1;startIndex<=endIndex;)if(child=children[index=Math.floor((startIndex+endIndex)/2)],checkRng.moveToElementText(child),0<(position=checkRng.compareEndPoints(start?"StartToStart":"EndToEnd",rng)))endIndex=index-1;else{if(!(position<0))return{node:child};startIndex=index+1}if(position<0)for(child?checkRng.collapse(!1):(checkRng.moveToElementText(parent),checkRng.collapse(!0),child=parent,inside=!0),offset=0;0!==checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)&&0!==checkRng.move("character",1)&&parent==checkRng.parentElement();)offset++;else for(checkRng.collapse(!0),offset=0;0!==checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)&&0!==checkRng.move("character",-1)&&parent==checkRng.parentElement();)offset++;return{node:child,position:position,offset:offset,inside:inside}}}this.getBookmark=function(type){var rng=selection.getRng(),bookmark={};function getIndexes(node){var parent,root,children,i,indexes=[];for(parent=node.parentNode,root=dom.getRoot().parentNode;parent!=root&&9!==parent.nodeType;){for(i=(children=parent.children).length;i--;)if(node===children[i]){indexes.push(i);break}parent=(node=parent).parentNode}return indexes}function getBookmarkEndPoint(start){var position;if(position=getPosition(rng,start))return{position:position.position,offset:position.offset,indexes:getIndexes(position.node),inside:position.inside}}return 2===type&&(rng.item?bookmark.start={ctrl:!0,indexes:getIndexes(rng.item(0))}:(bookmark.start=getBookmarkEndPoint(!0),selection.isCollapsed()||(bookmark.end=getBookmarkEndPoint()))),bookmark},this.moveToBookmark=function(bookmark){var rng,body=dom.doc.body;function resolveIndexes(indexes){var node,i,idx,children;for(node=dom.getRoot(),i=indexes.length-1;0<=i;i--)children=node.children,(idx=indexes[i])<=children.length-1&&(node=children[idx]);return node}function setBookmarkEndPoint(start){var moveLeft,moveRng,offset,endPoint=bookmark[start?"start":"end"];endPoint&&(moveLeft=0<endPoint.position,(moveRng=body.createTextRange()).moveToElementText(resolveIndexes(endPoint.indexes)),void 0!==(offset=endPoint.offset)?(moveRng.collapse(endPoint.inside||moveLeft),moveRng.moveStart("character",moveLeft?-offset:offset)):moveRng.collapse(start),rng.setEndPoint(start?"StartToStart":"EndToStart",moveRng),start&&rng.collapse(!0))}bookmark.start&&(bookmark.start.ctrl?(rng=body.createControlRange()).addElement(resolveIndexes(bookmark.start.indexes)):(rng=body.createTextRange(),setBookmarkEndPoint(!0),setBookmarkEndPoint()),rng.select())},this.addRange=function(rng){var ieRng,ctrlRng,startContainer,startOffset,endContainer,endOffset,sibling,nativeRng,ctrlElm,doc=selection.dom.doc,body=doc.body;function setEndPoint(start){var container,offset,marker,tmpRng,nodes;marker=dom.create("a"),container=start?startContainer:endContainer,offset=start?startOffset:endOffset,tmpRng=ieRng.duplicate(),container!=doc&&container!=doc.documentElement||(container=body,offset=0),3==container.nodeType?(container.parentNode.insertBefore(marker,container),tmpRng.moveToElementText(marker),tmpRng.moveStart("character",offset),dom.remove(marker),ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng)):((nodes=container.childNodes).length?(offset>=nodes.length?dom.insertAfter(marker,nodes[nodes.length-1]):container.insertBefore(marker,nodes[offset]),tmpRng.moveToElementText(marker)):container.canHaveHTML&&(container.innerHTML="<span>&#xFEFF;</span>",marker=container.firstChild,tmpRng.moveToElementText(marker),tmpRng.collapse(!1)),ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng),dom.remove(marker))}if(startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,ieRng=body.createTextRange(),startContainer==endContainer&&1==startContainer.nodeType){if(startOffset==endOffset&&!startContainer.hasChildNodes()){if(startContainer.canHaveHTML)return(sibling=startContainer.previousSibling)&&!sibling.hasChildNodes()&&dom.isBlock(sibling)?sibling.innerHTML="&#xFEFF;":sibling=null,startContainer.innerHTML="<span>&#xFEFF;</span><span>&#xFEFF;</span>",ieRng.moveToElementText(startContainer.lastChild),ieRng.select(),dom.doc.selection.clear(),startContainer.innerHTML="",void(sibling&&(sibling.innerHTML=""));startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode}if(startOffset==endOffset-1)try{if(ctrlElm=startContainer.childNodes[startOffset],(ctrlRng=body.createControlRange()).addElement(ctrlElm),ctrlRng.select(),(nativeRng=selection.getRng()).item&&ctrlElm===nativeRng.item(0))return}catch(ex){}}setEndPoint(!0),setEndPoint(),ieRng.select()},this.getRangeAt=function getRange(){var element,collapsed,tmpRange,element2,bookmark,ieRange=selection.getRng(),domRange=dom.createRng();if((element=ieRange.item?ieRange.item(0):ieRange.parentElement()).ownerDocument!=dom.doc)return domRange;if(collapsed=selection.isCollapsed(),ieRange.item)return domRange.setStart(element.parentNode,dom.nodeIndex(element)),domRange.setEnd(domRange.startContainer,domRange.startOffset+1),domRange;function findEndPoint(start){var container,offset,sibling,nodeValue,endPoint=getPosition(ieRange,start),textNodeOffset=0;if(container=endPoint.node,offset=endPoint.offset,!endPoint.inside||container.hasChildNodes())if(void 0!==offset){if(endPoint.position<0){if(!(sibling=endPoint.inside?container.firstChild:container.nextSibling))return void domRange[start?"setStartAfter":"setEndAfter"](container);if(!offset)return void(3==sibling.nodeType?domRange[start?"setStart":"setEnd"](sibling,0):domRange[start?"setStartBefore":"setEndBefore"](sibling));for(;sibling;){if(3==sibling.nodeType&&offset<=(textNodeOffset+=(nodeValue=sibling.nodeValue).length)){container=sibling,textNodeOffset-=offset,textNodeOffset=nodeValue.length-textNodeOffset;break}sibling=sibling.nextSibling}}else{if(!(sibling=container.previousSibling))return domRange[start?"setStartBefore":"setEndBefore"](container);if(!offset)return void(3==container.nodeType?domRange[start?"setStart":"setEnd"](sibling,container.nodeValue.length):domRange[start?"setStartAfter":"setEndAfter"](sibling));for(;sibling;){if(3==sibling.nodeType&&offset<=(textNodeOffset+=sibling.nodeValue.length)){container=sibling,textNodeOffset-=offset;break}sibling=sibling.previousSibling}}domRange[start?"setStart":"setEnd"](container,textNodeOffset)}else domRange[start?"setStartBefore":"setEndAfter"](container);else domRange[start?"setStart":"setEnd"](container,0)}try{findEndPoint(!0),collapsed||findEndPoint()}catch(ex){if(-2147024809!=ex.number)throw ex;bookmark=self.getBookmark(2),(tmpRange=ieRange.duplicate()).collapse(!0),element=tmpRange.parentElement(),collapsed||((tmpRange=ieRange.duplicate()).collapse(!1),(element2=tmpRange.parentElement()).innerHTML=element2.innerHTML),element.innerHTML=element.innerHTML,self.moveToBookmark(bookmark),ieRange=selection.getRng(),findEndPoint(!0),collapsed||findEndPoint()}return domRange}}}),define("ephox.katamari.api.Type",["global!Array","global!String"],function(Array,String){var isType=function(type){return function(value){return function(x){if(null===x)return"null";var t=typeof x;return"object"==t&&Array.prototype.isPrototypeOf(x)?"array":"object"==t&&String.prototype.isPrototypeOf(x)?"string":t}(value)===type}};return{isString:isType("string"),isObject:isType("object"),isArray:isType("array"),isNull:isType("null"),isBoolean:isType("boolean"),isUndefined:isType("undefined"),isFunction:isType("function"),isNumber:isType("number")}}),define("ephox.katamari.data.Immutable",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","global!Array","global!Error"],function(Arr,Fun,Array,Error){return function(){var fields=arguments;return function(){for(var values=new Array(arguments.length),i=0;i<values.length;i++)values[i]=arguments[i];if(fields.length!==values.length)throw new Error('Wrong number of arguments to struct. Expected "['+fields.length+']", got '+values.length+" arguments");var struct={};return Arr.each(fields,function(name,i){struct[name]=Fun.constant(values[i])}),struct}}}),define("ephox.katamari.api.Obj",["ephox.katamari.api.Option","global!Object"],function(Option,Object){var fastKeys,keys=(fastKeys=Object.keys)===undefined?function(o){var r=[];for(var i in o)o.hasOwnProperty(i)&&r.push(i);return r}:fastKeys,each=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i,obj)}},tupleMap=function(obj,f){var r={};return each(obj,function(x,i){var tuple=f(x,i,obj);r[tuple.k]=tuple.v}),r},mapToArray=function(obj,f){var r=[];return each(obj,function(value,name){r.push(f(value,name))}),r},values=function(obj){return mapToArray(obj,function(v){return v})};return{bifilter:function(obj,pred){var t={},f={};return each(obj,function(x,i){(pred(x,i)?t:f)[i]=x}),{t:t,f:f}},each:each,map:function(obj,f){return tupleMap(obj,function(x,i,obj){return{k:i,v:f(x,i,obj)}})},mapToArray:mapToArray,tupleMap:tupleMap,find:function(obj,pred){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x=obj[i];if(pred(x,i,obj))return Option.some(x)}return Option.none()},keys:keys,values:values,size:function(obj){return values(obj).length}}}),define("ephox.katamari.util.BagUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Type","global!Error"],function(Arr,Type,Error){var sort=function(arr){return arr.slice(0).sort()};return{sort:sort,reqMessage:function(required,keys){throw new Error("All required keys ("+sort(required).join(", ")+") were not specified. Specified keys were: "+sort(keys).join(", ")+".")},unsuppMessage:function(unsupported){throw new Error("Unsupported keys for object: "+sort(unsupported).join(", "))},validateStrArr:function(label,array){if(!Type.isArray(array))throw new Error("The "+label+" fields must be an array. Was: "+array+".");Arr.each(array,function(a){if(!Type.isString(a))throw new Error("The value "+a+" in the "+label+" fields was not a string.")})},invalidTypeMessage:function(incorrect,type){throw new Error("All values need to be of type: "+type+". Keys ("+sort(incorrect).join(", ")+") were not.")},checkDupes:function(everything){var sorted=sort(everything);Arr.find(sorted,function(s,i){return i<sorted.length-1&&s===sorted[i+1]}).each(function(d){throw new Error("The field: "+d+" occurs more than once in the combined fields: ["+sorted.join(", ")+"].")})}}}),define("ephox.katamari.data.MixedBag",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Obj","ephox.katamari.api.Option","ephox.katamari.util.BagUtils","global!Error","global!Object"],function(Arr,Fun,Obj,Option,BagUtils,Error,Object){return function(required,optional){var everything=required.concat(optional);if(0===everything.length)throw new Error("You must specify at least one required or optional field.");return BagUtils.validateStrArr("required",required),BagUtils.validateStrArr("optional",optional),BagUtils.checkDupes(everything),function(obj){var keys=Obj.keys(obj);Arr.forall(required,function(req){return Arr.contains(keys,req)})||BagUtils.reqMessage(required,keys);var unsupported=Arr.filter(keys,function(key){return!Arr.contains(everything,key)});0<unsupported.length&&BagUtils.unsuppMessage(unsupported);var r={};return Arr.each(required,function(req){r[req]=Fun.constant(obj[req])}),Arr.each(optional,function(opt){r[opt]=Fun.constant(Object.prototype.hasOwnProperty.call(obj,opt)?Option.some(obj[opt]):Option.none())}),r}}}),define("ephox.katamari.api.Struct",["ephox.katamari.data.Immutable","ephox.katamari.data.MixedBag"],function(Immutable,MixedBag){return{immutable:Immutable,immutableBag:MixedBag}}),define("ephox.sugar.alien.Recurse",[],function(){return{toArray:function(target,f){for(var r=[],recurse=function(e){return r.push(e),f(e)},cur=f(target);(cur=cur.bind(recurse)).isSome(););return r}}}),define("ephox.katamari.api.Global",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),define("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(Global){var path=function(parts,scope){for(var o=scope!==undefined?scope:Global,i=0;i<parts.length&&o!==undefined&&null!==o;++i)o=o[parts[i]];return o},step=function(o,part){return o[part]!==undefined&&null!==o[part]||(o[part]={}),o[part]},forge=function(parts,target){for(var o=target!==undefined?target:Global,i=0;i<parts.length;++i)o=step(o,parts[i]);return o};return{path:path,resolve:function(p,scope){var parts=p.split(".");return path(parts,scope)},forge:forge,namespace:function(name,target){var parts=name.split(".");return forge(parts,target)}}}),define("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(Resolve){return{getOrDie:function(name,scope){var actual=function(name,scope){return Resolve.resolve(name,scope)}(name,scope);if(actual===undefined)throw name+" not available on this browser";return actual}}}),define("ephox.sand.api.Node",["ephox.sand.util.Global"],function(Global){var node=function(){return Global.getOrDie("Node")},compareDocumentPosition=function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)};return{documentPositionPreceding:function(a,b){return compareDocumentPosition(a,b,node().DOCUMENT_POSITION_PRECEDING)},documentPositionContainedBy:function(a,b){return compareDocumentPosition(a,b,node().DOCUMENT_POSITION_CONTAINED_BY)}}}),define("ephox.katamari.api.Thunk",[],function(){return{cached:function(f){var r,called=!1;return function(){return called||(called=!0,r=f.apply(null,arguments)),r}}}}),defineGlobal("global!Number",Number),define("ephox.sand.detect.Version",["ephox.katamari.api.Arr","global!Number","global!String"],function(Arr,Number,String){var find=function(regexes,agent){var r=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}return undefined}(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu(group(1),group(2))},unknown=function(){return nu(0,0)},nu=function(major,minor){return{major:major,minor:minor}};return{nu:nu,detect:function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown():find(versionRegexes,cleanedAgent)},unknown:unknown}}),define("ephox.sand.core.Browser",["ephox.katamari.api.Fun","ephox.sand.detect.Version"],function(Fun,Version){var isBrowser=function(name,current){return function(){return current===name}},nu=function(info){var current=info.current;return{current:current,version:info.version,isEdge:isBrowser("Edge",current),isChrome:isBrowser("Chrome",current),isIE:isBrowser("IE",current),isOpera:isBrowser("Opera",current),isFirefox:isBrowser("Firefox",current),isSafari:isBrowser("Safari",current)}};return{unknown:function(){return nu({current:undefined,version:Version.unknown()})},nu:nu,edge:Fun.constant("Edge"),chrome:Fun.constant("Chrome"),ie:Fun.constant("IE"),opera:Fun.constant("Opera"),firefox:Fun.constant("Firefox"),safari:Fun.constant("Safari")}}),define("ephox.sand.core.OperatingSystem",["ephox.katamari.api.Fun","ephox.sand.detect.Version"],function(Fun,Version){var isOS=function(name,current){return function(){return current===name}},nu=function(info){var current=info.current;return{current:current,version:info.version,isWindows:isOS("Windows",current),isiOS:isOS("iOS",current),isAndroid:isOS("Android",current),isOSX:isOS("OSX",current),isLinux:isOS("Linux",current),isSolaris:isOS("Solaris",current),isFreeBSD:isOS("FreeBSD",current)}};return{unknown:function(){return nu({current:undefined,version:Version.unknown()})},nu:nu,windows:Fun.constant("Windows"),ios:Fun.constant("iOS"),android:Fun.constant("Android"),linux:Fun.constant("Linux"),osx:Fun.constant("OSX"),solaris:Fun.constant("Solaris"),freebsd:Fun.constant("FreeBSD")}}),define("ephox.sand.detect.DeviceType",["ephox.katamari.api.Fun"],function(Fun){return function(os,browser,userAgent){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isAndroid3=os.isAndroid()&&3===os.version.major,isAndroid4=os.isAndroid()&&4===os.version.major,isTablet=isiPad||isAndroid3||isAndroid4&&!0===/mobile/i.test(userAgent),isTouch=os.isiOS()||os.isAndroid(),isPhone=isTouch&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent);return{isiPad:Fun.constant(isiPad),isiPhone:Fun.constant(isiPhone),isTablet:Fun.constant(isTablet),isPhone:Fun.constant(isPhone),isTouch:Fun.constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:Fun.constant(iOSwebview)}}}),define("ephox.sand.detect.UaString",["ephox.katamari.api.Arr","ephox.sand.detect.Version","global!String"],function(Arr,Version,String){var detect=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return Arr.find(candidates,function(candidate){return candidate.search(agent)})};return{detectBrowser:function(browsers,userAgent){return detect(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})},detectOs:function(oses,userAgent){return detect(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}}}),define("ephox.katamari.str.StrAppend",[],function(){return{addToStart:function(str,prefix){return prefix+str},addToEnd:function(str,suffix){return str+suffix},removeFromStart:function(str,numChars){return str.substring(numChars)},removeFromEnd:function(str,numChars){return str.substring(0,str.length-numChars)}}}),define("ephox.katamari.str.StringParts",["ephox.katamari.api.Option","global!Error"],function(Option,Error){return{first:function(str,count){return str.substr(0,count)},last:function(str,count){return str.substr(str.length-count,str.length)},head:function(str){return""===str?Option.none():Option.some(str.substr(0,1))},tail:function(str){return""===str?Option.none():Option.some(str.substring(1))}}}),define("ephox.katamari.api.Strings",["ephox.katamari.str.StrAppend","ephox.katamari.str.StringParts","global!Error"],function(StrAppend,StringParts,Error){var checkRange=function(str,substr,start){return""===substr||!(str.length<substr.length)&&str.substr(start,start+substr.length)===substr},startsWith=function(str,prefix){return checkRange(str,prefix,0)},endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length)};return{supplant:function(str,obj){return str.replace(/\${([^{}]*)}/g,function(a,b){var value=obj[b];return function(a){var t=typeof a;return"string"==t||"number"==t}(value)?value:a})},startsWith:startsWith,removeLeading:function(str,prefix){return startsWith(str,prefix)?StrAppend.removeFromStart(str,prefix.length):str},removeTrailing:function(str,prefix){return endsWith(str,prefix)?StrAppend.removeFromEnd(str,prefix.length):str},ensureLeading:function(str,prefix){return startsWith(str,prefix)?str:StrAppend.addToStart(str,prefix)},ensureTrailing:function(str,prefix){return endsWith(str,prefix)?str:StrAppend.addToEnd(str,prefix)},endsWith:endsWith,contains:function(str,substr){return-1!==str.indexOf(substr)},trim:function(str){return str.replace(/^\s+|\s+$/g,"")},lTrim:function(str){return str.replace(/^\s+/g,"")},rTrim:function(str){return str.replace(/\s+$/g,"")},capitalize:function(str){return StringParts.head(str).bind(function(head){return StringParts.tail(str).map(function(tail){return head.toUpperCase()+tail})}).getOr(str)}}}),define("ephox.sand.info.PlatformInfo",["ephox.katamari.api.Fun","ephox.katamari.api.Strings"],function(Fun,Strings){var normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return Strings.contains(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return Strings.contains(uastring,"edge/")&&Strings.contains(uastring,"chrome")&&Strings.contains(uastring,"safari")&&Strings.contains(uastring,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return Strings.contains(uastring,"chrome")&&!Strings.contains(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return Strings.contains(uastring,"msie")||Strings.contains(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(Strings.contains(uastring,"safari")||Strings.contains(uastring,"mobile/"))&&Strings.contains(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return Strings.contains(uastring,"iphone")||Strings.contains(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]}];return{browsers:Fun.constant(browsers),oses:Fun.constant(oses)}}),define("ephox.sand.core.PlatformDetection",["ephox.sand.core.Browser","ephox.sand.core.OperatingSystem","ephox.sand.detect.DeviceType","ephox.sand.detect.UaString","ephox.sand.info.PlatformInfo"],function(Browser,OperatingSystem,DeviceType,UaString,PlatformInfo){return{detect:function(userAgent){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=UaString.detectBrowser(browsers,userAgent).fold(Browser.unknown,Browser.nu),os=UaString.detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);return{browser:browser,os:os,deviceType:DeviceType(os,browser,userAgent)}}}}),defineGlobal("global!navigator",navigator),define("ephox.sand.api.PlatformDetection",["ephox.katamari.api.Thunk","ephox.sand.core.PlatformDetection","global!navigator"],function(Thunk,PlatformDetection,navigator){return{detect:Thunk.cached(function(){var userAgent=navigator.userAgent;return PlatformDetection.detect(userAgent)})}}),define("global!console",[],function(){return"undefined"==typeof console&&(console={log:function(){}}),console}),defineGlobal("global!document",document),define("ephox.sugar.api.node.Element",["ephox.katamari.api.Fun","global!Error","global!console","global!document"],function(Fun,Error,console,document){var fromDom=function(node){if(null===node||node===undefined)throw new Error("Node cannot be null or undefined");return{dom:Fun.constant(node)}};return{fromHtml:function(html,scope){var div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||1<div.childNodes.length)throw console.error("HTML does not have a single root node",html),"HTML must have a single root node";return fromDom(div.childNodes[0])},fromTag:function(tag,scope){var node=(scope||document).createElement(tag);return fromDom(node)},fromText:function(text,scope){var node=(scope||document).createTextNode(text);return fromDom(node)},fromDom:fromDom}}),define("ephox.sugar.api.node.NodeTypes",[],function(){return{ATTRIBUTE:2,CDATA_SECTION:4,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,ELEMENT:1,TEXT:3,PROCESSING_INSTRUCTION:7,ENTITY_REFERENCE:5,ENTITY:6,NOTATION:12}}),define("ephox.sugar.api.search.Selectors",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.node.NodeTypes","global!Error","global!document"],function(Arr,Option,Element,NodeTypes,Error,document){var test,selectorType=(test=document.createElement("span")).matches!==undefined?0:test.msMatchesSelector!==undefined?1:test.webkitMatchesSelector!==undefined?2:test.mozMatchesSelector!==undefined?3:-1,ELEMENT=NodeTypes.ELEMENT,DOCUMENT=NodeTypes.DOCUMENT,bypassSelector=function(dom){return dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT||0===dom.childElementCount};return{all:function(selector,scope){var base=scope===undefined?document:scope.dom();return bypassSelector(base)?[]:Arr.map(base.querySelectorAll(selector),Element.fromDom)},is:function(element,selector){var elem=element.dom();if(elem.nodeType!==ELEMENT)return!1;if(0==selectorType)return elem.matches(selector);if(1==selectorType)return elem.msMatchesSelector(selector);if(2==selectorType)return elem.webkitMatchesSelector(selector);if(3==selectorType)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},one:function(selector,scope){var base=scope===undefined?document:scope.dom();return bypassSelector(base)?Option.none():Option.from(base.querySelector(selector)).map(Element.fromDom)}}}),define("ephox.sugar.api.dom.Compare",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sand.api.Node","ephox.sand.api.PlatformDetection","ephox.sugar.api.search.Selectors"],function(Arr,Fun,Node,PlatformDetection,Selectors){var eq=function(e1,e2){return e1.dom()===e2.dom()},contains=PlatformDetection.detect().browser.isIE()?function(e1,e2){return Node.documentPositionContainedBy(e1.dom(),e2.dom())}:function(e1,e2){var d1=e1.dom(),d2=e2.dom();return d1!==d2&&d1.contains(d2)};return{eq:eq,isEqualNode:function(e1,e2){return e1.dom().isEqualNode(e2.dom())},member:function(element,elements){return Arr.exists(elements,Fun.curry(eq,element))},contains:contains,is:Selectors.is}}),define("ephox.sugar.api.search.Traverse",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Struct","ephox.sugar.alien.Recurse","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element"],function(Type,Arr,Fun,Option,Struct,Recurse,Compare,Element){var owner=function(element){return Element.fromDom(element.dom().ownerDocument)},parent=function(element){var dom=element.dom();return Option.from(dom.parentNode).map(Element.fromDom)},prevSibling=function(element){var dom=element.dom();return Option.from(dom.previousSibling).map(Element.fromDom)},nextSibling=function(element){var dom=element.dom();return Option.from(dom.nextSibling).map(Element.fromDom)},children=function(element){var dom=element.dom();return Arr.map(dom.childNodes,Element.fromDom)},child=function(element,index){var children=element.dom().childNodes;return Option.from(children[index]).map(Element.fromDom)},spot=Struct.immutable("element","offset");return{owner:owner,defaultView:function(element){var defaultView=element.dom().ownerDocument.defaultView;return Element.fromDom(defaultView)},documentElement:function(element){var doc=owner(element);return Element.fromDom(doc.dom().documentElement)},parent:parent,findIndex:function(element){return parent(element).bind(function(p){var kin=children(p);return Arr.findIndex(kin,function(elem){return Compare.eq(element,elem)})})},parents:function(element,isRoot){for(var stop=Type.isFunction(isRoot)?isRoot:Fun.constant(!1),dom=element.dom(),ret=[];null!==dom.parentNode&&dom.parentNode!==undefined;){var rawParent=dom.parentNode,parent=Element.fromDom(rawParent);if(ret.push(parent),!0===stop(parent))break;dom=rawParent}return ret},siblings:function(element){return parent(element).map(children).map(function(elements){return Arr.filter(elements,function(x){return!Compare.eq(element,x)})}).getOr([])},prevSibling:prevSibling,offsetParent:function(element){var dom=element.dom();return Option.from(dom.offsetParent).map(Element.fromDom)},prevSiblings:function(element){return Arr.reverse(Recurse.toArray(element,prevSibling))},nextSibling:nextSibling,nextSiblings:function(element){return Recurse.toArray(element,nextSibling)},children:children,child:child,firstChild:function(element){return child(element,0)},lastChild:function(element){return child(element,element.dom().childNodes.length-1)},leaf:function(element,offset){var cs=children(element);return 0<cs.length&&offset<cs.length?spot(cs[offset],0):spot(element,offset)}}}),define("ephox.sugar.api.dom.Insert",["ephox.sugar.api.search.Traverse"],function(Traverse){var before=function(marker,element){Traverse.parent(marker).each(function(v){v.dom().insertBefore(element.dom(),marker.dom())})},append=function(parent,element){parent.dom().appendChild(element.dom())};return{before:before,after:function(marker,element){Traverse.nextSibling(marker).fold(function(){Traverse.parent(marker).each(function(v){append(v,element)})},function(v){before(v,element)})},prepend:function(parent,element){Traverse.firstChild(parent).fold(function(){append(parent,element)},function(v){parent.dom().insertBefore(element.dom(),v.dom())})},append:append,appendAt:function(parent,element,index){Traverse.child(parent,index).fold(function(){append(parent,element)},function(v){before(v,element)})},wrap:function(element,wrapper){before(element,wrapper),append(wrapper,element)}}}),define("ephox.sugar.api.node.Node",["ephox.sugar.api.node.NodeTypes"],function(NodeTypes){var name=function(element){return element.dom().nodeName.toLowerCase()},type=function(element){return element.dom().nodeType},isType=function(t){return function(element){return type(element)===t}},isElement=isType(NodeTypes.ELEMENT),isText=isType(NodeTypes.TEXT),isDocument=isType(NodeTypes.DOCUMENT);return{name:name,type:type,value:function(element){return element.dom().nodeValue},isElement:isElement,isText:isText,isDocument:isDocument,isComment:function(element){return type(element)===NodeTypes.COMMENT||"#comment"===name(element)}}}),define("ephox.sugar.api.properties.Attr",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.sugar.api.node.Node","global!Error","global!console"],function(Type,Arr,Obj,Node,Error,console){var rawSet=function(dom,key,value){if(!(Type.isString(value)||Type.isBoolean(value)||Type.isNumber(value)))throw console.error("Invalid call to Attr.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set=function(element,key,value){rawSet(element.dom(),key,value)},get=function(element,key){var v=element.dom().getAttribute(key);return null===v?undefined:v},has=function(element,key){var dom=element.dom();return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)};return{clone:function(element){return Arr.foldl(element.dom().attributes,function(acc,attr){return acc[attr.name]=attr.value,acc},{})},set:set,setAll:function(element,attrs){var dom=element.dom();Obj.each(attrs,function(v,k){rawSet(dom,k,v)})},get:get,has:has,remove:function(element,key){element.dom().removeAttribute(key)},hasNone:function(element){var attrs=element.dom().attributes;return attrs===undefined||null===attrs||0===attrs.length},transfer:function(source,destination,attrs){Node.isElement(source)&&Node.isElement(destination)&&Arr.each(attrs,function(attr){!function(source,destination,attr){has(source,attr)&&!has(destination,attr)&&set(destination,attr,get(source,attr))}(source,destination,attr)})}}}),define("ephox.sugar.api.dom.InsertAll",["ephox.katamari.api.Arr","ephox.sugar.api.dom.Insert"],function(Arr,Insert){return{before:function(marker,elements){Arr.each(elements,function(x){Insert.before(marker,x)})},after:function(marker,elements){Arr.each(elements,function(x,i){var e=0===i?marker:elements[i-1];Insert.after(e,x)})},prepend:function(parent,elements){Arr.each(elements.slice().reverse(),function(x){Insert.prepend(parent,x)})},append:function(parent,elements){Arr.each(elements,function(x){Insert.append(parent,x)})}}}),define("ephox.sugar.api.dom.Remove",["ephox.katamari.api.Arr","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.search.Traverse"],function(Arr,InsertAll,Traverse){var remove=function(element){var dom=element.dom();null!==dom.parentNode&&dom.parentNode.removeChild(dom)};return{empty:function(element){element.dom().textContent="",Arr.each(Traverse.children(element),function(rogue){remove(rogue)})},remove:remove,unwrap:function(wrapper){var children=Traverse.children(wrapper);0<children.length&&InsertAll.before(wrapper,children),remove(wrapper)}}}),define("ephox.sugar.api.dom.Replication",["ephox.sugar.api.properties.Attr","ephox.sugar.api.node.Element","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Remove","ephox.sugar.api.search.Traverse"],function(Attr,Element,Insert,InsertAll,Remove,Traverse){var clone=function(original,deep){return Element.fromDom(original.dom().cloneNode(deep))},deep=function(original){return clone(original,!0)},shallowAs=function(original,tag){var nu=Element.fromTag(tag),attributes=Attr.clone(original);return Attr.setAll(nu,attributes),nu};return{shallow:function(original){return clone(original,!1)},shallowAs:shallowAs,deep:deep,copy:function(original,tag){var nu=shallowAs(original,tag),cloneChildren=Traverse.children(deep(original));return InsertAll.append(nu,cloneChildren),nu},mutate:function(original,tag){var nu=shallowAs(original,tag);Insert.before(original,nu);var children=Traverse.children(original);return InsertAll.append(nu,children),Remove.remove(original),nu}}}),define("ephox.sugar.api.node.Fragment",["ephox.katamari.api.Arr","ephox.sugar.api.node.Element","global!document"],function(Arr,Element,document){return{fromElements:function(elements,scope){var fragment=(scope||document).createDocumentFragment();return Arr.each(elements,function(element){fragment.appendChild(element.dom())}),Element.fromDom(fragment)}}}),define("tinymce.core.dom.ElementType",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.node.Node"],function(Arr,Fun,Node){var lazyLookup=function(items){var lookup;return function(node){return(lookup=lookup||Arr.mapToObject(items,Fun.constant(!0))).hasOwnProperty(Node.name(node))}},isHeading=lazyLookup(["h1","h2","h3","h4","h5","h6"]),isBlock=lazyLookup(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]);return{isBlock:isBlock,isInline:function(node){return Node.isElement(node)&&!isBlock(node)},isHeading:isHeading,isTextBlock:lazyLookup(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),isVoid:lazyLookup(["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed","source","wbr","track"]),isTableCell:lazyLookup(["td","th"])}}),define("tinymce.core.dom.Parents",["ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.search.Traverse"],function(Fun,Compare,Traverse){var parentsUntil=function(startNode,rootElm,predicate){return Compare.contains(rootElm,startNode)?Traverse.parents(startNode,function(elm){return predicate(elm)||Compare.eq(elm,rootElm)}).slice(0,-1):[]},parents=function(startNode,rootElm){return parentsUntil(startNode,rootElm,Fun.constant(!1))};return{parentsUntil:parentsUntil,parents:parents,parentsAndSelf:function(startNode,rootElm){return[startNode].concat(parents(startNode,rootElm))}}}),define("ephox.katamari.api.Options",["ephox.katamari.api.Option"],function(Option){return{cat:function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},findMap:function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Option.none()},liftN:function(arr,f){for(var r=[],i=0;i<arr.length;i++){var x=arr[i];if(!x.isSome())return Option.none();r.push(x.getOrDie())}return Option.some(f.apply(null,r))}}}),define("tinymce.core.selection.SelectionUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.Traverse","tinymce.core.dom.NodeType"],function(Arr,Fun,Option,Options,Compare,Element,Node,Traverse,NodeType){var getFirstChildren=function(node){return Traverse.firstChild(node).fold(Fun.constant([node]),function(child){return[node].concat(getFirstChildren(child))})},getLastChildren=function(node){return Traverse.lastChild(node).fold(Fun.constant([node]),function(child){return"br"===Node.name(child)?Traverse.prevSibling(child).map(function(sibling){return[node].concat(getLastChildren(sibling))}).getOr([]):[node].concat(getLastChildren(child))})};return{hasAllContentsSelected:function(elm,rng){return Options.liftN([function(rng){var sc=rng.startContainer,so=rng.startOffset;return NodeType.isText(sc)?0===so?Option.some(Element.fromDom(sc)):Option.none():Option.from(sc.childNodes[so]).map(Element.fromDom)}(rng),function(rng){var ec=rng.endContainer,eo=rng.endOffset;return NodeType.isText(ec)?eo===ec.data.length?Option.some(Element.fromDom(ec)):Option.none():Option.from(ec.childNodes[eo-1]).map(Element.fromDom)}(rng)],function(startNode,endNode){var start=Arr.find(getFirstChildren(elm),Fun.curry(Compare.eq,startNode)),end=Arr.find(getLastChildren(elm),Fun.curry(Compare.eq,endNode));return start.isSome()&&end.isSome()}).getOr(!1)}}}),define("tinymce.core.selection.FragmentReader",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Replication","ephox.sugar.api.node.Element","ephox.sugar.api.node.Fragment","ephox.sugar.api.node.Node","tinymce.core.dom.ElementType","tinymce.core.dom.Parents","tinymce.core.selection.SelectionUtils"],function(Arr,Fun,Insert,Replication,Element,Fragment,Node,ElementType,Parents,SelectionUtils){var getFullySelectedListWrappers=function(parents,rng){return Arr.find(parents,function(elm){return"li"===Node.name(elm)&&SelectionUtils.hasAllContentsSelected(elm,rng)}).fold(Fun.constant([]),function(li){return function(parents){return Arr.find(parents,function(elm){return"ul"===Node.name(elm)||"ol"===Node.name(elm)})}(parents).map(function(listCont){return[Element.fromTag("li"),Element.fromTag(Node.name(listCont))]}).getOr([])})},getFragmentFromRange=function(rootNode,rng){return innerElm=Element.fromDom(rng.cloneContents()),elms=function(rootNode,rng){var parents=Parents.parentsAndSelf(Element.fromDom(rng.commonAncestorContainer),Element.fromDom(rootNode)),wrapElements=Arr.filter(parents,function(elm){return ElementType.isInline(elm)||ElementType.isHeading(elm)}),fullWrappers=getFullySelectedListWrappers(parents,rng);return Arr.map(wrapElements.concat(fullWrappers),Replication.shallow)}(rootNode,rng),wrapped=Arr.foldl(elms,function(acc,elm){return Insert.append(elm,acc),elm},innerElm),0<elms.length?Fragment.fromElements([wrapped]):wrapped;var innerElm,elms,wrapped};return{read:function(rootNode,rng){return rng.collapsed?Fragment.fromElements([]):getFragmentFromRange(rootNode,rng)}}}),define("tinymce.core.dom.Selection",["tinymce.core.caret.CaretPosition","tinymce.core.dom.BookmarkManager","tinymce.core.dom.ControlSelection","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.dom.ScrollIntoView","tinymce.core.dom.TreeWalker","tinymce.core.dom.TridentSelection","tinymce.core.Env","tinymce.core.selection.FragmentReader","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(CaretPosition,BookmarkManager,ControlSelection,NodeType,RangeUtils,ScrollIntoView,TreeWalker,TridentSelection,Env,FragmentReader,Zwsp,Tools){var each=Tools.each,trim=Tools.trim,isIE=Env.ie;function Selection(dom,win,serializer,editor){this.dom=dom,this.win=win,this.serializer=serializer,this.editor=editor,this.bookmarkManager=new BookmarkManager(this),this.controlSelection=new ControlSelection(this,editor),this.win.getSelection||(this.tridentSel=new TridentSelection(this))}return Selection.prototype={setCursorLocation:function(node,offset){var rng=this.dom.createRng();node?(rng.setStart(node,offset),rng.setEnd(node,offset),this.setRng(rng),this.collapse(!1)):(this._moveEndPoint(rng,this.editor.getBody(),!0),this.setRng(rng))},getContent:function(args){var whiteSpaceBefore,whiteSpaceAfter,fragment,rng=this.getRng(),tmpElm=this.dom.create("body"),se=this.getSel();return whiteSpaceBefore=whiteSpaceAfter="",(args=args||{}).get=!0,args.format=args.format||"html",args.selection=!0,this.editor.fire("BeforeGetContent",args),"text"===args.format?this.isCollapsed()?"":Zwsp.trim(rng.text||(se.toString?se.toString():"")):(rng.cloneContents?(fragment=args.contextual?FragmentReader.read(this.editor.getBody(),rng).dom():rng.cloneContents())&&tmpElm.appendChild(fragment):rng.item!==undefined||rng.htmlText!==undefined?(tmpElm.innerHTML="<br>"+(rng.item?rng.item(0).outerHTML:rng.htmlText),tmpElm.removeChild(tmpElm.firstChild)):tmpElm.innerHTML=rng.toString(),/^\s/.test(tmpElm.innerHTML)&&(whiteSpaceBefore=" "),/\s+$/.test(tmpElm.innerHTML)&&(whiteSpaceAfter=" "),args.getInner=!0,args.content=this.isCollapsed()?"":whiteSpaceBefore+this.serializer.serialize(tmpElm,args)+whiteSpaceAfter,this.editor.fire("GetContent",args),args.content)},setContent:function(content,args){var caretNode,frag,temp,rng=this.getRng(),doc=this.win.document;if((args=args||{format:"html"}).set=!0,args.selection=!0,args.content=content,args.no_events||this.editor.fire("BeforeSetContent",args),content=args.content,rng.insertNode){content+='<span id="__caret">_</span>',rng.startContainer==doc&&rng.endContainer==doc?doc.body.innerHTML=content:(rng.deleteContents(),0===doc.body.childNodes.length?doc.body.innerHTML=content:rng.createContextualFragment?rng.insertNode(rng.createContextualFragment(content)):(frag=doc.createDocumentFragment(),temp=doc.createElement("div"),frag.appendChild(temp),temp.outerHTML=content,rng.insertNode(frag))),caretNode=this.dom.get("__caret"),(rng=doc.createRange()).setStartBefore(caretNode),rng.setEndBefore(caretNode),this.setRng(rng),this.dom.remove("__caret");try{this.setRng(rng)}catch(ex){}}else rng.item&&(doc.execCommand("Delete",!1,null),rng=this.getRng()),/^\s+/.test(content)?(rng.pasteHTML('<span id="__mce_tmp">_</span>'+content),this.dom.remove("__mce_tmp")):rng.pasteHTML(content);args.no_events||this.editor.fire("SetContent",args)},getStart:function(real){var startElement,parentElement,checkRng,node,rng=this.getRng();if(rng.duplicate||rng.item){if(rng.item)return rng.item(0);for((checkRng=rng.duplicate()).collapse(1),(startElement=checkRng.parentElement()).ownerDocument!==this.dom.doc&&(startElement=this.dom.getRoot()),parentElement=node=rng.parentElement();node=node.parentNode;)if(node==startElement){startElement=parentElement;break}return startElement}return 1==(startElement=rng.startContainer).nodeType&&startElement.hasChildNodes()&&(real&&rng.collapsed||(startElement=startElement.childNodes[Math.min(startElement.childNodes.length-1,rng.startOffset)])),startElement&&3==startElement.nodeType?startElement.parentNode:startElement},getEnd:function(real){var endElement,endOffset,rng=this.getRng();return rng.duplicate||rng.item?rng.item?rng.item(0):((rng=rng.duplicate()).collapse(0),(endElement=rng.parentElement()).ownerDocument!==this.dom.doc&&(endElement=this.dom.getRoot()),endElement&&"BODY"==endElement.nodeName&&endElement.lastChild||endElement):(endElement=rng.endContainer,endOffset=rng.endOffset,1==endElement.nodeType&&endElement.hasChildNodes()&&(real&&rng.collapsed||(endElement=endElement.childNodes[0<endOffset?endOffset-1:endOffset])),endElement&&3==endElement.nodeType?endElement.parentNode:endElement)},getBookmark:function(type,normalized){return this.bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return this.bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){var idx,dom=this.dom,rng=dom.createRng();if(this.lastFocusBookmark=null,node){if(!content&&this.controlSelection.controlSelect(node))return;idx=dom.nodeIndex(node),rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(this._moveEndPoint(rng,node,!0),this._moveEndPoint(rng,node)),this.setRng(rng)}return node},isCollapsed:function(){var rng=this.getRng(),sel=this.getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},collapse:function(toStart){var node,rng=this.getRng();rng.item&&(node=rng.item(0),(rng=this.win.document.body.createTextRange()).moveToElementText(node)),rng.collapse(!!toStart),this.setRng(rng)},getSel:function(){var win=this.win;return win.getSelection?win.getSelection():win.document.selection},getRng:function(w3c){var selection,rng,elm,doc,ieRng,evt;function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}}if(!this.win)return null;if(null==(doc=this.win.document))return null;if(!w3c&&this.lastFocusBookmark){var bookmark=this.lastFocusBookmark;return bookmark.startContainer?((rng=doc.createRange()).setStart(bookmark.startContainer,bookmark.startOffset),rng.setEnd(bookmark.endContainer,bookmark.endOffset)):rng=bookmark,rng}if(w3c&&this.tridentSel)return this.tridentSel.getRangeAt(0);try{(selection=this.getSel())&&(rng=0<selection.rangeCount?selection.getRangeAt(0):selection.createRange?selection.createRange():doc.createRange())}catch(ex){}if((evt=this.editor.fire("GetSelectionRange",{range:rng})).range!==rng)return evt.range;if(isIE&&rng&&rng.setStart&&doc.selection){try{ieRng=doc.selection.createRange()}catch(ex){}ieRng&&ieRng.item&&(elm=ieRng.item(0),(rng=doc.createRange()).setStartBefore(elm),rng.setEndAfter(elm))}return(rng=rng||(doc.createRange?doc.createRange():doc.body.createTextRange())).setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(elm=this.dom.getRoot(),rng.setStart(elm,0),rng.setEnd(elm,0)),this.selectedRange&&this.explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,this.selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,this.selectedRange)?rng=this.explicitRange:(this.selectedRange=null,this.explicitRange=null)),rng},setRng:function(rng,forward){var sel,node;if(rng)if(rng.select){this.explicitRange=null;try{rng.select()}catch(ex){}}else if(this.tridentSel){if(rng.cloneRange)try{this.tridentSel.addRange(rng)}catch(ex){}}else{if(sel=this.getSel(),rng=this.editor.fire("SetSelectionRange",{range:rng,forward:forward}).range,sel){this.explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}!1===forward&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),this.selectedRange=0<sel.rangeCount?sel.getRangeAt(0):null}rng.collapsed||rng.startContainer!==rng.endContainer||!sel.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset])&&"IMG"===node.tagName&&(sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),sel.anchorNode===rng.startContainer&&sel.focusNode===rng.endContainer||sel.setBaseAndExtent(node,0,node,1)),this.editor.fire("AfterSetSelectionRange",{range:rng,forward:forward})}},setNode:function(elm){return this.setContent(this.dom.getOuterHTML(elm)),elm},getNode:function(){var elm,startContainer,endContainer,startOffset,endOffset,rng=this.getRng(),root=this.dom.getRoot();function skipEmptyTextNodes(node,forwards){for(var orig=node;node&&3===node.nodeType&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig}return rng?(startContainer=rng.startContainer,endContainer=rng.endContainer,startOffset=rng.startOffset,endOffset=rng.endOffset,rng.setStart?(elm=rng.commonAncestorContainer,!rng.collapsed&&(startContainer==endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(elm=startContainer.childNodes[startOffset]),3===startContainer.nodeType&&3===endContainer.nodeType&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer))?startContainer:elm&&3==elm.nodeType?elm.parentNode:elm):((elm=rng.item?rng.item(0):rng.parentElement()).ownerDocument!==this.win.document&&(elm=root),elm)):root},getSelectedBlocks:function(startElm,endElm){var node,root,dom=this.dom,selectedBlocks=[];if(root=dom.getRoot(),startElm=dom.getParent(startElm||this.getStart(),dom.isBlock),endElm=dom.getParent(endElm||this.getEnd(),dom.isBlock),startElm&&startElm!=root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!=endElm)for(var walker=new TreeWalker(node=startElm,root);(node=walker.next())&&node!=endElm;)dom.isBlock(node)&&selectedBlocks.push(node);return endElm&&startElm!=endElm&&endElm!=root&&selectedBlocks.push(endElm),selectedBlocks},isForward:function(){var anchorRange,focusRange,dom=this.dom,sel=this.getSel();return!(sel&&sel.anchorNode&&sel.focusNode)||((anchorRange=dom.createRng()).setStart(sel.anchorNode,sel.anchorOffset),anchorRange.collapse(!0),(focusRange=dom.createRng()).setStart(sel.focusNode,sel.focusOffset),focusRange.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0)},normalize:function(){var rng=this.getRng();return Env.range&&new RangeUtils(this.dom).normalize(rng)&&this.setRng(rng,this.isForward()),rng},selectorChanged:function(selector,callback){var currentSelectors,self=this;return self.selectorChangedData||(self.selectorChangedData={},currentSelectors={},self.editor.on("NodeChange",function(e){var node=e.element,dom=self.dom,parents=dom.getParents(node,null,dom.getRoot()),matchedSelectors={};each(self.selectorChangedData,function(callbacks,selector){each(parents,function(node){if(dom.is(node,selector))return currentSelectors[selector]||(each(callbacks,function(callback){callback(!0,{node:node,selector:selector,parents:parents})}),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks,!1})}),each(currentSelectors,function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],each(callbacks,function(callback){callback(!1,{node:node,selector:selector,parents:parents})}))})})),self.selectorChangedData[selector]||(self.selectorChangedData[selector]=[]),self.selectorChangedData[selector].push(callback),self},getScrollContainer:function(){for(var scrollContainer,node=this.dom.getRoot();node&&"BODY"!=node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){ScrollIntoView.scrollIntoView(this.editor,elm,alignToTop)},placeCaretAt:function(clientX,clientY){this.setRng(RangeUtils.getCaretRangeFromPoint(clientX,clientY,this.editor.getDoc()))},_moveEndPoint:function(rng,node,start){var root=node,walker=new TreeWalker(node,root),nonEmptyElementsMap=this.dom.schema.getNonEmptyElements();do{if(3==node.nodeType&&0!==trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(nonEmptyElementsMap[node.nodeName]&&!/^(TD|TH)$/.test(node.nodeName))return void(start?rng.setStartBefore(node):"BR"==node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node));if(Env.ie&&Env.ie<11&&this.dom.isBlock(node)&&this.dom.isEmpty(node))return void(start?rng.setStart(node,0):rng.setEnd(node,0))}while(node=start?walker.next():walker.prev());"BODY"==root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},getBoundingClientRect:function(){var rng=this.getRng();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy:function(){this.win=null,this.controlSelection.destroy()}},Selection}),define("tinymce.core.dom.ElementUtils",["tinymce.core.dom.BookmarkManager","tinymce.core.util.Tools"],function(BookmarkManager,Tools){var each=Tools.each;return function ElementUtils(dom){this.compare=function(node1,node2){if(node1.nodeName!=node2.nodeName)return!1;function getAttribs(node){var attribs={};return each(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();0!==name.indexOf("_")&&"style"!==name&&0!==name.indexOf("data-")&&(attribs[name]=dom.getAttrib(node,name))}),attribs}function compareObjects(obj1,obj2){var value,name;for(name in obj1)if(obj1.hasOwnProperty(name)){if(void 0===(value=obj2[name]))return!1;if(obj1[name]!=value)return!1;delete obj2[name]}for(name in obj2)if(obj2.hasOwnProperty(name))return!1;return!0}return!!compareObjects(getAttribs(node1),getAttribs(node2))&&(!!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))&&(!BookmarkManager.isBookmarkNode(node1)&&!BookmarkManager.isBookmarkNode(node2)))}}}),define("tinymce.core.fmt.Preview",["tinymce.core.dom.DOMUtils","tinymce.core.util.Tools","tinymce.core.html.Schema"],function(DOMUtils,Tools,Schema){var each=Tools.each,dom=DOMUtils.DOM;function parsedSelectorToHtml(ancestry,editor){var elm,item,fragment,schema=editor&&editor.schema||new Schema({});function createElement(sItem){var elm;return item="string"==typeof sItem?{name:sItem,classes:[],attrs:{}}:sItem,function decorate(elm,item){item.classes.length&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)}(elm=dom.create(item.name),item),elm}return ancestry&&ancestry.length?(elm=createElement(item=ancestry[0]),(fragment=dom.create("div")).appendChild(function wrapInHtml(elm,ancestry,siblings){var parent,parentCandidate,parentRequired,ancestor=0<ancestry.length&&ancestry[0],ancestorName=ancestor&&ancestor.name;if(parentRequired=function getRequiredParent(elm,candidate){var name="string"!=typeof elm?elm.nodeName.toLowerCase():elm,elmRule=schema.getElementRule(name),parentsRequired=elmRule&&elmRule.parentsRequired;return!(!parentsRequired||!parentsRequired.length)&&(candidate&&-1!==Tools.inArray(parentsRequired,candidate)?candidate:parentsRequired[0])}(elm,ancestorName))ancestorName==parentRequired?(parentCandidate=ancestry[0],ancestry=ancestry.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestry[0],ancestry=ancestry.slice(1);else if(!siblings)return elm;return parentCandidate&&(parent=createElement(parentCandidate)).appendChild(elm),siblings&&(parent||(parent=dom.create("div")).appendChild(elm),Tools.each(siblings,function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm)})),wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings)}(elm,ancestry.slice(1),item.siblings)),fragment):""}function parseSelectorItem(item){var tagName,obj={classes:[],attrs:{}};return"*"!==(item=obj.selector=Tools.trim(item))&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function($0,$1,$2,$3,$4){switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}if("["==$3){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);m&&(obj.attrs[m[1]]=m[2])}return""})),obj.name=tagName||"div",obj}function parseSelector(selector){return selector&&"string"==typeof selector?(selector=(selector=selector.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=siblings.pop();return siblings.length&&(obj.siblings=siblings),obj}).reverse()):[]}return{getCssText:function getCssText(editor,format){var name,previewFrag,previewElm,items,parentFontSize,previewStyles,previewCss="";if(!1===(previewStyles=editor.settings.preview_styles))return"";function removeVars(val){return val.replace(/%(\w+)/g,"")}if("string"!=typeof previewStyles&&(previewStyles="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"),"string"==typeof format){if(!(format=editor.formatter.get(format)))return;format=format[0]}return"preview"in format&&!1===(previewStyles=format.preview)?"":(name=format.block||format.inline||"span",previewFrag=(items=parseSelector(format.selector)).length?(items[0].name||(items[0].name=name),name=format.selector,parsedSelectorToHtml(items,editor)):parsedSelectorToHtml([name],editor),previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild,each(format.styles,function(value,name){(value=removeVars(value))&&dom.setStyle(previewElm,name,value)}),each(format.attributes,function(value,name){(value=removeVars(value))&&dom.setAttrib(previewElm,name,value)}),each(format.classes,function(value){value=removeVars(value),dom.hasClass(previewElm,value)||dom.addClass(previewElm,value)}),editor.fire("PreviewFormats"),dom.setStyles(previewFrag,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewFrag),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each(previewStyles.split(" "),function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"==name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"==dom.toHex(value).toLowerCase())||"color"==name&&"#000000"==dom.toHex(value).toLowerCase())){if("font-size"==name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=(value=parseFloat(value,10)/(/%$/.test(value)?100:1))*parentFontSize+"px"}"border"==name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}}),editor.fire("AfterPreviewFormats"),dom.remove(previewFrag),previewCss)},parseSelector:parseSelector,selectorToHtml:function selectorToHtml(selector,editor){return parsedSelectorToHtml(parseSelector(selector),editor)}}}),define("tinymce.core.fmt.Hooks",["tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.dom.DomQuery"],function(Arr,NodeType,$){var postProcessHooks={},filter=Arr.filter,each=Arr.each;return function addPostProcessHook(name,hook){var hooks=postProcessHooks[name];hooks||(postProcessHooks[name]=hooks=[]),postProcessHooks[name].push(hook)}("pre",function(editor){var isPre,blocks,rng=editor.selection.getRng();isPre=NodeType.matchNodeNames("pre"),rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each(filter(filter(blocks,isPre),function hasPreSibling(pre){return isPre(pre.previousSibling)&&-1!=Arr.indexOf(blocks,pre.previousSibling)}),function(pre){!function joinPre(pre1,pre2){$(pre2).remove(),$(pre1).append("<br><br>").append(pre2.childNodes)}(pre.previousSibling,pre)}))}),{postProcess:function postProcess(name,editor){each(postProcessHooks[name],function(hook){hook(editor)})}}}),define("tinymce.core.Formatter",["tinymce.core.dom.TreeWalker","tinymce.core.dom.RangeUtils","tinymce.core.dom.BookmarkManager","tinymce.core.dom.ElementUtils","tinymce.core.dom.NodeType","tinymce.core.util.Fun","tinymce.core.util.Tools","tinymce.core.fmt.Preview","tinymce.core.fmt.Hooks"],function(TreeWalker,RangeUtils,BookmarkManager,ElementUtils,NodeType,Fun,Tools,Preview,Hooks){return function(ed){var formatChangeData,undef,disableCaretContainer,markCaretContainersBogus,formats={},dom=ed.dom,selection=ed.selection,rangeUtils=new RangeUtils(dom),isValid=ed.schema.isValidChild,isBlock=dom.isBlock,forcedRootBlock=ed.settings.forced_root_block,nodeIndex=dom.nodeIndex,INVISIBLE_CHAR="\ufeff",MCE_ATTR_RE=/^(src|href|style)$/,FALSE=!1,TRUE=!0,getContentEditable=dom.getContentEditable,isBookmarkNode=BookmarkManager.isBookmarkNode,each=Tools.each,grep=Tools.grep,walk=Tools.walk,extend=Tools.extend;function isTextBlock(name){return name.nodeType&&(name=name.nodeName),!!ed.schema.getTextBlockElements()[name.toLowerCase()]}function isTableCell(node){return/^(TH|TD)$/.test(node.nodeName)}function getParents(node,selector){return dom.getParents(node,selector,dom.getRoot())}function isCaretNode(node){return 1===node.nodeType&&"_mce_caret"===node.id}var clearChildStyles=function(format,node){format.clear_child_styles&&each(dom.select("*",node),function(node){each(format.styles,function(value,name){dom.setStyle(node,name,"")})})};function get(name){return name?formats[name]:formats}function register(name,format){name&&("string"!=typeof name?each(name,function(format,name){register(name,format)}):(format=format.length?format:[format],each(format,function(format){format.deep===undef&&(format.deep=!format.selector),format.split===undef&&(format.split=!format.selector||format.inline),format.remove===undef&&format.selector&&!format.inline&&(format.remove="none"),format.selector&&format.inline&&(format.mixed=!0,format.block_expand=!0),"string"==typeof format.classes&&(format.classes=format.classes.split(/\s+/))}),formats[name]=format))}function matchesUnInheritedFormatSelector(node,name){var formatList=get(name);if(formatList)for(var i=0;i<formatList.length;i++)if(!1===formatList[i].inherit&&dom.is(node,formatList[i].selector))return!0;return!1}function getTextDecoration(node){var decoration;return ed.dom.getParent(node,function(n){return(decoration=ed.dom.getStyle(n,"text-decoration"))&&"none"!==decoration}),decoration}function processUnderlineAndColor(node){var textDecoration;1===node.nodeType&&node.parentNode&&1===node.parentNode.nodeType&&(textDecoration=getTextDecoration(node.parentNode),ed.dom.getStyle(node,"color")&&textDecoration?ed.dom.setStyle(node,"text-decoration",textDecoration):ed.dom.getStyle(node,"text-decoration")===textDecoration&&ed.dom.setStyle(node,"text-decoration",null))}function apply(name,vars,node){var bookmark,rng,formatList=get(name),format=formatList[0],isCollapsed=!node&&selection.isCollapsed();function setElementFormat(elm,fmt){if(fmt=fmt||format,elm){if(fmt.onformat&&fmt.onformat(elm,fmt,vars,node),each(fmt.styles,function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))}),fmt.styles){var styleVal=dom.getAttrib(elm,"style");styleVal&&elm.setAttribute("data-mce-style",styleVal)}each(fmt.attributes,function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))}),each(fmt.classes,function(value){value=replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)})}}function applyNodeStyle(formatList,node){var found=!1;return!!format.selector&&(each(formatList,function(format){if(!("collapsed"in format&&format.collapsed!==isCollapsed))return dom.is(node,format.selector)&&!isCaretNode(node)?(setElementFormat(node,format),!(found=!0)):void 0}),found)}function applyRngStyle(rng,bookmark,nodeSpecific){var wrapName,wrapElm,newWrappers=[],contentEditable=!0;wrapName=format.inline||format.block,setElementFormat(wrapElm=dom.create(wrapName)),rangeUtils.walk(rng,function(nodes){var currentWrapElm;each(nodes,function process(node){var nodeName,parentName,hasContentEditableState,lastContentEditable;if(lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentName=node.parentNode.nodeName.toLowerCase(),1===node.nodeType&&getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===getContentEditable(node),hasContentEditableState=!0),isEq(nodeName,"br"))return currentWrapElm=0,void(format.block&&dom.remove(node));if(format.wrapper&&matchNode(node,name,vars))currentWrapElm=0;else{if(contentEditable&&!hasContentEditableState&&format.block&&!format.wrapper&&isTextBlock(nodeName)&&isValid(parentName,wrapName))return setElementFormat(node=dom.rename(node,wrapName)),newWrappers.push(node),void(currentWrapElm=0);if(format.selector){var found=applyNodeStyle(formatList,node);if(!format.inline||found)return void(currentWrapElm=0)}!contentEditable||hasContentEditableState||!isValid(wrapName,nodeName)||!isValid(parentName,wrapName)||!nodeSpecific&&3===node.nodeType&&1===node.nodeValue.length&&65279===node.nodeValue.charCodeAt(0)||isCaretNode(node)||format.inline&&isBlock(node)?(currentWrapElm=0,each(grep(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=0):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,FALSE),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node))}})}),!0===format.links&&each(newWrappers,function(node){!function process(node){"A"===node.nodeName&&setElementFormat(node,format),each(grep(node.childNodes),process)}(node)}),each(newWrappers,function(node){var childCount;function getChildCount(node){var count=0;return each(node.childNodes,function(node){isWhiteSpaceNode(node)||isBookmarkNode(node)||count++}),count}function getChildElementNode(root){var child=!1;return each(root.childNodes,function(node){if(isElementNode(node))return child=node,!1}),child}if(childCount=getChildCount(node),!(1<newWrappers.length)&&isBlock(node)||0!==childCount){if(format.inline||format.wrapper){if(format.exact||1!==childCount||(node=function mergeStyles(node){var child,clone;return(child=getChildElementNode(node))&&!isBookmarkNode(child)&&matchName(child,format)&&(setElementFormat(clone=dom.clone(child,FALSE)),dom.replace(clone,node,TRUE),dom.remove(child,1)),clone||node}(node)),each(formatList,function(format){each(dom.select(format.inline,node),function(child){isElementNode(child)&&removeFormat(format,vars,child,format.exact?child:null)}),clearChildStyles(format,node)}),matchNode(node.parentNode,name,vars)&&removeFormat(format,vars,node)&&(node=0),format.merge_with_parents&&dom.getParent(node.parentNode,function(parent){if(matchNode(parent,name,vars))return removeFormat(format,vars,node)&&(node=0),TRUE}),node&&!isBlock(node)&&!getStyle(node,"fontSize")){var styleNode=function matchNestedWrapper(node,filter){do{if(1!==getChildCount(node))break;if(!(node=getChildElementNode(node)))break;if(filter(node))return node}while(node);return null}(node,hasStyle("fontSize"));styleNode&&apply("fontsize",{value:getStyle(styleNode,"fontSize")},node)}node&&!1!==format.merge_siblings&&(node=mergeSiblings(getNonWhiteSpaceSibling(node),node),node=mergeSiblings(node,getNonWhiteSpaceSibling(node,TRUE)))}}else dom.remove(node,1)})}if("false"!==getContentEditable(selection.getNode())){if(format){if(node)node.nodeType?applyNodeStyle(formatList,node)||((rng=dom.createRng()).setStartBefore(node),rng.setEndAfter(node),applyRngStyle(expandRng(rng,formatList),0,!0)):applyRngStyle(node,0,!0);else if(isCollapsed&&format.inline&&!dom.select("td[data-mce-selected],th[data-mce-selected]").length)performCaretAction("apply",name,vars);else{var curSelNode=ed.selection.getNode();forcedRootBlock||!formatList[0].defaultBlock||dom.getParent(curSelNode,dom.isBlock)||apply(formatList[0].defaultBlock),ed.selection.setRng(function adjustSelectionToVisibleSelection(){var rng=ed.selection.getRng(),start=rng.startContainer,end=rng.endContainer;if(start!=end&&0===rng.endOffset){var newEnd=function findSelectionEnd(start,end){var walker=new TreeWalker(end);for(node=walker.prev2();node;node=walker.prev2()){if(3==node.nodeType&&0<node.data.length)return node;if(1<node.childNodes.length||node==start||"BR"==node.tagName)return node}}(start,end),endOffset=3==newEnd.nodeType?newEnd.data.length:newEnd.childNodes.length;rng.setEnd(newEnd,endOffset)}return rng}()),bookmark=selection.getBookmark(),applyRngStyle(expandRng(selection.getRng(TRUE),formatList)),format.styles&&((format.styles.color||format.styles.textDecoration)&&(walk(curSelNode,processUnderlineAndColor,"childNodes"),processUnderlineAndColor(curSelNode)),format.styles.backgroundColor&&function processChildElements(node,filter,process){each(node.childNodes,function(node){isElementNode(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))})}(curSelNode,hasStyle("fontSize"),function applyStyle(name,value){return Fun.curry(function(name,value,node){dom.setStyle(node,name,value)},name,value)}("backgroundColor",replaceVars(format.styles.backgroundColor,vars)))),selection.moveToBookmark(bookmark),moveStart(selection.getRng(TRUE)),ed.nodeChanged()}Hooks.postProcess(name,ed)}}else{node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++)if(formatList[i].ceFalseOverride&&dom.is(node,formatList[i].selector))return void setElementFormat(node,formatList[i])}}function remove(name,vars,node,similar){var bookmark,rng,formatList=get(name),format=formatList[0],contentEditable=!0;function splitToFormatRoot(container){return function wrapAndSplit(formatRoot,container,target,split){var parent,clone,lastClone,firstClone,i,formatRootParent;if(formatRoot){for(formatRootParent=formatRoot.parentNode,parent=container.parentNode;parent&&parent!=formatRootParent;parent=parent.parentNode){for(clone=dom.clone(parent,FALSE),i=0;i<formatList.length;i++)if(removeFormat(formatList[i],vars,clone,clone)){clone=0;break}clone&&(lastClone&&clone.appendChild(lastClone),firstClone=firstClone||clone,lastClone=clone)}!split||format.mixed&&isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target))}return container}(function findFormatRoot(container){var formatRoot;return each(getParents(container.parentNode).reverse(),function(parent){var format;formatRoot||"_start"==parent.id||"_end"==parent.id||(format=matchNode(parent,name,vars,similar))&&!1!==format.split&&(formatRoot=parent)}),formatRoot}(container),container,container,!0)}function unwrap(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return isBookmarkNode(out)&&(out=out[start?"firstChild":"lastChild"]),3==out.nodeType&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out}function removeRngStyle(rng){var startContainer,endContainer,commonAncestorContainer=rng.commonAncestorContainer;if(rng=expandRng(rng,formatList,TRUE),format.split){if((startContainer=getContainer(rng,TRUE))!=(endContainer=getContainer(rng))){if(/^(TR|TH|TD)$/.test(startContainer.nodeName)&&startContainer.firstChild&&(startContainer="TR"==startContainer.nodeName?startContainer.firstChild.firstChild||startContainer:startContainer.firstChild||startContainer),commonAncestorContainer&&/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName)&&isTableCell(endContainer)&&endContainer.firstChild&&(endContainer=endContainer.firstChild||endContainer),dom.isChildOf(startContainer,endContainer)&&!isBlock(endContainer)&&!isTableCell(startContainer)&&!isTableCell(endContainer))return splitToFormatRoot(startContainer=wrap(startContainer,"span",{id:"_start","data-mce-type":"bookmark"})),void(startContainer=unwrap(TRUE));startContainer=wrap(startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap(endContainer,"span",{id:"_end","data-mce-type":"bookmark"}),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(TRUE),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);rng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,rng.startOffset=nodeIndex(startContainer),rng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,rng.endOffset=nodeIndex(endContainer)+1}rangeUtils.walk(rng,function(nodes){each(nodes,function(node){!function process(node){var children,i,l,lastContentEditable,hasContentEditableState;if(1===node.nodeType&&getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===getContentEditable(node),hasContentEditableState=!0),children=grep(node.childNodes),contentEditable&&!hasContentEditableState)for(i=0,l=formatList.length;i<l&&!removeFormat(formatList[i],vars,node,node);i++);if(format.deep&&children.length){for(i=0,l=children.length;i<l;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}}(node),1===node.nodeType&&"underline"===ed.dom.getStyle(node,"text-decoration")&&node.parentNode&&"underline"===getTextDecoration(node.parentNode)&&removeFormat({deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,node)})})}if(node)node.nodeType?((rng=dom.createRng()).setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)):removeRngStyle(node);else if("false"!==getContentEditable(selection.getNode()))selection.isCollapsed()&&format.inline&&!dom.select("td[data-mce-selected],th[data-mce-selected]").length?performCaretAction("remove",name,vars,similar):(bookmark=selection.getBookmark(),removeRngStyle(selection.getRng(TRUE)),selection.moveToBookmark(bookmark),format.inline&&match(name,vars,selection.getStart())&&moveStart(selection.getRng(!0)),ed.nodeChanged());else{node=selection.getNode();for(var i=0,l=formatList.length;i<l&&(!formatList[i].ceFalseOverride||!removeFormat(formatList[i],vars,node,node));i++);}}function matchNode(node,name,vars,similar){var format,i,classes,formatList=get(name);function matchItems(node,format,itemName){var key,value,i,items=format[itemName];if(format.onmatch)return format.onmatch(node,format,itemName);if(items)if(items.length===undef){for(key in items)if(items.hasOwnProperty(key)){if(value="attributes"===itemName?dom.getAttrib(node,key):getStyle(node,key),similar&&!value&&!format.exact)return;if((!similar||format.exact)&&!isEq(value,normalizeStyleValue(replaceVars(items[key],vars),key)))return}}else for(i=0;i<items.length;i++)if("attributes"===itemName?dom.getAttrib(node,items[i]):getStyle(node,items[i]))return format;return format}if(formatList&&node)for(i=0;i<formatList.length;i++)if(matchName(node,format=formatList[i])&&matchItems(node,format,"attributes")&&matchItems(node,format,"styles")){if(classes=format.classes)for(i=0;i<classes.length;i++)if(!dom.hasClass(node,classes[i]))return;return format}}function match(name,vars,node){var startNode;function matchParents(node){var root=dom.getRoot();return node!==root&&(node=dom.getParent(node,function(node){return!!matchesUnInheritedFormatSelector(node,name)||(node.parentNode===root||!!matchNode(node,name,vars,!0))}),matchNode(node,name,vars))}return node?matchParents(node):matchParents(node=selection.getNode())?TRUE:(startNode=selection.getStart())!=node&&matchParents(startNode)?TRUE:FALSE}function matchName(node,format){return isEq(node,format.inline)?TRUE:isEq(node,format.block)?TRUE:format.selector?1==node.nodeType&&dom.is(node,format.selector):void 0}function isEq(str1,str2){return str1=""+((str1=str1||"").nodeName||str1),str2=""+((str2=str2||"").nodeName||str2),str1.toLowerCase()==str2.toLowerCase()}function isElementNode(node){return node&&1===node.nodeType&&!isBookmarkNode(node)&&!isCaretNode(node)&&!NodeType.isBogus(node)}function hasStyle(name){return Fun.curry(function(name,node){return!(!node||!getStyle(node,name))},name)}function getStyle(node,name){return normalizeStyleValue(dom.getStyle(node,name),name)}function normalizeStyleValue(value,name){return"color"!=name&&"backgroundColor"!=name||(value=dom.toHex(value)),"fontWeight"==name&&700==value&&(value="bold"),"fontFamily"==name&&(value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+value}function replaceVars(value,vars){return"string"!=typeof value?value=value(vars):vars&&(value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str})),value}function isWhiteSpaceNode(node){return node&&3===node.nodeType&&/^([\t \r\n]+|)$/.test(node.nodeValue)}function wrap(node,name,attrs){var wrapper=dom.create(name,attrs);return node.parentNode.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper}function expandRng(rng,format,remove){var lastIdx,leaf,endPoint,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;function findParentContainer(start){var container,parent,sibling,siblingName,root,node;if(container=parent=start?startContainer:endContainer,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot(),3==container.nodeType&&!isWhiteSpaceNode(container)&&(start?0<startOffset:endOffset<container.nodeValue.length))return container;for(;;){if(!format[0].block_expand&&isBlock(parent))return parent;for(sibling=parent[siblingName];sibling;sibling=sibling[siblingName])if(!isBookmarkNode(sibling)&&!isWhiteSpaceNode(sibling)&&("BR"!=(node=sibling).nodeName||!node.getAttribute("data-mce-bogus")||node.nextSibling))return parent;if(parent==root||parent.parentNode==root){container=parent;break}parent=parent.parentNode}return container}function findLeaf(node,offset){for(offset===undef&&(offset=3===node.nodeType?node.length:node.childNodes.length);node&&node.hasChildNodes();)(node=node.childNodes[offset])&&(offset=3===node.nodeType?node.length:node.childNodes.length);return{node:node,offset:offset}}function findParentContentEditable(node){for(var parent=node;parent;){if(1===parent.nodeType&&getContentEditable(parent))return"false"===getContentEditable(parent)?parent:node;parent=parent.parentNode}return node}function findWordEndPoint(container,offset,start){var walker,node,pos,lastTextNode;function findSpace(node,offset){var pos,pos2,str=node.nodeValue;return void 0===offset&&(offset=start?str.length:0),start?(pos=str.lastIndexOf(" ",offset),-1===(pos=(pos2=str.lastIndexOf(" ",offset))<pos?pos:pos2)||remove||pos++):(pos=str.indexOf(" ",offset),pos2=str.indexOf(" ",offset),pos=-1!==pos&&(-1===pos2||pos<pos2)?pos:pos2),pos}if(3===container.nodeType){if(-1!==(pos=findSpace(container,offset)))return{container:container,offset:pos};lastTextNode=container}for(walker=new TreeWalker(container,dom.getParent(container,isBlock)||ed.getBody());node=walker[start?"prev":"next"]();)if(3===node.nodeType){if(-1!==(pos=findSpace(lastTextNode=node)))return{container:node,offset:pos}}else if(isBlock(node))break;if(lastTextNode)return{container:lastTextNode,offset:offset=start?0:lastTextNode.length}}function findSelectorEndPoint(container,siblingName){var parents,i,y,curFormat;for(3==container.nodeType&&0===container.nodeValue.length&&container[siblingName]&&(container=container[siblingName]),parents=getParents(container),i=0;i<parents.length;i++)for(y=0;y<format.length;y++)if(!("collapsed"in(curFormat=format[y])&&curFormat.collapsed!==rng.collapsed)&&dom.is(parents[i],curFormat.selector))return parents[i];return container}function findBlockEndPoint(container,siblingName){var node,root=dom.getRoot();if(format[0].wrapper||(node=dom.getParent(container,format[0].block,root)),(node=node||dom.getParent(3==container.nodeType?container.parentNode:container,function(node){return node!=root&&isTextBlock(node)}))&&format[0].wrapper&&(node=getParents(node,"ul,ol").reverse()[0]||node),!node)for(node=container;node[siblingName]&&!isBlock(node[siblingName])&&!isEq(node=node[siblingName],"br"););return node||container}if(1==startContainer.nodeType&&startContainer.hasChildNodes()&&(lastIdx=startContainer.childNodes.length-1,3==(startContainer=startContainer.childNodes[lastIdx<startOffset?lastIdx:startOffset]).nodeType&&(startOffset=0)),1==endContainer.nodeType&&endContainer.hasChildNodes()&&(lastIdx=endContainer.childNodes.length-1,3==(endContainer=endContainer.childNodes[lastIdx<endOffset?lastIdx:endOffset-1]).nodeType&&(endOffset=endContainer.nodeValue.length)),startContainer=findParentContentEditable(startContainer),endContainer=findParentContentEditable(endContainer),(isBookmarkNode(startContainer.parentNode)||isBookmarkNode(startContainer))&&3==(startContainer=(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode).nextSibling||startContainer).nodeType&&(startOffset=0),(isBookmarkNode(endContainer.parentNode)||isBookmarkNode(endContainer))&&3==(endContainer=(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode).previousSibling||endContainer).nodeType&&(endOffset=endContainer.length),format[0].inline&&(rng.collapsed&&((endPoint=findWordEndPoint(startContainer,startOffset,!0))&&(startContainer=endPoint.container,startOffset=endPoint.offset),(endPoint=findWordEndPoint(endContainer,endOffset))&&(endContainer=endPoint.container,endOffset=endPoint.offset)),(leaf=findLeaf(endContainer,endOffset)).node)){for(;leaf.node&&0===leaf.offset&&leaf.node.previousSibling;)leaf=findLeaf(leaf.node.previousSibling);leaf.node&&0<leaf.offset&&3===leaf.node.nodeType&&" "===leaf.node.nodeValue.charAt(leaf.offset-1)&&1<leaf.offset&&(endContainer=leaf.node).splitText(leaf.offset-1)}return(format[0].inline||format[0].block_expand)&&(format[0].inline&&3==startContainer.nodeType&&0!==startOffset||(startContainer=findParentContainer(!0)),format[0].inline&&3==endContainer.nodeType&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer())),format[0].selector&&format[0].expand!==FALSE&&!format[0].inline&&(startContainer=findSelectorEndPoint(startContainer,"previousSibling"),endContainer=findSelectorEndPoint(endContainer,"nextSibling")),(format[0].block||format[0].selector)&&(startContainer=findBlockEndPoint(startContainer,"previousSibling"),endContainer=findBlockEndPoint(endContainer,"nextSibling"),format[0].block&&(isBlock(startContainer)||(startContainer=findParentContainer(!0)),isBlock(endContainer)||(endContainer=findParentContainer()))),1==startContainer.nodeType&&(startOffset=nodeIndex(startContainer),startContainer=startContainer.parentNode),1==endContainer.nodeType&&(endOffset=nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}}function removeFormat(format,vars,node,compareNode){var i,attrs,stylesModified;if(!matchName(node,format)&&!function isColorFormatAndAnchor(node,format){return format.links&&"A"==node.tagName}(node,format))return FALSE;if("all"!=format.remove)for(each(format.styles,function(value,name){value=normalizeStyleValue(replaceVars(value,vars),name),"number"==typeof name&&(name=value,compareNode=0),!format.remove_similar&&compareNode&&!isEq(getStyle(compareNode,name),value)||dom.setStyle(node,name,""),stylesModified=1}),stylesModified&&""===dom.getAttrib(node,"style")&&(node.removeAttribute("style"),node.removeAttribute("data-mce-style")),each(format.attributes,function(value,name){var valueOut;if(value=replaceVars(value,vars),"number"==typeof name&&(name=value,compareNode=0),!compareNode||isEq(dom.getAttrib(compareNode,name),value)){if("class"==name&&(value=dom.getAttrib(node,name))&&(valueOut="",each(value.split(/\s+/),function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)}),valueOut))return void dom.setAttrib(node,name,valueOut);"class"==name&&node.removeAttribute("className"),MCE_ATTR_RE.test(name)&&node.removeAttribute("data-mce-"+name),node.removeAttribute(name)}}),each(format.classes,function(value){value=replaceVars(value,vars),compareNode&&!dom.hasClass(compareNode,value)||dom.removeClass(node,value)}),attrs=dom.getAttribs(node),i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(0!==attrName.indexOf("_")&&0!==attrName.indexOf("data-"))return FALSE}return"none"!=format.remove?(function removeNode(node,format){var rootBlockElm,parentNode=node.parentNode;function find(node,next,inc){return!(node=getNonWhiteSpaceSibling(node,next,inc))||"BR"==node.nodeName||isBlock(node)}format.block&&(forcedRootBlock?parentNode==dom.getRoot()&&(format.list_block&&isEq(node,format.list_block)||each(grep(node.childNodes),function(node){isValid(forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap(node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=0})):isBlock(node)&&!isBlock(parentNode)&&(find(node,FALSE)||find(node.firstChild,TRUE,1)||node.insertBefore(dom.create("br"),node.firstChild),find(node,TRUE)||find(node.lastChild,FALSE,1)||node.appendChild(dom.create("br"))));if(format.selector&&format.inline&&!isEq(format.inline,node))return;dom.remove(node,1)}(node,format),TRUE):void 0}function getNonWhiteSpaceSibling(node,next,inc){if(node)for(next=next?"nextSibling":"previousSibling",node=inc?node:node[next];node;node=node[next])if(1==node.nodeType||!isWhiteSpaceNode(node))return node}function mergeSiblings(prev,next){var sibling,tmpSibling,elementUtils=new ElementUtils(dom);function findElementSibling(node,siblingName){for(sibling=node;sibling;sibling=sibling[siblingName]){if(3==sibling.nodeType&&0!==sibling.nodeValue.length)return node;if(1==sibling.nodeType&&!isBookmarkNode(sibling))return sibling}return node}if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(sibling=prev.nextSibling;sibling&&sibling!=next;)sibling=(tmpSibling=sibling).nextSibling,prev.appendChild(tmpSibling);return dom.remove(next),each(grep(next.childNodes),function(node){prev.appendChild(node)}),prev}return next}function getContainer(rng,start){var container,offset,lastIdx;return container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],1==container.nodeType&&(lastIdx=container.childNodes.length-1,!start&&offset&&offset--,container=container.childNodes[lastIdx<offset?lastIdx:offset]),3===container.nodeType&&start&&offset>=container.nodeValue.length&&(container=new TreeWalker(container,ed.getBody()).next()||container),3!==container.nodeType||start||0!==offset||(container=new TreeWalker(container,ed.getBody()).prev()||container),container}function performCaretAction(type,name,vars,similar){var caretContainerId="_mce_caret",debug=ed.settings.caret_debug;function createCaretContainer(fill){var caretContainer=dom.create("span",{id:caretContainerId,"data-mce-bogus":!0,style:debug?"color:red":""});return fill&&caretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR)),caretContainer}function isCaretContainerEmpty(node,nodes){for(;node;){if(3===node.nodeType&&node.nodeValue!==INVISIBLE_CHAR||1<node.childNodes.length)return!1;nodes&&1===node.nodeType&&nodes.push(node),node=node.firstChild}return!0}function getParentCaretContainer(node){for(;node;){if(node.id===caretContainerId)return node;node=node.parentNode}}function findFirstTextNode(node){var walker;if(node)for(node=(walker=new TreeWalker(node,node)).current();node;node=walker.next())if(3===node.nodeType)return node}function removeCaretContainer(node,moveCaret){var child,rng;if(node)rng=selection.getRng(!0),isCaretContainerEmpty(node)?(!1!==moveCaret&&(rng.setStartBefore(node),rng.setEndBefore(node)),dom.remove(node)):((child=findFirstTextNode(node)).nodeValue.charAt(0)===INVISIBLE_CHAR&&(child.deleteData(0,1),rng.startContainer==child&&0<rng.startOffset&&rng.setStart(child,rng.startOffset-1),rng.endContainer==child&&0<rng.endOffset&&rng.setEnd(child,rng.endOffset-1)),dom.remove(node,1)),selection.setRng(rng);else if(!(node=getParentCaretContainer(selection.getStart())))for(;node=dom.get(caretContainerId);)removeCaretContainer(node,!1)}function unmarkBogusCaretParents(){var caretContainer;(caretContainer=getParentCaretContainer(selection.getStart()))&&!dom.isEmpty(caretContainer)&&walk(caretContainer,function(node){1!=node.nodeType||node.id===caretContainerId||dom.isEmpty(node)||dom.setAttrib(node,"data-mce-bogus",null)},"childNodes")}ed._hasCaretEvents||(markCaretContainersBogus=function(){var i,nodes=[];if(isCaretContainerEmpty(getParentCaretContainer(selection.getStart()),nodes))for(i=nodes.length;i--;)dom.setAttrib(nodes[i],"data-mce-bogus","1")},disableCaretContainer=function(e){var keyCode=e.keyCode;removeCaretContainer(),8==keyCode&&selection.isCollapsed()&&selection.getStart().innerHTML==INVISIBLE_CHAR&&removeCaretContainer(getParentCaretContainer(selection.getStart())),37!=keyCode&&39!=keyCode||removeCaretContainer(getParentCaretContainer(selection.getStart())),unmarkBogusCaretParents()},ed.on("SetContent",function(e){e.selection&&unmarkBogusCaretParents()}),ed._hasCaretEvents=!0),"apply"==type?function applyCaretFormat(){var rng,caretContainer,textNode,offset,bookmark,text;offset=(rng=selection.getRng(!0)).startOffset,text=rng.startContainer.nodeValue,(caretContainer=getParentCaretContainer(selection.getStart()))&&(textNode=findFirstTextNode(caretContainer));var wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;text&&0<offset&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))?(bookmark=selection.getBookmark(),rng.collapse(!0),rng=expandRng(rng,get(name)),rng=rangeUtils.split(rng),apply(name,vars,rng),selection.moveToBookmark(bookmark)):(caretContainer&&textNode.nodeValue===INVISIBLE_CHAR||(textNode=(caretContainer=createCaretContainer(!0)).firstChild,rng.insertNode(caretContainer),offset=1),apply(name,vars,caretContainer),selection.setCursorLocation(textNode,offset))}():function removeCaretFormat(){var container,offset,bookmark,hasContentAfter,node,formatNode,i,caretContainer,rng=selection.getRng(!0),parents=[];for(container=rng.startContainer,offset=rng.startOffset,3==(node=container).nodeType&&(offset!=container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(matchNode(node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter)bookmark=selection.getBookmark(),rng.collapse(!0),rng=expandRng(rng,get(name),!0),rng=rangeUtils.split(rng),remove(name,vars,rng),selection.moveToBookmark(bookmark);else{for(node=caretContainer=createCaretContainer(),i=parents.length-1;0<=i;i--)node.appendChild(dom.clone(parents[i],!1)),node=node.firstChild;node.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR)),node=node.firstChild;var block=dom.getParent(formatNode,isTextBlock);block&&dom.isEmpty(block)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode),selection.setCursorLocation(node,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}}()}function moveStart(rng){var walker,node,nodes,container=rng.startContainer,offset=rng.startOffset;if((rng.startContainer!=rng.endContainer||!function isInlineBlock(node){return node&&/^(IMG)$/.test(node.nodeName)}(rng.startContainer.childNodes[rng.startOffset]))&&(3==container.nodeType&&offset>=container.nodeValue.length&&(offset=nodeIndex(container),container=container.parentNode),1==container.nodeType))for(offset<(nodes=container.childNodes).length?(container=nodes[offset],walker=new TreeWalker(container,dom.getParent(container,dom.isBlock))):(container=nodes[nodes.length-1],(walker=new TreeWalker(container,dom.getParent(container,dom.isBlock))).next(!0)),node=walker.current();node;node=walker.next())if(3==node.nodeType&&!isWhiteSpaceNode(node))return rng.setStart(node,0),void selection.setRng(rng)}extend(this,{get:get,register:register,unregister:function unregister(name){return name&&formats[name]&&delete formats[name],formats},apply:apply,remove:remove,toggle:function toggle(name,vars,node){var fmt=get(name);!match(name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?apply(name,vars,node):remove(name,vars,node)},match:match,matchAll:function matchAll(names,vars){var startElement,matchedFormatNames=[],checkedMap={};return startElement=selection.getStart(),dom.getParent(startElement,function(node){var i,name;for(i=0;i<names.length;i++)name=names[i],!checkedMap[name]&&matchNode(node,name,vars)&&(checkedMap[name]=!0,matchedFormatNames.push(name))},dom.getRoot()),matchedFormatNames},matchNode:matchNode,canApply:function canApply(name){var parents,i,x,selector,formatList=get(name);if(formatList)for(parents=getParents(selection.getStart()),x=formatList.length-1;0<=x;x--){if(!(selector=formatList[x].selector)||formatList[x].defaultBlock)return TRUE;for(i=parents.length-1;0<=i;i--)if(dom.is(parents[i],selector))return TRUE}return FALSE},formatChanged:function formatChanged(formats,callback,similar){var currentFormats;return formatChangeData||(formatChangeData={},currentFormats={},ed.on("NodeChange",function(e){var parents=getParents(e.element),matchedFormats={};parents=Tools.grep(parents,function(node){return 1==node.nodeType&&!node.getAttribute("data-mce-bogus")}),each(formatChangeData,function(callbacks,format){each(parents,function(node){return matchNode(node,format,{},callbacks.similar)?(currentFormats[format]||(each(callbacks,function(callback){callback(!0,{node:node,format:format,parents:parents})}),currentFormats[format]=callbacks),matchedFormats[format]=callbacks,!1):!matchesUnInheritedFormatSelector(node,format)&&void 0})}),each(currentFormats,function(callbacks,format){matchedFormats[format]||(delete currentFormats[format],each(callbacks,function(callback){callback(!1,{node:e.element,format:format,parents:parents})}))})})),each(formats.split(","),function(format){formatChangeData[format]||(formatChangeData[format]=[],formatChangeData[format].similar=similar),formatChangeData[format].push(callback)}),this},getCssText:function getCssText(format){return Preview.getCssText(ed,format)}}),function defaultFormats(){register({valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",styles:{fontSize:"%value"},clear_child_styles:!0},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(elm,fmt,vars){each(vars,function(value,key){dom.setAttrib(elm,key,value)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]}),each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(name){register(name,{block:name,remove:"all"})}),register(ed.settings.formats)}(),function addKeyboardShortcuts(){ed.addShortcut("meta+b","bold_desc","Bold"),ed.addShortcut("meta+i","italic_desc","Italic"),ed.addShortcut("meta+u","underline_desc","Underline");for(var i=1;i<=6;i++)ed.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);ed.addShortcut("access+7","",["FormatBlock",!1,"p"]),ed.addShortcut("access+8","",["FormatBlock",!1,"div"]),ed.addShortcut("access+9","",["FormatBlock",!1,"address"])}(),ed.on("BeforeGetContent",function(e){markCaretContainersBogus&&"raw"!=e.format&&markCaretContainersBogus()}),ed.on("mouseup keydown",function(e){disableCaretContainer&&disableCaretContainer(e)})}}),define("tinymce.core.undo.Diff",[],function(){return{KEEP:0,DELETE:2,INSERT:1,diff:function(left,right){var size=left.length+right.length+2,vDown=new Array(size),vUp=new Array(size),buildScript=function(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2)for(var i=start1,j=start2;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end2-start2<end1-start1?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j);else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}},buildSnake=function(start,diag,end1,end2){for(var end=start;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return function(start,end,diag){return{start:start,end:end,diag:diag}}(start,end,diag)},getMiddleSnake=function(start1,end1,start2,end2){var m=end1-start1,n=end2-start2;if(0==m||0==n)return null;var delta=m-n,sum=n+m,offset=(sum%2==0?sum:1+sum)/2;vDown[1+offset]=start1,vUp[1+offset]=end1+1;for(var d=0;d<=offset;++d){for(var k=-d;k<=d;k+=2){var i=k+offset;k===-d||k!=d&&vDown[i-1]<vDown[i+1]?vDown[i]=vDown[i+1]:vDown[i]=vDown[i-1]+1;for(var x=vDown[i],y=x-start1+start2-k;x<end1&&y<end2&&left[x]===right[y];)vDown[i]=++x,++y;if(delta%2!=0&&delta-d<=k&&k<=delta+d&&vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){for(i=k+offset-delta,k===delta-d||k!=delta+d&&vUp[i+1]<=vUp[i-1]?vUp[i]=vUp[i+1]-1:vUp[i]=vUp[i-1],y=(x=vUp[i]-1)-start1+start2-k;start1<=x&&start2<=y&&left[x]===right[y];)vUp[i]=x--,y--;if(delta%2==0&&-d<=k&&k<=d&&vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}},script=[];return buildScript(0,left.length,0,right.length,script),script}}}),define("tinymce.core.undo.Fragments",["tinymce.core.util.Arr","tinymce.core.html.Entities","tinymce.core.undo.Diff"],function(Arr,Entities,Diff){var getOuterHtml=function(elm){return 1===elm.nodeType?elm.outerHTML:3===elm.nodeType?Entities.encodeRaw(elm.data,!1):8===elm.nodeType?"\x3c!--"+elm.data+"--\x3e":""},insertAt=function(elm,html,index){var fragment=function(html){var frag,node,container;for(container=document.createElement("div"),frag=document.createDocumentFragment(),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag}(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target)}else elm.appendChild(fragment)};return{read:function(elm){return Arr.filter(Arr.map(elm.childNodes,getOuterHtml),function(item){return 0<item.length})},write:function(fragments,elm){var currentFragments=Arr.map(elm.childNodes,getOuterHtml);return function(diff,elm){var index=0;Arr.each(diff,function(action){action[0]===Diff.KEEP?index++:action[0]===Diff.INSERT?(insertAt(elm,action[1],index),index++):action[0]===Diff.DELETE&&function(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target)}}(elm,index)})}(Diff.diff(currentFragments,fragments),elm),elm}}}),define("tinymce.core.undo.Levels",["tinymce.core.util.Arr","tinymce.core.undo.Fragments"],function(Arr,Fragments){var createFragmentedLevel=function(fragments){return{type:"fragmented",fragments:fragments,content:"",bookmark:null,beforeBookmark:null}},createCompleteLevel=function(content){return{type:"complete",fragments:null,content:content,bookmark:null,beforeBookmark:null}},getLevelContent=function(level){return"fragmented"===level.type?level.fragments.join(""):level.content};return{createFragmentedLevel:createFragmentedLevel,createCompleteLevel:createCompleteLevel,createFromEditor:function(editor){var fragments,content,trimmedFragments;return fragments=Fragments.read(editor.getBody()),content=(trimmedFragments=Arr.map(fragments,function(html){return editor.serializer.trimContent(html)})).join(""),-1!==content.indexOf("</iframe>")?createFragmentedLevel(trimmedFragments):createCompleteLevel(content)},applyToEditor:function(editor,level,before){"fragmented"===level.type?Fragments.write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw"}),editor.selection.moveToBookmark(before?level.beforeBookmark:level.bookmark)},isEq:function(level1,level2){return getLevelContent(level1)===getLevelContent(level2)}}}),define("tinymce.core.UndoManager",["tinymce.core.util.VK","tinymce.core.util.Tools","tinymce.core.undo.Levels"],function(VK,Tools,Levels){return function(editor){var beforeBookmark,isFirstTypedCharacter,self=this,index=0,data=[],locks=0,isUnlocked=function(){return 0===locks},setTyping=function(typing){isUnlocked()&&(self.typing=typing)};function setDirty(state){editor.setDirty(state)}function addNonTypingUndoLevel(e){setTyping(!1),self.add({},e)}function endTyping(){self.typing&&(setTyping(!1),self.add())}return editor.on("init",function(){self.add()}),editor.on("BeforeExecCommand",function(e){var cmd=e.command;"Undo"!==cmd&&"Redo"!==cmd&&"mceRepaint"!==cmd&&(endTyping(),self.beforeChange())}),editor.on("ExecCommand",function(e){var cmd=e.command;"Undo"!==cmd&&"Redo"!==cmd&&"mceRepaint"!==cmd&&addNonTypingUndoLevel(e)}),editor.on("ObjectResizeStart Cut",function(){self.beforeChange()}),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("DragEnd",addNonTypingUndoLevel),editor.on("KeyUp",function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((33<=keyCode&&keyCode<=36||37<=keyCode&&keyCode<=40||45===keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter&&self.typing&&!1===Levels.isEq(Levels.createFromEditor(editor),data[0])&&(!1===editor.isDirty()&&(setDirty(!0),editor.fire("change",{level:data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter=!1,editor.nodeChanged()))}),editor.on("KeyDown",function(e){var keyCode=e.keyCode;if(!e.isDefaultPrevented())if(33<=keyCode&&keyCode<=36||37<=keyCode&&keyCode<=40||45===keyCode)self.typing&&addNonTypingUndoLevel(e);else{var modKey=e.ctrlKey&&!e.altKey||e.metaKey;!(keyCode<16||20<keyCode)||224===keyCode||91===keyCode||self.typing||modKey||(self.beforeChange(),setTyping(!0),self.add({},e),isFirstTypedCharacter=!0)}}),editor.on("MouseDown",function(e){self.typing&&addNonTypingUndoLevel(e)}),editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo"),editor.on("AddUndo Undo Redo ClearUndos",function(e){e.isDefaultPrevented()||editor.nodeChanged()}),self={data:data,typing:!1,beforeChange:function(){isUnlocked()&&(beforeBookmark=editor.selection.getBookmark(2,!0))},add:function(level,event){var i,lastLevel,currentLevel,settings=editor.settings;if(currentLevel=Levels.createFromEditor(editor),level=level||{},level=Tools.extend(level,currentLevel),!1===isUnlocked()||editor.removed)return null;if(lastLevel=data[index],editor.fire("BeforeAddUndo",{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&Levels.isEq(lastLevel,level))return null;if(data[index]&&(data[index].beforeBookmark=beforeBookmark),settings.custom_undo_redo_levels&&data.length>settings.custom_undo_redo_levels){for(i=0;i<data.length-1;i++)data[i]=data[i+1];data.length--,index=data.length}level.bookmark=editor.selection.getBookmark(2,!0),index<data.length-1&&(data.length=index+1),data.push(level),index=data.length-1;var args={level:level,lastLevel:lastLevel,originalEvent:event};return editor.fire("AddUndo",args),0<index&&(setDirty(!0),editor.fire("change",args)),level},undo:function(){var level;return self.typing&&(self.add(),self.typing=!1,setTyping(!1)),0<index&&(level=data[--index],Levels.applyToEditor(editor,level,!0),setDirty(!0),editor.fire("undo",{level:level})),level},redo:function(){var level;return index<data.length-1&&(level=data[++index],Levels.applyToEditor(editor,level,!1),setDirty(!0),editor.fire("redo",{level:level})),level},clear:function(){data=[],index=0,self.typing=!1,self.data=data,editor.fire("ClearUndos")},hasUndo:function(){return 0<index||self.typing&&data[0]&&!Levels.isEq(Levels.createFromEditor(editor),data[0])},hasRedo:function(){return index<data.length-1&&!self.typing},transact:function(callback){return endTyping(),self.beforeChange(),self.ignore(callback),self.add()},ignore:function(callback){try{locks++,callback()}finally{locks--}},extra:function(callback1,callback2){var lastLevel,bookmark;self.transact(callback1)&&(bookmark=data[index].bookmark,lastLevel=data[index-1],Levels.applyToEditor(editor,lastLevel,!0),self.transact(callback2)&&(data[index-1].beforeBookmark=bookmark))}}}}),define("ephox.sugar.api.node.Body",["ephox.katamari.api.Thunk","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","global!document"],function(Thunk,Element,Node,document){var body=Thunk.cached(function(){return getBody(Element.fromDom(document))}),getBody=function(doc){var body=doc.dom().body;if(null===body||body===undefined)throw"Body is not available yet";return Element.fromDom(body)};return{body:body,getBody:getBody,inBody:function(element){var dom=Node.isText(element)?element.dom().parentNode:element.dom();return dom!==undefined&&null!==dom&&dom.ownerDocument.body.contains(dom)}}}),define("ephox.sugar.impl.ClosestOrAncestor",["ephox.katamari.api.Type","ephox.katamari.api.Option"],function(Type,Option){return function(is,ancestor,scope,a,isRoot){return is(scope,a)?Option.some(scope):Type.isFunction(isRoot)&&isRoot(scope)?Option.none():ancestor(scope,a,isRoot)}}),define("ephox.sugar.api.search.PredicateFind",["ephox.katamari.api.Type","ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Body","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.impl.ClosestOrAncestor"],function(Type,Arr,Fun,Option,Body,Compare,Element,ClosestOrAncestor){var ancestor=function(scope,predicate,isRoot){for(var element=scope.dom(),stop=Type.isFunction(isRoot)?isRoot:Fun.constant(!1);element.parentNode;){element=element.parentNode;var el=Element.fromDom(element);if(predicate(el))return Option.some(el);if(stop(el))break}return Option.none()},child=function(scope,predicate){return Arr.find(scope.dom().childNodes,Fun.compose(predicate,Element.fromDom)).map(Element.fromDom)},descendant=function(scope,predicate){var descend=function(element){for(var i=0;i<element.childNodes.length;i++){if(predicate(Element.fromDom(element.childNodes[i])))return Option.some(Element.fromDom(element.childNodes[i]));var res=descend(element.childNodes[i]);if(res.isSome())return res}return Option.none()};return descend(scope.dom())};return{first:function(predicate){return descendant(Body.body(),predicate)},ancestor:ancestor,closest:function(scope,predicate,isRoot){return ClosestOrAncestor(function(scope){return predicate(scope)},ancestor,scope,predicate,isRoot)},sibling:function(scope,predicate){var element=scope.dom();return element.parentNode?child(Element.fromDom(element.parentNode),function(x){return!Compare.eq(scope,x)&&predicate(x)}):Option.none()},child:child,descendant:descendant}}),define("tinymce.core.caret.CaretUtils",["tinymce.core.util.Fun","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodeType","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretCandidate"],function(Fun,TreeWalker,NodeType,CaretPosition,CaretContainer,CaretCandidate){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBlockLike=NodeType.matchStyleValues("display","block table table-cell table-caption"),isCaretContainer=CaretContainer.isCaretContainer,isCaretContainerBlock=CaretContainer.isCaretContainerBlock,curry=Fun.curry,isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate;function isForwards(direction){return 0<direction}function isBackwards(direction){return direction<0}function skipCaretContainers(walk,shallow){for(var node;node=walk(shallow);)if(!isCaretContainerBlock(node))return node;return null}function getEditingHost(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode)if(isContentEditableTrue(node))return node;return rootNode}function getParentBlock(node,rootNode){for(;node&&node!=rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null}function beforeAfter(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range}function isNodesInSameBlock(rootNode,node1,node2){return getParentBlock(node1,rootNode)==getParentBlock(node2,rootNode)}function lean(left,rootNode,node){var sibling,siblingName;for(siblingName=left?"previousSibling":"nextSibling";node&&node!=rootNode;){if(sibling=node[siblingName],isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse(sibling)){if(isNodesInSameBlock(rootNode,sibling,node))return sibling;break}if(isCaretCandidate(sibling))break;node=node.parentNode}return null}var before=curry(beforeAfter,!0),after=curry(beforeAfter,!1);function isNextToContentEditableFalse(relativeOffset,caretPosition){return isContentEditableFalse(function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){var container,offset;return caretPosition?(container=caretPosition.container(),offset=caretPosition.offset(),isElement(container)?container.childNodes[offset+relativeOffset]:null):null}(relativeOffset,caretPosition))}return{isForwards:isForwards,isBackwards:isBackwards,findNode:function findNode(node,direction,predicateFn,rootNode,shallow){var walker=new TreeWalker(node,rootNode);if(isBackwards(direction)){if((isContentEditableFalse(node)||isCaretContainerBlock(node))&&predicateFn(node=skipCaretContainers(walker.prev,!0)))return node;for(;node=skipCaretContainers(walker.prev,shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if((isContentEditableFalse(node)||isCaretContainerBlock(node))&&predicateFn(node=skipCaretContainers(walker.next,!0)))return node;for(;node=skipCaretContainers(walker.next,shallow);)if(predicateFn(node))return node}return null},getEditingHost:getEditingHost,getParentBlock:getParentBlock,isInSameBlock:function isInSameBlock(caretPosition1,caretPosition2,rootNode){return getParentBlock(caretPosition1.container(),rootNode)==getParentBlock(caretPosition2.container(),rootNode)},isInSameEditingHost:function isInSameEditingHost(caretPosition1,caretPosition2,rootNode){return getEditingHost(caretPosition1.container(),rootNode)==getEditingHost(caretPosition2.container(),rootNode)},isBeforeContentEditableFalse:curry(isNextToContentEditableFalse,0),isAfterContentEditableFalse:curry(isNextToContentEditableFalse,-1),normalizeRange:function normalizeRange(direction,rootNode,range){var node,container,offset,location,leanLeft=curry(lean,!0,rootNode),leanRight=curry(lean,!1,rootNode);if(container=range.startContainer,offset=range.startOffset,CaretContainer.isCaretContainerBlock(container)){if(isElement(container)||(container=container.parentNode),"before"==(location=container.getAttribute("data-mce-caret"))&&(node=container.nextSibling,isContentEditableFalse(node)))return before(node);if("after"==location&&(node=container.previousSibling,isContentEditableFalse(node)))return after(node)}if(!range.collapsed)return range;if(NodeType.isText(container)){if(isCaretContainer(container)){if(1===direction){if(node=leanRight(container))return before(node);if(node=leanLeft(container))return after(node)}if(-1===direction){if(node=leanLeft(container))return after(node);if(node=leanRight(container))return before(node)}return range}if(CaretContainer.endsWithCaretContainer(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container))?before(node):range;if(CaretContainer.startsWithCaretContainer(container)&&offset<=1)return-1===direction&&(node=leanLeft(container))?after(node):range;if(offset===container.data.length)return(node=leanRight(container))?before(node):range;if(0===offset)return(node=leanLeft(container))?after(node):range}return range}}}),define("tinymce.core.caret.CaretWalker",["tinymce.core.dom.NodeType","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.util.Arr","tinymce.core.util.Fun"],function(NodeType,CaretCandidate,CaretPosition,CaretUtils,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,isText=NodeType.isText,isElement=NodeType.isElement,isBr=NodeType.isBr,isForwards=CaretUtils.isForwards,isBackwards=CaretUtils.isBackwards,isCaretCandidate=CaretCandidate.isCaretCandidate,isAtomic=CaretCandidate.isAtomic,isEditableCaretCandidate=CaretCandidate.isEditableCaretCandidate;function nodeAtIndex(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null}function getCaretCandidatePosition(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText(node.previousSibling))return CaretPosition.before(node);if(isText(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText(node.nextSibling))return CaretPosition.after(node);if(isText(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)}function findCaretPosition(direction,startCaretPosition,rootNode){var container,offset,node,nextNode,innerNode,rootContentEditableFalseElm,caretPosition;if(!isElement(rootNode)||!startCaretPosition)return null;if(startCaretPosition.isEqual(CaretPosition.after(rootNode))&&rootNode.lastChild){if(caretPosition=CaretPosition.after(rootNode.lastChild),isBackwards(direction)&&isCaretCandidate(rootNode.lastChild)&&isElement(rootNode.lastChild))return isBr(rootNode.lastChild)?CaretPosition.before(rootNode.lastChild):caretPosition}else caretPosition=startCaretPosition;if(container=caretPosition.container(),offset=caretPosition.offset(),isText(container)){if(isBackwards(direction)&&0<offset)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&0<offset&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode))?isText(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate(nextNode)))return function isBrBeforeBlock(node,rootNode){var next;return!!NodeType.isBr(node)&&(!!(next=findCaretPosition(1,CaretPosition.after(node),rootNode))&&!CaretUtils.isInSameBlock(CaretPosition.before(node),CaretPosition.before(next),rootNode))}(nextNode,rootNode)?findCaretPosition(direction,CaretPosition.after(nextNode),rootNode):!isAtomic(nextNode)&&(innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode))?isText(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=caretPosition.getNode()}return(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=CaretUtils.findNode(node,direction,Fun.constant(!0),rootNode,!0),isEditableCaretCandidate(node))?getCaretCandidatePosition(direction,node):(nextNode=CaretUtils.findNode(node,direction,isEditableCaretCandidate,rootNode),!(rootContentEditableFalseElm=Arr.last(Arr.filter(function getParents(node,rootNode){for(var parents=[];node&&node!=rootNode;)parents.push(node),node=node.parentNode;return parents}(container,rootNode),isContentEditableFalse)))||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm))}return function(rootNode){return{next:function(caretPosition){return findCaretPosition(1,caretPosition,rootNode)},prev:function(caretPosition){return findCaretPosition(-1,caretPosition,rootNode)}}}}),define("tinymce.core.caret.CaretFinder",["ephox.katamari.api.Fun","ephox.katamari.api.Option","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretWalker","tinymce.core.dom.NodeType"],function(Fun,Option,CaretCandidate,CaretPosition,CaretWalker,NodeType){return{fromPosition:function(forward,rootElement,position){var walker=new CaretWalker(rootElement);return Option.from(forward?walker.next(position):walker.prev(position))},positionIn:function(forward,element){var node,startNode=forward?element.firstChild:element.lastChild;return NodeType.isText(startNode)?Option.some(new CaretPosition(startNode,forward?0:startNode.data.length)):startNode?CaretCandidate.isCaretCandidate(startNode)?Option.some(forward?CaretPosition.before(startNode):(node=startNode,NodeType.isBr(node)?CaretPosition.before(node):CaretPosition.after(node))):function(forward,rootNode,startNode){var caretWalker=new CaretWalker(rootNode),startPos=forward?CaretPosition.before(startNode):CaretPosition.after(startNode);return Option.from(forward?caretWalker.next(startPos):caretWalker.prev(startPos))}(forward,element,startNode):Option.none()}}}),define("tinymce.core.delete.DeleteUtils",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.PredicateFind"],function(Arr,Option,Compare,Element,Node,PredicateFind){var names,lookup,isTextBlock=(names=["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"],lookup=Arr.foldl(names,function(acc,name){return acc[name]=!0,acc},{}),function(elm){return!0===lookup[Node.name(elm)]});return{getParentTextBlock:function(rootNode,elm){return Compare.contains(rootNode,elm)?PredicateFind.closest(elm,isTextBlock,function(rootNode){return function(elm){return Compare.eq(rootNode,Element.fromDom(elm.dom().parentNode))}}(rootNode)):Option.none()}}}),define("ephox.sugar.api.search.SelectorFind",["ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Selectors","ephox.sugar.impl.ClosestOrAncestor"],function(PredicateFind,Selectors,ClosestOrAncestor){var ancestor=function(scope,selector,isRoot){return PredicateFind.ancestor(scope,function(e){return Selectors.is(e,selector)},isRoot)};return{first:function(selector){return Selectors.one(selector)},ancestor:ancestor,sibling:function(scope,selector){return PredicateFind.sibling(scope,function(e){return Selectors.is(e,selector)})},child:function(scope,selector){return PredicateFind.child(scope,function(e){return Selectors.is(e,selector)})},descendant:function(scope,selector){return Selectors.one(selector,scope)},closest:function(scope,selector,isRoot){return ClosestOrAncestor(Selectors.is,ancestor,scope,selector,isRoot)}}}),define("ephox.sugar.api.search.SelectorExists",["ephox.sugar.api.search.SelectorFind"],function(SelectorFind){return{any:function(selector){return SelectorFind.first(selector).isSome()},ancestor:function(scope,selector,isRoot){return SelectorFind.ancestor(scope,selector,isRoot).isSome()},sibling:function(scope,selector){return SelectorFind.sibling(scope,selector).isSome()},child:function(scope,selector){return SelectorFind.child(scope,selector).isSome()},descendant:function(scope,selector){return SelectorFind.descendant(scope,selector).isSome()},closest:function(scope,selector,isRoot){return SelectorFind.closest(scope,selector,isRoot).isSome()}}}),define("tinymce.core.dom.Empty",["ephox.katamari.api.Fun","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.search.SelectorExists","tinymce.core.caret.CaretCandidate","tinymce.core.dom.NodeType","tinymce.core.dom.TreeWalker"],function(Fun,Compare,Element,SelectorExists,CaretCandidate,NodeType,TreeWalker){var isWhitespace=function(rootNode,node){return NodeType.isText(node)&&/^[ \t\r\n]*$/.test(node.data)&&!1===function(rootNode,node){var rootElement=Element.fromDom(rootNode),startNode=Element.fromDom(node);return SelectorExists.ancestor(startNode,"pre,code",Fun.curry(Compare.eq,rootElement))}(rootNode,node)},isContent=function(rootNode,node){return CaretCandidate.isCaretCandidate(node)&&!1===isWhitespace(rootNode,node)||function(node){return NodeType.isElement(node)&&"A"===node.nodeName&&node.hasAttribute("name")}(node)||isBookmark(node)},isBookmark=NodeType.hasAttribute("data-mce-bookmark"),isBogus=NodeType.hasAttribute("data-mce-bogus"),isBogusAll=NodeType.hasAttributeValue("data-mce-bogus","all");return{isEmpty:function(elm){return function(targetNode){var walker,node,brCount=0;if(isContent(targetNode,targetNode))return!1;if(!(node=targetNode.firstChild))return!0;walker=new TreeWalker(node,targetNode);do{if(isBogusAll(node))node=walker.next(!0);else if(isBogus(node))node=walker.next();else if(NodeType.isBr(node))brCount++,node=walker.next();else{if(isContent(targetNode,node))return!1;node=walker.next()}}while(node);return brCount<=1}(elm.dom())}}}),define("tinymce.core.delete.BlockBoundary",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.katamari.api.Struct","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Traverse","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.delete.DeleteUtils","tinymce.core.dom.Empty","tinymce.core.dom.NodeType"],function(Arr,Fun,Option,Options,Struct,Compare,Element,Node,PredicateFind,Traverse,CaretFinder,CaretPosition,DeleteUtils,Empty,NodeType){var BlockPosition=Struct.immutable("block","position"),BlockBoundary=Struct.immutable("from","to"),getBlockPosition=function(rootNode,pos){var rootElm=Element.fromDom(rootNode),containerElm=Element.fromDom(pos.container());return DeleteUtils.getParentTextBlock(rootElm,containerElm).map(function(block){return BlockPosition(block,pos)})},readFromRange=function(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng)),toBlockPos=fromBlockPos.bind(function(blockPos){return CaretFinder.fromPosition(forward,rootNode,blockPos.position()).bind(function(to){return getBlockPosition(rootNode,to).map(function(blockPos){return function(rootNode,forward,blockPosition){return NodeType.isBr(blockPosition.position().getNode())&&!1===Empty.isEmpty(blockPosition.block())?CaretFinder.positionIn(!1,blockPosition.block().dom()).bind(function(lastPositionInBlock){return lastPositionInBlock.isEqual(blockPosition.position())?CaretFinder.fromPosition(forward,rootNode,lastPositionInBlock).bind(function(to){return getBlockPosition(rootNode,to)}):Option.some(blockPosition)}).getOr(blockPosition):blockPosition}(rootNode,forward,blockPos)})})});return Options.liftN([fromBlockPos,toBlockPos],BlockBoundary).filter(function(blockBoundary){return function(blockBoundary){return!1===Compare.eq(blockBoundary.from().block(),blockBoundary.to().block())}(blockBoundary)&&function(blockBoundary){return Traverse.parent(blockBoundary.from().block()).bind(function(parent1){return Traverse.parent(blockBoundary.to().block()).filter(function(parent2){return Compare.eq(parent1,parent2)})}).isSome()}(blockBoundary)&&function(blockBoundary){return!1===NodeType.isContentEditableFalse(blockBoundary.from().block())&&!1===NodeType.isContentEditableFalse(blockBoundary.to().block())}(blockBoundary)})};return{read:function(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Option.none()}}}),define("tinymce.core.delete.MergeBlocks",["ephox.katamari.api.Arr","ephox.katamari.api.Option","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.search.Traverse","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.dom.Empty","tinymce.core.dom.NodeType"],function(Arr,Option,Insert,Remove,Element,Traverse,CaretFinder,CaretPosition,Empty,NodeType){var mergeBlocksAndReposition=function(forward,fromBlock,toBlock,toPosition){var children=Traverse.children(fromBlock);return NodeType.isBr(toPosition.getNode())&&(Remove.remove(Element.fromDom(toPosition.getNode())),toPosition=CaretFinder.positionIn(!1,toBlock.dom()).getOr(toPosition)),!1===Empty.isEmpty(fromBlock)&&Arr.each(children,function(node){Insert.append(toBlock,node)}),Empty.isEmpty(fromBlock)&&Remove.remove(fromBlock),0<children.length?Option.from(toPosition):Option.none()};return{mergeBlocks:function(forward,block1,block2){return forward?Empty.isEmpty(block1)?(Remove.remove(block1),CaretFinder.positionIn(!0,block2.dom())):CaretFinder.positionIn(!1,block1.dom()).bind(function(toPosition){return mergeBlocksAndReposition(0,block2,block1,toPosition)}):Empty.isEmpty(block2)?(Remove.remove(block2),CaretFinder.positionIn(!0,block1.dom())):CaretFinder.positionIn(!1,block2.dom()).bind(function(toPosition){return mergeBlocksAndReposition(0,block1,block2,toPosition)})}}}),define("tinymce.core.delete.BlockBoundaryDelete",["tinymce.core.delete.BlockBoundary","tinymce.core.delete.MergeBlocks"],function(BlockBoundary,MergeBlocks){return{backspaceDelete:function(editor,forward){var position;return(position=BlockBoundary.read(editor.getBody(),forward,editor.selection.getRng()).bind(function(blockBoundary){return MergeBlocks.mergeBlocks(forward,blockBoundary.from().block(),blockBoundary.to().block())})).each(function(pos){editor.selection.setRng(pos.toRange())}),position.isSome()}}}),define("tinymce.core.delete.BlockRangeDelete",["ephox.katamari.api.Options","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","tinymce.core.delete.DeleteUtils","tinymce.core.delete.MergeBlocks"],function(Options,Compare,Element,DeleteUtils,MergeBlocks){return{backspaceDelete:function(editor,forward){var rootNode=Element.fromDom(editor.getBody());return!1===editor.selection.isCollapsed()&&function(rootNode,selection){var rng=selection.getRng();return Options.liftN([DeleteUtils.getParentTextBlock(rootNode,Element.fromDom(rng.startContainer)),DeleteUtils.getParentTextBlock(rootNode,Element.fromDom(rng.endContainer))],function(block1,block2){return!1===Compare.eq(block1,block2)&&(rng.deleteContents(),MergeBlocks.mergeBlocks(!0,block1,block2).each(function(pos){selection.setRng(pos.toRange())}),!0)}).getOr(!1)}(rootNode,editor.selection)}}}),define("ephox.katamari.api.Adt",["ephox.katamari.api.Arr","ephox.katamari.api.Obj","ephox.katamari.api.Type","global!Array","global!Error","global!console"],function(Arr,Obj,Type,Array,Error,console){return{generate:function(cases){if(!Type.isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return Arr.each(cases,function(acase,count){var keys=Obj.keys(acase);if(1!==keys.length)throw new Error("one and only one name per case");var key=keys[0],value=acase[key];if(adt[key]!==undefined)throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!Type.isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){var argLength=arguments.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);for(var args=new Array(argLength),i=0;i<args.length;i++)args[i]=arguments[i];return{fold:function(){if(arguments.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+arguments.length);return arguments[count].apply(null,args)},match:function(branches){var branchKeys=Obj.keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!Arr.forall(constructors,function(reqKey){return Arr.contains(branchKeys,reqKey)}))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)},log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}}),adt}}}),define("tinymce.core.delete.CefDeleteAction",["ephox.katamari.api.Adt","ephox.katamari.api.Option","ephox.sugar.api.node.Element","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.delete.DeleteUtils","tinymce.core.dom.Empty","tinymce.core.dom.NodeType"],function(Adt,Option,Element,CaretFinder,CaretPosition,CaretUtils,DeleteUtils,Empty,NodeType){var DeleteAction=Adt.generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),deleteEmptyBlockOrMoveToCef=function(rootNode,forward,from,to){var toCefElm=to.getNode(!1===forward);return DeleteUtils.getParentTextBlock(Element.fromDom(rootNode),Element.fromDom(from.getNode())).map(function(blockElm){return Empty.isEmpty(blockElm)?DeleteAction.remove(blockElm.dom()):DeleteAction.moveToElement(toCefElm)}).orThunk(function(){return Option.some(DeleteAction.moveToElement(toCefElm))})},findCefPosition=function(rootNode,forward,from){return CaretFinder.fromPosition(forward,rootNode,from).bind(function(to){return forward&&NodeType.isContentEditableFalse(to.getNode())?deleteEmptyBlockOrMoveToCef(rootNode,forward,from,to):!1===forward&&NodeType.isContentEditableFalse(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(rootNode,forward,from,to):forward&&CaretUtils.isAfterContentEditableFalse(from)?Option.some(DeleteAction.moveToPosition(to)):!1===forward&&CaretUtils.isBeforeContentEditableFalse(from)?Option.some(DeleteAction.moveToPosition(to)):Option.none()})},getContentEditableAction=function(rootNode,forward,from){return function(forward,from){var elm=from.getNode(!1===forward),caretLocation=forward?"after":"before";return NodeType.isElement(elm)&&elm.getAttribute("data-mce-caret")===caretLocation}(forward,from)?function(forward,elm){return forward&&NodeType.isContentEditableFalse(elm.nextSibling)?Option.some(DeleteAction.moveToElement(elm.nextSibling)):!1===forward&&NodeType.isContentEditableFalse(elm.previousSibling)?Option.some(DeleteAction.moveToElement(elm.previousSibling)):Option.none()}(forward,from.getNode(!1===forward)).fold(function(){return findCefPosition(rootNode,forward,from)},Option.some):findCefPosition(rootNode,forward,from)};return{read:function(rootNode,forward,rng){var normalizedRange=CaretUtils.normalizeRange(forward?1:-1,rootNode,rng),from=CaretPosition.fromRangeStart(normalizedRange);return!1===forward&&CaretUtils.isAfterContentEditableFalse(from)?Option.some(DeleteAction.remove(from.getNode(!0))):forward&&CaretUtils.isBeforeContentEditableFalse(from)?Option.some(DeleteAction.remove(from.getNode())):getContentEditableAction(rootNode,forward,from)}}}),define("tinymce.core.text.Bidi",[],function(){var strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/;return{hasStrongRtl:function(text){return strongRtl.test(text)}}}),define("tinymce.core.keyboard.InlineUtils",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.dom.DOMUtils","tinymce.core.text.Bidi"],function(Fun,Option,Options,CaretContainer,CaretFinder,CaretPosition,CaretUtils,CaretWalker,DOMUtils,Bidi){var isInlineTarget=function(elm){return DOMUtils.DOM.is(elm,"a[href],code")},findInline=function(rootNode,pos){return Option.from(DOMUtils.DOM.getParent(pos.container(),isInlineTarget,rootNode))},findCaretPosition=function(rootNode,forward,from){return CaretFinder.fromPosition(forward,rootNode,from)},normalizePosition=function(forward,pos){var container=pos.container(),offset=pos.offset();return forward?CaretContainer.isBeforeInline(pos)?new CaretPosition(container,offset+1):pos:CaretContainer.isAfterInline(pos)?new CaretPosition(container,offset-1):pos},normalizeForwards=Fun.curry(normalizePosition,!0),normalizeBackwards=Fun.curry(normalizePosition,!1);return{isInlineTarget:isInlineTarget,findInline:findInline,isInInline:function(rootNode,pos){return!!pos&&findInline(rootNode,pos).isSome()},isRtl:function(element){return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||Bidi.hasStrongRtl(element.textContent)},isAtInlineEndPoint:function(rootNode,pos){return findInline(rootNode,pos).map(function(inline){return findCaretPosition(inline,!1,pos).isNone()||findCaretPosition(inline,!0,pos).isNone()}).getOr(!1)},isAtZwsp:function(pos){return CaretContainer.isBeforeInline(pos)||CaretContainer.isAfterInline(pos)},findCaretPositionIn:function(node,forward){return CaretFinder.positionIn(forward,node)},findCaretPosition:findCaretPosition,normalizePosition:normalizePosition,normalizeForwards:normalizeForwards,normalizeBackwards:normalizeBackwards,hasSameParentBlock:function(rootNode,node1,node2){var block1=CaretUtils.getParentBlock(node1,rootNode),block2=CaretUtils.getParentBlock(node2,rootNode);return block1&&block1===block2}}}),define("tinymce.core.delete.DeleteElement",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Remove","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","ephox.sugar.api.search.PredicateFind","ephox.sugar.api.search.Traverse","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretPosition","tinymce.core.dom.Empty","tinymce.core.dom.NodeType","tinymce.core.keyboard.InlineUtils"],function(Fun,Option,Options,Insert,Remove,Element,Node,PredicateFind,Traverse,CaretCandidate,CaretPosition,Empty,NodeType,InlineUtils){var reposition=function(elm,pos){return function(pos,elm){var container=pos.container(),offset=pos.offset();return!1===CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()}(pos,elm)?new CaretPosition(pos.container(),pos.offset()-1):pos},getPreviousSiblingCaretPosition=function(elm){return CaretCandidate.isCaretCandidate(elm.previousSibling)?Option.some((node=elm.previousSibling,NodeType.isText(node)?new CaretPosition(node,node.data.length):CaretPosition.after(node))):elm.previousSibling?InlineUtils.findCaretPositionIn(elm.previousSibling,!1):Option.none();var node},getNextSiblingCaretPosition=function(elm){return CaretCandidate.isCaretCandidate(elm.nextSibling)?Option.some((node=elm.nextSibling,NodeType.isText(node)?new CaretPosition(node,0):CaretPosition.before(node))):elm.nextSibling?InlineUtils.findCaretPositionIn(elm.nextSibling,!0):Option.none();var node},findCaretPositionBackwards=function(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk(function(){return getNextSiblingCaretPosition(elm)}).orThunk(function(){return function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return InlineUtils.findCaretPosition(rootElement,!1,startPosition).fold(function(){return InlineUtils.findCaretPosition(rootElement,!0,CaretPosition.after(elm))},Option.some)}(rootElement,elm)})},findCaretPositionForward=function(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk(function(){return getPreviousSiblingCaretPosition(elm)}).orThunk(function(){return function(rootElement,elm){return InlineUtils.findCaretPosition(rootElement,!0,CaretPosition.after(elm)).fold(function(){return InlineUtils.findCaretPosition(rootElement,!1,CaretPosition.before(elm))},Option.some)}(rootElement,elm)})},findCaretPosOutsideElmAfterDelete=function(forward,rootElement,elm){return function(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm)}(forward,rootElement,elm).map(Fun.curry(reposition,elm))},setSelection=function(editor,forward,pos){pos.fold(function(){editor.focus()},function(pos){editor.selection.setRng(pos.toRange(),forward)})},isBlock=function(editor,elm){return elm&&editor.schema.getBlockElements().hasOwnProperty(Node.name(elm))},paddEmptyBlock=function(elm){if(Empty.isEmpty(elm)){var br=Element.fromHtml('<br data-mce-bogus="1">');return Remove.empty(elm),Insert.append(elm,br),Option.some(CaretPosition.before(br.dom()))}return Option.none()};return{deleteElement:function(editor,forward,elm){var rawNode,afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom()),parentBlock=PredicateFind.ancestor(elm,Fun.curry(isBlock,editor),(rawNode=editor.getBody(),function(elm){return elm.dom()===rawNode})),normalizedAfterDeletePos=function(elm,afterDeletePosOpt){return Options.liftN([Traverse.prevSibling(elm),Traverse.nextSibling(elm),afterDeletePosOpt],function(prev,next,afterDeletePos){var offset,prevNode=prev.dom(),nextNode=next.dom();return NodeType.isText(prevNode)&&NodeType.isText(nextNode)?(offset=prevNode.data.length,prevNode.appendData(nextNode.data),Remove.remove(next),Remove.remove(elm),afterDeletePos.container()===nextNode?new CaretPosition(prevNode,offset):afterDeletePos):(Remove.remove(elm),afterDeletePos)}).orThunk(function(){return Remove.remove(elm),afterDeletePosOpt})}(elm,afterDeletePos);parentBlock.bind(paddEmptyBlock).fold(function(){setSelection(editor,forward,normalizedAfterDeletePos)},function(paddPos){setSelection(editor,forward,Option.some(paddPos))})}}}),define("tinymce.core.delete.CefDelete",["ephox.sugar.api.node.Element","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.delete.BlockBoundary","tinymce.core.delete.CefDeleteAction","tinymce.core.delete.DeleteElement","tinymce.core.delete.MergeBlocks","tinymce.core.dom.NodeType"],function(Element,CaretPosition,CaretUtils,BlockBoundary,CefDeleteAction,DeleteElement,MergeBlocks,NodeType){var backspaceDeleteCaret=function(editor,forward){return CefDeleteAction.read(editor.getBody(),forward,editor.selection.getRng()).map(function(deleteAction){return deleteAction.fold(function(editor,forward){return function(element){return DeleteElement.deleteElement(editor,forward,Element.fromDom(element)),!0}}(editor,forward),function(editor,forward){return function(element){var pos=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(pos.toRange()),!0}}(editor,forward),function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),!0}}(editor))}).getOr(!1)};return{backspaceDelete:function(editor,forward){return editor.selection.isCollapsed()?backspaceDeleteCaret(editor,forward):function(editor,forward){var selectedElement=editor.selection.getNode();return!!NodeType.isContentEditableFalse(selectedElement)&&(DeleteElement.deleteElement(editor,forward,Element.fromDom(editor.selection.getNode())),!0)}(editor,forward)},paddEmptyElement:function(editor){var br,ceRoot=function(root,node){for(;node&&node!==root;){if(NodeType.isContentEditableTrue(node)||NodeType.isContentEditableFalse(node))return node;node=node.parentNode}return null}(editor.getBody(),editor.selection.getNode());return NodeType.isContentEditableTrue(ceRoot)&&editor.dom.isBlock(ceRoot)&&editor.dom.isEmpty(ceRoot)&&(br=editor.dom.create("br",{"data-mce-bogus":"1"}),editor.dom.setHTML(ceRoot,""),ceRoot.appendChild(br),editor.selection.setRng(CaretPosition.before(br).toRange())),!0}}}),define("tinymce.core.caret.CaretContainerInline",["ephox.katamari.api.Fun","tinymce.core.dom.NodeType","tinymce.core.text.Zwsp"],function(Fun,NodeType,Zwsp){var isText=NodeType.isText,startsWithCaretContainer=function(node){return isText(node)&&node.data[0]===Zwsp.ZWSP},endsWithCaretContainer=function(node){return isText(node)&&node.data[node.data.length-1]===Zwsp.ZWSP},createZwsp=function(node){return node.ownerDocument.createTextNode(Zwsp.ZWSP)},insertInline=function(before,node){return before?function(node){if(isText(node.previousSibling))return endsWithCaretContainer(node.previousSibling)||node.previousSibling.appendData(Zwsp.ZWSP),node.previousSibling;if(isText(node))return startsWithCaretContainer(node)||node.insertData(0,Zwsp.ZWSP),node;var newNode=createZwsp(node);return node.parentNode.insertBefore(newNode,node),newNode}(node):function(node){if(isText(node.nextSibling))return startsWithCaretContainer(node.nextSibling)||node.nextSibling.insertData(0,Zwsp.ZWSP),node.nextSibling;if(isText(node))return endsWithCaretContainer(node)||node.appendData(Zwsp.ZWSP),node;var newNode=createZwsp(node);return node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode),newNode}(node)};return{insertInline:insertInline,insertInlineBefore:Fun.curry(insertInline,!0),insertInlineAfter:Fun.curry(insertInline,!1)}}),define("tinymce.core.caret.CaretContainerRemove",["ephox.katamari.api.Arr","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(Arr,CaretContainer,CaretPosition,NodeType,Zwsp,Tools){var isElement=NodeType.isElement,isText=NodeType.isText,removeNode=function(node){var parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},setNodeValue=function(node,text){0===text.length?removeNode(node):node.nodeValue=text},trimCount=function(text){var trimmedText=Zwsp.trim(text);return{count:text.length-trimmedText.length,text:trimmedText}},removeUnchanged=function(caretContainer,pos){return remove(caretContainer),pos},removeTextCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer?function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset())),text=before.text+after.text;return 0<text.length?(setNodeValue(caretContainer,text),new CaretPosition(caretContainer,pos.offset()-before.count)):pos}(caretContainer,pos):removeUnchanged(caretContainer,pos)},removeElementCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer.parentNode?function(caretContainer,pos){var parentNode=pos.container(),newPosition=Arr.indexOf(parentNode.childNodes,caretContainer).map(function(index){return index<pos.offset()?new CaretPosition(parentNode,pos.offset()-1):pos}).getOr(pos);return remove(caretContainer),newPosition}(caretContainer,pos):removeUnchanged(caretContainer,pos)},remove=function(caretContainerNode){if(isElement(caretContainerNode)&&CaretContainer.isCaretContainer(caretContainerNode)&&(CaretContainer.hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode(caretContainerNode)),isText(caretContainerNode)){var text=Zwsp.trim(function(node){try{return node.nodeValue}catch(ex){return""}}(caretContainerNode));setNodeValue(caretContainerNode,text)}};return{removeAndReposition:function(container,pos){return CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos)},remove:remove}}),define("tinymce.core.keyboard.BoundaryCaret",["ephox.katamari.api.Option","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretContainerInline","tinymce.core.caret.CaretContainerRemove","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.keyboard.InlineUtils"],function(Option,CaretContainer,CaretContainerInline,CaretContainerRemove,CaretPosition,NodeType,InlineUtils){var insertInlinePos=function(pos,before){return NodeType.isText(pos.container())?CaretContainerInline.insertInline(before,pos.container()):CaretContainerInline.insertInline(before,pos.getNode())};return{renderCaret:function(caret,location){return location.fold(function(element){CaretContainerRemove.remove(caret.get());var text=CaretContainerInline.insertInlineBefore(element);return caret.set(text),Option.some(new CaretPosition(text,text.length-1))},function(element){return InlineUtils.findCaretPositionIn(element,!0).map(function(pos){CaretContainerRemove.remove(caret.get());var text=insertInlinePos(pos,!0);return caret.set(text),new CaretPosition(text,1)})},function(element){return InlineUtils.findCaretPositionIn(element,!1).map(function(pos){CaretContainerRemove.remove(caret.get());var text=insertInlinePos(pos,!1);return caret.set(text),new CaretPosition(text,text.length-1)})},function(element){CaretContainerRemove.remove(caret.get());var text=CaretContainerInline.insertInlineAfter(element);return caret.set(text),Option.some(new CaretPosition(text,1))})}}}),define("tinymce.core.util.LazyEvaluator",["ephox.katamari.api.Option"],function(Option){return{evaluateUntil:function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome())return result}return Option.none()}}}),define("tinymce.core.keyboard.BoundaryLocation",["ephox.katamari.api.Adt","ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.dom.NodeType","tinymce.core.keyboard.InlineUtils","tinymce.core.util.LazyEvaluator"],function(Adt,Fun,Option,Options,CaretContainer,CaretPosition,CaretUtils,NodeType,InlineUtils,LazyEvaluator){var Location=Adt.generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),rescope=function(rootNode,node){var parentBlock=CaretUtils.getParentBlock(node,rootNode);return parentBlock||rootNode},before=function(rootNode,pos){var nPos=InlineUtils.normalizeForwards(pos),scope=rescope(rootNode,nPos.container());return InlineUtils.findInline(scope,nPos).fold(function(){return InlineUtils.findCaretPosition(scope,!0,nPos).bind(Fun.curry(InlineUtils.findInline,scope)).map(function(inline){return Location.before(inline)})},Option.none)},start=function(rootNode,pos){var nPos=InlineUtils.normalizeBackwards(pos);return InlineUtils.findInline(rootNode,nPos).bind(function(inline){return InlineUtils.findCaretPosition(inline,!1,nPos).isNone()?Option.some(Location.start(inline)):Option.none()})},end=function(rootNode,pos){var nPos=InlineUtils.normalizeForwards(pos);return InlineUtils.findInline(rootNode,nPos).bind(function(inline){return InlineUtils.findCaretPosition(inline,!0,nPos).isNone()?Option.some(Location.end(inline)):Option.none()})},after=function(rootNode,pos){var nPos=InlineUtils.normalizeBackwards(pos),scope=rescope(rootNode,nPos.container());return InlineUtils.findInline(scope,nPos).fold(function(){return InlineUtils.findCaretPosition(scope,!1,nPos).bind(Fun.curry(InlineUtils.findInline,scope)).map(function(inline){return Location.after(inline)})},Option.none)},isValidLocation=function(location){return!1===InlineUtils.isRtl(getElement(location))},readLocation=function(rootNode,pos){return LazyEvaluator.evaluateUntil([before,start,end,after],[rootNode,pos]).filter(isValidLocation)},getElement=function(location){return location.fold(Fun.identity,Fun.identity,Fun.identity,Fun.identity)},getName=function(location){return location.fold(Fun.constant("before"),Fun.constant("start"),Fun.constant("end"),Fun.constant("after"))},outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after)},betweenInlines=function(forward,rootNode,from,to,location){return Options.liftN([InlineUtils.findInline(rootNode,from),InlineUtils.findInline(rootNode,to)],function(fromInline,toInline){return fromInline!==toInline&&InlineUtils.hasSameParentBlock(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location}).getOr(location)},skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(Fun.constant(!0),function(fromLocation){return location2=toLocation,!(getName(location1=fromLocation)===getName(location2)&&getElement(location1)===getElement(location2));var location1,location2})},findLocationSimple=function(forward,location){return forward?location.fold(Fun.compose(Option.some,Location.start),Option.none,Fun.compose(Option.some,Location.after),Option.none):location.fold(Option.none,Fun.compose(Option.some,Location.before),Option.none,Fun.compose(Option.some,Location.end))},findLocation=function(forward,rootNode,pos){var from=InlineUtils.normalizePosition(forward,pos),fromLocation=readLocation(rootNode,from);return readLocation(rootNode,from).bind(Fun.curry(findLocationSimple,forward)).orThunk(function(){return function(forward,rootNode,fromLocation,pos){var from=InlineUtils.normalizePosition(forward,pos);return InlineUtils.findCaretPosition(rootNode,forward,from).map(Fun.curry(InlineUtils.normalizePosition,forward)).fold(function(){return fromLocation.map(outside)},function(to){return readLocation(rootNode,to).map(Fun.curry(betweenInlines,forward,rootNode,from,to)).filter(Fun.curry(skipNoMovement,fromLocation))}).filter(isValidLocation)}(forward,rootNode,fromLocation,pos)})};return{readLocation:readLocation,prevLocation:Fun.curry(findLocation,!1),nextLocation:Fun.curry(findLocation,!0),getElement:getElement,outside:outside,inside:function(location){return location.fold(Location.start,Location.start,Location.end,Location.end)}}}),define("ephox.katamari.api.Cell",[],function(){var Cell=function(initial){var value=initial,get=function(){return value};return{get:get,set:function(v){value=v},clone:function(){return Cell(get())}}};return Cell}),define("tinymce.core.keyboard.BoundarySelection",["ephox.katamari.api.Arr","ephox.katamari.api.Cell","ephox.katamari.api.Fun","tinymce.core.caret.CaretContainerRemove","tinymce.core.caret.CaretPosition","tinymce.core.keyboard.BoundaryCaret","tinymce.core.keyboard.BoundaryLocation","tinymce.core.keyboard.InlineUtils"],function(Arr,Cell,Fun,CaretContainerRemove,CaretPosition,BoundaryCaret,BoundaryLocation,InlineUtils){var setCaretPosition=function(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)},isFeatureEnabled=function(editor){return!1!==editor.settings.inline_boundaries},setSelected=function(state,elm){state?elm.setAttribute("data-mce-selected","1"):elm.removeAttribute("data-mce-selected","1")},renderCaretLocation=function(editor,caret,location){return BoundaryCaret.renderCaret(caret,location).map(function(pos){return setCaretPosition(editor,pos),location})};return{move:function(editor,caret,forward){return function(){return!!isFeatureEnabled(editor)&&function(editor,caret,forward){var rootNode=editor.getBody(),from=CaretPosition.fromRangeStart(editor.selection.getRng());return(forward?BoundaryLocation.nextLocation(rootNode,from):BoundaryLocation.prevLocation(rootNode,from)).bind(function(location){return renderCaretLocation(editor,caret,location)})}(editor,caret,forward).isSome()}},setupSelectedState:function(editor){var caret=new Cell(null);return editor.on("NodeChange",function(e){var dom,elms,selectedInlines,targetInlines;isFeatureEnabled(editor)&&(dom=editor.dom,elms=e.parents,selectedInlines=dom.select("a[href][data-mce-selected],code[data-mce-selected]"),targetInlines=Arr.filter(elms,InlineUtils.isInlineTarget),Arr.each(Arr.difference(selectedInlines,targetInlines),Fun.curry(setSelected,!1)),Arr.each(Arr.difference(targetInlines,selectedInlines),Fun.curry(setSelected,!0)),function(editor,caret){if(editor.selection.isCollapsed()&&!0!==editor.composing&&caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());CaretPosition.isTextPosition(pos)&&!1===InlineUtils.isAtZwsp(pos)&&(setCaretPosition(editor,CaretContainerRemove.removeAndReposition(caret.get(),pos)),caret.set(null))}}(editor,caret),function(editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=Arr.filter(elms,InlineUtils.isInlineTarget);Arr.each(inlines,function(inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());BoundaryLocation.readLocation(editor.getBody(),pos).bind(function(location){return renderCaretLocation(editor,caret,location)})})}}(editor,caret,e.parents))}),caret},setCaretPosition:setCaretPosition}}),define("tinymce.core.delete.InlineBoundaryDelete",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.katamari.api.Options","ephox.sugar.api.node.Element","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.delete.DeleteElement","tinymce.core.keyboard.BoundaryCaret","tinymce.core.keyboard.BoundaryLocation","tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.InlineUtils"],function(Fun,Option,Options,Element,CaretContainer,CaretPosition,CaretUtils,DeleteElement,BoundaryCaret,BoundaryLocation,BoundarySelection,InlineUtils){var setCaretLocation=function(editor,caret){return function(location){return BoundaryCaret.renderCaret(caret,location).map(function(pos){return BoundarySelection.setCaretPosition(editor,pos),!0}).getOr(!1)}},deleteFromTo=function(editor,caret,from,to){var rootNode=editor.getBody();editor.undoManager.ignore(function(){editor.selection.setRng(function(from,to){var range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range}(from,to)),editor.execCommand("Delete"),BoundaryLocation.readLocation(rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(BoundaryLocation.inside).map(setCaretLocation(editor,caret))}),editor.nodeChanged()},backspaceDeleteCollapsed=function(editor,caret,forward,from){var rootNode=function(rootNode,node){var parentBlock=CaretUtils.getParentBlock(node,rootNode);return parentBlock||rootNode}(editor.getBody(),from.container()),fromLocation=BoundaryLocation.readLocation(rootNode,from);return fromLocation.bind(function(location){return forward?location.fold(Fun.constant(Option.some(BoundaryLocation.inside(location))),Option.none,Fun.constant(Option.some(BoundaryLocation.outside(location))),Option.none):location.fold(Option.none,Fun.constant(Option.some(BoundaryLocation.outside(location))),Option.none,Fun.constant(Option.some(BoundaryLocation.inside(location))))}).map(setCaretLocation(editor,caret)).getOrThunk(function(){var toPosition=InlineUtils.findCaretPosition(rootNode,forward,from),toLocation=toPosition.bind(function(pos){return BoundaryLocation.readLocation(rootNode,pos)});return fromLocation.isSome()&&toLocation.isSome()?InlineUtils.findInline(rootNode,from).map(function(elm){return DeleteElement.deleteElement(editor,forward,Element.fromDom(elm)),!0}).getOr(!1):toLocation.map(function(_){return toPosition.map(function(to){forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from)}),!0}).getOr(!1)})};return{backspaceDelete:function(editor,caret,forward){if(editor.selection.isCollapsed()&&function(editor){return!1!==editor.settings.inline_boundaries}(editor)){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from)}return!1}}}),define("tinymce.core.delete.DeleteCommands",["tinymce.core.delete.BlockBoundaryDelete","tinymce.core.delete.BlockRangeDelete","tinymce.core.delete.CefDelete","tinymce.core.delete.InlineBoundaryDelete"],function(BlockBoundaryDelete,BlockRangeDelete,CefDelete,BoundaryDelete){var nativeCommand=function(editor,command){editor.getDoc().execCommand(command,!1,null)};return{deleteCommand:function(editor){CefDelete.backspaceDelete(editor,!1)||BoundaryDelete.backspaceDelete(editor,!1)||BlockBoundaryDelete.backspaceDelete(editor,!1)||BlockRangeDelete.backspaceDelete(editor,!1)||(nativeCommand(editor,"Delete"),function(editor){var dom=editor.dom,body=editor.getBody();dom.isEmpty(body)&&(editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0))}(editor))},forwardDeleteCommand:function(editor){CefDelete.backspaceDelete(editor,!0)||BoundaryDelete.backspaceDelete(editor,!0)||BlockBoundaryDelete.backspaceDelete(editor,!0)||BlockRangeDelete.backspaceDelete(editor,!0)||nativeCommand(editor,"ForwardDelete")}}}),define("tinymce.core.dom.RangeNormalizer",["tinymce.core.caret.CaretFinder","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.dom.NodeType"],function(CaretFinder,CaretPosition,CaretUtils,NodeType){var isTextBlock=function(elm){return NodeType.isElement(elm)&&/^(P|H[1-6]|DIV)$/.test(elm.nodeName)},normalizeBlockSelection=function(rng){var startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return!1===rng.collapsed&&function(rng,predicate){return predicate(rng.endContainer)}(rng,isTextBlock)&&0===rng.endOffset?CaretFinder.fromPosition(!1,rootNode,endPos).map(function(newEndPos){return!CaretUtils.isInSameBlock(startPos,endPos,rootNode)&&CaretUtils.isInSameBlock(startPos,newEndPos,rootNode)?function(sc,so,ec,eo){var rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng}(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng}).getOr(rng):rng};return{normalize:function(rng){return normalizeBlockSelection(rng)}}}),define("tinymce.core.InsertList",["tinymce.core.util.Tools","tinymce.core.caret.CaretWalker","tinymce.core.caret.CaretPosition"],function(Tools,CaretWalker,CaretPosition){var listItems=function(elm){return Tools.grep(elm.childNodes,function(child){return"LI"===child.nodeName})},trimListItems=function(elms){return 0<elms.length&&!elms[elms.length-1].firstChild?elms.slice(0,-1):elms},getParentLi=function(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&"LI"===parentBlock.nodeName?parentBlock:null},findLastOf=function(node,rootNode){var caretPos=CaretPosition.after(node),newCaretPos=new CaretWalker(rootNode).prev(caretPos);return newCaretPos?newCaretPos.toRange():null},insertBefore=function(target,elms,rootNode){var parentElm=target.parentNode;return Tools.each(elms,function(elm){parentElm.insertBefore(elm,target)}),function(node,rootNode){var caretPos=CaretPosition.before(node),newCaretPos=new CaretWalker(rootNode).next(caretPos);return newCaretPos?newCaretPos.toRange():null}(target,rootNode)};return{isListFragment:function(fragment){var firstChild=fragment.firstChild,lastChild=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),lastChild&&"mce_marker"===lastChild.attr("id")&&(lastChild=lastChild.prev),!(!firstChild||firstChild!==lastChild)&&("ul"===firstChild.name||"ol"===firstChild.name)},insertAtCaret:function(serializer,dom,rng,fragment){var domFragment=function(dom,serializer,fragment){var html=serializer.serialize(fragment);return function(domFragment){var firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&firstChild.parentNode.removeChild(firstChild),lastChild&&"mce_marker"===lastChild.id&&lastChild.parentNode.removeChild(lastChild),domFragment}(dom.createFragment(html))}(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),liElms=trimListItems(listItems(domFragment.firstChild)),rootNode=dom.getRoot(),isAt=function(location){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=new CaretWalker(dom.getRoot()),newPos=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos);return!newPos||getParentLi(dom,newPos.getNode())!==liTarget};return isAt(1)?insertBefore(liTarget,liElms,rootNode):isAt(2)?function(target,elms,rootNode,dom){return dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)}(liTarget,liElms,rootNode,dom):function(target,elms,rootNode,rng){var parts=function(parentNode,rng){var beforeRng=rng.cloneRange(),afterRng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),afterRng.setEndAfter(parentNode),[beforeRng.cloneContents(),afterRng.cloneContents()]}(target,rng),parentElm=target.parentNode;return parentElm.insertBefore(parts[0],target),Tools.each(elms,function(li){parentElm.insertBefore(li,target)}),parentElm.insertBefore(parts[1],target),parentElm.removeChild(target),findLastOf(elms[elms.length-1],rootNode)}(liTarget,liElms,rootNode,rng)},isParentBlockLi:function(dom,node){return!!getParentLi(dom,node)},trimListItems:trimListItems,listItems:listItems}}),define("tinymce.core.InsertContent",["tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretWalker","tinymce.core.dom.ElementUtils","tinymce.core.dom.NodeType","tinymce.core.dom.RangeNormalizer","tinymce.core.Env","tinymce.core.html.Serializer","tinymce.core.InsertList","tinymce.core.util.Tools"],function(CaretPosition,CaretWalker,ElementUtils,NodeType,RangeNormalizer,Env,Serializer,InsertList,Tools){var isTableCell=NodeType.matchNodeNames("td th"),insertHtmlAtCaret=function(editor,value,details){var parser,serializer,parentNode,rootNode,fragment,args,marker,rng,node,node2,bookmarkHtml,merge,textInlineElements=editor.schema.getTextInlineElements(),selection=editor.selection,dom=editor.dom;/^ | $/.test(value)&&(value=function trimOrPaddLeftRight(html){var rng,container,offset;function hasSiblingText(siblingName){return container[siblingName]&&3==container[siblingName].nodeType}return rng=selection.getRng(!0),container=rng.startContainer,offset=rng.startOffset,3==container.nodeType&&(0<offset?html=html.replace(/^&nbsp;/," "):hasSiblingText("previousSibling")||(html=html.replace(/^ /,"&nbsp;")),offset<container.length?html=html.replace(/&nbsp;(<br>|)$/," "):hasSiblingText("nextSibling")||(html=html.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),html}(value)),parser=editor.parser,merge=details.merge,serializer=new Serializer({validate:editor.settings.validate},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>',args={content:value,format:"html",selection:!0},editor.fire("BeforeSetContent",args),-1==(value=args.content).indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);var caretElement=(rng=selection.getRng()).startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&function canHaveChildren(node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}(body.firstChild)&&dom.isEmpty(body.firstChild)&&((rng=dom.createRng()).setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||(editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng())),editor.getDoc().execCommand("Delete",!1,null),function trimNbspAfterDeleteAndPaddValue(){var rng,container,offset;container=(rng=selection.getRng(!0)).startContainer,offset=rng.startOffset,3==container.nodeType&&rng.collapsed&&(" "===container.data[offset]?(container.deleteData(offset,1),/[\u00a0| ]$/.test(value)||(value+=" ")):" "===container.data[offset-1]&&(container.deleteData(offset-1,1),/[\u00a0| ]$/.test(value)||(value=" "+value)))}());var parserArgs={context:(parentNode=selection.getNode()).nodeName.toLowerCase(),data:details.data};if(fragment=parser.parse(value,parserArgs),!0===details.paste&&InsertList.isListFragment(fragment)&&InsertList.isParentBlockLi(dom,parentNode))return rng=InsertList.insertAtCaret(serializer,dom,editor.selection.getRng(!0),fragment),editor.selection.setRng(rng),void editor.fire("SetContent",args);if(!function markFragmentElements(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")}(fragment),"mce_marker"==(node=fragment.lastChild).attr("id"))for(node=(marker=node).prev;node;node=node.walk(!0))if(3==node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid){for(selection.setContent(bookmarkHtml),parentNode=selection.getNode(),rootNode=editor.getBody(),9==parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)node=(parentNode=node).parentNode;value=parentNode==rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment)}))),parentNode==rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else value=serializer.serialize(fragment),function(editor,value,parentNode){if("all"===parentNode.getAttribute("data-mce-bogus"))parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);else{var node=parentNode.firstChild,node2=parentNode.lastChild;!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value)}}(editor,value,parentNode);!function reduceInlineTextElements(){if(merge){var root=editor.getBody(),elementUtils=new ElementUtils(dom);Tools.each(dom.select("*[data-mce-fragment]"),function(node){for(var testNode=node.parentNode;testNode&&testNode!=root;testNode=testNode.parentNode)textInlineElements[node.nodeName.toLowerCase()]&&elementUtils.compare(testNode,node)&&dom.remove(node,!0)})}}(),function moveSelectionToMarker(marker){var parentEditableFalseElm,parentBlock,nextRng;if(marker){if(selection.scrollIntoView(marker),parentEditableFalseElm=function getContentEditableFalseParent(node){for(var root=editor.getBody();node&&node!==root;node=node.parentNode)if("false"===editor.dom.getContentEditable(node))return node;return null}(marker))return dom.remove(marker),void selection.select(parentEditableFalseElm);rng=dom.createRng(),(node=marker.previousSibling)&&3==node.nodeType?(rng.setStart(node,node.nodeValue.length),Env.ie||(node2=marker.nextSibling)&&3==node2.nodeType&&(node.appendData(node2.data),node2.parentNode.removeChild(node2))):(rng.setStartBefore(marker),rng.setEndBefore(marker)),parentBlock=dom.getParent(marker,dom.isBlock),dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)&&(editor.$(parentBlock).empty(),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isTableCell(parentBlock)||function isPartOfFragment(node){return!!node.getAttribute("data-mce-fragment")}(parentBlock)||!(nextRng=function findNextCaretRng(rng){var caretPos=CaretPosition.fromRangeStart(rng);if(caretPos=new CaretWalker(editor.getBody()).next(caretPos))return caretPos.toRange()}(rng))?dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))),selection.setRng(rng)}}(dom.get("mce_marker")),function umarkFragmentElements(elm){Tools.each(elm.getElementsByTagName("*"),function(elm){elm.removeAttribute("data-mce-fragment")})}(editor.getBody()),editor.fire("SetContent",args),editor.addVisual()};return{insertAtCaret:function(editor,value){var result=function(value){var details;return"string"!=typeof value?(details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value),{content:value.content,details:details}):{content:value,details:{}}}(value);insertHtmlAtCaret(editor,result.content,result.details)}}}),define("tinymce.core.EditorCommands",["tinymce.core.delete.DeleteCommands","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.Env","tinymce.core.InsertContent","tinymce.core.util.Tools"],function(DeleteCommands,NodeType,RangeUtils,TreeWalker,Env,InsertContent,Tools){var each=Tools.each,extend=Tools.extend,map=Tools.map,inArray=Tools.inArray,explode=Tools.explode,isOldIE=Env.ie&&Env.ie<11;return function(editor){var dom,selection,formatter,bookmark,commands={state:{},exec:{},value:{}},settings=editor.settings;function queryCommandState(command){var func;if(!editor.quirks.isHidden()&&!editor.removed){if(command=command.toLowerCase(),func=commands.state[command])return func(command);try{return editor.getDoc().queryCommandState(command)}catch(ex){}return!1}}function addCommands(commandList,type){type=type||"exec",each(commandList,function(callback,command){each(command.toLowerCase().split(","),function(command){commands[type][command]=callback})})}function execNativeCommand(command,ui,value){return ui===undefined&&(ui=!1),value===undefined&&(value=null),editor.getDoc().execCommand(command,ui,value)}function isFormatMatch(name){return formatter.match(name)}function toggleFormat(name,value){formatter.toggle(name,value?{value:value}:undefined),editor.nodeChanged()}function storeSelection(type){bookmark=selection.getBookmark(type)}function restoreSelection(){selection.moveToBookmark(bookmark)}editor.on("PreInit",function(){dom=editor.dom,selection=editor.selection,settings=editor.settings,formatter=editor.formatter}),extend(this,{execCommand:function execCommand(command,ui,value,args){var func,customCommand,state=0;if(!editor.removed){if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus||editor.focus(),(args=editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value})).isDefaultPrevented())return!1;if(customCommand=command.toLowerCase(),func=commands.exec[customCommand])return func(customCommand,ui,value),editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;if(each(editor.plugins,function(p){if(p.execCommand&&p.execCommand(command,ui,value))return editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!(state=!0)}),state)return state;if(editor.theme&&editor.theme.execCommand&&editor.theme.execCommand(command,ui,value))return editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;try{state=editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0)}},queryCommandState:queryCommandState,queryCommandValue:function queryCommandValue(command){var func;if(!editor.quirks.isHidden()&&!editor.removed){if(command=command.toLowerCase(),func=commands.value[command])return func(command);try{return editor.getDoc().queryCommandValue(command)}catch(ex){}}},queryCommandSupported:function queryCommandSupported(command){if(command=command.toLowerCase(),commands.exec[command])return!0;try{return editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1},addCommands:addCommands,addCommand:function addCommand(command,callback,scope){command=command.toLowerCase(),commands.exec[command]=function(command,ui,value,args){return callback.call(scope||editor,ui,value,args)}},addQueryStateHandler:function addQueryStateHandler(command,callback,scope){command=command.toLowerCase(),commands.state[command]=function(){return callback.call(scope||editor)}},addQueryValueHandler:function addQueryValueHandler(command,callback,scope){command=command.toLowerCase(),commands.value[command]=function(){return callback.call(scope||editor)}},hasCustomCommand:function hasCustomCommand(command){return command=command.toLowerCase(),!!commands.exec[command]}}),addCommands({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},"Cut,Copy,Paste":function(command){var failed,doc=editor.getDoc();try{execNativeCommand(command)}catch(ex){failed=!0}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");Env.mac&&(msg=msg.replace(/Ctrl\+/g,"⌘+")),editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),"a");elm&&editor.dom.remove(elm,!0)}else formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"==align&&(align="justify"),each("left,center,right,justify".split(","),function(name){align!=name&&formatter.remove("align"+name)}),"none"!=align&&toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){var listElm,listParent;execNativeCommand(command),(listElm=dom.getParent(selection.getNode(),"ol,ul"))&&(listParent=listElm.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(storeSelection(),dom.split(listParent,listElm),restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){toggleFormat(command)},"ForeColor,HiliteColor,FontName":function(command,ui,value){toggleFormat(command,value)},FontSize:function(command,ui,value){var fontClasses,fontSizes;1<=value&&value<=7&&(fontSizes=explode(settings.font_size_style_values),value=(fontClasses=explode(settings.font_size_classes))?fontClasses[value-1]||value:fontSizes[value-1]||value),toggleFormat(command,value)},RemoveFormat:function(command){formatter.remove(command)},mceBlockQuote:function(){toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return toggleFormat(value||"p")},mceCleanup:function(){var bookmark=selection.getBookmark();editor.setContent(editor.getContent({cleanup:!0}),{cleanup:!0}),selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||selection.getNode();node!=editor.getBody()&&(storeSelection(),editor.dom.remove(node,!0),restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;dom.getParent(selection.getNode(),function(node){if(1==node.nodeType&&counter++==value)return selection.select(node),!1},editor.getBody())},mceSelectNode:function(command,ui,value){selection.select(value)},mceInsertContent:function(command,ui,value){InsertContent.insertAtCaret(editor,value)},mceInsertRawHTML:function(command,ui,value){selection.setContent("tiny_mce_marker"),editor.setContent(editor.getContent().replace(/tiny_mce_marker/g,function(){return value}))},mceToggleFormat:function(command,ui,value){toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){var intentValue,indentUnit,value;intentValue=settings.indentation,indentUnit=/[a-z%]+$/i.exec(intentValue),intentValue=parseInt(intentValue,10),queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")?execNativeCommand(command):(settings.forced_root_block||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each(selection.getSelectedBlocks(),function(element){if("false"!==dom.getContentEditable(element)&&"LI"!==element.nodeName){var indentStyleName=editor.getParam("indent_use_margin",!1)?"margin":"padding";indentStyleName="TABLE"===element.nodeName?"margin":indentStyleName,indentStyleName+="rtl"==dom.getStyle(element,"direction",!0)?"Right":"Left","outdent"==command?(value=Math.max(0,parseInt(element.style[indentStyleName]||0,10)-intentValue),dom.setStyle(element,indentStyleName,value?value+indentUnit:"")):(value=parseInt(element.style[indentStyleName]||0,10)+intentValue+indentUnit,dom.setStyle(element,indentStyleName,value))}}))},mceRepaint:function(){},InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){var anchor;"string"==typeof value&&(value={href:value}),anchor=dom.getParent(selection.getNode(),"a"),value.href=value.href.replace(" ","%20"),anchor&&value.href||formatter.remove("link"),value.href&&formatter.apply("link",value,anchor)},selectAll:function(){var rng,root=dom.getRoot();if(selection.getRng().setStart){var editingHost=dom.getParent(selection.getStart(),NodeType.isContentEditableTrue);editingHost&&((rng=dom.createRng()).selectNodeContents(editingHost),selection.setRng(rng))}else(rng=selection.getRng()).item||(rng.moveToElementText(root),rng.select())},"delete":function(){DeleteCommands.deleteCommand(editor)},forwardDelete:function(){DeleteCommands.forwardDeleteCommand(editor)},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){var brElm,extraBr,marker,evt=value,rng=selection.getRng(!0);new RangeUtils(dom).normalize(rng);var offset=rng.startOffset,container=rng.startContainer;if(1==container.nodeType&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3==container.nodeType?container.nodeValue.length:0}var parentBlock=dom.getParent(container,dom.isBlock),parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"",containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=evt&&evt.ctrlKey;"LI"!=containerBlockName||isControlKey||(parentBlock=containerBlock,parentBlockName=containerBlockName),container&&3==container.nodeType&&offset>=container.nodeValue.length&&(isOldIE||function hasRightSideContent(){for(var node,walker=new TreeWalker(container,parentBlock),nonEmptyElementsMap=editor.schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||0<node.length)return!0}()||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rng.insertNode(brElm);var documentMode=dom.doc.documentMode;return isOldIE&&"PRE"==parentBlockName&&(!documentMode||documentMode<8)&&brElm.parentNode.insertBefore(dom.doc.createTextNode("\r"),brElm),marker=dom.create("span",{},"&nbsp;"),brElm.parentNode.insertBefore(marker,brElm),selection.scrollIntoView(marker),dom.remove(marker),extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),selection.setRng(rng),editor.undoManager.add(),!0}}),addCommands({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(command){var name="align"+command.substring(7),nodes=selection.isCollapsed()?[dom.getParent(selection.getNode(),dom.isBlock)]:selection.getSelectedBlocks(),matches=map(nodes,function(node){return!!formatter.matchNode(node,name)});return-1!==inArray(matches,!0)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return isFormatMatch(command)},mceBlockQuote:function(){return isFormatMatch("blockquote")},Outdent:function(){var node;if(settings.inline_styles){if((node=dom.getParent(selection.getStart(),dom.isBlock))&&0<parseInt(node.style.paddingLeft,10))return!0;if((node=dom.getParent(selection.getEnd(),dom.isBlock))&&0<parseInt(node.style.paddingLeft,10))return!0}return queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")||!settings.inline_styles&&!!dom.getParent(selection.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(command){var list=dom.getParent(selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),addCommands({"FontSize,FontName":function(command){var parent,value=0;return(parent=dom.getParent(selection.getNode(),"span"))&&(value="fontsize"==command?parent.style.fontSize:parent.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),value}},"value"),addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}})}}),define("tinymce.core.util.URI",["global!document","tinymce.core.util.Tools"],function(document,Tools){var each=Tools.each,trim=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};function URI(url,settings){var baseUri,baseUrl,self=this;if(url=trim(url),baseUri=(settings=self.settings=settings||{}).base_uri,/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))self.source=url;else{var isProtocolRelative=0===url.indexOf("//");0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+url),/^[\w\-]*:?\/\//.test(url)||(baseUrl=settings.base_uri?settings.base_uri.path:new URI(document.location.href).directory,url=""===settings.base_uri.protocol?"//mce_host"+self.toAbsPath(baseUrl,url):(url=/([^#?]*)([#?]?.*)/.exec(url),(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,url[1])+url[2])),url=url.replace(/@@/g,"(mce_at)"),url=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url),each(queryParts,function(v,i){var part=url[i];part=part&&part.replace(/\(mce_at\)/g,"@@"),self[v]=part}),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}}return URI.prototype={setPath:function(path){path=/^(.*?)\/?(\w+)?$/.exec(path),this.path=path[0],this.directory=path[1],this.file=path[2],this.source="",this.getURI()},toRelative:function(uri){var output;if("./"===uri)return uri;if("mce_host"!=(uri=new URI(uri,{base_uri:this})).host&&this.host!=uri.host&&uri.host||this.port!=uri.port||this.protocol!=uri.protocol&&""!==uri.protocol)return uri.getURI();var tu=this.getURI(),uu=uri.getURI();return tu==uu||"/"==tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)==uu?tu:(output=this.toRelPath(this.path,uri.path),uri.query&&(output+="?"+uri.query),uri.anchor&&(output+="#"+uri.anchor),output)},toAbsolute:function(uri,noHost){return(uri=new URI(uri,{base_uri:this})).getURI(noHost&&this.isSameOrigin(uri))},isSameOrigin:function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},toRelPath:function(base,path){var items,i,l,breakPoint=0,out="";if(base=(base=base.substring(0,base.lastIndexOf("/"))).split("/"),items=path.split("/"),base.length>=items.length)for(i=0,l=base.length;i<l;i++)if(i>=items.length||base[i]!=items[i]){breakPoint=i+1;break}if(base.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=base.length||base[i]!=items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=base.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!=breakPoint-1?"/"+items[i]:items[i];return out},toAbsPath:function(base,path){var i,tr,outPath,nb=0,o=[];for(tr=/\/$/.test(path)?"/":"",base=base.split("/"),path=path.split("/"),each(base,function(k){k&&o.push(k)}),base=o,i=path.length-1,o=[];0<=i;i--)0!==path[i].length&&"."!==path[i]&&(".."!==path[i]?0<nb?nb--:o.push(path[i]):nb++);return 0!==(outPath=(i=base.length-nb)<=0?o.reverse().join("/"):base.slice(0,i).join("/")+"/"+o.reverse().join("/")).indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath},getURI:function(noProtoHost){var s;return this.source&&!noProtoHost||(s="",noProtoHost||(this.protocol?s+=this.protocol+"://":s+="//",this.userInfo&&(s+=this.userInfo+"@"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port)),this.path&&(s+=this.path),this.query&&(s+="?"+this.query),this.anchor&&(s+="#"+this.anchor),this.source=s),this.source}},URI.parseDataUri=function(uri){var type,matches;return uri=decodeURIComponent(uri).split(","),(matches=/data:([^;]+)/.exec(uri[0]))&&(type=matches[1]),{type:type,data:uri[1]}},URI.getDocumentBaseUrl=function(loc){var baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl},URI}),define("tinymce.core.util.Class",["tinymce.core.util.Tools"],function(Tools){var extendClass,initializing,each=Tools.each,extend=Tools.extend;function Class(){}return Class.extend=extendClass=function(prop){var prototype,name,member,_super=this.prototype;function Class(){var i,mixins,mixin;if(!initializing&&(this.init&&this.init.apply(this,arguments),mixins=this.Mixins))for(i=mixins.length;i--;)(mixin=mixins[i]).init&&mixin.init.apply(this,arguments)}function dummy(){return this}function createMethod(name,fn){return function(){var ret,tmp=this._super;return this._super=_super[name],ret=fn.apply(this,arguments),this._super=tmp,ret}}for(name in initializing=!0,prototype=new this,initializing=!1,prop.Mixins&&(each(prop.Mixins,function(mixin){for(var name in mixin)"init"!==name&&(prop[name]=mixin[name])}),_super.Mixins&&(prop.Mixins=_super.Mixins.concat(prop.Mixins))),prop.Methods&&each(prop.Methods.split(","),function(name){prop[name]=dummy}),prop.Properties&&each(prop.Properties.split(","),function(name){var fieldName="_"+name;prop[name]=function(value){return void 0!==value?(this[fieldName]=value,this):this[fieldName]}}),prop.Statics&&each(prop.Statics,function(func,name){Class[name]=func}),prop.Defaults&&_super.Defaults&&(prop.Defaults=extend({},_super.Defaults,prop.Defaults)),prop)"function"==typeof(member=prop[name])&&_super[name]?prototype[name]=createMethod(name,member):prototype[name]=member;return Class.prototype=prototype,(Class.constructor=Class).extend=extendClass,Class},Class}),define("tinymce.core.util.EventDispatcher",["tinymce.core.util.Tools"],function(Tools){var nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend"," ");function Dispatcher(settings){var scope,toggleEvent,self=this,bindings={};function returnFalse(){return!1}function returnTrue(){return!0}function on(name,callback,prepend,extra){var handlers,names,i;if(!1===callback&&(callback=returnFalse),callback)for(callback={func:callback},extra&&Tools.extend(callback,extra),i=(names=name.toLowerCase().split(" ")).length;i--;)name=names[i],(handlers=bindings[name])||(handlers=bindings[name]=[],toggleEvent(name,!0)),prepend?handlers.unshift(callback):handlers.push(callback);return self}function off(name,callback){var i,handlers,bindingName,names,hi;if(name)for(i=(names=name.toLowerCase().split(" ")).length;i--;){if(name=names[i],handlers=bindings[name],!name){for(bindingName in bindings)toggleEvent(bindingName,!1),delete bindings[bindingName];return self}if(handlers){if(callback)for(hi=handlers.length;hi--;)handlers[hi].func===callback&&(handlers=handlers.slice(0,hi).concat(handlers.slice(hi+1)),bindings[name]=handlers);else handlers.length=0;handlers.length||(toggleEvent(name,!1),delete bindings[name])}}else{for(name in bindings)toggleEvent(name,!1);bindings={}}return self}scope=(settings=settings||{}).scope||self,toggleEvent=settings.toggleEvent||returnFalse,self.fire=function fire(name,args){var handlers,i,l,callback;if(name=name.toLowerCase(),(args=args||{}).type=name,args.target||(args.target=scope),args.preventDefault||(args.preventDefault=function(){args.isDefaultPrevented=returnTrue},args.stopPropagation=function(){args.isPropagationStopped=returnTrue},args.stopImmediatePropagation=function(){args.isImmediatePropagationStopped=returnTrue},args.isDefaultPrevented=returnFalse,args.isPropagationStopped=returnFalse,args.isImmediatePropagationStopped=returnFalse),settings.beforeFire&&settings.beforeFire(args),handlers=bindings[name])for(i=0,l=handlers.length;i<l;i++){if((callback=handlers[i]).once&&off(name,callback.func),args.isImmediatePropagationStopped())return args.stopPropagation(),args;if(!1===callback.func.call(scope,args))return args.preventDefault(),args}return args},self.on=on,self.off=off,self.once=function once(name,callback,prepend){return on(name,callback,prepend,{once:!0})},self.has=function has(name){return name=name.toLowerCase(),!(!bindings[name]||0===bindings[name].length)}}return Dispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},Dispatcher}),define("tinymce.core.util.Observable",["tinymce.core.util.EventDispatcher"],function(EventDispatcher){function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher}return{fire:function(name,args,bubble){if(this.removed&&"remove"!==name)return args;if(args=getEventDispatcher(this).fire(name,args,bubble),!1!==bubble&&this.parent)for(var parent=this.parent();parent&&!args.isPropagationStopped();)parent.fire(name,args,!1),parent=parent.parent();return args},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}}}),define("tinymce.core.data.Binding",[],function(){function Binding(settings){this.create=settings.create}return Binding.create=function(model,name){return new Binding({create:function(otherModel,otherName){var bindings;function fromSelfToOther(e){otherModel.set(otherName,e.value)}return otherModel.on("change:"+otherName,function fromOtherToSelf(e){model.set(name,e.value)}),model.on("change:"+name,fromSelfToOther),(bindings=otherModel._bindings)||(bindings=otherModel._bindings=[],otherModel.on("destroy",function(){for(var i=bindings.length;i--;)bindings[i]()})),bindings.push(function(){model.off("change:"+name,fromSelfToOther)}),model.get(name)}})},Binding}),define("tinymce.core.data.ObservableObject",["tinymce.core.data.Binding","tinymce.core.util.Class","tinymce.core.util.Observable","tinymce.core.util.Tools"],function(Binding,Class,Observable,Tools){function isNode(node){return 0<node.nodeType}return Class.extend({Mixins:[Observable],init:function(data){var name,value;for(name in data=data||{})(value=data[name])instanceof Binding&&(data[name]=value.create(this,name));this.data=data},set:function(name,value){var key,args,oldValue=this.data[name];if(value instanceof Binding&&(value=value.create(this,name)),"object"!=typeof name)return function isEqual(a,b){var k,checked;if(a===b)return!0;if(null===a||null===b)return a===b;if("object"!=typeof a||"object"!=typeof b)return a===b;if(Tools.isArray(b)){if(a.length!==b.length)return!1;for(k=a.length;k--;)if(!isEqual(a[k],b[k]))return!1}if(isNode(a)||isNode(b))return a===b;for(k in checked={},b){if(!isEqual(a[k],b[k]))return!1;checked[k]=!0}for(k in a)if(!checked[k]&&!isEqual(a[k],b[k]))return!1;return!0}(oldValue,value)||(this.data[name]=value,args={target:this,name:name,value:value,oldValue:oldValue},this.fire("change:"+name,args),this.fire("change",args)),this;for(key in name)this.set(key,name[key]);return this},get:function(name){return this.data[name]},has:function(name){return name in this.data},bind:function(name){return Binding.create(this,name)},destroy:function(){this.fire("destroy")}})}),define("tinymce.core.ui.Selector",["tinymce.core.util.Class"],function(Class){"use strict";var Collection,expression=/^([\w\\*]+)?(?:#([\w\-\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i,chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,whiteSpace=/^\s*|\s*$/g,Selector=Class.extend({init:function(selector){var match=this.match;function compile(selector,filters,direct){var parts;function add(filter){filter&&filters.push(filter)}return add(function compileNameFilter(name){if(name)return name=name.toLowerCase(),function(item){return"*"===name||item.type===name}}((parts=expression.exec(selector.replace(whiteSpace,"")))[1])),add(function compileIdFilter(id){if(id)return function(item){return item._name===id}}(parts[2])),add(function compileClassesFilter(classes){if(classes)return classes=classes.split("."),function(item){for(var i=classes.length;i--;)if(!item.classes.contains(classes[i]))return!1;return!0}}(parts[3])),add(function compileAttrFilter(name,cmp,check){if(name)return function(item){var value=item[name]?item[name]():"";return cmp?"="===cmp?value===check:"*="===cmp?0<=value.indexOf(check):"~="===cmp?0<=(" "+value+" ").indexOf(" "+check+" "):"!="===cmp?value!=check:"^="===cmp?0===value.indexOf(check):"$="===cmp&&value.substr(value.length-check.length)===check:!!check}}(parts[4],parts[5],parts[6])),add(function compilePsuedoFilter(name){var notSelectors;if(name)return(name=/(?:not\((.+)\))|(.+)/i.exec(name))[1]?(notSelectors=parseChunks(name[1],[]),function(item){return!match(item,notSelectors)}):(name=name[2],function(item,index,length){return"first"===name?0===index:"last"===name?index===length-1:"even"===name?index%2==0:"odd"===name?index%2==1:!!item[name]&&item[name]()})}(parts[7])),filters.pseudo=!!parts[7],filters.direct=direct,filters}function parseChunks(selector,selectors){var extra,matches,i,parts=[];do{if(chunker.exec(""),(matches=chunker.exec(selector))&&(selector=matches[3],parts.push(matches[1]),matches[2])){extra=matches[3];break}}while(matches);for(extra&&parseChunks(extra,selectors),selector=[],i=0;i<parts.length;i++)">"!=parts[i]&&selector.push(compile(parts[i],[],">"===parts[i-1]));return selectors.push(selector),selectors}this._selectors=parseChunks(selector,[])},match:function(control,selectors){var i,l,si,sl,selector,fi,fl,filters,index,length,siblings,count,item;for(i=0,l=(selectors=selectors||this._selectors).length;i<l;i++){for(item=control,count=0,si=(sl=(selector=selectors[i]).length)-1;0<=si;si--)for(filters=selector[si];item;){if(filters.pseudo)for(index=length=(siblings=item.parent().items()).length;index--&&siblings[index]!==item;);for(fi=0,fl=filters.length;fi<fl;fi++)if(!filters[fi](item,index,length)){fi=fl+1;break}if(fi===fl){count++;break}if(si===sl-1)break;item=item.parent()}if(count===sl)return!0}return!1},find:function(container){var i,l,matches=[],selectors=this._selectors;function collect(items,selector,index){var i,l,fi,fl,item,filters=selector[index];for(i=0,l=items.length;i<l;i++){for(item=items[i],fi=0,fl=filters.length;fi<fl;fi++)if(!filters[fi](item,i,l)){fi=fl+1;break}if(fi===fl)index==selector.length-1?matches.push(item):item.items&&collect(item.items(),selector,index+1);else if(filters.direct)return;item.items&&collect(item.items(),selector,index)}}if(container.items){for(i=0,l=selectors.length;i<l;i++)collect(container.items(),selectors[i],0);1<l&&(matches=function unique(array){for(var item,uniqueItems=[],i=array.length;i--;)(item=array[i]).__checked||(uniqueItems.push(item),item.__checked=1);for(i=uniqueItems.length;i--;)delete uniqueItems[i].__checked;return uniqueItems}(matches))}return new(Collection=Collection||Selector.Collection)(matches)}});return Selector}),define("tinymce.core.ui.Collection",["tinymce.core.util.Tools","tinymce.core.ui.Selector","tinymce.core.util.Class"],function(Tools,Selector,Class){"use strict";var Collection,proto,push=Array.prototype.push,slice=Array.prototype.slice;return proto={length:0,init:function(items){items&&this.add(items)},add:function(items){return Tools.isArray(items)?push.apply(this,items):items instanceof Collection?this.add(items.toArray()):push.call(this,items),this},set:function(items){var i,len=this.length;for(this.length=0,this.add(items),i=this.length;i<len;i++)delete this[i];return this},filter:function(selector){var i,l,item,match,matches=[];for(match="string"==typeof selector?(selector=new Selector(selector),function(item){return selector.match(item)}):selector,i=0,l=this.length;i<l;i++)match(item=this[i])&&matches.push(item);return new Collection(matches)},slice:function(){return new Collection(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},each:function(callback){return Tools.each(this,callback),this},toArray:function(){return Tools.toArray(this)},indexOf:function(ctrl){for(var i=this.length;i--&&this[i]!==ctrl;);return i},reverse:function(){return new Collection(Tools.toArray(this).reverse())},hasClass:function(cls){return!!this[0]&&this[0].classes.contains(cls)},prop:function(name,value){var item;return void 0!==value?(this.each(function(item){item[name]&&item[name](value)}),this):(item=this[0])&&item[name]?item[name]():void 0},exec:function(name){var args=Tools.toArray(arguments).slice(1);return this.each(function(item){item[name]&&item[name].apply(item,args)}),this},remove:function(){for(var i=this.length;i--;)this[i].remove();return this},addClass:function(cls){return this.each(function(item){item.classes.add(cls)})},removeClass:function(cls){return this.each(function(item){item.classes.remove(cls)})}},Tools.each("fire on off show hide append prepend before after reflow".split(" "),function(name){proto[name]=function(){var args=Tools.toArray(arguments);return this.each(function(ctrl){name in ctrl&&ctrl[name].apply(ctrl,args)}),this}}),Tools.each("text name disabled active selected checked visible parent value data".split(" "),function(name){proto[name]=function(value){return this.prop(name,value)}}),Collection=Class.extend(proto),Selector.Collection=Collection}),define("tinymce.core.ui.DomUtils",["tinymce.core.Env","tinymce.core.util.Tools","tinymce.core.dom.DOMUtils"],function(Env,Tools,DOMUtils){"use strict";var count=0,funcs={id:function(){return"mceu_"+count++},create:function(name,attrs,children){var elm=document.createElement(name);return DOMUtils.DOM.setAttribs(elm,attrs),"string"==typeof children?elm.innerHTML=children:Tools.each(children,function(child){child.nodeType&&elm.appendChild(child)}),elm},createFragment:function(html){return DOMUtils.DOM.createFragment(html)},getWindowSize:function(){return DOMUtils.DOM.getViewPort()},getSize:function(elm){var width,height;if(elm.getBoundingClientRect){var rect=elm.getBoundingClientRect();width=Math.max(rect.width||rect.right-rect.left,elm.offsetWidth),height=Math.max(rect.height||rect.bottom-rect.bottom,elm.offsetHeight)}else width=elm.offsetWidth,height=elm.offsetHeight;return{width:width,height:height}},getPos:function(elm,root){return DOMUtils.DOM.getPos(elm,root||funcs.getContainer())},getContainer:function(){return Env.container?Env.container:document.body},getViewPort:function(win){return DOMUtils.DOM.getViewPort(win)},get:function(id){return document.getElementById(id)},addClass:function(elm,cls){return DOMUtils.DOM.addClass(elm,cls)},removeClass:function(elm,cls){return DOMUtils.DOM.removeClass(elm,cls)},hasClass:function(elm,cls){return DOMUtils.DOM.hasClass(elm,cls)},toggleClass:function(elm,cls,state){return DOMUtils.DOM.toggleClass(elm,cls,state)},css:function(elm,name,value){return DOMUtils.DOM.setStyle(elm,name,value)},getRuntimeStyle:function(elm,name){return DOMUtils.DOM.getStyle(elm,name,!0)},on:function(target,name,callback,scope){return DOMUtils.DOM.bind(target,name,callback,scope)},off:function(target,name,callback){return DOMUtils.DOM.unbind(target,name,callback)},fire:function(target,name,args){return DOMUtils.DOM.fire(target,name,args)},innerHtml:function(elm,html){DOMUtils.DOM.setHTML(elm,html)}};return funcs}),define("tinymce.core.ui.BoxUtils",[],function(){"use strict";return{parseBox:function(value){var len;if(value)return"number"==typeof value?{top:value=value||0,left:value,bottom:value,right:value}:(1===(len=(value=value.split(" ")).length)?value[1]=value[2]=value[3]=value[0]:2===len?(value[2]=value[0],value[3]=value[1]):3===len&&(value[3]=value[1]),{top:parseInt(value[0],10)||0,right:parseInt(value[1],10)||0,bottom:parseInt(value[2],10)||0,left:parseInt(value[3],10)||0})},measureBox:function(elm,prefix){function getSide(name){var val=parseFloat(function getStyle(name){var defaultView=document.defaultView;return defaultView?(name=name.replace(/[A-Z]/g,function(a){return"-"+a}),defaultView.getComputedStyle(elm,null).getPropertyValue(name)):elm.currentStyle[name]}(name),10);return isNaN(val)?0:val}return{top:getSide(prefix+"TopWidth"),right:getSide(prefix+"RightWidth"),bottom:getSide(prefix+"BottomWidth"),left:getSide(prefix+"LeftWidth")}}}}),define("tinymce.core.ui.ClassList",["tinymce.core.util.Tools"],function(Tools){"use strict";function noop(){}function ClassList(onchange){this.cls=[],this.cls._map={},this.onchange=onchange||noop,this.prefix=""}return Tools.extend(ClassList.prototype,{add:function(cls){return cls&&!this.contains(cls)&&(this.cls._map[cls]=!0,this.cls.push(cls),this._change()),this},remove:function(cls){if(this.contains(cls)){for(var i=0;i<this.cls.length&&this.cls[i]!==cls;i++);this.cls.splice(i,1),delete this.cls._map[cls],this._change()}return this},toggle:function(cls,state){var curState=this.contains(cls);return curState!==state&&(curState?this.remove(cls):this.add(cls),this._change()),this},contains:function(cls){return!!this.cls._map[cls]},_change:function(){delete this.clsValue,this.onchange.call(this)}}),ClassList.prototype.toString=function(){var value;if(this.clsValue)return this.clsValue;value="";for(var i=0;i<this.cls.length;i++)0<i&&(value+=" "),value+=this.prefix+this.cls[i];return value},ClassList}),define("tinymce.core.ui.ReflowQueue",["tinymce.core.util.Delay"],function(Delay){var animationFrameRequested,dirtyCtrls={};return{add:function(ctrl){var parent=ctrl.parent();if(parent){if(!parent._layout||parent._layout.isNative())return;dirtyCtrls[parent._id]||(dirtyCtrls[parent._id]=parent),animationFrameRequested||(animationFrameRequested=!0,Delay.requestAnimationFrame(function(){var id,ctrl;for(id in animationFrameRequested=!1,dirtyCtrls)(ctrl=dirtyCtrls[id]).state.get("rendered")&&ctrl.reflow();dirtyCtrls={}},document.body))}},remove:function(ctrl){dirtyCtrls[ctrl._id]&&delete dirtyCtrls[ctrl._id]}}}),define("tinymce.core.ui.Control",["tinymce.core.util.Class","tinymce.core.util.Tools","tinymce.core.util.EventDispatcher","tinymce.core.data.ObservableObject","tinymce.core.ui.Collection","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.ui.BoxUtils","tinymce.core.ui.ClassList","tinymce.core.ui.ReflowQueue"],function(Class,Tools,EventDispatcher,ObservableObject,Collection,DomUtils,$,BoxUtils,ClassList,ReflowQueue){"use strict";var Control,hasMouseWheelEventSupport="onmousewheel"in document,hasWheelEventSupport=!1,idCounter=0,proto={Statics:{classPrefix:"mce-"},isRtl:function(){return Control.rtl},classPrefix:"mce-",init:function(settings){var classes,defaultClasses,self=this;function applyClasses(classes){var i;for(classes=classes.split(" "),i=0;i<classes.length;i++)self.classes.add(classes[i])}self.settings=settings=Tools.extend({},self.Defaults,settings),self._id=settings.id||"mceu_"+idCounter++,self._aria={role:settings.role},self._elmCache={},self.$=$,self.state=new ObservableObject({visible:!0,active:!1,disabled:!1,value:""}),self.data=new ObservableObject(settings.data),self.classes=new ClassList(function(){self.state.get("rendered")&&(self.getEl().className=this.toString())}),self.classes.prefix=self.classPrefix,(classes=settings.classes)&&(self.Defaults&&(defaultClasses=self.Defaults.classes)&&classes!=defaultClasses&&applyClasses(defaultClasses),applyClasses(classes)),Tools.each("title text name visible disabled active value".split(" "),function(name){name in settings&&self[name](settings[name])}),self.on("click",function(){if(self.disabled())return!1}),self.settings=settings,self.borderBox=BoxUtils.parseBox(settings.border),self.paddingBox=BoxUtils.parseBox(settings.padding),self.marginBox=BoxUtils.parseBox(settings.margin),settings.hidden&&self.hide()},Properties:"parent,name",getContainerElm:function(){return DomUtils.getContainer()},getParentCtrl:function(elm){for(var ctrl,lookup=this.getRoot().controlIdLookup;elm&&lookup&&!(ctrl=lookup[elm.id]);)elm=elm.parentNode;return ctrl},initLayoutRect:function(){var borderBox,layoutRect,width,height,minWidth,minHeight,autoResize,startMinWidth,startMinHeight,initialSize,settings=this.settings,elm=this.getEl();borderBox=this.borderBox=this.borderBox||BoxUtils.measureBox(elm,"border"),this.paddingBox=this.paddingBox||BoxUtils.measureBox(elm,"padding"),this.marginBox=this.marginBox||BoxUtils.measureBox(elm,"margin"),initialSize=DomUtils.getSize(elm),startMinWidth=settings.minWidth,startMinHeight=settings.minHeight,minWidth=startMinWidth||initialSize.width,minHeight=startMinHeight||initialSize.height,width=settings.width,height=settings.height,autoResize=void 0!==(autoResize=settings.autoResize)?autoResize:!width&&!height,width=width||minWidth,height=height||minHeight;var deltaW=borderBox.left+borderBox.right,deltaH=borderBox.top+borderBox.bottom,maxW=settings.maxWidth||65535,maxH=settings.maxHeight||65535;return this._layoutRect=layoutRect={x:settings.x||0,y:settings.y||0,w:width,h:height,deltaW:deltaW,deltaH:deltaH,contentW:width-deltaW,contentH:height-deltaH,innerW:width-deltaW,innerH:height-deltaH,startMinWidth:startMinWidth||0,startMinHeight:startMinHeight||0,minW:Math.min(minWidth,maxW),minH:Math.min(minHeight,maxH),maxW:maxW,maxH:maxH,autoResize:autoResize,scrollW:0},this._lastLayoutRect={},layoutRect},layoutRect:function(newRect){var lastLayoutRect,size,deltaWidth,deltaHeight,repaintControls,curRect=this._layoutRect;return curRect=curRect||this.initLayoutRect(),newRect?(deltaWidth=curRect.deltaW,deltaHeight=curRect.deltaH,void 0!==newRect.x&&(curRect.x=newRect.x),void 0!==newRect.y&&(curRect.y=newRect.y),void 0!==newRect.minW&&(curRect.minW=newRect.minW),void 0!==newRect.minH&&(curRect.minH=newRect.minH),void 0!==(size=newRect.w)&&(size=(size=size<curRect.minW?curRect.minW:size)>curRect.maxW?curRect.maxW:size,curRect.w=size,curRect.innerW=size-deltaWidth),void 0!==(size=newRect.h)&&(size=(size=size<curRect.minH?curRect.minH:size)>curRect.maxH?curRect.maxH:size,curRect.h=size,curRect.innerH=size-deltaHeight),void 0!==(size=newRect.innerW)&&(size=(size=size<curRect.minW-deltaWidth?curRect.minW-deltaWidth:size)>curRect.maxW-deltaWidth?curRect.maxW-deltaWidth:size,curRect.innerW=size,curRect.w=size+deltaWidth),void 0!==(size=newRect.innerH)&&(size=(size=size<curRect.minH-deltaHeight?curRect.minH-deltaHeight:size)>curRect.maxH-deltaHeight?curRect.maxH-deltaHeight:size,curRect.innerH=size,curRect.h=size+deltaHeight),void 0!==newRect.contentW&&(curRect.contentW=newRect.contentW),void 0!==newRect.contentH&&(curRect.contentH=newRect.contentH),(lastLayoutRect=this._lastLayoutRect).x===curRect.x&&lastLayoutRect.y===curRect.y&&lastLayoutRect.w===curRect.w&&lastLayoutRect.h===curRect.h||((repaintControls=Control.repaintControls)&&repaintControls.map&&!repaintControls.map[this._id]&&(repaintControls.push(this),repaintControls.map[this._id]=!0),lastLayoutRect.x=curRect.x,lastLayoutRect.y=curRect.y,lastLayoutRect.w=curRect.w,lastLayoutRect.h=curRect.h),this):curRect},repaint:function(){var style,bodyStyle,bodyElm,rect,borderBox,borderW,borderH,lastRepaintRect,round,value;round=document.createRange?function(value){return value}:Math.round,style=this.getEl().style,rect=this._layoutRect,lastRepaintRect=this._lastRepaintRect||{},borderW=(borderBox=this.borderBox).left+borderBox.right,borderH=borderBox.top+borderBox.bottom,rect.x!==lastRepaintRect.x&&(style.left=round(rect.x)+"px",lastRepaintRect.x=rect.x),rect.y!==lastRepaintRect.y&&(style.top=round(rect.y)+"px",lastRepaintRect.y=rect.y),rect.w!==lastRepaintRect.w&&(value=round(rect.w-borderW),style.width=(0<=value?value:0)+"px",lastRepaintRect.w=rect.w),rect.h!==lastRepaintRect.h&&(value=round(rect.h-borderH),style.height=(0<=value?value:0)+"px",lastRepaintRect.h=rect.h),this._hasBody&&rect.innerW!==lastRepaintRect.innerW&&(value=round(rect.innerW),(bodyElm=this.getEl("body"))&&((bodyStyle=bodyElm.style).width=(0<=value?value:0)+"px"),lastRepaintRect.innerW=rect.innerW),this._hasBody&&rect.innerH!==lastRepaintRect.innerH&&(value=round(rect.innerH),(bodyElm=bodyElm||this.getEl("body"))&&((bodyStyle=bodyStyle||bodyElm.style).height=(0<=value?value:0)+"px"),lastRepaintRect.innerH=rect.innerH),this._lastRepaintRect=lastRepaintRect,this.fire("repaint",{},!1)},updateLayoutRect:function(){this.parent()._lastRect=null,DomUtils.css(this.getEl(),{width:"",height:""}),this._layoutRect=this._lastRepaintRect=this._lastLayoutRect=null,this.initLayoutRect()},on:function(name,callback){var self=this;return getEventDispatcher(self).on(name,function resolveCallbackName(name){var callback,scope;return"string"!=typeof name?name:function(e){return callback||self.parentsAndSelf().each(function(ctrl){var callbacks=ctrl.settings.callbacks;if(callbacks&&(callback=callbacks[name]))return scope=ctrl,!1}),callback?callback.call(scope,e):(e.action=name,void this.fire("execute",e))}}(callback)),self},off:function(name,callback){return getEventDispatcher(this).off(name,callback),this},fire:function(name,args,bubble){if((args=args||{}).control||(args.control=this),args=getEventDispatcher(this).fire(name,args),!1!==bubble&&this.parent)for(var parent=this.parent();parent&&!args.isPropagationStopped();)parent.fire(name,args,!1),parent=parent.parent();return args},hasEventListeners:function(name){return getEventDispatcher(this).has(name)},parents:function(selector){var ctrl,parents=new Collection;for(ctrl=this.parent();ctrl;ctrl=ctrl.parent())parents.add(ctrl);return selector&&(parents=parents.filter(selector)),parents},parentsAndSelf:function(selector){return new Collection(this).add(this.parents(selector))},next:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)+1]},prev:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)-1]},innerHtml:function(html){return this.$el.html(html),this},getEl:function(suffix){var id=suffix?this._id+"-"+suffix:this._id;return this._elmCache[id]||(this._elmCache[id]=$("#"+id)[0]),this._elmCache[id]},show:function(){return this.visible(!0)},hide:function(){return this.visible(!1)},focus:function(){try{this.getEl().focus()}catch(ex){}return this},blur:function(){return this.getEl().blur(),this},aria:function(name,value){var elm=this.getEl(this.ariaTarget);return void 0===value?this._aria[name]:(this._aria[name]=value,this.state.get("rendered")&&elm.setAttribute("role"==name?name:"aria-"+name,value),this)},encode:function(text,translate){return!1!==translate&&(text=this.translate(text)),(text||"").replace(/[&<>"]/g,function(match){return"&#"+match.charCodeAt(0)+";"})},translate:function(text){return Control.translate?Control.translate(text):text},before:function(items){var parent=this.parent();return parent&&parent.insert(items,parent.items().indexOf(this),!0),this},after:function(items){var parent=this.parent();return parent&&parent.insert(items,parent.items().indexOf(this)),this},remove:function(){var newItems,i,self=this,elm=self.getEl(),parent=self.parent();if(self.items){var controls=self.items().toArray();for(i=controls.length;i--;)controls[i].remove()}parent&&parent.items&&(newItems=[],parent.items().each(function(item){item!==self&&newItems.push(item)}),parent.items().set(newItems),parent._lastRect=null),self._eventsRoot&&self._eventsRoot==self&&$(elm).off();var lookup=self.getRoot().controlIdLookup;return lookup&&delete lookup[self._id],elm&&elm.parentNode&&elm.parentNode.removeChild(elm),self.state.set("rendered",!1),self.state.destroy(),self.fire("remove"),self},renderBefore:function(elm){return $(elm).before(this.renderHtml()),this.postRender(),this},renderTo:function(elm){return $(elm||this.getContainerElm()).append(this.renderHtml()),this.postRender(),this},preRender:function(){},render:function(){},renderHtml:function(){return'<div id="'+this._id+'" class="'+this.classes+'"></div>'},postRender:function(){var elm,box,parent,name,parentEventsRoot,self=this,settings=self.settings;for(name in self.$el=$(self.getEl()),self.state.set("rendered",!0),settings)0===name.indexOf("on")&&self.on(name.substr(2),settings[name]);if(self._eventsRoot){for(parent=self.parent();!parentEventsRoot&&parent;parent=parent.parent())parentEventsRoot=parent._eventsRoot;if(parentEventsRoot)for(name in parentEventsRoot._nativeEvents)self._nativeEvents[name]=!0}bindPendingEvents(self),settings.style&&(elm=self.getEl())&&(elm.setAttribute("style",settings.style),elm.style.cssText=settings.style),self.settings.border&&(box=self.borderBox,self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left}));var root=self.getRoot();for(var key in root.controlIdLookup||(root.controlIdLookup={}),(root.controlIdLookup[self._id]=self)._aria)self.aria(key,self._aria[key]);!1===self.state.get("visible")&&(self.getEl().style.display="none"),self.bindStates(),self.state.on("change:visible",function(e){var parentCtrl,state=e.value;self.state.get("rendered")&&(self.getEl().style.display=!1===state?"none":"",self.getEl().getBoundingClientRect()),(parentCtrl=self.parent())&&(parentCtrl._lastRect=null),self.fire(state?"show":"hide"),ReflowQueue.add(self)}),self.fire("postrender",{},!1)},bindStates:function(){},scrollIntoView:function(align){var x,y,width,height,parentWidth,parentHeight,elm=this.getEl(),parentElm=elm.parentNode,pos=function getOffset(elm,rootElm){var x,y,parent=elm;for(x=y=0;parent&&parent!=rootElm&&parent.nodeType;)x+=parent.offsetLeft||0,y+=parent.offsetTop||0,parent=parent.offsetParent;return{x:x,y:y}}(elm,parentElm);return x=pos.x,y=pos.y,width=elm.offsetWidth,height=elm.offsetHeight,parentWidth=parentElm.clientWidth,parentHeight=parentElm.clientHeight,"end"==align?(x-=parentWidth-width,y-=parentHeight-height):"center"==align&&(x-=parentWidth/2-width/2,y-=parentHeight/2-height/2),parentElm.scrollLeft=x,parentElm.scrollTop=y,this},getRoot:function(){for(var rootControl,ctrl=this,parents=[];ctrl;){if(ctrl.rootControl){rootControl=ctrl.rootControl;break}parents.push(ctrl),ctrl=(rootControl=ctrl).parent()}rootControl=rootControl||this;for(var i=parents.length;i--;)parents[i].rootControl=rootControl;return rootControl},reflow:function(){ReflowQueue.remove(this);var parent=this.parent();return parent&&parent._layout&&!parent._layout.isNative()&&parent.reflow(),this}};function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){state&&EventDispatcher.isNative(name)&&(obj._nativeEvents||(obj._nativeEvents={}),obj._nativeEvents[name]=!0,obj.state.get("rendered")&&bindPendingEvents(obj))}})),obj._eventDispatcher}function bindPendingEvents(eventCtrl){var i,l,parents,eventRootCtrl,nativeEvents,name;function delegate(e){var control=eventCtrl.getParentCtrl(e.target);control&&control.fire(e.type,e)}function mouseLeaveHandler(){var ctrl=eventRootCtrl._lastHoverCtrl;ctrl&&(ctrl.fire("mouseleave",{target:ctrl.getEl()}),ctrl.parents().each(function(ctrl){ctrl.fire("mouseleave",{target:ctrl.getEl()})}),eventRootCtrl._lastHoverCtrl=null)}function mouseEnterHandler(e){var i,parents,lastParents,ctrl=eventCtrl.getParentCtrl(e.target),lastCtrl=eventRootCtrl._lastHoverCtrl,idx=0;if(ctrl!==lastCtrl){if((parents=(eventRootCtrl._lastHoverCtrl=ctrl).parents().toArray().reverse()).push(ctrl),lastCtrl){for((lastParents=lastCtrl.parents().toArray().reverse()).push(lastCtrl),idx=0;idx<lastParents.length&&parents[idx]===lastParents[idx];idx++);for(i=lastParents.length-1;idx<=i;i--)(lastCtrl=lastParents[i]).fire("mouseleave",{target:lastCtrl.getEl()})}for(i=idx;i<parents.length;i++)(ctrl=parents[i]).fire("mouseenter",{target:ctrl.getEl()})}}function fixWheelEvent(e){e.preventDefault(),"mousewheel"==e.type?(e.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(e.deltaX=-.025*e.wheelDeltaX)):(e.deltaX=0,e.deltaY=e.detail),e=eventCtrl.fire("wheel",e)}if(nativeEvents=eventCtrl._nativeEvents){for((parents=eventCtrl.parents().toArray()).unshift(eventCtrl),i=0,l=parents.length;!eventRootCtrl&&i<l;i++)eventRootCtrl=parents[i]._eventsRoot;for(eventRootCtrl=eventRootCtrl||(parents[parents.length-1]||eventCtrl),eventCtrl._eventsRoot=eventRootCtrl,l=i,i=0;i<l;i++)parents[i]._eventsRoot=eventRootCtrl;var eventRootDelegates=eventRootCtrl._delegates;for(name in eventRootDelegates=eventRootDelegates||(eventRootCtrl._delegates={}),nativeEvents){if(!nativeEvents)return!1;"wheel"!==name||hasWheelEventSupport?("mouseenter"===name||"mouseleave"===name?eventRootCtrl._hasMouseEnter||($(eventRootCtrl.getEl()).on("mouseleave",mouseLeaveHandler).on("mouseover",mouseEnterHandler),eventRootCtrl._hasMouseEnter=1):eventRootDelegates[name]||($(eventRootCtrl.getEl()).on(name,delegate),eventRootDelegates[name]=!0),nativeEvents[name]=!1):hasMouseWheelEventSupport?$(eventCtrl.getEl()).on("mousewheel",fixWheelEvent):$(eventCtrl.getEl()).on("DOMMouseScroll",fixWheelEvent)}}}return Tools.each("text title visible disabled active value".split(" "),function(name){proto[name]=function(value){return 0===arguments.length?this.state.get(name):(void 0!==value&&this.state.set(name,value),this)}}),Control=Class.extend(proto)}),define("tinymce.core.ui.Factory",[],function(){"use strict";var types={};return{add:function(type,typeClass){types[type.toLowerCase()]=typeClass},has:function(type){return!!types[type.toLowerCase()]},create:function(type,settings){var ControlType;if("string"==typeof type?(settings=settings||{}).type=type:type=(settings=type).type,type=type.toLowerCase(),!(ControlType=types[type]))throw new Error("Could not find control by type: "+type);return(ControlType=new ControlType(settings)).type=type,ControlType}}}),define("tinymce.core.ui.KeyboardNavigation",[],function(){"use strict";var hasTabstopData=function(elm){return!!elm.getAttribute("data-mce-tabstop")};return function(settings){var focusedElement,focusedControl,root=settings.root;function isElement(node){return node&&1===node.nodeType}try{focusedElement=document.activeElement}catch(ex){focusedElement=document.body}function getRole(elm){return isElement(elm=elm||focusedElement)?elm.getAttribute("role"):null}function getParentRole(elm){for(var role,parent=elm||focusedElement;parent=parent.parentNode;)if(role=getRole(parent))return role}function getAriaProp(name){var elm=focusedElement;if(isElement(elm))return elm.getAttribute("aria-"+name)}function isTextInputElement(elm){var tagName=elm.tagName.toUpperCase();return"INPUT"==tagName||"TEXTAREA"==tagName||"SELECT"==tagName}function getFocusElements(elm){var elements=[];return function collect(elm){if(1==elm.nodeType&&"none"!=elm.style.display&&!elm.disabled){!function canFocus(elm){return!(!isTextInputElement(elm)||elm.hidden)||!!hasTabstopData(elm)||!!/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))}(elm)||elements.push(elm);for(var i=0;i<elm.childNodes.length;i++)collect(elm.childNodes[i])}}(elm||root.getEl()),elements}function getNavigationRoot(targetControl){var navigationRoot,controls;(controls=(targetControl=targetControl||focusedControl).parents().toArray()).unshift(targetControl);for(var i=0;i<controls.length&&!(navigationRoot=controls[i]).settings.ariaRoot;i++);return navigationRoot}function moveFocusToIndex(idx,elements){return idx<0?idx=elements.length-1:idx>=elements.length&&(idx=0),elements[idx]&&elements[idx].focus(),idx}function moveFocus(dir,elements){var idx=-1,navigationRoot=getNavigationRoot();elements=elements||getFocusElements(navigationRoot.getEl());for(var i=0;i<elements.length;i++)elements[i]===focusedElement&&(idx=i);idx+=dir,navigationRoot.lastAriaIndex=moveFocusToIndex(idx,elements)}function left(){"tablist"==getParentRole()?moveFocus(-1,getFocusElements(focusedElement.parentNode)):focusedControl.parent().submenu?cancel():moveFocus(-1)}function right(){var role=getRole(),parentRole=getParentRole();"tablist"==parentRole?moveFocus(1,getFocusElements(focusedElement.parentNode)):"menuitem"==role&&"menu"==parentRole&&getAriaProp("haspopup")?enter():moveFocus(1)}function up(){moveFocus(-1)}function down(){var role=getRole(),parentRole=getParentRole();"menuitem"==role&&"menubar"==parentRole?enter():"button"==role&&getAriaProp("haspopup")?enter({key:"down"}):moveFocus(1)}function cancel(){focusedControl.fire("cancel")}function enter(aria){aria=aria||{},focusedControl.fire("click",{target:focusedElement,aria:aria})}return focusedControl=root.getParentCtrl(focusedElement),root.on("keydown",function(e){function handleNonTabOrEscEvent(e,handler){isTextInputElement(focusedElement)||hasTabstopData(focusedElement)||"slider"!==getRole(focusedElement)&&!1!==handler(e)&&e.preventDefault()}if(!e.isDefaultPrevented())switch(e.keyCode){case 37:handleNonTabOrEscEvent(e,left);break;case 39:handleNonTabOrEscEvent(e,right);break;case 38:handleNonTabOrEscEvent(e,up);break;case 40:handleNonTabOrEscEvent(e,down);break;case 27:cancel();break;case 14:case 13:case 32:handleNonTabOrEscEvent(e,enter);break;case 9:!1!==function tab(e){if("tablist"==getParentRole()){var elm=getFocusElements(focusedControl.getEl("body"))[0];elm&&elm.focus()}else moveFocus(e.shiftKey?-1:1)}(e)&&e.preventDefault()}}),root.on("focusin",function(e){focusedElement=e.target,focusedControl=e.control}),{focusFirst:function focusFirst(targetControl){var navigationRoot=getNavigationRoot(targetControl),focusElements=getFocusElements(navigationRoot.getEl());navigationRoot.settings.ariaRemember&&"lastAriaIndex"in navigationRoot?moveFocusToIndex(navigationRoot.lastAriaIndex,focusElements):moveFocusToIndex(0,focusElements)}}}}),define("tinymce.core.ui.Container",["tinymce.core.ui.Control","tinymce.core.ui.Collection","tinymce.core.ui.Selector","tinymce.core.ui.Factory","tinymce.core.ui.KeyboardNavigation","tinymce.core.util.Tools","tinymce.core.dom.DomQuery","tinymce.core.ui.ClassList","tinymce.core.ui.ReflowQueue"],function(Control,Collection,Selector,Factory,KeyboardNavigation,Tools,$,ClassList,ReflowQueue){"use strict";var selectorCache={};return Control.extend({init:function(settings){var self=this;self._super(settings),(settings=self.settings).fixed&&self.state.set("fixed",!0),self._items=new Collection,self.isRtl()&&self.classes.add("rtl"),self.bodyClasses=new ClassList(function(){self.state.get("rendered")&&(self.getEl("body").className=this.toString())}),self.bodyClasses.prefix=self.classPrefix,self.classes.add("container"),self.bodyClasses.add("container-body"),settings.containerCls&&self.classes.add(settings.containerCls),self._layout=Factory.create((settings.layout||"")+"layout"),self.settings.items?self.add(self.settings.items):self.add(self.render()),self._hasBody=!0},items:function(){return this._items},find:function(selector){return(selector=selectorCache[selector]=selectorCache[selector]||new Selector(selector)).find(this)},add:function(items){return this.items().add(this.create(items)).parent(this),this},focus:function(keyboard){var focusCtrl,keyboardNav,items;if(!keyboard||!(keyboardNav=this.keyboardNav||this.parents().eq(-1)[0].keyboardNav))return items=this.find("*"),this.statusbar&&items.add(this.statusbar.items()),items.each(function(ctrl){if(ctrl.settings.autofocus)return focusCtrl=null,!1;ctrl.canFocus&&(focusCtrl=focusCtrl||ctrl)}),focusCtrl&&focusCtrl.focus(),this;keyboardNav.focusFirst(this)},replace:function(oldItem,newItem){for(var ctrlElm,items=this.items(),i=items.length;i--;)if(items[i]===oldItem){items[i]=newItem;break}0<=i&&((ctrlElm=newItem.getEl())&&ctrlElm.parentNode.removeChild(ctrlElm),(ctrlElm=oldItem.getEl())&&ctrlElm.parentNode.removeChild(ctrlElm)),newItem.parent(this)},create:function(items){var settings,self=this,ctrlItems=[];return Tools.isArray(items)||(items=[items]),Tools.each(items,function(item){item&&(item instanceof Control||("string"==typeof item&&(item={type:item}),settings=Tools.extend({},self.settings.defaults,item),item.type=settings.type=settings.type||item.type||self.settings.defaultType||(settings.defaults?settings.defaults.type:null),item=Factory.create(settings)),ctrlItems.push(item))}),ctrlItems},renderNew:function(){var self=this;return self.items().each(function(ctrl,index){var containerElm;ctrl.parent(self),ctrl.state.get("rendered")||((containerElm=self.getEl("body")).hasChildNodes()&&index<=containerElm.childNodes.length-1?$(containerElm.childNodes[index]).before(ctrl.renderHtml()):$(containerElm).append(ctrl.renderHtml()),ctrl.postRender(),ReflowQueue.add(ctrl))}),self._layout.applyClasses(self.items().filter(":visible")),self._lastRect=null,self},append:function(items){return this.add(items).renderNew()},prepend:function(items){return this.items().set(this.create(items).concat(this.items().toArray())),this.renderNew()},insert:function(items,index,before){var curItems,beforeItems,afterItems;return items=this.create(items),curItems=this.items(),!before&&index<curItems.length-1&&(index+=1),0<=index&&index<curItems.length&&(beforeItems=curItems.slice(0,index).toArray(),afterItems=curItems.slice(index).toArray(),curItems.set(beforeItems.concat(items,afterItems))),this.renderNew()},fromJSON:function(data){for(var name in data)this.find("#"+name).value(data[name]);return this},toJSON:function(){var data={};return this.find("*").each(function(ctrl){var name=ctrl.name(),value=ctrl.value();name&&void 0!==value&&(data[name]=value)}),data},renderHtml:function(){var layout=this._layout,role=this.settings.role;return this.preRender(),layout.preRender(this),'<div id="'+this._id+'" class="'+this.classes+'"'+(role?' role="'+this.settings.role+'"':"")+'><div id="'+this._id+'-body" class="'+this.bodyClasses+'">'+(this.settings.html||"")+layout.renderHtml(this)+"</div></div>"},postRender:function(){var box;return this.items().exec("postRender"),this._super(),this._layout.postRender(this),this.state.set("rendered",!0),this.settings.style&&this.$el.css(this.settings.style),this.settings.border&&(box=this.borderBox,this.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left})),this.parent()||(this.keyboardNav=new KeyboardNavigation({root:this})),this},initLayoutRect:function(){var layoutRect=this._super();return this._layout.recalc(this),layoutRect},recalc:function(){var rect=this._layoutRect,lastRect=this._lastRect;if(!lastRect||lastRect.w!=rect.w||lastRect.h!=rect.h)return this._layout.recalc(this),rect=this.layoutRect(),this._lastRect={x:rect.x,y:rect.y,w:rect.w,h:rect.h},!0},reflow:function(){var i;if(ReflowQueue.remove(this),this.visible()){for(Control.repaintControls=[],Control.repaintControls.map={},this.recalc(),i=Control.repaintControls.length;i--;)Control.repaintControls[i].repaint();"flow"!==this.settings.layout&&"stack"!==this.settings.layout&&this.repaint(),Control.repaintControls=[]}return this}})}),define("tinymce.core.ui.DragHelper",["tinymce.core.dom.DomQuery"],function($){"use strict";function updateWithTouchData(e){var keys,i;if(e.changedTouches)for(keys="screenX screenY pageX pageY clientX clientY".split(" "),i=0;i<keys.length;i++)e[keys[i]]=e.changedTouches[0][keys[i]]}return function(id,settings){var $eventOverlay,downButton,start,stop,drag,startX,startY,doc=settings.document||document;function getHandleElm(){return doc.getElementById(settings.handle||id)}settings=settings||{},start=function(e){var handleElm,cursor,docSize=function getDocumentSize(doc){var documentElement,body,scrollWidth,clientWidth,offsetWidth,scrollHeight,clientHeight,max=Math.max;return documentElement=doc.documentElement,body=doc.body,scrollWidth=max(documentElement.scrollWidth,body.scrollWidth),clientWidth=max(documentElement.clientWidth,body.clientWidth),offsetWidth=max(documentElement.offsetWidth,body.offsetWidth),scrollHeight=max(documentElement.scrollHeight,body.scrollHeight),clientHeight=max(documentElement.clientHeight,body.clientHeight),{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<max(documentElement.offsetHeight,body.offsetHeight)?clientHeight:scrollHeight}}(doc);updateWithTouchData(e),e.preventDefault(),downButton=e.button,handleElm=getHandleElm(),startX=e.screenX,startY=e.screenY,cursor=window.getComputedStyle?window.getComputedStyle(handleElm,null).getPropertyValue("cursor"):handleElm.runtimeStyle.cursor,$eventOverlay=$("<div></div>").css({position:"absolute",top:0,left:0,width:docSize.width,height:docSize.height,zIndex:2147483647,opacity:1e-4,cursor:cursor}).appendTo(doc.body),$(doc).on("mousemove touchmove",drag).on("mouseup touchend",stop),settings.start(e)},drag=function(e){if(updateWithTouchData(e),e.button!==downButton)return stop(e);e.deltaX=e.screenX-startX,e.deltaY=e.screenY-startY,e.preventDefault(),settings.drag(e)},stop=function(e){updateWithTouchData(e),$(doc).off("mousemove touchmove",drag).off("mouseup touchend",stop),$eventOverlay.remove(),settings.stop&&settings.stop(e)},this.destroy=function(){$(getHandleElm()).off()},$(getHandleElm()).on("mousedown touchstart",start)}}),define("tinymce.core.ui.Scrollable",["tinymce.core.dom.DomQuery","tinymce.core.ui.DragHelper"],function($,DragHelper){"use strict";return{init:function(){this.on("repaint",this.renderScroll)},renderScroll:function(){var self=this,margin=2;function repaintScroll(){var hasScrollH,hasScrollV,bodyElm;function repaintAxis(axisName,posName,sizeName,contentSizeName,hasScroll,ax){var containerElm,scrollBarElm,scrollThumbElm,containerSize,ratio,rect,posNameLower,sizeNameLower;if(scrollBarElm=self.getEl("scroll"+axisName)){if(posNameLower=posName.toLowerCase(),sizeNameLower=sizeName.toLowerCase(),$(self.getEl("absend")).css(posNameLower,self.layoutRect()[contentSizeName]-1),!hasScroll)return void $(scrollBarElm).css("display","none");$(scrollBarElm).css("display","block"),containerElm=self.getEl("body"),scrollThumbElm=self.getEl("scroll"+axisName+"t"),containerSize=containerElm["client"+sizeName]-2*margin,ratio=(containerSize-=hasScrollH&&hasScrollV?scrollBarElm["client"+ax]:0)/containerElm["scroll"+sizeName],(rect={})[posNameLower]=containerElm["offset"+posName]+margin,rect[sizeNameLower]=containerSize,$(scrollBarElm).css(rect),(rect={})[posNameLower]=containerElm["scroll"+posName]*ratio,rect[sizeNameLower]=containerSize*ratio,$(scrollThumbElm).css(rect)}}bodyElm=self.getEl("body"),hasScrollH=bodyElm.scrollWidth>bodyElm.clientWidth,hasScrollV=bodyElm.scrollHeight>bodyElm.clientHeight,repaintAxis("h","Left","Width","contentW",hasScrollH,"Height"),repaintAxis("v","Top","Height","contentH",hasScrollV,"Width")}self.settings.autoScroll&&(self._hasScroll||(self._hasScroll=!0,function addScroll(){function addScrollAxis(axisName,posName,sizeName,deltaPosName,ax){var scrollStart,axisId=self._id+"-scroll"+axisName,prefix=self.classPrefix;$(self.getEl()).append('<div id="'+axisId+'" class="'+prefix+"scrollbar "+prefix+"scrollbar-"+axisName+'"><div id="'+axisId+'t" class="'+prefix+'scrollbar-thumb"></div></div>'),self.draghelper=new DragHelper(axisId+"t",{start:function(){scrollStart=self.getEl("body")["scroll"+posName],$("#"+axisId).addClass(prefix+"active")},drag:function(e){var ratio,hasScrollH,hasScrollV,containerSize,layoutRect=self.layoutRect();hasScrollH=layoutRect.contentW>layoutRect.innerW,hasScrollV=layoutRect.contentH>layoutRect.innerH,containerSize=self.getEl("body")["client"+sizeName]-2*margin,ratio=(containerSize-=hasScrollH&&hasScrollV?self.getEl("scroll"+axisName)["client"+ax]:0)/self.getEl("body")["scroll"+sizeName],self.getEl("body")["scroll"+posName]=scrollStart+e["delta"+deltaPosName]/ratio},stop:function(){$("#"+axisId).removeClass(prefix+"active")}})}self.classes.add("scroll"),addScrollAxis("v","Top","Height","Y","Width"),addScrollAxis("h","Left","Width","X","Height")}(),self.on("wheel",function(e){var bodyEl=self.getEl("body");bodyEl.scrollLeft+=10*(e.deltaX||0),bodyEl.scrollTop+=10*e.deltaY,repaintScroll()}),$(self.getEl("body")).on("scroll",repaintScroll)),repaintScroll())}}}),define("tinymce.core.ui.Panel",["tinymce.core.ui.Container","tinymce.core.ui.Scrollable"],function(Container,Scrollable){"use strict";return Container.extend({Defaults:{layout:"fit",containerCls:"panel"},Mixins:[Scrollable],renderHtml:function(){var layout=this._layout,innerHtml=this.settings.html;return this.preRender(),layout.preRender(this),void 0===innerHtml?innerHtml='<div id="'+this._id+'-body" class="'+this.bodyClasses+'">'+layout.renderHtml(this)+"</div>":("function"==typeof innerHtml&&(innerHtml=innerHtml.call(this)),this._hasBody=!1),'<div id="'+this._id+'" class="'+this.classes+'" hidefocus="1" tabindex="-1" role="group">'+(this._preBodyHtml||"")+innerHtml+"</div>"}})}),define("tinymce.core.ui.Movable",["tinymce.core.ui.DomUtils"],function(DomUtils){"use strict";function calculateRelativePosition(ctrl,targetElm,rel){var ctrlElm,pos,x,y,selfW,selfH,targetW,targetH,viewport,size;return viewport=DomUtils.getViewPort(),x=(pos=DomUtils.getPos(targetElm)).x,y=pos.y,ctrl.state.get("fixed")&&"static"==DomUtils.getRuntimeStyle(document.body,"position")&&(x-=viewport.x,y-=viewport.y),ctrlElm=ctrl.getEl(),selfW=(size=DomUtils.getSize(ctrlElm)).width,selfH=size.height,targetW=(size=DomUtils.getSize(targetElm)).width,targetH=size.height,"b"===(rel=(rel||"").split(""))[0]&&(y+=targetH),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=Math.round(targetH/2)),"c"===rel[1]&&(x+=Math.round(targetW/2)),"b"===rel[3]&&(y-=selfH),"r"===rel[4]&&(x-=selfW),"c"===rel[3]&&(y-=Math.round(selfH/2)),"c"===rel[4]&&(x-=Math.round(selfW/2)),{x:x,y:y,w:selfW,h:selfH}}return{testMoveRel:function(elm,rels){for(var viewPortRect=DomUtils.getViewPort(),i=0;i<rels.length;i++){var pos=calculateRelativePosition(this,elm,rels[i]);if(this.state.get("fixed")){if(0<pos.x&&pos.x+pos.w<viewPortRect.w&&0<pos.y&&pos.y+pos.h<viewPortRect.h)return rels[i]}else if(pos.x>viewPortRect.x&&pos.x+pos.w<viewPortRect.w+viewPortRect.x&&pos.y>viewPortRect.y&&pos.y+pos.h<viewPortRect.h+viewPortRect.y)return rels[i]}return rels[0]},moveRel:function(elm,rel){"string"!=typeof rel&&(rel=this.testMoveRel(elm,rel));var pos=calculateRelativePosition(this,elm,rel);return this.moveTo(pos.x,pos.y)},moveBy:function(dx,dy){var rect=this.layoutRect();return this.moveTo(rect.x+dx,rect.y+dy),this},moveTo:function(x,y){function constrain(value,max,size){return value<0?0:max<value+size&&(value=max-size)<0?0:value}if(this.settings.constrainToViewport){var viewPortRect=DomUtils.getViewPort(window),layoutRect=this.layoutRect();x=constrain(x,viewPortRect.w+viewPortRect.x,layoutRect.w),y=constrain(y,viewPortRect.h+viewPortRect.y,layoutRect.h)}return this.state.get("rendered")?this.layoutRect({x:x,y:y}).repaint():(this.settings.x=x,this.settings.y=y),this.fire("move",{x:x,y:y}),this}}}),define("tinymce.core.ui.Resizable",["tinymce.core.ui.DomUtils"],function(DomUtils){"use strict";return{resizeToContent:function(){this._layoutRect.autoResize=!0,this._lastRect=null,this.reflow()},resizeTo:function(w,h){if(w<=1||h<=1){var rect=DomUtils.getWindowSize();w=w<=1?w*rect.w:w,h=h<=1?h*rect.h:h}return this._layoutRect.autoResize=!1,this.layoutRect({minW:w,minH:h,w:w,h:h}).reflow()},resizeBy:function(dw,dh){var rect=this.layoutRect();return this.resizeTo(rect.w+dw,rect.h+dh)}}}),define("tinymce.core.ui.FloatPanel",["tinymce.core.ui.Panel","tinymce.core.ui.Movable","tinymce.core.ui.Resizable","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.util.Delay"],function(Panel,Movable,Resizable,DomUtils,$,Delay){"use strict";var documentClickHandler,documentScrollHandler,windowResizeHandler,hasModal,visiblePanels=[],zOrder=[];function isChildOf(ctrl,parent){for(;ctrl;){if(ctrl==parent)return!0;ctrl=ctrl.parent()}}function bindDocumentClickHandler(){documentClickHandler||(documentClickHandler=function(e){2!=e.button&&!function skipOrHidePanels(e){for(var i=visiblePanels.length;i--;){var panel=visiblePanels[i],clickCtrl=panel.getParentCtrl(e.target);if(panel.settings.autohide){if(clickCtrl&&(isChildOf(clickCtrl,panel)||panel.parent()===clickCtrl))continue;(e=panel.fire("autohide",{target:e.target})).isDefaultPrevented()||panel.hide()}}}(e)},$(document).on("click touchstart",documentClickHandler))}function repositionPanel(panel){var scrollY=DomUtils.getViewPort().y;function toggleFixedChildPanels(fixed,deltaY){for(var parent,i=0;i<visiblePanels.length;i++)if(visiblePanels[i]!=panel)for(parent=visiblePanels[i].parent();parent=parent&&parent.parent();)parent==panel&&visiblePanels[i].fixed(fixed).moveBy(0,deltaY).repaint()}panel.settings.autofix&&(panel.state.get("fixed")?panel._autoFixY>scrollY&&(panel.fixed(!1).layoutRect({y:panel._autoFixY}).repaint(),toggleFixedChildPanels(!1,panel._autoFixY-scrollY)):(panel._autoFixY=panel.layoutRect().y,panel._autoFixY<scrollY&&(panel.fixed(!0).layoutRect({y:0}).repaint(),toggleFixedChildPanels(!0,scrollY-panel._autoFixY))))}function addRemove(add,ctrl){var i,topModal,zIndex=FloatPanel.zIndex||65535;if(add)zOrder.push(ctrl);else for(i=zOrder.length;i--;)zOrder[i]===ctrl&&zOrder.splice(i,1);if(zOrder.length)for(i=0;i<zOrder.length;i++)zOrder[i].modal&&(zIndex++,topModal=zOrder[i]),zOrder[i].getEl().style.zIndex=zIndex,zOrder[i].zIndex=zIndex,zIndex++;var modalBlockEl=$("#"+ctrl.classPrefix+"modal-block",ctrl.getContainerElm())[0];topModal?$(modalBlockEl).css("z-index",topModal.zIndex-1):modalBlockEl&&(modalBlockEl.parentNode.removeChild(modalBlockEl),hasModal=!1),FloatPanel.currentZIndex=zIndex}var FloatPanel=Panel.extend({Mixins:[Movable,Resizable],init:function(settings){var self=this;self._super(settings),(self._eventsRoot=self).classes.add("floatpanel"),settings.autohide&&(bindDocumentClickHandler(),function bindWindowResizeHandler(){if(!windowResizeHandler){var docElm=document.documentElement,clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight;windowResizeHandler=function(){document.all&&clientWidth==docElm.clientWidth&&clientHeight==docElm.clientHeight||(clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight,FloatPanel.hideAll())},$(window).on("resize",windowResizeHandler)}}(),visiblePanels.push(self)),settings.autofix&&(function bindDocumentScrollHandler(){documentScrollHandler||(documentScrollHandler=function(){var i;for(i=visiblePanels.length;i--;)repositionPanel(visiblePanels[i])},$(window).on("scroll",documentScrollHandler))}(),self.on("move",function(){repositionPanel(this)})),self.on("postrender show",function(e){if(e.control==self){var $modalBlockEl,prefix=self.classPrefix;self.modal&&!hasModal&&(($modalBlockEl=$("#"+prefix+"modal-block",self.getContainerElm()))[0]||($modalBlockEl=$('<div id="'+prefix+'modal-block" class="'+prefix+"reset "+prefix+'fade"></div>').appendTo(self.getContainerElm())),Delay.setTimeout(function(){$modalBlockEl.addClass(prefix+"in"),$(self.getEl()).addClass(prefix+"in")}),hasModal=!0),addRemove(!0,self)}}),self.on("show",function(){self.parents().each(function(ctrl){if(ctrl.state.get("fixed"))return self.fixed(!0),!1})}),settings.popover&&(self._preBodyHtml='<div class="'+self.classPrefix+'arrow"></div>',self.classes.add("popover").add("bottom").add(self.isRtl()?"end":"start")),self.aria("label",settings.ariaLabel),self.aria("labelledby",self._id),self.aria("describedby",self.describedBy||self._id+"-none")},fixed:function(state){if(this.state.get("fixed")!=state){if(this.state.get("rendered")){var viewport=DomUtils.getViewPort();state?this.layoutRect().y-=viewport.y:this.layoutRect().y+=viewport.y}this.classes.toggle("fixed",state),this.state.set("fixed",state)}return this},show:function(){var i,state=this._super();for(i=visiblePanels.length;i--&&visiblePanels[i]!==this;);return-1===i&&visiblePanels.push(this),state},hide:function(){return removeVisiblePanel(this),addRemove(!1,this),this._super()},hideAll:function(){FloatPanel.hideAll()},close:function(){return this.fire("close").isDefaultPrevented()||(this.remove(),addRemove(!1,this)),this},remove:function(){removeVisiblePanel(this),this._super()},postRender:function(){return this.settings.bodyRole&&this.getEl("body").setAttribute("role",this.settings.bodyRole),this._super()}});function removeVisiblePanel(panel){var i;for(i=visiblePanels.length;i--;)visiblePanels[i]===panel&&visiblePanels.splice(i,1);for(i=zOrder.length;i--;)zOrder[i]===panel&&zOrder.splice(i,1)}return FloatPanel.hideAll=function(){for(var i=visiblePanels.length;i--;){var panel=visiblePanels[i];panel&&panel.settings.autohide&&(panel.hide(),visiblePanels.splice(i,1))}},FloatPanel}),define("tinymce.core.ui.Window",["tinymce.core.ui.FloatPanel","tinymce.core.ui.Panel","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.ui.DragHelper","tinymce.core.ui.BoxUtils","tinymce.core.Env","tinymce.core.util.Delay"],function(FloatPanel,Panel,DomUtils,$,DragHelper,BoxUtils,Env,Delay){"use strict";var windows=[],oldMetaValue="";function toggleFullScreenState(state){var contentValue,viewport=$("meta[name=viewport]")[0];!1!==Env.overrideViewPort&&(viewport||((viewport=document.createElement("meta")).setAttribute("name","viewport"),document.getElementsByTagName("head")[0].appendChild(viewport)),(contentValue=viewport.getAttribute("content"))&&void 0!==oldMetaValue&&(oldMetaValue=contentValue),viewport.setAttribute("content",state?"width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0":oldMetaValue))}function toggleBodyFullScreenClasses(classPrefix,state){!function checkFullscreenWindows(){for(var i=0;i<windows.length;i++)if(windows[i]._fullscreen)return!0;return!1}()||!1!==state||$([document.documentElement,document.body]).removeClass(classPrefix+"fullscreen")}var Window=FloatPanel.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},init:function(settings){var self=this;self._super(settings),self.isRtl()&&self.classes.add("rtl"),self.classes.add("window"),self.bodyClasses.add("window-body"),self.state.set("fixed",!0),settings.buttons&&(self.statusbar=new Panel({layout:"flex",border:"1 0 0 0",spacing:3,padding:10,align:"center",pack:self.isRtl()?"start":"end",defaults:{type:"button"},items:settings.buttons}),self.statusbar.classes.add("foot"),self.statusbar.parent(self)),self.on("click",function(e){var closeClass=self.classPrefix+"close";(DomUtils.hasClass(e.target,closeClass)||DomUtils.hasClass(e.target.parentNode,closeClass))&&self.close()}),self.on("cancel",function(){self.close()}),self.aria("describedby",self.describedBy||self._id+"-none"),self.aria("label",settings.title),self._fullscreen=!1},recalc:function(){var layoutRect,width,x,needsRecalc,statusbar=this.statusbar;this._fullscreen&&(this.layoutRect(DomUtils.getWindowSize()),this.layoutRect().contentH=this.layoutRect().innerH),this._super(),layoutRect=this.layoutRect(),this.settings.title&&!this._fullscreen&&(width=layoutRect.headerW)>layoutRect.w&&(x=layoutRect.x-Math.max(0,width/2),this.layoutRect({w:width,x:x}),needsRecalc=!0),statusbar&&(statusbar.layoutRect({w:this.layoutRect().innerW}).recalc(),(width=statusbar.layoutRect().minW+layoutRect.deltaW)>layoutRect.w&&(x=layoutRect.x-Math.max(0,width-layoutRect.w),this.layoutRect({w:width,x:x}),needsRecalc=!0)),needsRecalc&&this.recalc()},initLayoutRect:function(){var headEl,layoutRect=this._super(),deltaH=0;if(this.settings.title&&!this._fullscreen){headEl=this.getEl("head");var size=DomUtils.getSize(headEl);layoutRect.headerW=size.width,layoutRect.headerH=size.height,deltaH+=layoutRect.headerH}this.statusbar&&(deltaH+=this.statusbar.layoutRect().h),layoutRect.deltaH+=deltaH,layoutRect.minH+=deltaH,layoutRect.h+=deltaH;var rect=DomUtils.getWindowSize();return layoutRect.x=this.settings.x||Math.max(0,rect.w/2-layoutRect.w/2),layoutRect.y=this.settings.y||Math.max(0,rect.h/2-layoutRect.h/2),layoutRect},renderHtml:function(){var layout=this._layout,id=this._id,prefix=this.classPrefix,settings=this.settings,headerHtml="",footerHtml="",html=settings.html;return this.preRender(),layout.preRender(this),settings.title&&(headerHtml='<div id="'+id+'-head" class="'+prefix+'window-head"><div id="'+id+'-title" class="'+prefix+'title">'+this.encode(settings.title)+'</div><div id="'+id+'-dragh" class="'+prefix+'dragh"></div><button type="button" class="'+prefix+'close" aria-hidden="true"><i class="mce-ico mce-i-remove"></i></button></div>'),settings.url&&(html='<iframe src="'+settings.url+'" tabindex="-1"></iframe>'),void 0===html&&(html=layout.renderHtml(this)),this.statusbar&&(footerHtml=this.statusbar.renderHtml()),'<div id="'+id+'" class="'+this.classes+'" hidefocus="1"><div class="'+this.classPrefix+'reset" role="application">'+headerHtml+'<div id="'+id+'-body" class="'+this.bodyClasses+'">'+html+"</div>"+footerHtml+"</div></div>"},fullscreen:function(state){var slowRendering,layoutRect,self=this,documentElement=document.documentElement,prefix=self.classPrefix;if(state!=self._fullscreen)if($(window).on("resize",function(){var time;if(self._fullscreen)if(slowRendering)self._timer||(self._timer=Delay.setTimeout(function(){var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h),self._timer=0},50));else{time=(new Date).getTime();var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h),50<(new Date).getTime()-time&&(slowRendering=!0)}}),layoutRect=self.layoutRect(),self._fullscreen=state){self._initial={x:layoutRect.x,y:layoutRect.y,w:layoutRect.w,h:layoutRect.h},self.borderBox=BoxUtils.parseBox("0"),self.getEl("head").style.display="none",layoutRect.deltaH-=layoutRect.headerH+2,$([documentElement,document.body]).addClass(prefix+"fullscreen"),self.classes.add("fullscreen");var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h)}else self.borderBox=BoxUtils.parseBox(self.settings.border),self.getEl("head").style.display="",layoutRect.deltaH+=layoutRect.headerH,$([documentElement,document.body]).removeClass(prefix+"fullscreen"),self.classes.remove("fullscreen"),self.moveTo(self._initial.x,self._initial.y).resizeTo(self._initial.w,self._initial.h);return self.reflow()},postRender:function(){var startPos,self=this;setTimeout(function(){self.classes.add("in"),self.fire("open")},0),self._super(),self.statusbar&&self.statusbar.postRender(),self.focus(),this.dragHelper=new DragHelper(self._id+"-dragh",{start:function(){startPos={x:self.layoutRect().x,y:self.layoutRect().y}},drag:function(e){self.moveTo(startPos.x+e.deltaX,startPos.y+e.deltaY)}}),self.on("submit",function(e){e.isDefaultPrevented()||self.close()}),windows.push(self),toggleFullScreenState(!0)},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){var i;for(this.dragHelper.destroy(),this._super(),this.statusbar&&this.statusbar.remove(),toggleBodyFullScreenClasses(this.classPrefix,!1),i=windows.length;i--;)windows[i]===this&&windows.splice(i,1);toggleFullScreenState(0<windows.length)},getContentWindow:function(){var ifr=this.getEl().getElementsByTagName("iframe")[0];return ifr?ifr.contentWindow:null}});return function handleWindowResize(){if(!Env.desktop){var lastSize={w:window.innerWidth,h:window.innerHeight};Delay.setInterval(function(){var w=window.innerWidth,h=window.innerHeight;lastSize.w==w&&lastSize.h==h||(lastSize={w:w,h:h},$(window).trigger("resize"))},100)}$(window).on("resize",function reposition(){var i,layoutRect,rect=DomUtils.getWindowSize();for(i=0;i<windows.length;i++)layoutRect=windows[i].layoutRect(),windows[i].moveTo(windows[i].settings.x||Math.max(0,rect.w/2-layoutRect.w/2),windows[i].settings.y||Math.max(0,rect.h/2-layoutRect.h/2))})}(),Window}),define("tinymce.core.ui.MessageBox",["tinymce.core.ui.Window"],function(Window){"use strict";var MessageBox=Window.extend({init:function(settings){settings={border:1,padding:20,layout:"flex",pack:"center",align:"center",containerCls:"panel",autoScroll:!0,buttons:{type:"button",text:"Ok",action:"ok"},items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200}},this._super(settings)},Statics:{OK:1,OK_CANCEL:2,YES_NO:3,YES_NO_CANCEL:4,msgBox:function(settings){var buttons,callback=settings.callback||function(){};function createButton(text,status,primary){return{type:"button",text:text,subtype:primary?"primary":"",onClick:function(e){e.control.parents()[1].close(),callback(status)}}}switch(settings.buttons){case MessageBox.OK_CANCEL:buttons=[createButton("Ok",!0,!0),createButton("Cancel",!1)];break;case MessageBox.YES_NO:case MessageBox.YES_NO_CANCEL:buttons=[createButton("Yes",1,!0),createButton("No",0)],settings.buttons==MessageBox.YES_NO_CANCEL&&buttons.push(createButton("Cancel",-1));break;default:buttons=[createButton("Ok",!0,!0)]}return new Window({padding:20,x:settings.x,y:settings.y,minWidth:300,minHeight:100,layout:"flex",pack:"center",align:"center",buttons:buttons,title:settings.title,role:"alertdialog",items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200,text:settings.text},onPostRender:function(){this.aria("describedby",this.items()[0]._id)},onClose:settings.onClose,onCancel:function(){callback(!1)}}).renderTo(document.body).reflow()},alert:function(settings,callback){return"string"==typeof settings&&(settings={text:settings}),settings.callback=callback,MessageBox.msgBox(settings)},confirm:function(settings,callback){return"string"==typeof settings&&(settings={text:settings}),settings.callback=callback,settings.buttons=MessageBox.OK_CANCEL,MessageBox.msgBox(settings)}}});return MessageBox}),define("tinymce.core.WindowManager",["tinymce.core.ui.Window","tinymce.core.ui.MessageBox"],function(Window,MessageBox){return function(editor){var windows=[];function getTopMostWindow(){if(windows.length)return windows[windows.length-1]}function fireOpenEvent(win){editor.fire("OpenWindow",{win:win})}function fireCloseEvent(win){editor.fire("CloseWindow",{win:win})}this.windows=windows,editor.on("remove",function(){for(var i=windows.length;i--;)windows[i].close()}),this.open=function(args,params){var win;return editor.editorManager.setActive(editor),args.title=args.title||" ",args.url=args.url||args.file,args.url&&(args.width=parseInt(args.width||320,10),args.height=parseInt(args.height||240,10)),args.body&&(args.items={defaults:args.defaults,type:args.bodyType||"form",items:args.body,data:args.data,callbacks:args.commands}),args.url||args.buttons||(args.buttons=[{text:"Ok",subtype:"primary",onclick:function(){win.find("form")[0].submit()}},{text:"Cancel",onclick:function(){win.close()}}]),win=new Window(args),windows.push(win),win.on("close",function(){for(var i=windows.length;i--;)windows[i]===win&&windows.splice(i,1);windows.length||editor.focus(),fireCloseEvent(win)}),args.data&&win.on("postRender",function(){this.find("*").each(function(ctrl){var name=ctrl.name();name in args.data&&ctrl.value(args.data[name])})}),win.features=args||{},win.params=params||{},1===windows.length&&editor.nodeChanged(),fireOpenEvent(win=win.renderTo().reflow()),win},this.alert=function(message,callback,scope){var win;(win=MessageBox.alert(message,function(){callback?callback.call(scope||this):editor.focus()})).on("close",function(){fireCloseEvent(win)}),fireOpenEvent(win)},this.confirm=function(message,callback,scope){var win;(win=MessageBox.confirm(message,function(state){callback.call(scope||this,state)})).on("close",function(){fireCloseEvent(win)}),fireOpenEvent(win)},this.close=function(){getTopMostWindow()&&getTopMostWindow().close()},this.getParams=function(){return getTopMostWindow()?getTopMostWindow().params:null},this.setParams=function(params){getTopMostWindow()&&(getTopMostWindow().params=params)},this.getWindows=function(){return windows}}}),define("tinymce.core.ui.Tooltip",["tinymce.core.ui.Control","tinymce.core.ui.Movable"],function(Control,Movable){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget tooltip tooltip-n"},renderHtml:function(){var prefix=this.classPrefix;return'<div id="'+this._id+'" class="'+this.classes+'" role="presentation"><div class="'+prefix+'tooltip-arrow"></div><div class="'+prefix+'tooltip-inner">'+this.encode(this.state.get("text"))+"</div></div>"},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl().lastChild.innerHTML=self.encode(e.value)}),self._super()},repaint:function(){var style,rect;style=this.getEl().style,rect=this._layoutRect,style.left=rect.x+"px",style.top=rect.y+"px",style.zIndex=131070}})}),define("tinymce.core.ui.Widget",["tinymce.core.ui.Control","tinymce.core.ui.Tooltip"],function(Control,Tooltip){"use strict";var tooltip,Widget=Control.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,self.canFocus=!0,settings.tooltip&&!1!==Widget.tooltips&&(self.on("mouseenter",function(e){var tooltip=self.tooltip().moveTo(-65535);if(e.control==self){var rel=tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(),["bc-tc","bc-tl","bc-tr"]);tooltip.classes.toggle("tooltip-n","bc-tc"==rel),tooltip.classes.toggle("tooltip-nw","bc-tl"==rel),tooltip.classes.toggle("tooltip-ne","bc-tr"==rel),tooltip.moveRel(self.getEl(),rel)}else tooltip.hide()}),self.on("mouseleave mousedown click",function(){self.tooltip().hide()})),self.aria("label",settings.ariaLabel||settings.tooltip)},tooltip:function(){return tooltip||(tooltip=new Tooltip({type:"tooltip"})).renderTo(),tooltip},postRender:function(){var settings=this.settings;this._super(),this.parent()||!settings.width&&!settings.height||(this.initLayoutRect(),this.repaint()),settings.autofocus&&this.focus()},bindStates:function(){var self=this;function disable(state){self.aria("disabled",state),self.classes.toggle("disabled",state)}function active(state){self.aria("pressed",state),self.classes.toggle("active",state)}return self.state.on("change:disabled",function(e){disable(e.value)}),self.state.on("change:active",function(e){active(e.value)}),self.state.get("disabled")&&disable(!0),self.state.get("active")&&active(!0),self._super()},remove:function(){this._super(),tooltip&&(tooltip.remove(),tooltip=null)}});return Widget}),define("tinymce.core.ui.Progress",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{value:0},init:function(settings){this._super(settings),this.classes.add("progress"),this.settings.filter||(this.settings.filter=function(value){return Math.round(value)})},renderHtml:function(){var id=this._id,prefix=this.classPrefix;return'<div id="'+id+'" class="'+this.classes+'"><div class="'+prefix+'bar-container"><div class="'+prefix+'bar"></div></div><div class="'+prefix+'text">0%</div></div>'},postRender:function(){return this._super(),this.value(this.settings.value),this},bindStates:function(){var self=this;function setValue(value){value=self.settings.filter(value),self.getEl().lastChild.innerHTML=value+"%",self.getEl().firstChild.firstChild.style.width=value+"%"}return self.state.on("change:value",function(e){setValue(e.value)}),setValue(self.state.get("value")),self._super()}})}),define("tinymce.core.ui.Notification",["tinymce.core.ui.Control","tinymce.core.ui.Movable","tinymce.core.ui.Progress","tinymce.core.util.Delay"],function(Control,Movable,Progress,Delay){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget notification"},init:function(settings){var self=this;self._super(settings),settings.text&&self.text(settings.text),settings.icon&&(self.icon=settings.icon),settings.color&&(self.color=settings.color),settings.type&&self.classes.add("notification-"+settings.type),settings.timeout&&(settings.timeout<0||0<settings.timeout)&&!settings.closeButton?self.closeButton=!1:(self.classes.add("has-close"),self.closeButton=!0),settings.progressBar&&(self.progressBar=new Progress),self.on("click",function(e){-1!=e.target.className.indexOf(self.classPrefix+"close")&&self.close()})},renderHtml:function(){var prefix=this.classPrefix,icon="",closeButton="",progressBar="",notificationStyle="";return this.icon&&(icon='<i class="'+prefix+"ico "+prefix+"i-"+this.icon+'"></i>'),this.color&&(notificationStyle=' style="background-color: '+this.color+'"'),this.closeButton&&(closeButton='<button type="button" class="'+prefix+'close" aria-hidden="true">×</button>'),this.progressBar&&(progressBar=this.progressBar.renderHtml()),'<div id="'+this._id+'" class="'+this.classes+'"'+notificationStyle+' role="presentation">'+icon+'<div class="'+prefix+'notification-inner">'+this.state.get("text")+"</div>"+progressBar+closeButton+"</div>"},postRender:function(){var self=this;return Delay.setTimeout(function(){self.$el.addClass(self.classPrefix+"in")}),self._super()},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl().childNodes[1].innerHTML=e.value}),self.progressBar&&self.progressBar.bindStates(),self._super()},close:function(){return this.fire("close").isDefaultPrevented()||this.remove(),this},repaint:function(){var style,rect;style=this.getEl().style,rect=this._layoutRect,style.left=rect.x+"px",style.top=rect.y+"px",style.zIndex=65534}})}),define("tinymce.core.NotificationManager",["tinymce.core.ui.Notification","tinymce.core.util.Delay","tinymce.core.util.Tools"],function(Notification,Delay,Tools){return function(editor){var notifications=[];function getLastNotification(){if(notifications.length)return notifications[notifications.length-1]}function positionNotifications(){if(0<notifications.length){var firstItem=notifications.slice(0,1)[0],container=editor.inline?editor.getElement():editor.getContentAreaContainer();if(firstItem.moveRel(container,"tc-tc"),1<notifications.length)for(var i=1;i<notifications.length;i++)notifications[i].moveRel(notifications[i-1].getEl(),"bc-tc")}}this.notifications=notifications,editor.on("remove",function(){for(var i=notifications.length;i--;)notifications[i].close()}),editor.on("ResizeEditor",positionNotifications),editor.on("ResizeWindow",function resizeWindowEvent(){Delay.requestAnimationFrame(function(){!function prePositionNotifications(){for(var i=0;i<notifications.length;i++)notifications[i].moveTo(0,0)}(),positionNotifications()})}),this.open=function(args){if(!editor.removed){var notif;editor.editorManager.setActive(editor);var duplicate=function findDuplicateMessage(notificationArray,newNotification){if(!function isPlainTextNotification(notification){return!notification.progressBar&&!notification.timeout}(newNotification))return null;var filteredNotifications=Tools.grep(notificationArray,function(notification){return function isSameNotification(a,b){return a.type===b.settings.type&&a.text===b.settings.text}(newNotification,notification)});return 0===filteredNotifications.length?null:filteredNotifications[0]}(notifications,args);return null===duplicate?(notif=new Notification(args),notifications.push(notif),0<args.timeout&&(notif.timer=setTimeout(function(){notif.close()},args.timeout)),notif.on("close",function(){var i=notifications.length;for(notif.timer&&editor.getWin().clearTimeout(notif.timer);i--;)notifications[i]===notif&&notifications.splice(i,1);positionNotifications()}),notif.renderTo(),positionNotifications()):notif=duplicate,notif}},this.close=function(){getLastNotification()&&getLastNotification().close()},this.getNotifications=function(){return notifications},editor.on("SkinLoaded",function(){var serviceMessage=editor.settings.service_message;serviceMessage&&editor.notificationManager.open({text:serviceMessage,type:"warning",timeout:0,icon:""})})}}),define("tinymce.core.EditorObservable",["tinymce.core.util.Observable","tinymce.core.dom.DOMUtils","tinymce.core.util.Tools"],function(Observable,DOMUtils,Tools){var customEventRootDelegates,DOM=DOMUtils.DOM;function getEventTarget(editor,eventName){return"selectionchange"==eventName?editor.getDoc():!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)?editor.getDoc().documentElement:editor.settings.event_root?(editor.eventRoot||(editor.eventRoot=DOM.select(editor.settings.event_root)[0]),editor.eventRoot):editor.getBody()}function bindEventDelegate(editor,eventName){var eventRootElm,delegate;function isListening(editor){return!editor.hidden&&!editor.readonly}if(editor.delegates||(editor.delegates={}),!editor.delegates[eventName]&&!editor.removed)if(eventRootElm=getEventTarget(editor,eventName),editor.settings.event_root){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",function(){var name;if(!editor.editorManager.activeEditor&&customEventRootDelegates){for(name in customEventRootDelegates)editor.dom.unbind(getEventTarget(editor,name));customEventRootDelegates=null}})),customEventRootDelegates[eventName])return;delegate=function(e){for(var target=e.target,editors=editor.editorManager.editors,i=editors.length;i--;){var body=editors[i].getBody();(body===target||DOM.isChildOf(target,body))&&isListening(editors[i])&&editors[i].fire(eventName,e)}},customEventRootDelegates[eventName]=delegate,DOM.bind(eventRootElm,eventName,delegate)}else delegate=function(e){isListening(editor)&&editor.fire(eventName,e)},DOM.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}var EditorObservable={bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name)})},toggleNativeEvent:function(name,state){"focus"!=name&&"blur"!=name&&(state?this.initialized?bindEventDelegate(this,name):this._pendingNativeEvents?this._pendingNativeEvents.push(name):this._pendingNativeEvents=[name]:this.initialized&&(this.dom.unbind(getEventTarget(this,name),name,this.delegates[name]),delete this.delegates[name]))},unbindAllNativeEvents:function(){var name;if(this.delegates){for(name in this.delegates)this.dom.unbind(getEventTarget(this,name),name,this.delegates[name]);delete this.delegates}this.inline||(this.getBody().onload=null,this.dom.unbind(this.getWin()),this.dom.unbind(this.getDoc())),this.dom.unbind(this.getBody()),this.dom.unbind(this.getContainer())}};return EditorObservable=Tools.extend({},Observable,EditorObservable)}),define("tinymce.core.Shortcuts",["tinymce.core.util.Tools","tinymce.core.Env"],function(Tools,Env){var each=Tools.each,explode=Tools.explode,keyCodeLookup={f9:120,f10:121,f11:122},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access");return function(editor){var shortcuts={},pendingPatterns=[];function parseShortcut(pattern){var id,key,shortcut={};for(key in each(explode(pattern,"+"),function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}),id=[shortcut.keyCode],modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut}function createShortcut(pattern,desc,cmdFunc,scope){var shortcuts;return(shortcuts=Tools.map(explode(pattern,">"),parseShortcut))[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||editor}),Tools.extend(shortcuts[0],{desc:editor.translate(desc),subpatterns:shortcuts.slice(1)})}function matchShortcut(e,shortcut){return!!shortcut&&(shortcut.ctrl==e.ctrlKey&&shortcut.meta==e.metaKey&&(shortcut.alt==e.altKey&&shortcut.shift==e.shiftKey&&(!!(e.keyCode==shortcut.keyCode||e.charCode&&e.charCode==shortcut.charCode)&&(e.preventDefault(),!0))))}function executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null}editor.on("keyup keypress keydown",function(e){!function hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey}(e)&&!function isFunctionKey(e){return"keydown"===e.type&&112<=e.keyCode&&e.keyCode<=123}(e)||e.isDefaultPrevented()||(each(shortcuts,function(shortcut){if(matchShortcut(e,shortcut))return pendingPatterns=shortcut.subpatterns.slice(0),"keydown"==e.type&&executeShortcutAction(shortcut),!0}),matchShortcut(e,pendingPatterns[0])&&(1===pendingPatterns.length&&"keydown"==e.type&&executeShortcutAction(pendingPatterns[0]),pendingPatterns.shift()))}),this.add=function(pattern,desc,cmdFunc,scope){var cmd;return"string"==typeof(cmd=cmdFunc)?cmdFunc=function(){editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)&&(cmdFunc=function(){editor.execCommand(cmd[0],cmd[1],cmd[2])}),each(explode(Tools.trim(pattern.toLowerCase())),function(pattern){var shortcut=createShortcut(pattern,desc,cmdFunc,scope);shortcuts[shortcut.id]=shortcut}),!0},this.remove=function(pattern){var shortcut=createShortcut(pattern);return!!shortcuts[shortcut.id]&&(delete shortcuts[shortcut.id],!0)}}}),defineGlobal("global!window",window),define("tinymce.core.ErrorReporter",["tinymce.core.AddOnManager"],function(AddOnManager){var PluginManager=AddOnManager.PluginManager,pluginUrlToMessage=function(editor,url){var plugin=function(targetUrl,suffix){for(var name in PluginManager.urls){if(PluginManager.urls[name]+"/plugin"+suffix+".js"===targetUrl)return name}return null}(url,editor.suffix);return plugin?"Failed to load plugin: "+plugin+" from url "+url:"Failed to load plugin url: "+url},displayNotification=function(editor,message){editor.notificationManager.open({type:"error",text:message})},displayError=function(editor,message){editor._skinLoaded?displayNotification(editor,message):editor.on("SkinLoaded",function(){displayNotification(editor,message)})};return{pluginLoadError:function(editor,url){displayError(editor,pluginUrlToMessage(editor,url))},uploadError:function(editor,message){displayError(editor,"Failed to upload image: "+message)},displayError:displayError,contentCssError:function(editor,urls){displayError(editor,"Failed to load content css: "+urls[0])},initError:function(message){var console=window.console;console&&!window.test&&(console.error?console.error.apply(console,arguments):console.log.apply(console,arguments))}}}),define("tinymce.core.caret.CaretContainerInput",["ephox.katamari.api.Fun","tinymce.core.caret.CaretContainer"],function(Fun,CaretContainer){var showBlockCaretContainer=function(editor,blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(CaretContainer.showCaretContainerBlock(blockCaretContainer),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.selection.scrollIntoView(blockCaretContainer))},handleBlockContainer=function(editor,e){var blockCaretContainer=function(editor){return editor.dom.select("*[data-mce-caret]")[0]}(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(blockCaretContainer)):void(CaretContainer.hasContent(blockCaretContainer)&&showBlockCaretContainer(editor,blockCaretContainer))};return{setup:function(editor){editor.on("keyup compositionstart",Fun.curry(handleBlockContainer,editor))}}}),define("tinymce.core.file.Uploader",["tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.core.util.Fun"],function(Promise,Tools,Fun){return function(uploadStatus,settings){var pendingPromises={};function defaultHandler(blobInfo,success,failure,progress){var xhr,formData;(xhr=new XMLHttpRequest).open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){var json;200==xhr.status?(json=JSON.parse(xhr.responseText))&&"string"==typeof json.location?success(function pathJoin(path1,path2){return path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2}(settings.basePath,json.location)):failure("Invalid JSON: "+xhr.responseText):failure("HTTP Error: "+xhr.status)},(formData=new FormData).append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)}function handlerSuccess(blobInfo,url){return{url:url,blobInfo:blobInfo,status:!0}}function handlerFailure(blobInfo,error){return{url:"",blobInfo:blobInfo,status:!1,error:error}}function resolvePending(blobUri,result){Tools.each(pendingPromises[blobUri],function(resolve){resolve(result)}),delete pendingPromises[blobUri]}function uploadBlobs(blobInfos,openNotification){return blobInfos=Tools.grep(blobInfos,function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri())}),Promise.all(Tools.map(blobInfos,function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?function pendingUploadBlobInfo(blobInfo){var blobUri=blobInfo.blobUri();return new Promise(function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)})}(blobInfo):function uploadBlobInfo(blobInfo,handler,openNotification){return uploadStatus.markPending(blobInfo.blobUri()),new Promise(function(resolve){var notification,noop=function(){};try{var closeNotification=function(){notification&&(notification.close(),noop)};handler(blobInfo,function(url){closeNotification(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))},function(error){closeNotification(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error)),resolve(handlerFailure(blobInfo,error))},function(percent){percent<0||100<percent||(notification=notification||openNotification()).progressBar.value(percent)})}catch(ex){resolve(handlerFailure(blobInfo,ex.message))}})}(blobInfo,settings.handler,openNotification)}))}return settings=Tools.extend({credentials:!1,handler:defaultHandler},settings),{upload:function upload(blobInfos,openNotification){return!settings.url&&function isDefaultHandler(handler){return handler===defaultHandler}(settings.handler)?function noUpload(){return new Promise(function(resolve){resolve([])})}():uploadBlobs(blobInfos,openNotification)}}}}),define("tinymce.core.file.Conversions",["tinymce.core.util.Promise"],function(Promise){function parseDataUri(uri){var type,matches;return uri=decodeURIComponent(uri).split(","),(matches=/data:([^;]+)/.exec(uri[0]))&&(type=matches[1]),{type:type,data:uri[1]}}return{uriToBlob:function uriToBlob(url){return 0===url.indexOf("blob:")?function blobUriToBlob(url){return new Promise(function(resolve,reject){var rejectWithError=function(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.")};try{var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="blob",xhr.onload=function(){200==this.status?resolve(this.response):rejectWithError()},xhr.onerror=rejectWithError,xhr.send()}catch(ex){rejectWithError()}})}(url):0===url.indexOf("data:")?function dataUriToBlob(uri){return new Promise(function(resolve){var str,arr,i;uri=parseDataUri(uri);try{str=atob(uri.data)}catch(e){return void resolve(new Blob([]))}for(arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);resolve(new Blob([arr],{type:uri.type}))})}(url):null},blobToDataUri:function blobToDataUri(blob){return new Promise(function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)})},parseDataUri:parseDataUri}}),define("tinymce.core.file.ImageScanner",["tinymce.core.util.Promise","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.file.Conversions","tinymce.core.Env"],function(Promise,Arr,Fun,Conversions,Env){var count=0,uniqueId=function(prefix){return(prefix||"blobid")+count++};return function(uploadStatus,blobCache){var cachedPromises={};return{findAll:function findAll(elm,predicate){var images,promises;return predicate=predicate||Fun.constant(!0),images=Arr.filter(function(elm){return elm?elm.getElementsByTagName("img"):[]}(elm),function(img){var src=img.src;return!!Env.fileApi&&(!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src==Env.transparentSrc)&&(0===src.indexOf("blob:")?!uploadStatus.isUploaded(src):0===src.indexOf("data:")&&predicate(img)))))}),promises=Arr.map(images,function(img){var newPromise;return cachedPromises[img.src]?new Promise(function(resolve){cachedPromises[img.src].then(function(imageInfo){if("string"==typeof imageInfo)return imageInfo;resolve({image:img,blobInfo:imageInfo.blobInfo})})}):(newPromise=new Promise(function(resolve,reject){!function(blobCache,img,resolve,reject){var base64,blobInfo;0!==img.src.indexOf("blob:")?(base64=Conversions.parseDataUri(img.src).data,(blobInfo=blobCache.findFirst(function(cachedBlobInfo){return cachedBlobInfo.base64()===base64}))?resolve({image:img,blobInfo:blobInfo}):Conversions.uriToBlob(img.src).then(function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})},function(err){reject(err)})):(blobInfo=blobCache.getByUri(img.src))?resolve({image:img,blobInfo:blobInfo}):Conversions.uriToBlob(img.src).then(function(blob){Conversions.blobToDataUri(blob).then(function(dataUri){base64=Conversions.parseDataUri(dataUri).data,blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})})},function(err){reject(err)})}(blobCache,img,resolve,reject)}).then(function(result){return delete cachedPromises[result.image.src],result})["catch"](function(error){return delete cachedPromises[img.src],error}),cachedPromises[img.src]=newPromise)}),Promise.all(promises)}}}}),define("tinymce.core.util.Uuid",[],function(){var count=0;return{uuid:function(prefix){return prefix+count+++(rnd=function(){return Math.round(4294967295*Math.random()).toString(36)},"s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd());var rnd}}}),defineGlobal("global!URL",URL),define("tinymce.core.file.BlobCache",["tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Uuid","global!URL"],function(Arr,Fun,Uuid,URL){return function(){var cache=[],constant=Fun.constant;function toBlobInfo(o){var id,name;if(!o.blob||!o.base64)throw"blob and base64 representations of the image are required for BlobInfo to be created";return id=o.id||Uuid.uuid("blobid"),name=o.name||id,{id:constant(id),name:constant(name),filename:constant(name+"."+function mimeToExt(mime){return{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"}[mime.toLowerCase()]||"dat"}(o.blob.type)),blob:constant(o.blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(o.blob)),uri:constant(o.uri)}}function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id})}function findFirst(predicate){return Arr.filter(cache,predicate)[0]}return{create:function create(o,blob,base64,filename){return toBlobInfo("object"==typeof o?o:{id:o,name:filename,blob:blob,base64:base64})},add:function add(blobInfo){get(blobInfo.id())||cache.push(blobInfo)},get:get,getByUri:function getByUri(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()==blobUri})},findFirst:findFirst,removeByUri:function removeByUri(blobUri){cache=Arr.filter(cache,function(blobInfo){return blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)})},destroy:function destroy(){Arr.each(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())}),cache=[]}}}}),define("tinymce.core.file.UploadStatus",[],function(){return function(){var blobUriStatuses={};function createStatus(status,resultUri){return{status:status,resultUri:resultUri}}function hasBlobUri(blobUri){return blobUri in blobUriStatuses}return{hasBlobUri:hasBlobUri,getResultUri:function getResultUri(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null},isPending:function isPending(blobUri){return!!hasBlobUri(blobUri)&&1===blobUriStatuses[blobUri].status},isUploaded:function isUploaded(blobUri){return!!hasBlobUri(blobUri)&&2===blobUriStatuses[blobUri].status},markPending:function markPending(blobUri){blobUriStatuses[blobUri]=createStatus(1,null)},markUploaded:function markUploaded(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(2,resultUri)},removeFailed:function removeFailed(blobUri){delete blobUriStatuses[blobUri]},destroy:function destroy(){blobUriStatuses={}}}}}),define("tinymce.core.EditorUpload",["tinymce.core.util.Arr","tinymce.core.file.Uploader","tinymce.core.file.ImageScanner","tinymce.core.file.BlobCache","tinymce.core.file.UploadStatus","tinymce.core.ErrorReporter"],function(Arr,Uploader,ImageScanner,BlobCache,UploadStatus,ErrorReporter){return function(editor){var uploader,imageScanner,blobCache=new BlobCache,settings=editor.settings,uploadStatus=new UploadStatus;function aliveGuard(callback){return function(result){return editor.selection?callback(result):[]}}function replaceString(content,search,replace){for(var index=0;-1!==(index=content.indexOf(search,index))&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1),-1!==index;);return content}function replaceImageUrl(content,targetUrl,replacementUrl){return content=replaceString(content,'src="'+targetUrl+'"','src="'+replacementUrl+'"'),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')}function replaceUrlInUndoStack(targetUrl,replacementUrl){Arr.each(editor.undoManager.data,function(level){"fragmented"===level.type?level.fragments=Arr.map(level.fragments,function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl)}):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)})}function openNotification(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}function replaceImageUri(image,resultUri){blobCache.removeByUri(image.src),replaceUrlInUndoStack(image.src,resultUri),editor.$(image).attr({src:settings.images_reuse_filename?resultUri+function cacheInvalidator(){return"?"+(new Date).getTime()}():resultUri,"data-mce-src":editor.convertURL(resultUri,"src")})}function uploadImages(callback){return uploader=uploader||new Uploader(uploadStatus,{url:settings.images_upload_url,basePath:settings.images_upload_base_path,credentials:settings.images_upload_credentials,handler:settings.images_upload_handler}),scanForImages().then(aliveGuard(function(imageInfos){var blobInfos;return blobInfos=Arr.map(imageInfos,function(imageInfo){return imageInfo.blobInfo}),uploader.upload(blobInfos,openNotification).then(aliveGuard(function(result){var filteredResult=Arr.map(result,function(uploadInfo,index){var image=imageInfos[index].image;return uploadInfo.status&&!1!==editor.settings.images_replace_blob_uris?replaceImageUri(image,uploadInfo.url):uploadInfo.error&&ErrorReporter.uploadError(editor,uploadInfo.error),{element:image,status:uploadInfo.status}});return callback&&callback(filteredResult),filteredResult}))}))}function uploadImagesAuto(callback){if(!1!==settings.automatic_uploads)return uploadImages(callback)}function isValidDataUriImage(imgElm){return!settings.images_dataimg_filter||settings.images_dataimg_filter(imgElm)}function scanForImages(){return(imageScanner=imageScanner||new ImageScanner(uploadStatus,blobCache)).findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(function(result){return result=Arr.filter(result,function(resultItem){return"string"!=typeof resultItem||(ErrorReporter.displayError(editor,resultItem),!1)}),Arr.each(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")}),result}))}function replaceBlobUris(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';var blobInfo=blobCache.getByUri(blobUri);return(blobInfo=blobInfo||Arr.reduce(editor.editorManager.editors,function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)},null))?'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"':match})}return editor.on("setContent",function(){!1!==editor.settings.automatic_uploads?uploadImagesAuto():scanForImages()}),editor.on("RawSaveContent",function(e){e.content=replaceBlobUris(e.content)}),editor.on("getContent",function(e){e.source_view||"raw"==e.format||(e.content=replaceBlobUris(e.content))}),editor.on("PostRender",function(){editor.parser.addNodeFilter("img",function(images){Arr.each(images,function(img){var src=img.attr("src");if(!blobCache.getByUri(src)){var resultUri=uploadStatus.getResultUri(src);resultUri&&img.attr("src",resultUri)}})})}),{blobCache:blobCache,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:function destroy(){blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null}}}}),define("tinymce.core.ForceBlocks",["ephox.katamari.api.Fun"],function(Fun){var addRootBlocks=function(editor){var rng,startContainer,startOffset,endContainer,endOffset,rootBlockNode,tempNode,wrapped,restoreSelection,tmpRng,rootNodeName,forcedRootBlock,settings=editor.settings,dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements(),node=selection.getStart(),rootNode=editor.getBody();if(forcedRootBlock=settings.forced_root_block,node&&1===node.nodeType&&forcedRootBlock){for(;node&&node!==rootNode;){if(blockElements[node.nodeName])return;node=node.parentNode}if((rng=selection.getRng()).setStart){startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;try{restoreSelection=editor.getDoc().activeElement===rootNode}catch(ex){}}else rng.item&&(node=rng.item(0),(rng=editor.getDoc().body.createTextRange()).moveToElementText(node)),restoreSelection=rng.parentElement().ownerDocument===editor.getDoc(),(tmpRng=rng.duplicate()).collapse(!0),startOffset=-1*tmpRng.move("character",-16777215),tmpRng.collapsed||((tmpRng=rng.duplicate()).collapse(!1),endOffset=-1*tmpRng.move("character",-16777215)-startOffset);for(node=rootNode.firstChild,rootNodeName=rootNode.nodeName.toLowerCase();node;)if((3===node.nodeType||1==node.nodeType&&!blockElements[node.nodeName])&&schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())){if(3===node.nodeType&&0===node.nodeValue.length){node=(tempNode=node).nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,editor.settings.forced_root_block_attrs),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),node=(tempNode=node).nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;if(wrapped&&restoreSelection){if(rng.setStart)rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng);else try{(rng=editor.getDoc().body.createTextRange()).moveToElementText(rootNode),rng.collapse(!0),rng.moveStart("character",startOffset),0<endOffset&&rng.moveEnd("character",endOffset),rng.select()}catch(ex){}editor.nodeChanged()}}};return{setup:function(editor){editor.settings.forced_root_block&&editor.on("NodeChange",Fun.curry(addRootBlocks,editor))}}}),define("tinymce.core.dom.Dimensions",["tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.geom.ClientRect"],function(Arr,NodeType,ClientRect){return{getClientRects:function getClientRects(node){function toArrayWithNode(clientRects){return Arr.map(clientRects,function(clientRect){return(clientRect=ClientRect.clone(clientRect)).node=node,clientRect})}if(Arr.isArray(node))return Arr.reduce(node,function(result,node){return result.concat(getClientRects(node))},[]);if(NodeType.isElement(node))return toArrayWithNode(node.getClientRects());if(NodeType.isText(node)){var rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())}}}}),define("tinymce.core.caret.LineUtils",["tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.dom.Dimensions","tinymce.core.geom.ClientRect","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretCandidate"],function(Fun,Arr,NodeType,Dimensions,ClientRect,CaretUtils,CaretCandidate){var isContentEditableFalse=NodeType.isContentEditableFalse,findNode=CaretUtils.findNode,curry=Fun.curry;function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX)}function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX)}function findClosestClientRect(clientRects,clientX){function isInside(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right}return Arr.reduce(clientRects,function(oldClientRect,clientRect){var oldDistance,newDistance;return oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX)),isInside(clientX,clientRect)?clientRect:isInside(clientX,oldClientRect)?oldClientRect:newDistance==oldDistance&&isContentEditableFalse(clientRect.node)?clientRect:newDistance<oldDistance?clientRect:oldClientRect})}function walkUntil(direction,rootNode,predicateFn,node){for(;node=findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode);)if(predicateFn(node))return}function findLineNodeRects(rootNode,targetNodeRect){var clientRects=[];function collect(checkPosFn,node){var lineRects;return lineRects=Arr.filter(Dimensions.getClientRects(node),function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}),clientRects=clientRects.concat(lineRects),0===lineRects.length}return clientRects.push(targetNodeRect),walkUntil(-1,rootNode,curry(collect,ClientRect.isAbove),targetNodeRect.node),walkUntil(1,rootNode,curry(collect,ClientRect.isBelow),targetNodeRect.node),clientRects}return{findClosestClientRect:findClosestClientRect,findLineNodeRects:findLineNodeRects,closestCaret:function closestCaret(rootNode,clientX,clientY){var contentEditableFalseNodeRects,closestNodeRect;return contentEditableFalseNodeRects=Dimensions.getClientRects(function getContentEditableFalseChildren(rootNode){return Arr.filter(Arr.toArray(rootNode.getElementsByTagName("*")),isContentEditableFalse)}(rootNode)),(closestNodeRect=(closestNodeRect=findClosestClientRect(contentEditableFalseNodeRects=Arr.filter(contentEditableFalseNodeRects,function(clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom}),clientX))&&findClosestClientRect(findLineNodeRects(rootNode,closestNodeRect),clientX))&&isContentEditableFalse(closestNodeRect.node)?function caretInfo(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}(closestNodeRect,clientX):null}}}),define("tinymce.core.caret.LineWalker",["tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.dom.Dimensions","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.CaretPosition","tinymce.core.geom.ClientRect"],function(Fun,Arr,Dimensions,CaretCandidate,CaretUtils,CaretWalker,CaretPosition,ClientRect){var curry=Fun.curry;function walkUntil(direction,isAboveFn,isBeflowFn,rootNode,predicateFn,caretPosition){var node,targetClientRect,line=0,result=[];function add(node){var i,clientRect,clientRects;for(clientRects=Dimensions.getClientRects(node),-1==direction&&(clientRects=clientRects.reverse()),i=0;i<clientRects.length;i++)if(clientRect=clientRects[i],!isBeflowFn(clientRect,targetClientRect)){if(0<result.length&&isAboveFn(clientRect,Arr.last(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}return(targetClientRect=Arr.last(caretPosition.getClientRects()))&&(add(node=caretPosition.getNode()),function findUntil(direction,rootNode,predicateFn,node){for(;node=CaretUtils.findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode);)if(predicateFn(node))return}(direction,rootNode,add,node)),result}return{upUntil:curry(walkUntil,-1,ClientRect.isAbove,ClientRect.isBelow),downUntil:curry(walkUntil,1,ClientRect.isBelow,ClientRect.isAbove),positionsUntil:function positionsUntil(direction,rootNode,predicateFn,node){var walkFn,isBelowFn,isAboveFn,caretPosition,clientRect,targetClientRect,caretWalker=new CaretWalker(rootNode),result=[],line=0;function getClientRect(caretPosition){return Arr.last(caretPosition.getClientRects())}targetClientRect=getClientRect(caretPosition=1==direction?(walkFn=caretWalker.next,isBelowFn=ClientRect.isBelow,isAboveFn=ClientRect.isAbove,CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=ClientRect.isAbove,isAboveFn=ClientRect.isBelow,CaretPosition.before(node)));do{if(caretPosition.isVisible()&&!isAboveFn(clientRect=getClientRect(caretPosition),targetClientRect)){if(0<result.length&&isBelowFn(clientRect,Arr.last(result))&&line++,(clientRect=ClientRect.clone(clientRect)).position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}}while(caretPosition=walkFn(caretPosition));return result},isAboveLine:curry(function aboveLineNumber(lineNumber,clientRect){return clientRect.line>lineNumber}),isLine:curry(function isLine(lineNumber,clientRect){return clientRect.line===lineNumber})}}),define("tinymce.core.keyboard.CefUtils",["tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.dom.NodeType","tinymce.core.util.Fun"],function(CaretPosition,CaretUtils,NodeType,Fun){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,showCaret=function(direction,editor,node,before){return editor._selectionOverrides.showCaret(direction,node,before)},renderCaretAtRange=function(editor,range){var caretPosition,ceRoot;return range=CaretUtils.normalizeRange(1,editor.getBody(),range),caretPosition=CaretPosition.fromRangeStart(range),isContentEditableFalse(caretPosition.getNode())?showCaret(1,editor,caretPosition.getNode(),!caretPosition.isAtEnd()):isContentEditableFalse(caretPosition.getNode(!0))?showCaret(1,editor,caretPosition.getNode(!0),!1):(ceRoot=editor.dom.getParent(caretPosition.getNode(),Fun.or(isContentEditableFalse,isContentEditableTrue)),isContentEditableFalse(ceRoot)?showCaret(1,editor,ceRoot,!1):null)};return{showCaret:showCaret,selectNode:function(editor,node){return editor.fire("BeforeObjectSelected",{target:node}).isDefaultPrevented()?null:function(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng}(node)},renderCaretAtRange:renderCaretAtRange,renderRangeCaret:function(editor,range){return range&&range.collapsed&&renderCaretAtRange(editor,range)||range}}}),define("tinymce.core.keyboard.CefNavigation",["tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.LineUtils","tinymce.core.caret.LineWalker","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.Env","tinymce.core.keyboard.CefUtils","tinymce.core.util.Arr","tinymce.core.util.Fun"],function(CaretContainer,CaretPosition,CaretUtils,CaretWalker,LineUtils,LineWalker,NodeType,RangeUtils,Env,CefUtils,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,getSelectedNode=RangeUtils.getSelectedNode,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse,getVisualCaretPosition=function(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition},getNormalizedRangeEndPoint=function(direction,rootNode,range){return range=CaretUtils.normalizeRange(direction,rootNode,range),-1===direction?CaretPosition.fromRangeStart(range):CaretPosition.fromRangeEnd(range)},moveToCeFalseHorizontally=function(direction,editor,getNextPosFn,isBeforeContentEditableFalseFn,range){var node,caretPosition,peekCaretPosition,rangeIsInContainerBlock,fromCaretPosition,toCaretPosition,inSameBlock;return!range.collapsed&&(node=getSelectedNode(range),isContentEditableFalse(node))?CefUtils.showCaret(direction,editor,node,-1===direction):(rangeIsInContainerBlock=function(range){return CaretContainer.isCaretContainerBlock(range.startContainer)}(range),isBeforeContentEditableFalseFn(caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range))?CefUtils.selectNode(editor,caretPosition.getNode(-1===direction)):(caretPosition=getNextPosFn(caretPosition))?isBeforeContentEditableFalseFn(caretPosition)?CefUtils.showCaret(direction,editor,caretPosition.getNode(-1===direction),1===direction):isBeforeContentEditableFalseFn(peekCaretPosition=getNextPosFn(caretPosition))&&(fromCaretPosition=caretPosition,toCaretPosition=peekCaretPosition,!(inSameBlock=CaretUtils.isInSameBlock(fromCaretPosition,toCaretPosition))&&NodeType.isBr(fromCaretPosition.getNode())||inSameBlock)?CefUtils.showCaret(direction,editor,peekCaretPosition.getNode(-1===direction),1===direction):rangeIsInContainerBlock?CefUtils.renderRangeCaret(editor,caretPosition.toRange()):null:rangeIsInContainerBlock?range:null)},exitPreBlock=function(editor,direction,range){var pre,newBlock,caretWalker=new CaretWalker(editor.getBody()),getNextVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.next),getPrevVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.prev);if(range.collapsed&&editor.settings.forced_root_block){if(!(pre=editor.dom.getParent(range.startContainer,"PRE")))return;(1===direction?getNextVisualCaretPosition(CaretPosition.fromRangeStart(range)):getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range)))||(newBlock=function(editor){var textBlock=editor.dom.create(editor.settings.forced_root_block);return(!Env.ie||11<=Env.ie)&&(textBlock.innerHTML='<br data-mce-bogus="1">'),textBlock}(editor),1===direction?editor.$(pre).after(newBlock):editor.$(pre).before(newBlock),editor.selection.select(newBlock,!0),editor.selection.collapse())}},getVerticalRange=function(editor,down){var newRange,direction=down?1:-1,walkerFn=down?LineWalker.downUntil:LineWalker.upUntil,range=editor.selection.getRng();return(newRange=function(direction,editor,walkerFn,range){var caretPosition,linePositions,nextLinePositions,closestNextLineRect,caretClientRect,clientX,dist1,dist2,contentEditableFalseNode;if(contentEditableFalseNode=getSelectedNode(range),caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),linePositions=walkerFn(editor.getBody(),LineWalker.isAboveLine(1),caretPosition),nextLinePositions=Arr.filter(linePositions,LineWalker.isLine(1)),caretClientRect=Arr.last(caretPosition.getClientRects()),isBeforeContentEditableFalse(caretPosition)&&(contentEditableFalseNode=caretPosition.getNode()),isAfterContentEditableFalse(caretPosition)&&(contentEditableFalseNode=caretPosition.getNode(!0)),!caretClientRect)return null;if(clientX=caretClientRect.left,(closestNextLineRect=LineUtils.findClosestClientRect(nextLinePositions,clientX))&&isContentEditableFalse(closestNextLineRect.node))return dist1=Math.abs(clientX-closestNextLineRect.left),dist2=Math.abs(clientX-closestNextLineRect.right),CefUtils.showCaret(direction,editor,closestNextLineRect.node,dist1<dist2);if(contentEditableFalseNode){var caretPositions=LineWalker.positionsUntil(direction,editor.getBody(),LineWalker.isAboveLine(1),contentEditableFalseNode);if(closestNextLineRect=LineUtils.findClosestClientRect(Arr.filter(caretPositions,LineWalker.isLine(1)),clientX))return CefUtils.renderRangeCaret(editor,closestNextLineRect.position.toRange());if(closestNextLineRect=Arr.last(Arr.filter(caretPositions,LineWalker.isLine(0))))return CefUtils.renderRangeCaret(editor,closestNextLineRect.position.toRange())}}(direction,editor,walkerFn,range))?newRange:(newRange=exitPreBlock(editor,direction,range))||null};return{moveH:function(editor,forward){return function(){var newRng=function(editor,forward){var newRange,caretWalker=new CaretWalker(editor.getBody()),getNextVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.next),getPrevVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.prev),direction=forward?1:-1,getNextPosFn=forward?getNextVisualCaretPosition:getPrevVisualCaretPosition,isBeforeContentEditableFalseFn=forward?isBeforeContentEditableFalse:isAfterContentEditableFalse,range=editor.selection.getRng();return(newRange=moveToCeFalseHorizontally(direction,editor,getNextPosFn,isBeforeContentEditableFalseFn,range))?newRange:(newRange=exitPreBlock(editor,direction,range))||null}(editor,forward);return!!newRng&&(editor.selection.setRng(newRng),!0)}},moveV:function(editor,down){return function(){var newRng=getVerticalRange(editor,down);return!!newRng&&(editor.selection.setRng(newRng),!0)}}}}),define("ephox.katamari.api.Merger",["ephox.katamari.api.Type","global!Array","global!Error"],function(Type,Array,Error){var baseMerge=function(merger){return function(){for(var objects=new Array(arguments.length),i=0;i<objects.length;i++)objects[i]=arguments[i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)curObject.hasOwnProperty(key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}},deepMerge=baseMerge(function(old,nu){return Type.isObject(old)&&Type.isObject(nu)?deepMerge(old,nu):nu}),merge=baseMerge(function(old,nu){return nu});return{deepMerge:deepMerge,merge:merge}}),define("tinymce.core.keyboard.MatchKeys",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","ephox.katamari.api.Merger"],function(Arr,Fun,Merger){return{match:function(patterns,evt){return Arr.bind(function(patterns){return Arr.map(patterns,function(pattern){return Merger.merge({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:Fun.noop},pattern)})}(patterns),function(pattern){return function(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey}(pattern,evt)?[pattern]:[]})},action:function(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}}}}),define("tinymce.core.keyboard.ArrowKeys",["ephox.katamari.api.Arr","ephox.katamari.api.Cell","tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.CefNavigation","tinymce.core.keyboard.MatchKeys","tinymce.core.util.VK"],function(Arr,Cell,BoundarySelection,CefNavigation,MatchKeys,VK){return{setup:function(editor,caret){editor.on("keydown",function(evt){var matches=MatchKeys.match([{keyCode:VK.RIGHT,action:CefNavigation.moveH(editor,!0)},{keyCode:VK.LEFT,action:CefNavigation.moveH(editor,!1)},{keyCode:VK.UP,action:CefNavigation.moveV(editor,!1)},{keyCode:VK.DOWN,action:CefNavigation.moveV(editor,!0)},{keyCode:VK.RIGHT,action:BoundarySelection.move(editor,caret,!0)},{keyCode:VK.LEFT,action:BoundarySelection.move(editor,caret,!1)}],evt);Arr.find(matches,function(pattern){return pattern.action()}).each(function(_){evt.preventDefault()})})}}}),define("tinymce.core.keyboard.DeleteBackspaceKeys",["ephox.katamari.api.Arr","tinymce.core.delete.BlockBoundaryDelete","tinymce.core.delete.BlockRangeDelete","tinymce.core.delete.CefDelete","tinymce.core.delete.InlineBoundaryDelete","tinymce.core.keyboard.MatchKeys","tinymce.core.util.VK"],function(Arr,BlockBoundaryDelete,BlockRangeDelete,CefDelete,InlineBoundaryDelete,MatchKeys,VK){return{setup:function(editor,caret){!function(editor,caret){editor.on("keydown",function(evt){var matches=MatchKeys.match([{keyCode:VK.BACKSPACE,action:MatchKeys.action(InlineBoundaryDelete.backspaceDelete,editor,caret,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(InlineBoundaryDelete.backspaceDelete,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(CefDelete.backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(CefDelete.backspaceDelete,editor,!0)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(BlockRangeDelete.backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(BlockRangeDelete.backspaceDelete,editor,!0)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(BlockBoundaryDelete.backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:MatchKeys.action(BlockBoundaryDelete.backspaceDelete,editor,!0)}],evt);Arr.find(matches,function(pattern){return pattern.action()}).each(function(_){evt.preventDefault()})})}(editor,caret),function(editor){editor.on("keyup",function(evt){var matches=MatchKeys.match([{keyCode:VK.BACKSPACE,action:MatchKeys.action(CefDelete.paddEmptyElement,editor)},{keyCode:VK.DELETE,action:MatchKeys.action(CefDelete.paddEmptyElement,editor)}],evt);Arr.find(matches,function(pattern){return pattern.action()})})}(editor)}}}),define("tinymce.core.keyboard.EnterKey",["tinymce.core.caret.CaretContainer","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.Env","tinymce.core.text.Zwsp","tinymce.core.util.Tools"],function(CaretContainer,NodeType,RangeUtils,TreeWalker,Env,Zwsp,Tools){var isIE=Env.ie&&Env.ie<11,emptyBlock=function(elm){elm.innerHTML=isIE?"":'<br data-mce-bogus="1">'},containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName},canSplitBlock=function(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)},renderBlockOnIE=function(dom,selection,block){var oldRng;dom.isBlock(block)&&(oldRng=selection.getRng(),block.appendChild(dom.create("span",null," ")),selection.select(block),block.lastChild.outerHTML="",selection.setRng(oldRng))},normalizeZwspOffset=function(start,container,offset){return!1===NodeType.isText(container)?offset:start?1===offset&&container.data.charAt(offset-1)===Zwsp.ZWSP?0:offset:offset===container.data.length-1&&container.data.charAt(offset)===Zwsp.ZWSP?container.data.length:offset};return{setup:function(editor){var dom=editor.dom,selection=editor.selection,settings=editor.settings,undoManager=editor.undoManager,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),moveCaretBeforeOnEnterElementsMap=schema.getMoveCaretBeforeOnEnterElements();function handleEnterKey(evt){var rng,tmpRng,editableRoot,container,offset,parentBlock,documentMode,shiftKey,newBlock,fragment,containerBlock,parentBlockName,containerBlockName,newBlockName,isAfterLastNodeInContainer;function moveToCaretPosition(root){var walker,node,rng,tempElm,lastNode=root;if(root){if(Env.ie&&Env.ie<9&&parentBlock&&parentBlock.firstChild&&parentBlock.firstChild==parentBlock.lastChild&&"BR"==parentBlock.firstChild.tagName&&dom.remove(parentBlock.firstChild),/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=function(node){for(;node;){if(1===node.nodeType||3===node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}}(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(" "),root.firstChild)}if(rng=dom.createRng(),Env.ie||root.normalize(),root.hasChildNodes()){for(walker=new TreeWalker(root,root);node=walker.current();){if(3==node.nodeType){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else"BR"==root.nodeName?root.nextSibling&&dom.isBlock(root.nextSibling)?((!documentMode||documentMode<9)&&(tempElm=dom.create("br"),root.parentNode.insertBefore(tempElm,root)),rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));selection.setRng(rng),dom.remove(tempElm),selection.scrollIntoView(root)}}function setForcedBlockAttrs(node){var forcedRootBlockName=settings.forced_root_block;forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()&&dom.setAttribs(node,settings.forced_root_block_attrs)}function createNewBlock(name){var block,clonedNode,caretNode,node=container,textInlineElements=schema.getTextInlineElements();if(name||"TABLE"==parentBlockName||"HR"==parentBlockName?setForcedBlockAttrs(block=dom.create(name||newBlockName)):block=parentBlock.cloneNode(!1),caretNode=block,!1===settings.keep_styles)dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);else do{if(textInlineElements[node.nodeName]){if("_mce_caret"==node.id)continue;clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?clonedNode.appendChild(block.firstChild):caretNode=clonedNode,block.appendChild(clonedNode)}}while((node=node.parentNode)&&node!=editableRoot);return isIE||(caretNode.innerHTML='<br data-mce-bogus="1">'),block}function isCaretAtStartOrEndOfBlock(start){var walker,node,name,normalizedOffset;if(normalizedOffset=normalizeZwspOffset(start,container,offset),3==container.nodeType&&(start?0<normalizedOffset:normalizedOffset<container.nodeValue.length))return!1;if(container.parentNode==parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&1==container.nodeType&&container==parentBlock.firstChild)return!0;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;for(walker=new TreeWalker(container,parentBlock),3==container.nodeType&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!=container.nodeValue.length||walker.next());node=walker.current();){if(1===node.nodeType){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return!1}else if(3===node.nodeType&&!/^[ \t\r\n]*$/.test(node.nodeValue))return!1;start?walker.prev():walker.next()}return!0}function insertBr(){editor.execCommand("InsertLineBreak",!1,evt)}function insertNewBlockAfter(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!=containerBlockName?createNewBlock(newBlockName):createNewBlock(),settings.end_container_on_empty_block&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(newBlock)}if(rng=selection.getRng(!0),!evt.isDefaultPrevented())if(rng.collapsed){if(new RangeUtils(dom).normalize(rng),container=rng.startContainer,offset=rng.startOffset,newBlockName=(newBlockName=(settings.force_p_newlines?"p":"")||settings.forced_root_block)?newBlockName.toUpperCase():"",documentMode=dom.doc.documentMode,shiftKey=evt.shiftKey,1==container.nodeType&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3==container.nodeType?container.nodeValue.length:0),editableRoot=function getEditableRoot(node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root}(container))if(undoManager.beforeChange(),dom.isBlock(editableRoot)||editableRoot==dom.getRoot()){if((newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=function wrapSelfAndSiblingsInDefaultBlock(container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P";if(!(parentBlock=dom.getParent(container,dom.isBlock))||!canSplitBlock(dom,parentBlock)){if(rootBlockName=(parentBlock=parentBlock||editableRoot)==editor.getBody()||function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}(parentBlock)?parentBlock.nodeName.toLowerCase():parentBlock.parentNode.nodeName.toLowerCase(),!parentBlock.hasChildNodes())return setForcedBlockAttrs(newBlock=dom.create(blockName)),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!=parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)node=(startNode=node).previousSibling;if(startNode&&schema.isValidChild(rootBlockName,blockName.toLowerCase())){for(setForcedBlockAttrs(newBlock=dom.create(blockName)),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container}(container,offset)),parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"","LI"!=(containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"")||evt.ctrlKey||(parentBlock=containerBlock,parentBlockName=containerBlockName),editor.undoManager.typing&&(editor.undoManager.typing=!1,editor.undoManager.add()),/^(LI|DT|DD)$/.test(parentBlockName)){if(!newBlockName&&shiftKey)return void insertBr();if(dom.isEmpty(parentBlock))return void function handleEmptyListItem(){function isFirstOrLastLi(first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&1!=node.nodeType;)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock}function getContainerBlock(){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock}if(containerBlock!=editor.getBody()){var containerBlockParentName=containerBlock.parentNode.nodeName;/^(OL|UL|LI)$/.test(containerBlockParentName)&&(newBlockName="LI"),newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR"),isFirstOrLastLi(!0)&&isFirstOrLastLi()?"LI"==containerBlockParentName?dom.insertAfter(newBlock,getContainerBlock()):dom.replace(newBlock,containerBlock):isFirstOrLastLi(!0)?"LI"==containerBlockParentName?(dom.insertAfter(newBlock,getContainerBlock()),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(newBlock,containerBlock):isFirstOrLastLi()?(dom.insertAfter(newBlock,getContainerBlock()),renderBlockOnIE(dom,selection,newBlock)):(containerBlock=getContainerBlock(),(tmpRng=rng.cloneRange()).setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock),fragment=tmpRng.extractContents(),"LI"==newBlockName&&"LI"==fragment.firstChild.nodeName?(newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock)):(dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock))),dom.remove(parentBlock),moveToCaretPosition(newBlock),undoManager.add()}}()}if("PRE"==parentBlockName&&!1!==settings.br_in_pre){if(!shiftKey)return void insertBr()}else if(!newBlockName&&!shiftKey&&"LI"!=parentBlockName||newBlockName&&shiftKey)return void insertBr();newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",CaretContainer.isCaretContainerBlock(parentBlock)?(newBlock=CaretContainer.showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),moveToCaretPosition(newBlock)):isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),renderBlockOnIE(dom,selection,newBlock),containerAndSiblingName(parentBlock,"HR")?moveToCaretPosition(newBlock):moveToCaretPosition(parentBlock)):((tmpRng=function(rng){var newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng}(rng).cloneRange()).setEndAfter(parentBlock),function trimLeadingLineBreaks(node){for(;3===node.nodeType&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild;);}(fragment=tmpRng.extractContents()),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),function(dom,nonEmptyElementsMap,block){var i,node=block,firstChilds=[];if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;1!=node.nodeType||nonEmptyElementsMap[node.nodeName.toLowerCase()]||firstChilds.push(node)}for(i=firstChilds.length;i--;)!(node=firstChilds[i]).hasChildNodes()||node.firstChild==node.lastChild&&""===node.firstChild.nodeValue?dom.remove(node):(elm=node)&&"A"===elm.nodeName&&0===Tools.trim(Zwsp.trim(elm.innerText||elm.textContent)).length&&dom.remove(node);var elm}}(dom,nonEmptyElementsMap,newBlock),function addBrToBlockIfNeeded(block){var lastChild;isIE||(block.normalize(),(lastChild=block.lastChild)&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br"))}(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):moveToCaretPosition(newBlock)),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock:newBlock}),undoManager.typing=!1,undoManager.add())}else newBlockName&&!shiftKey||insertBr()}else editor.execCommand("Delete")}editor.on("keydown",function(evt){13==evt.keyCode&&!1!==handleEnterKey(evt)&&evt.preventDefault()})}}}),define("tinymce.core.keyboard.InsertSpace",["ephox.katamari.api.Fun","tinymce.core.caret.CaretPosition","tinymce.core.dom.NodeType","tinymce.core.keyboard.BoundaryLocation"],function(Fun,CaretPosition,NodeType,BoundaryLocation){var insertAtLocation=function(editor,caretPosition,location){return!!function(location,caretPosition){return isAtStartOrEnd(location)&&NodeType.isText(caretPosition.container())}(location,caretPosition)&&(function(editor,caretPosition){var container=caretPosition.container(),offset=caretPosition.offset();container.insertData(offset," "),editor.selection.setCursorLocation(container,offset+1)}(editor,caretPosition),!0)},isAtStartOrEnd=function(location){return location.fold(Fun.constant(!1),Fun.constant(!0),Fun.constant(!0),Fun.constant(!1))};return{insertAtSelection:function(editor){return!!editor.selection.isCollapsed()&&function(editor){var caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return BoundaryLocation.readLocation(editor.getBody(),caretPosition).map(Fun.curry(insertAtLocation,editor,caretPosition)).getOr(!1)}(editor)}}}),define("tinymce.core.keyboard.SpaceKey",["ephox.katamari.api.Arr","tinymce.core.keyboard.InsertSpace","tinymce.core.keyboard.MatchKeys","tinymce.core.util.VK"],function(Arr,InsertSpace,MatchKeys,VK){return{setup:function(editor){!function(editor){editor.on("keydown",function(evt){var matches=MatchKeys.match([{keyCode:VK.SPACEBAR,action:MatchKeys.action(InsertSpace.insertAtSelection,editor)}],evt);Arr.find(matches,function(pattern){return pattern.action()}).each(function(_){evt.preventDefault()})})}(editor)}}}),define("tinymce.core.keyboard.KeyboardOverrides",["tinymce.core.keyboard.ArrowKeys","tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.DeleteBackspaceKeys","tinymce.core.keyboard.EnterKey","tinymce.core.keyboard.SpaceKey"],function(ArrowKeys,BoundarySelection,DeleteBackspaceKeys,EnterKey,SpaceKey){return{setup:function(editor){var caret=BoundarySelection.setupSelectedState(editor);ArrowKeys.setup(editor,caret),DeleteBackspaceKeys.setup(editor,caret),EnterKey.setup(editor),SpaceKey.setup(editor)}}}),define("tinymce.core.NodeChange",["tinymce.core.dom.RangeUtils","tinymce.core.Env","tinymce.core.util.Delay"],function(RangeUtils,Env,Delay){return function(editor){var lastRng,lastPath=[];"onselectionchange"in editor.getDoc()||editor.on("NodeChange Click MouseUp KeyUp Focus",function(e){var nativeRng,fakeRng;fakeRng={startContainer:(nativeRng=editor.selection.getRng()).startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset},"nodechange"!=e.type&&RangeUtils.compareRanges(fakeRng,lastRng)||editor.fire("SelectionChange"),lastRng=fakeRng}),editor.on("contextmenu",function(){editor.fire("SelectionChange")}),editor.on("SelectionChange",function(){var startElm=editor.selection.getStart(!0);!Env.range&&editor.selection.isCollapsed()||!function isSameElementPath(startElm){var i,currentPath;if((currentPath=editor.$(startElm).parentsUntil(editor.getBody()).add(startElm)).length===lastPath.length){for(i=currentPath.length;0<=i&&currentPath[i]===lastPath[i];i--);if(-1===i)return lastPath=currentPath,!0}return lastPath=currentPath,!1}(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})}),editor.on("MouseUp",function(e){e.isDefaultPrevented()||("IMG"==editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,function(){editor.nodeChanged()}):editor.nodeChanged())}),this.nodeChanged=function(args){var node,parents,root,selection=editor.selection;editor.initialized&&selection&&!editor.settings.disable_nodechange&&!editor.readonly&&(root=editor.getBody(),(node=selection.getStart(!0)||root).ownerDocument==editor.getDoc()&&editor.dom.isChildOf(node,root)||(node=root),parents=[],editor.dom.getParent(node,function(node){if(node===root)return!0;parents.push(node)}),(args=args||{}).element=node,args.parents=parents,editor.fire("NodeChange",args))}}}),define("tinymce.core.caret.FakeCaret",["tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretContainerRemove","tinymce.core.caret.CaretPosition","tinymce.core.dom.DomQuery","tinymce.core.dom.NodeType","tinymce.core.dom.RangeUtils","tinymce.core.geom.ClientRect","tinymce.core.util.Delay"],function(CaretContainer,CaretContainerRemove,CaretPosition,DomQuery,NodeType,RangeUtils,ClientRect,Delay){var isContentEditableFalse=NodeType.isContentEditableFalse;return function(rootNode,isBlock){var cursorInterval,$lastVisualCaret,caretContainerNode;function hide(){!function trimInlineCaretContainers(){var contentEditableFalseNodes,node,sibling,i,data;for(contentEditableFalseNodes=DomQuery("*[contentEditable=false]",rootNode),i=0;i<contentEditableFalseNodes.length;i++)sibling=(node=contentEditableFalseNodes[i]).previousSibling,CaretContainer.endsWithCaretContainer(sibling)&&(1==(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1)),sibling=node.nextSibling,CaretContainer.startsWithCaretContainer(sibling)&&(1==(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1));return null}(),caretContainerNode&&(CaretContainerRemove.remove(caretContainerNode),caretContainerNode=null),$lastVisualCaret&&($lastVisualCaret.remove(),$lastVisualCaret=null),clearInterval(cursorInterval)}return{show:function show(before,node){var clientRect,rng;return hide(),function(node){return node&&/^(TD|TH)$/i.test(node.nodeName)}(node)?null:(isBlock(node)?(caretContainerNode=CaretContainer.insertBlock("p",node,before),clientRect=function getAbsoluteClientRect(node,before){var docElm,scrollX,scrollY,margin,rootRect,clientRect=ClientRect.collapse(node.getBoundingClientRect(),before);return scrollY="BODY"==rootNode.tagName?(docElm=rootNode.ownerDocument.documentElement,scrollX=rootNode.scrollLeft||docElm.scrollLeft,rootNode.scrollTop||docElm.scrollTop):(rootRect=rootNode.getBoundingClientRect(),scrollX=rootNode.scrollLeft-rootRect.left,rootNode.scrollTop-rootRect.top),clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1,0<(margin=node.offsetWidth-node.clientWidth)&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect}(node,before),DomQuery(caretContainerNode).css("top",clientRect.top),$lastVisualCaret=DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(clientRect).appendTo(rootNode),before&&$lastVisualCaret.addClass("mce-visual-caret-before"),function startBlink(){cursorInterval=Delay.setInterval(function(){DomQuery("div.mce-visual-caret",rootNode).toggleClass("mce-visual-caret-hidden")},500)}(),(rng=node.ownerDocument.createRange()).setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(caretContainerNode=CaretContainer.insertInline(node,before),rng=node.ownerDocument.createRange(),isContentEditableFalse(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1))),rng)},hide:hide,getCss:function getCss(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},destroy:function destroy(){Delay.clearInterval(cursorInterval)}}}}),define("tinymce.core.dom.MousePosition",[],function(){var getAbsolutePosition=function(elm){var doc,docElem,win,clientRect;return clientRect=elm.getBoundingClientRect(),docElem=(doc=elm.ownerDocument).documentElement,win=doc.defaultView,{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft}};return{calc:function(editor,event){return bodyPosition=function(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0}}(editor),scrollPosition=function(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}}(editor),{pageX:(mousePosition=function(editor,event){if(event.target.ownerDocument===editor.getDoc())return{left:event.pageX,top:event.pageY};var iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),scrollPosition=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll}(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top}}(editor,event)).left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top};var bodyPosition,scrollPosition,mousePosition}}}),define("tinymce.core.DragDropOverrides",["tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Delay","tinymce.core.dom.DOMUtils","tinymce.core.dom.MousePosition"],function(NodeType,Arr,Fun,Delay,DOMUtils,MousePosition){var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue,removeElement=function(elm){elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},start=function(state,editor){return function(e){if(function(e){return 0===e.button}(e)){var ceElm=Arr.find(editor.dom.getParents(e.target),Fun.or(isContentEditableFalse,isContentEditableTrue));if(rootElm=editor.getBody(),isContentEditableFalse(elm=ceElm)&&elm!==rootElm){var elmPos=editor.dom.getPos(ceElm),bodyElm=editor.getBody(),docElm=editor.getDoc().documentElement;state.element=ceElm,state.screenX=e.screenX,state.screenY=e.screenY,state.maxX=(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,state.maxY=(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,state.relX=e.pageX-elmPos.x,state.relY=e.pageY-elmPos.y,state.width=ceElm.offsetWidth,state.height=ceElm.offsetHeight,state.ghost=function(editor,elm,width,height){var clonedElm=elm.cloneNode(!0);editor.dom.setStyles(clonedElm,{width:width,height:height}),editor.dom.setAttrib(clonedElm,"data-mce-selected",null);var ghostElm=editor.dom.create("div",{"class":"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return editor.dom.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:width,height:height}),editor.dom.setStyles(clonedElm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(clonedElm),ghostElm}(editor,ceElm,state.width,state.height)}}var rootElm,elm}},move=function(state,editor){var throttledPlaceCaretAt=Delay.throttle(function(clientX,clientY){editor._selectionOverrides.hideFakeCaret(),editor.selection.placeCaretAt(clientX,clientY)},0);return function(e){var ghostElm,bodyElm,movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(function(state){return state.element}(state)&&!state.dragging&&10<movement){if(editor.fire("dragstart",{target:state.element}).isDefaultPrevented())return;state.dragging=!0,editor.focus()}if(state.dragging){var targetPos=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5}}(state,MousePosition.calc(editor,e));ghostElm=state.ghost,bodyElm=editor.getBody(),ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm),function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px"}(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY),throttledPlaceCaretAt(e.clientX,e.clientY)}}},drop=function(state,editor){return function(e){if(state.dragging&&function(editor,targetElement,dragElement){return targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&!isContentEditableFalse(targetElement)}(editor,(selection=editor.selection,3===(startContainer=selection.getSel().getRangeAt(0).startContainer).nodeType?startContainer.parentNode:startContainer),state.element)){var targetClone=(elm=state.element,(cloneElm=elm.cloneNode(!0)).removeAttribute("data-mce-selected"),cloneElm),args=editor.fire("drop",{targetClone:targetClone,clientX:e.clientX,clientY:e.clientY});args.isDefaultPrevented()||(targetClone=args.targetClone,editor.undoManager.transact(function(){removeElement(state.element),editor.insertContent(editor.dom.getOuterHTML(targetClone)),editor._selectionOverrides.hideFakeCaret()}))}var elm,cloneElm,selection,startContainer;removeDragState(state)}},removeDragState=function(state){state.dragging=!1,state.element=null,removeElement(state.ghost)},bindFakeDragEvents=function(editor){var pageDom,dragStartHandler,dragHandler,dropHandler,dragEndHandler,rootDocument,state={};pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start(state,editor),dragHandler=move(state,editor),dropHandler=drop(state,editor),dragEndHandler=function(state,editor){return function(){removeDragState(state),state.dragging&&editor.fire("dragend")}}(state,editor),editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",function(){pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)})};return{init:function(editor){bindFakeDragEvents(editor),function(editor){editor.on("drop",function(e){var realTarget="undefined"!=typeof e.clientX?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;(isContentEditableFalse(realTarget)||isContentEditableFalse(editor.dom.getContentEditableParent(realTarget)))&&e.preventDefault()})}(editor)}}}),define("tinymce.core.SelectionOverrides",["tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.FakeCaret","tinymce.core.caret.LineUtils","tinymce.core.dom.NodeType","tinymce.core.DragDropOverrides","tinymce.core.Env","tinymce.core.geom.ClientRect","tinymce.core.keyboard.CefUtils","tinymce.core.util.Arr","tinymce.core.util.Delay","tinymce.core.util.Fun","tinymce.core.util.VK"],function(CaretContainer,CaretPosition,CaretUtils,CaretWalker,FakeCaret,LineUtils,NodeType,DragDropOverrides,Env,ClientRect,CefUtils,Arr,Delay,Fun,VK){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse;return function SelectionOverrides(editor){var selectedContentEditableNode,rootNode=editor.getBody(),fakeCaret=new FakeCaret(editor.getBody(),function isBlock(node){return editor.dom.isBlock(node)}),realSelectionId="sel-"+editor.dom.uniqueId();function setRange(range){range&&editor.selection.setRng(range)}function getRange(){return editor.selection.getRng()}function scrollIntoView(node,alignToTop){editor.selection.scrollIntoView(node,alignToTop)}function showCaret(direction,node,before){return editor.fire("ShowCaret",{target:node,direction:direction,before:before}).isDefaultPrevented()?null:(scrollIntoView(node,-1===direction),fakeCaret.show(before,node))}function getNormalizedRangeEndPoint(direction,range){return range=CaretUtils.normalizeRange(direction,rootNode,range),-1==direction?CaretPosition.fromRangeStart(range):CaretPosition.fromRangeEnd(range)}function isWithinCaretContainer(node){return CaretContainer.isCaretContainer(node)||CaretContainer.startsWithCaretContainer(node)||CaretContainer.endsWithCaretContainer(node)}function isRangeInCaretContainer(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer)}function setContentEditableSelection(range,forward){var node,$realSelectionContainer,sel,startContainer,startOffset,endOffset,e,caretPosition,targetClone,origTargetClone,$=editor.$,dom=editor.dom;if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range))if(!1===forward){if(caretPosition=getNormalizedRangeEndPoint(-1,range),isContentEditableFalse(caretPosition.getNode(!0)))return showCaret(-1,caretPosition.getNode(!0),!1);if(isContentEditableFalse(caretPosition.getNode()))return showCaret(-1,caretPosition.getNode(),!caretPosition.isAtEnd())}else{if(caretPosition=getNormalizedRangeEndPoint(1,range),isContentEditableFalse(caretPosition.getNode()))return showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd());if(isContentEditableFalse(caretPosition.getNode(!0)))return showCaret(1,caretPosition.getNode(!0),!1)}return null}return startContainer=range.startContainer,startOffset=range.startOffset,endOffset=range.endOffset,3==startContainer.nodeType&&0==startOffset&&isContentEditableFalse(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1!=startContainer.nodeType?null:(endOffset==startOffset+1&&(node=startContainer.childNodes[startOffset]),isContentEditableFalse(node)?(targetClone=origTargetClone=node.cloneNode(!0),(e=editor.fire("ObjectSelected",{target:node,targetClone:targetClone})).isDefaultPrevented()?null:(targetClone=e.targetClone,0===($realSelectionContainer=$("#"+realSelectionId)).length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId)).appendTo(editor.getBody()),range=editor.dom.createRng(),targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all"> </p>').append(targetClone),range.setStartAfter($realSelectionContainer[0].firstChild.firstChild),range.setEndAfter(targetClone)):($realSelectionContainer.empty().append(" ").append(targetClone).append(" "),range.setStart($realSelectionContainer[0].firstChild,1),range.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),$realSelectionContainer[0].focus(),(sel=editor.selection.getSel()).removeAllRanges(),sel.addRange(range),editor.$("*[data-mce-selected]").removeAttr("data-mce-selected"),node.setAttribute("data-mce-selected",1),selectedContentEditableNode=node,hideFakeCaret(),range)):null)}function removeContentEditableSelection(){selectedContentEditableNode&&(selectedContentEditableNode.removeAttribute("data-mce-selected"),editor.$("#"+realSelectionId).remove(),selectedContentEditableNode=null)}function hideFakeCaret(){fakeCaret.hide()}return Env.ceFalse&&(function registerEvents(){function getContentEditableRoot(node){for(var root=editor.getBody();node&&node!=root;){if(isContentEditableTrue(node)||isContentEditableFalse(node))return node;node=node.parentNode}return null}editor.on("mouseup",function(){var range=getRange();range.collapsed&&setRange(CefUtils.renderCaretAtRange(editor,range))}),editor.on("click",function(e){var contentEditableRoot;(contentEditableRoot=getContentEditableRoot(e.target))&&(isContentEditableFalse(contentEditableRoot)&&(e.preventDefault(),editor.focus()),isContentEditableTrue(contentEditableRoot)&&editor.dom.isChildOf(contentEditableRoot,editor.selection.getNode())&&removeContentEditableSelection())}),editor.on("blur NewBlock",function(){removeContentEditableSelection(),hideFakeCaret()});var hasBetterMouseTarget=function(targetNode,caretNode){var node1,node2,targetBlock=editor.dom.getParent(targetNode,editor.dom.isBlock),caretBlock=editor.dom.getParent(caretNode,editor.dom.isBlock);return targetBlock&&(node1=targetBlock,node2=caretBlock,!(editor.dom.getParent(node1,editor.dom.isBlock)===editor.dom.getParent(node2,editor.dom.isBlock)))&&function(elm){var caretWalker=new CaretWalker(elm);if(!elm.firstChild)return!1;var startPos=CaretPosition.before(elm.firstChild),newPos=caretWalker.next(startPos);return newPos&&!isBeforeContentEditableFalse(newPos)&&!isAfterContentEditableFalse(newPos)}(targetBlock)};!function handleTouchSelect(editor){var moved=!1;editor.on("touchstart",function(){moved=!1}),editor.on("touchmove",function(){moved=!0}),editor.on("touchend",function(e){var contentEditableRoot=getContentEditableRoot(e.target);isContentEditableFalse(contentEditableRoot)&&(moved||(e.preventDefault(),setContentEditableSelection(CefUtils.selectNode(editor,contentEditableRoot))))})}(editor),editor.on("mousedown",function(e){var contentEditableRoot;if(contentEditableRoot=getContentEditableRoot(e.target))isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),setContentEditableSelection(CefUtils.selectNode(editor,contentEditableRoot))):(removeContentEditableSelection(),isContentEditableTrue(contentEditableRoot)&&e.shiftKey||function isXYWithinRange(clientX,clientY,range){return!range.collapsed&&Arr.reduce(range.getClientRects(),function(state,rect){return state||ClientRect.containsXY(rect,clientX,clientY)},!1)}(e.clientX,e.clientY,editor.selection.getRng())||editor.selection.placeCaretAt(e.clientX,e.clientY));else{removeContentEditableSelection(),hideFakeCaret();var caretInfo=LineUtils.closestCaret(rootNode,e.clientX,e.clientY);caretInfo&&(hasBetterMouseTarget(e.target,caretInfo.node)||(e.preventDefault(),editor.getBody().focus(),setRange(showCaret(1,caretInfo.node,caretInfo.before))))}}),editor.on("keydown",function(e){VK.modifierPressed(e)||(e.keyCode,isContentEditableFalse(editor.selection.getNode())&&function(e){return!(112<=e.keyCode&&e.keyCode<=123)}(e)&&e.preventDefault())}),editor.on("getSelectionRange",function(e){var rng=e.range;if(selectedContentEditableNode){if(!selectedContentEditableNode.parentNode)return void(selectedContentEditableNode=null);(rng=rng.cloneRange()).selectNode(selectedContentEditableNode),e.range=rng}}),editor.on("setSelectionRange",function(e){var rng;(rng=setContentEditableSelection(e.range,e.forward))&&(e.range=rng)}),editor.on("AfterSetSelectionRange",function(e){var rng=e.range;isRangeInCaretContainer(rng)||hideFakeCaret(),function isFakeSelectionElement(elm){return editor.dom.hasClass(elm,"mce-offscreen-selection")}(rng.startContainer.parentNode)||removeContentEditableSelection()}),editor.on("focus",function(){Delay.setEditorTimeout(editor,function(){editor.selection.setRng(CefUtils.renderRangeCaret(editor,editor.selection.getRng()))},0)}),editor.on("copy",function(e){var clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&&e.clipboardData&&!Env.ie){var realSelectionElement=function getRealSelectionElement(){var container=editor.dom.get(realSelectionId);return container?container.getElementsByTagName("*")[0]:container}();realSelectionElement&&(e.preventDefault(),clipboardData.clearData(),clipboardData.setData("text/html",realSelectionElement.outerHTML),clipboardData.setData("text/plain",realSelectionElement.outerText))}}),DragDropOverrides.init(editor)}(),function addCss(){var styles=editor.contentStyles;styles.push(fakeCaret.getCss()),styles.push(".mce-content-body .mce-offscreen-selection {position: absolute;left: -9999999999px;max-width: 1000000px;}.mce-content-body *[contentEditable=false] {cursor: default;}.mce-content-body *[contentEditable=true] {cursor: text;}")}()),{showCaret:showCaret,showBlockCaretContainer:function showBlockCaretContainer(blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(CaretContainer.showCaretContainerBlock(blockCaretContainer),setRange(getRange()),scrollIntoView(blockCaretContainer[0]))},hideFakeCaret:hideFakeCaret,destroy:function destroy(){fakeCaret.destroy(),selectedContentEditableNode=null}}}}),define("tinymce.core.dom.NodePath",["tinymce.core.dom.DOMUtils"],function(DOMUtils){return{create:function create(rootNode,targetNode,normalized){for(var path=[];targetNode&&targetNode!=rootNode;targetNode=targetNode.parentNode)path.push(DOMUtils.nodeIndex(targetNode,normalized));return path},resolve:function resolve(rootNode,path){var i,node,children;for(node=rootNode,i=path.length-1;0<=i;i--){if(children=node.childNodes,path[i]>children.length-1)return null;node=children[path[i]]}return node}}}),define("tinymce.core.util.Quirks",["tinymce.core.util.VK","tinymce.core.dom.RangeUtils","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodePath","tinymce.core.html.Node","tinymce.core.html.Entities","tinymce.core.Env","tinymce.core.util.Tools","tinymce.core.util.Delay","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretWalker"],function(VK,RangeUtils,TreeWalker,NodePath,Node,Entities,Env,Tools,Delay,CaretContainer,CaretPosition,CaretWalker){return function(editor){var each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,settings=editor.settings,parser=editor.parser,serializer=editor.serializer,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalUrlPrefix="data:text/mce-internal,",mceInternalDataType=isIE?"Text":"URL";function setEditorCommandState(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}}function getDocumentMode(){var documentMode=editor.getDoc().documentMode;return documentMode||6}function isDefaultPrevented(e){return e.isDefaultPrevented()}function selectAll(){editor.shortcuts.add("meta+a",null,"SelectAll")}function removeHrOnBackspace(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng(!0).startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"==node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}})}function disableBackspaceIntoATable(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng(!0).startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}})}function bodyHeight(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",function(e){var rng;if("HTML"==e.target.nodeName){if(11<Env.ie)return void editor.getBody().focus();rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged()}}))}function refreshContentEditable(){}function emptyEditorOnDeleteEverything(){function isEverythingSelected(editor){var caretWalker=new CaretWalker(editor.getBody()),rng=editor.selection.getRng(),startCaretPos=CaretPosition.fromRangeStart(rng),endCaretPos=CaretPosition.fromRangeEnd(rng),prev=caretWalker.prev(startCaretPos),next=caretWalker.next(endCaretPos);return!editor.selection.isCollapsed()&&(!prev||prev.isAtStart()&&startCaretPos.isEqual(prev))&&(!next||next.isAtEnd()&&startCaretPos.isEqual(next))}editor.on("keypress",function(e){!isDefaultPrevented(e)&&!selection.isCollapsed()&&31<e.charCode&&!VK.metaKeyPressed(e)&&isEverythingSelected(editor)&&(e.preventDefault(),editor.setContent(String.fromCharCode(e.charCode)),editor.selection.select(editor.getBody(),!0),editor.selection.collapse(!1),editor.nodeChanged())}),editor.on("keydown",function(e){var keyCode=e.keyCode;isDefaultPrevented(e)||keyCode!=DELETE&&keyCode!=BACKSPACE||isEverythingSelected(editor)&&(e.preventDefault(),editor.setContent(""),editor.nodeChanged())})}return function removeBlockQuoteOnBackSpace(){editor.on("keydown",function(e){var rng,container,offset,root,parent;if(!isDefaultPrevented(e)&&e.keyCode==VK.BACKSPACE&&(container=(rng=selection.getRng()).startContainer,offset=rng.startOffset,root=dom.getRoot(),parent=container,rng.collapsed&&0===offset)){for(;parent&&parent.parentNode&&parent.parentNode.firstChild==parent&&parent.parentNode!=root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),(rng=dom.createRng()).setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}})}(),function emptyEditorWhenDeleting(){function serializeRng(rng){var body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})}editor.on("keydown",function(e){var isCollapsed,body,keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode==DELETE||keyCode==BACKSPACE)){if(isCollapsed=editor.selection.isCollapsed(),body=editor.getBody(),isCollapsed&&!dom.isEmpty(body))return;if(!isCollapsed&&!function allContentsSelected(rng){if(!rng.setStart){if(rng.item)return!1;var bodyRng=rng.duplicate();return bodyRng.moveToElementText(editor.getBody()),RangeUtils.compareRanges(rng,bodyRng)}var selection=serializeRng(rng),allRng=dom.createRng();return allRng.selectNode(editor.getBody()),selection===serializeRng(allRng)}(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}})}(),Env.windowsPhone||function normalizeSelection(){editor.on("keyup focusin mouseup",function(e){65==e.keyCode&&VK.metaKeyPressed(e)||selection.normalize()},!0)}(),isWebKit&&(emptyEditorOnDeleteEverything(),function inputMethodFocus(){editor.settings.content_editable||dom.bind(editor.getDoc(),"mousedown mouseup",function(e){var rng;if(e.target==editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"==e.type){if(CaretContainer.isCaretContainer(rng.startContainer))return;selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)})}(),function selectControlElements(){editor.on("click",function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"==target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))})}(),function setDefaultBlockType(){settings.forced_root_block&&editor.on("init",function(){setEditorCommandState("DefaultParagraphSeparator",settings.forced_root_block)})}(),function blockFormSubmitInsideEditor(){editor.on("init",function(){editor.dom.bind(editor.getBody(),"submit",function(e){e.preventDefault()})})}(),disableBackspaceIntoATable(),function removeAppleInterchangeBrs(){parser.addNodeFilter("br",function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"==nodes[i].attr("class")&&nodes[i].remove()})}(),Env.iOS?(function restoreFocusOnKeyDown(){editor.inline||editor.on("keydown",function(){document.activeElement==document.body&&editor.getWin().focus()})}(),bodyHeight(),function tapLinksAndImages(){editor.on("click",function(e){var elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)}),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")}()):selectAll()),isIE&&Env.ie<11&&(removeHrOnBackspace(),function ensureBodyHasRoleApplication(){document.body.setAttribute("role","application")}(),function addNewLinesBeforeBrInPre(){7<getDocumentMode()||(setEditorCommandState("RespectVisibilityInDesign",!0),editor.contentStyles.push(".mceHideBrInPre pre br {display: none}"),dom.addClass(editor.getBody(),"mceHideBrInPre"),parser.addNodeFilter("pre",function(nodes){for(var brNodes,j,brElm,sibling,i=nodes.length;i--;)for(j=(brNodes=nodes[i].getAll("br")).length;j--;)(sibling=(brElm=brNodes[j]).prev)&&3===sibling.type&&"\n"!=sibling.value.charAt(sibling.value-1)?sibling.value+="\n":brElm.parent.insert(new Node("#text",3),brElm,!0).value="\n"}),serializer.addNodeFilter("pre",function(nodes){for(var brNodes,j,sibling,i=nodes.length;i--;)for(j=(brNodes=nodes[i].getAll("br")).length;j--;)(sibling=brNodes[j].prev)&&3==sibling.type&&(sibling.value=sibling.value.replace(/\r?\n$/,""))}))}(),function removePreSerializedStylesWhenSelectingControls(){dom.bind(editor.getBody(),"mouseup",function(){var value,node=selection.getNode();"IMG"==node.nodeName&&((value=dom.getStyle(node,"width"))&&(dom.setAttrib(node,"width",value.replace(/[^0-9%]+/g,"")),dom.setStyle(node,"width","")),(value=dom.getStyle(node,"height"))&&(dom.setAttrib(node,"height",value.replace(/[^0-9%]+/g,"")),dom.setStyle(node,"height","")))})}(),function deleteControlItemOnBackSpace(){editor.on("keydown",function(e){var rng;isDefaultPrevented(e)||e.keyCode!=BACKSPACE||(rng=editor.getDoc().selection.createRange())&&rng.item&&(e.preventDefault(),editor.undoManager.beforeChange(),dom.remove(rng.item(0)),editor.undoManager.add())})}(),function renderEmptyBlocksFix(){var emptyBlocksCSS;10<=getDocumentMode()&&(emptyBlocksCSS="",each("p div h1 h2 h3 h4 h5 h6".split(" "),function(name,i){emptyBlocksCSS+=(0<i?",":"")+name+":empty"}),editor.contentStyles.push(emptyBlocksCSS+"{padding-right: 1px !important}"))}(),function keepNoScriptContents(){getDocumentMode()<9&&(parser.addNodeFilter("noscript",function(nodes){for(var node,textNode,i=nodes.length;i--;)(textNode=(node=nodes[i]).firstChild)&&node.attr("data-mce-innertext",textNode.value)}),serializer.addNodeFilter("noscript",function(nodes){for(var node,textNode,value,i=nodes.length;i--;)node=nodes[i],(textNode=nodes[i].firstChild)?textNode.value=Entities.decode(textNode.value):(value=node.attributes.map["data-mce-innertext"])&&(node.attr("data-mce-innertext",null),(textNode=new Node("#text",3)).value=value,textNode.raw=!0,node.append(textNode))}))}(),function fixCaretSelectionOfDocumentElementOnIe(){var started,startRng,htmlElm,doc=dom.doc,body=doc.body;function rngFromPoint(x,y){var rng=body.createTextRange();try{rng.moveToPoint(x,y)}catch(ex){rng=null}return rng}function selectionChange(e){var pointRng;e.button?(pointRng=rngFromPoint(e.x,e.y))&&(0<pointRng.compareEndPoints("StartToStart",startRng)?pointRng.setEndPoint("StartToStart",startRng):pointRng.setEndPoint("EndToEnd",startRng),pointRng.select()):endSelection()}function endSelection(){var rng=doc.selection.createRange();startRng&&!rng.item&&0===rng.compareEndPoints("StartToEnd",rng)&&startRng.select(),dom.unbind(doc,"mouseup",endSelection),dom.unbind(doc,"mousemove",selectionChange),startRng=started=0}doc.documentElement.unselectable=!0,dom.bind(doc,"mousedown contextmenu",function(e){if("HTML"===e.target.nodeName){if(started&&endSelection(),(htmlElm=doc.documentElement).scrollHeight>htmlElm.clientHeight)return;started=1,(startRng=rngFromPoint(e.x,e.y))&&(dom.bind(doc,"mouseup",endSelection),dom.bind(doc,"mousemove",selectionChange),dom.getRoot().focus(),startRng.select())}})}()),11<=Env.ie&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),function disableAutoUrlDetect(){setEditorCommandState("AutoUrlDetect",!1)}(),function ieInternalDragAndDrop(){editor.on("dragstart",function(e){!function setMceInternalContent(e){var selectionHtml,internalContent;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"==e.target.tagName&&selection.select(e.target),0<(selectionHtml=editor.selection.getContent()).length&&(internalContent=mceInternalUrlPrefix+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,internalContent)))}(e)}),editor.on("drop",function(e){if(!isDefaultPrevented(e)){var internalContent=function getMceInternalContent(e){var internalContent;return e.dataTransfer&&(internalContent=e.dataTransfer.getData(mceInternalDataType))&&0<=internalContent.indexOf(mceInternalUrlPrefix)?(internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(","),{id:unescape(internalContent[0]),html:unescape(internalContent[1])}):null}(e);if(internalContent&&internalContent.id!=editor.id){e.preventDefault();var rng=RangeUtils.getCaretRangeFromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng),function insertClipboardContents(content,internal){editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content:content,internal:internal}):editor.execCommand("mceInsertContent",!1,content)}(internalContent.html,!0)}}})}()),isGecko&&(emptyEditorOnDeleteEverything(),removeHrOnBackspace(),function focusBody(){window.Range.prototype.getClientRects||editor.on("mousedown",function(e){if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){var body=editor.getBody();body.blur(),Delay.setEditorTimeout(editor,function(){body.focus()})}})}(),function removeStylesWhenDeletingAcrossBlockElements(){function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,function(attr){target.setAttributeNode(attr.cloneNode(!0))}))}}function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!=dom.getParent(selection.getEnd(),dom.isBlock)}editor.on("keypress",function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8==e.keyCode||46==e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1}),dom.bind(editor.getDoc(),"cut",function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,function(){applyAttributes()}))})}(),function setGeckoEditingOptions(){settings.readonly||editor.on("BeforeExecCommand MouseDown",function setOpts(){setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),settings.object_resizing||setEditorCommandState("enableObjectResizing",!1)})}(),function addBrAfterLastLinks(){editor.on("SetContent ExecCommand",function(e){"setcontent"!=e.type&&"mceInsertLink"!==e.command||!function fixLinks(){each(dom.select("a"),function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}})}()})}(),function showBrokenImageIcon(){editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")}(),function blockCmdArrowNavigation(){Env.mac&&editor.on("keydown",function(e){!VK.metaKeyPressed(e)||e.shiftKey||37!=e.keyCode&&39!=e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37==e.keyCode?"backward":"forward","lineboundary"))})}(),disableBackspaceIntoATable()),{refreshContentEditable:refreshContentEditable,isHidden:function isHidden(){var sel;return!isGecko||editor.removed?0:!(sel=editor.selection.getSel())||!sel.rangeCount||0===sel.rangeCount}}}}),define("tinymce.core.init.InitContentBody",["global!document","global!window","tinymce.core.caret.CaretContainerInput","tinymce.core.dom.DOMUtils","tinymce.core.dom.Selection","tinymce.core.dom.Serializer","tinymce.core.EditorUpload","tinymce.core.ErrorReporter","tinymce.core.ForceBlocks","tinymce.core.Formatter","tinymce.core.html.DomParser","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.keyboard.KeyboardOverrides","tinymce.core.NodeChange","tinymce.core.SelectionOverrides","tinymce.core.UndoManager","tinymce.core.util.Delay","tinymce.core.util.Quirks","tinymce.core.util.Tools"],function(document,window,CaretContainerInput,DOMUtils,Selection,Serializer,EditorUpload,ErrorReporter,ForceBlocks,Formatter,DomParser,Node,Schema,KeyboardOverrides,NodeChange,SelectionOverrides,UndoManager,Delay,Quirks,Tools){var DOM=DOMUtils.DOM,initEditor=function(editor){editor.bindPendingEventDelegates(),editor.initialized=!0,editor.fire("init"),editor.focus(!0),editor.nodeChanged({initial:!0}),editor.execCallback("init_instance_callback",editor),function(editor){editor.settings.auto_focus&&Delay.setEditorTimeout(editor,function(){var focusEditor;(focusEditor=!0===editor.settings.auto_focus?editor:editor.editorManager.get(editor.settings.auto_focus)).destroyed||focusEditor.focus()},100)}(editor)};return{initContentBody:function(editor,skipWrite){var body,contentCssText,settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc();settings.inline||(editor.getElement().style.visibility=editor.orgVisibility),skipWrite||settings.content_editable||(doc.open(),doc.write(editor.iframeHTML),doc.close()),settings.content_editable&&(editor.on("remove",function(){var bodyEl=this.getBody();DOM.removeClass(bodyEl,"mce-content-body"),DOM.removeClass(bodyEl,"mce-edit-focus"),DOM.setAttrib(bodyEl,"contentEditable",null)}),DOM.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=settings.content_document||document,editor.contentWindow=settings.content_window||window,editor.bodyElement=targetElm,settings.content_document=settings.content_window=null,settings.root_name=targetElm.nodeName.toLowerCase()),(body=editor.getBody()).disabled=!0,editor.readonly=settings.readonly,editor.readonly||(editor.inline&&"static"===DOM.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable=editor.getParam("content_editable_state",!0)),body.disabled=!1,editor.editorUpload=new EditorUpload(editor),editor.schema=new Schema(settings),editor.dom=new DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,class_filter:settings.class_filter,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:settings.content_editable,schema:editor.schema,onSetAttrib:function(e){editor.fire("SetAttrib",e)}}),editor.parser=function(editor){var parser=new DomParser(editor.settings,editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",function(nodes,name){for(var node,value,internalName,i=nodes.length,dom=editor.dom;i--;)if(value=(node=nodes[i]).attr(name),internalName="data-mce-"+name,!node.attributes.map[internalName]){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?((value=dom.serializeStyle(dom.parseStyle(value),node.name)).length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name))}}),parser.addNodeFilter("script",function(nodes){for(var node,type,i=nodes.length;i--;)0!==(type=(node=nodes[i]).attr("type")||"no/type").indexOf("mce-")&&node.attr("type","mce-"+type)}),parser.addNodeFilter("#cdata",function(nodes){for(var node,i=nodes.length;i--;)(node=nodes[i]).type=8,node.name="#comment",node.value="[CDATA["+node.value+"]]"}),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(nodes){for(var node,i=nodes.length,nonEmptyElements=editor.schema.getNonEmptyElements();i--;)(node=nodes[i]).isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&(node.append(new Node("br",1)).shortEnded=!0)}),parser}(editor),editor.serializer=new Serializer(settings,editor),editor.selection=new Selection(editor.dom,editor.getWin(),editor.serializer,editor),editor.formatter=new Formatter(editor),editor.undoManager=new UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=new SelectionOverrides(editor),CaretContainerInput.setup(editor),KeyboardOverrides.setup(editor),ForceBlocks.setup(editor),editor.fire("PreInit"),settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM.setAttrib(body,"spellcheck","false")),editor.quirks=new Quirks(editor),editor.fire("PostRender"),settings.directionality&&(body.dir=settings.directionality),settings.nowrap&&(body.style.whiteSpace="nowrap"),settings.protect&&editor.on("BeforeSetContent",function(e){Tools.each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"})})}),editor.on("SetContent",function(){editor.addVisual(editor.getBody())}),settings.padd_empty_editor&&editor.on("PostProcess",function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|<br \/>|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"}),editor.on("compositionstart compositionend",function(e){editor.composing="compositionstart"===e.type}),0<editor.contentStyles.length&&(contentCssText="",Tools.each(editor.contentStyles,function(style){contentCssText+=style+"\r\n"}),editor.dom.addStyle(contentCssText)),editor.dom.styleSheetLoader.loadAll(editor.contentCSS,function(_){initEditor(editor)},function(urls){initEditor(editor),ErrorReporter.contentCssError(editor,urls)})}}}),define("tinymce.core.PluginManager",["tinymce.core.AddOnManager"],function(AddOnManager){return AddOnManager.PluginManager}),define("tinymce.core.ThemeManager",["tinymce.core.AddOnManager"],function(AddOnManager){return AddOnManager.ThemeManager}),define("tinymce.core.init.Init",["global!document","global!window","tinymce.core.dom.DOMUtils","tinymce.core.Env","tinymce.core.init.InitContentBody","tinymce.core.PluginManager","tinymce.core.ThemeManager","tinymce.core.util.Tools","tinymce.core.util.Uuid"],function(document,window,DOMUtils,Env,InitContentBody,PluginManager,ThemeManager,Tools,Uuid){var DOM=DOMUtils.DOM,initPlugin=function(editor,initializedPlugins,plugin){var pluginUrl,pluginInstance,Plugin=PluginManager.get(plugin);if(pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,""),plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)){if(Tools.each(PluginManager.dependencies(plugin),function(dep){initPlugin(editor,initializedPlugins,dep)}),editor.plugins[plugin])return;pluginInstance=new Plugin(editor,pluginUrl,editor.$),(editor.plugins[plugin]=pluginInstance).init&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}},createIframe=function(editor,o){var bodyId,bodyClass,settings=editor.settings;editor.iframeHTML=settings.doctype+"<html><head>",settings.document_base_url!=editor.documentBaseUrl&&(editor.iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),!Env.caretAfter&&settings.ie7_compat&&(editor.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'),editor.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',-1!=(bodyId=settings.body_id||"tinymce").indexOf("=")&&(bodyId=(bodyId=editor.getParam("body_id","","hash"))[editor.id]||bodyId),-1!=(bodyClass=settings.body_class||"").indexOf("=")&&(bodyClass=(bodyClass=editor.getParam("body_class","","hash"))[editor.id]||""),settings.content_security_policy&&(editor.iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+settings.content_security_policy+'" />'),editor.iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'"><br></body></html>';var ifr=DOM.create("iframe",{id:editor.id+"_ifr",frameBorder:"0",allowTransparency:"true",title:editor.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),style:{width:"100%",height:o.height,display:"block"}});ifr.onload=function(){ifr.onload=null,editor.fire("load")};var isDomainRelaxed=function(editor,ifr){if(document.domain!==window.location.hostname&&Env.ie&&Env.ie<12){var bodyUuid=Uuid.uuid("mce");editor[bodyUuid]=function(){InitContentBody.initContentBody(editor)};var domainRelaxUrl='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);document.close();ed.'+bodyUuid+"(true);})()";return DOM.setAttrib(ifr,"src",domainRelaxUrl),!0}return!1}(editor,ifr);return editor.contentAreaContainer=o.iframeContainer,editor.iframeElement=ifr,DOM.add(o.iframeContainer,ifr),isDomainRelaxed};return{init:function(editor){var boxInfo,settings=editor.settings,elm=editor.getElement();if(editor.rtl=settings.rtl_ui||editor.editorManager.i18n.rtl,editor.editorManager.i18n.setCode(settings.language),settings.aria_label=settings.aria_label||DOM.getAttrib(elm,"aria-label",editor.getLang("aria.rich_text_area")),editor.fire("ScriptsLoaded"),function(editor){var Theme,settings=editor.settings;settings.theme&&("function"!=typeof settings.theme?(settings.theme=settings.theme.replace(/-/,""),Theme=ThemeManager.get(settings.theme),editor.theme=new Theme(editor,ThemeManager.urls[settings.theme]),editor.theme.init&&editor.theme.init(editor,ThemeManager.urls[settings.theme]||editor.documentBaseUrl.replace(/\/$/,""),editor.$)):editor.theme=settings.theme)}(editor),function(editor){var initializedPlugins=[];Tools.each(editor.settings.plugins.replace(/\-/g,"").split(/[ ,]/),function(name){initPlugin(editor,initializedPlugins,name)})}(editor),boxInfo=function(editor){var w,h,minHeight,re,o,settings=editor.settings,elm=editor.getElement();return settings.render_ui&&editor.theme&&(editor.orgDisplay=elm.style.display,"function"!=typeof settings.theme?(w=settings.width||DOM.getStyle(elm,"width")||"100%",h=settings.height||DOM.getStyle(elm,"height")||elm.offsetHeight,minHeight=settings.min_height||100,(re=/^[0-9\.]+(|px)$/i).test(""+w)&&(w=Math.max(parseInt(w,10),100)),re.test(""+h)&&(h=Math.max(parseInt(h,10),minHeight)),o=editor.theme.renderUI({targetNode:elm,width:w,height:h,deltaWidth:settings.delta_width,deltaHeight:settings.delta_height}),settings.content_editable||(h=(o.iframeHeight||h)+("number"==typeof h?o.deltaHeight||0:""))<minHeight&&(h=minHeight)):((o=settings.theme(editor,elm)).editorContainer.nodeType&&(o.editorContainer.id=o.editorContainer.id||editor.id+"_parent"),o.iframeContainer.nodeType&&(o.iframeContainer.id=o.iframeContainer.id||editor.id+"_iframecontainer"),h=o.iframeHeight||elm.offsetHeight),editor.editorContainer=o.editorContainer,o.height=h),o}(editor),settings.content_css&&Tools.each(Tools.explode(settings.content_css),function(u){editor.contentCSS.push(editor.documentBaseURI.toAbsolute(u))}),settings.content_style&&editor.contentStyles.push(settings.content_style),settings.content_editable)return InitContentBody.initContentBody(editor);var isDomainRelaxed=createIframe(editor,boxInfo);boxInfo.editorContainer&&(DOM.get(boxInfo.editorContainer).style.display=editor.orgDisplay,editor.hidden=DOM.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM.setAttrib(editor.id,"aria-hidden",!0),isDomainRelaxed||InitContentBody.initContentBody(editor)}}}),define("tinymce.core.init.Render",["global!window","tinymce.core.dom.DOMUtils","tinymce.core.dom.EventUtils","tinymce.core.dom.ScriptLoader","tinymce.core.Env","tinymce.core.ErrorReporter","tinymce.core.init.Init","tinymce.core.NotificationManager","tinymce.core.PluginManager","tinymce.core.ThemeManager","tinymce.core.util.Tools","tinymce.core.WindowManager"],function(window,DOMUtils,EventUtils,ScriptLoader,Env,ErrorReporter,Init,NotificationManager,PluginManager,ThemeManager,Tools,WindowManager){var DOM=DOMUtils.DOM;return{render:function(editor){var settings=editor.settings,id=editor.id;if(EventUtils.Event.domLoaded){if(editor.getElement()&&Env.contentEditable){settings.inline?editor.inline=!0:(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden");var form=editor.getElement().form||DOM.getParent(id,"form");form&&(editor.formElement=form,settings.hidden_input&&!/TEXTAREA|INPUT/i.test(editor.getElement().nodeName)&&(DOM.insertAfter(DOM.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=function(e){editor.fire(e.type,e)},DOM.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",function(){editor.setContent(editor.startContent,{format:"raw"})}),!settings.submit_patch||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)})),editor.windowManager=new WindowManager(editor),editor.notificationManager=new NotificationManager(editor),"xml"===settings.encoding&&editor.on("GetContent",function(e){e.save&&(e.content=DOM.encode(e.content))}),settings.add_form_submit_trigger&&editor.on("submit",function(){editor.initialized&&editor.save()}),settings.add_unload_trigger&&(editor._beforeUnload=function(){!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),function(editor,suffix){var settings=editor.settings,scriptLoader=ScriptLoader.ScriptLoader;if(settings.language&&"en"!=settings.language&&!settings.language_url&&(settings.language_url=editor.editorManager.baseURL+"/langs/"+settings.language+".js"),settings.language_url&&scriptLoader.add(settings.language_url),settings.theme&&"function"!=typeof settings.theme&&"-"!=settings.theme.charAt(0)&&!ThemeManager.urls[settings.theme]){var themeUrl=settings.theme_url;themeUrl=themeUrl?editor.documentBaseURI.toAbsolute(themeUrl):"themes/"+settings.theme+"/theme"+suffix+".js",ThemeManager.load(settings.theme,themeUrl)}Tools.isArray(settings.plugins)&&(settings.plugins=settings.plugins.join(" ")),Tools.each(settings.external_plugins,function(url,name){PluginManager.load(name,url),settings.plugins+=" "+name}),Tools.each(settings.plugins.split(/[ ,]/),function(plugin){if((plugin=Tools.trim(plugin))&&!PluginManager.urls[plugin])if("-"===plugin.charAt(0)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,function(dep){var defaultSettings={prefix:"plugins/",resource:dep,suffix:"/plugin"+suffix+".js"};dep=PluginManager.createUrl(defaultSettings,dep),PluginManager.load(dep.resource,dep)})}else PluginManager.load(plugin,{prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"})}),scriptLoader.loadQueue(function(){editor.removed||Init.init(editor)},editor,function(urls){ErrorReporter.pluginLoadError(editor,urls[0]),editor.removed||Init.init(editor)})}(editor,editor.suffix)}}else DOM.bind(window,"ready",function readyHandler(){DOM.unbind(window,"ready",readyHandler),editor.render()})}}}),define("tinymce.core.Mode",[],function(){function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}}function toggleReadOnly(editor,state){editor._clickBlocker&&(editor._clickBlocker.unbind(),editor._clickBlocker=null),state?(editor._clickBlocker=function clickBlocker(editor){var target,handler;return target=editor.getBody(),handler=function(e){0<editor.dom.getParents(e.target,"a").length&&e.preventDefault()},editor.dom.bind(target,"click",handler),{unbind:function(){editor.dom.unbind(target,"click",handler)}}}(editor),editor.selection.controlSelection.hideResizeRect(),editor.readonly=!0,editor.getBody().contentEditable=!1):(editor.readonly=!1,editor.getBody().contentEditable=!0,setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),editor.focus(),editor.nodeChanged())}return{setMode:function setMode(editor,mode){var currentMode=editor.readonly?"readonly":"design";mode!=currentMode&&(editor.initialized?toggleReadOnly(editor,"readonly"==mode):editor.on("init",function(){toggleReadOnly(editor,"readonly"==mode)}),editor.fire("SwitchMode",{mode:mode}))}}}),define("tinymce.core.ui.Sidebar",[],function(){return{add:function(editor,name,settings){var sidebars=editor.sidebars?editor.sidebars:[];sidebars.push({name:name,settings:settings}),editor.sidebars=sidebars}}}),define("tinymce.core.Editor",["tinymce.core.AddOnManager","tinymce.core.dom.DomQuery","tinymce.core.dom.DOMUtils","tinymce.core.EditorCommands","tinymce.core.EditorObservable","tinymce.core.Env","tinymce.core.html.Serializer","tinymce.core.init.Render","tinymce.core.Mode","tinymce.core.Shortcuts","tinymce.core.ui.Sidebar","tinymce.core.util.Tools","tinymce.core.util.URI","tinymce.core.util.Uuid"],function(AddOnManager,DomQuery,DOMUtils,EditorCommands,EditorObservable,Env,Serializer,Render,Mode,Shortcuts,Sidebar,Tools,URI,Uuid){var DOM=DOMUtils.DOM,extend=Tools.extend,each=Tools.each,trim=Tools.trim,resolve=Tools.resolve,isGecko=Env.gecko,ie=Env.ie;function Editor(id,settings,editorManager){var documentBaseUrl,baseUri,defaultSettings,self=this;documentBaseUrl=self.documentBaseUrl=editorManager.documentBaseURL,baseUri=editorManager.baseURI,defaultSettings=editorManager.defaultSettings,settings=extend({id:id,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,padd_empty_editor:!0,render_ui:!0,indentation:"30px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",validate:!0,entity_encoding:"named",url_converter:self.convertURL,url_converter_scope:self,ie7_compat:!0},defaultSettings,settings),defaultSettings&&defaultSettings.external_plugins&&settings.external_plugins&&(settings.external_plugins=extend({},defaultSettings.external_plugins,settings.external_plugins)),self.settings=settings,AddOnManager.language=settings.language||"en",AddOnManager.languageLoad=settings.language_load,AddOnManager.baseURL=editorManager.baseURL,self.id=settings.id=id,self.setDirty(!1),self.plugins={},self.documentBaseURI=new URI(settings.document_base_url||documentBaseUrl,{base_uri:baseUri}),self.baseURI=baseUri,self.contentCSS=[],self.contentStyles=[],self.shortcuts=new Shortcuts(self),self.loadedCSS={},self.editorCommands=new EditorCommands(self),self.suffix=editorManager.suffix,self.editorManager=editorManager,self.inline=settings.inline,self.settings.content_editable=self.inline,settings.cache_suffix&&(Env.cacheSuffix=settings.cache_suffix.replace(/^[\?\&]+/,"")),!1===settings.override_viewport&&(Env.overrideViewPort=!1),editorManager.fire("SetupEditor",self),self.execCallback("setup",self),self.$=DomQuery.overrideDefaults(function(){return{context:self.inline?self.getBody():self.getDoc(),element:self.getBody()}})}return Editor.prototype={render:function(){Render.render(this)},focus:function(skipFocus){var rng,controlElm,contentEditableHost,self=this,selection=self.selection,contentEditable=self.settings.content_editable,doc=self.getDoc(),body=self.getBody();if(!self.removed){if(!skipFocus){if((rng=selection.getRng()).item&&(controlElm=rng.item(0)),self.quirks.refreshContentEditable(),contentEditableHost=function getContentEditableHost(node){return self.dom.getParent(node,function(node){return"true"===self.dom.getContentEditable(node)})}(selection.getNode()),self.$.contains(body,contentEditableHost))return contentEditableHost.focus(),selection.normalize(),void self.editorManager.setActive(self);if(contentEditable||(Env.opera||self.getBody().focus(),self.getWin().focus()),isGecko||contentEditable){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus();contentEditable&&selection.normalize()}controlElm&&controlElm.ownerDocument==doc&&((rng=doc.body.createControlRange()).addElement(controlElm),rng.select())}self.editorManager.setActive(self)}},execCallback:function(name){var scope,callback=this.settings[name];if(callback)return this.callbackLookup&&(scope=this.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=(scope=callback.replace(/\.\w+$/,""))?resolve(scope):0,callback=resolve(callback),this.callbackLookup=this.callbackLookup||{},this.callbackLookup[name]={func:callback,scope:scope}),callback.apply(scope||this,Array.prototype.slice.call(arguments,1))},translate:function(text){var lang=this.settings.language||"en",i18n=this.editorManager.i18n;return text?(text=i18n.data[lang+"."+text]||text.replace(/\{\#([^\}]+)\}/g,function(a,b){return i18n.data[lang+"."+b]||"{#"+b+"}"}),this.editorManager.translate(text)):""},getLang:function(name,defaultVal){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+name]||(defaultVal!==undefined?defaultVal:"{#"+name+"}")},getParam:function(name,defaultVal,type){var output,value=name in this.settings?this.settings[name]:defaultVal;return"hash"===type?(output={},"string"==typeof value?each(0<value.indexOf("=")?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),function(value){1<(value=value.split("=")).length?output[trim(value[0])]=trim(value[1]):output[trim(value[0])]=trim(value)}):output=value,output):value},nodeChanged:function(args){this._nodeChangeDispatcher.nodeChanged(args)},addButton:function(name,settings){var self=this;settings.cmd&&(settings.onclick=function(){self.execCommand(settings.cmd)}),settings.text||settings.icon||(settings.icon=name),self.buttons=self.buttons||{},settings.tooltip=settings.tooltip||settings.title,self.buttons[name]=settings},addSidebar:function(name,settings){return Sidebar.add(this,name,settings)},addMenuItem:function(name,settings){var self=this;settings.cmd&&(settings.onclick=function(){self.execCommand(settings.cmd)}),self.menuItems=self.menuItems||{},self.menuItems[name]=settings},addContextToolbar:function(predicate,items){var selector,self=this;self.contextToolbars=self.contextToolbars||[],"string"==typeof predicate&&(selector=predicate,predicate=function(elm){return self.dom.is(elm,selector)}),self.contextToolbars.push({id:Uuid.uuid("mcet"),predicate:predicate,items:items})},addCommand:function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},addQueryStateHandler:function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},addQueryValueHandler:function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},addShortcut:function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},execCommand:function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},queryCommandState:function(cmd){return this.editorCommands.queryCommandState(cmd)},queryCommandValue:function(cmd){return this.editorCommands.queryCommandValue(cmd)},queryCommandSupported:function(cmd){return this.editorCommands.queryCommandSupported(cmd)},show:function(){this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable=!0:(DOM.show(this.getContainer()),DOM.hide(this.id)),this.load(),this.fire("show"))},hide:function(){var doc=this.getDoc();this.hidden||(ie&&doc&&!this.inline&&doc.execCommand("SelectAll"),this.save(),this.inline?(this.getBody().contentEditable=!1,this==this.editorManager.focusedEditor&&(this.editorManager.focusedEditor=null)):(DOM.hide(this.getContainer()),DOM.setStyle(this.id,"display",this.orgDisplay)),this.hidden=!0,this.fire("hide"))},isHidden:function(){return!!this.hidden},setProgressState:function(state,time){this.fire("ProgressState",{state:state,time:time})},load:function(args){var html,elm=this.getElement();return this.removed?"":elm?((args=args||{}).load=!0,html=this.setContent(elm.value!==undefined?elm.value:elm.innerHTML,args),args.element=elm,args.no_events||this.fire("LoadContent",args),args.element=elm=null,html):void 0},save:function(args){var html,form,self=this,elm=self.getElement();if(elm&&self.initialized&&!self.removed)return(args=args||{}).save=!0,args.element=elm,args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"==args.format&&self.fire("RawSaveContent",args),html=args.content,/TEXTAREA|INPUT/i.test(elm.nodeName)?elm.value=html:(self.inline||(elm.innerHTML=html),(form=DOM.getParent(self.id,"form"))&&each(form.elements,function(elm){if(elm.name==self.id)return elm.value=html,!1})),args.element=elm=null,!1!==args.set_dirty&&self.setDirty(!1),html},setContent:function(content,args){var forcedRootBlockName,padd,body=this.getBody();return(args=args||{}).format=args.format||"html",args.set=!0,args.content=content,args.no_events||this.fire("BeforeSetContent",args),0===(content=args.content).length||/^\s+$/.test(content)?(padd=ie&&ie<11?"":'<br data-mce-bogus="1">',"TABLE"==body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>"),(forcedRootBlockName=this.settings.forced_root_block)&&this.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=this.dom.createHTML(forcedRootBlockName,this.settings.forced_root_block_attrs,content)):ie||content||(content='<br data-mce-bogus="1">'),this.dom.setHTML(body,content),this.fire("SetContent",args)):("raw"!==args.format&&(content=new Serializer({validate:this.validate},this.schema).serialize(this.parser.parse(content,{isRootContent:!0}))),args.content=trim(content),this.dom.setHTML(body,args.content),args.no_events||this.fire("SetContent",args)),args.content},getContent:function(args){var content,body=this.getBody();return this.removed?"":((args=args||{}).format=args.format||"html",args.get=!0,args.getInner=!0,args.no_events||this.fire("BeforeGetContent",args),content="raw"==args.format?Tools.trim(this.serializer.getTrimmedContent()):"text"==args.format?body.innerText||body.textContent:this.serializer.serialize(body,args),"text"!=args.format?args.content=trim(content):args.content=content,args.no_events||this.fire("GetContent",args),args.content)},insertContent:function(content,args){args&&(content=extend({content:content},args)),this.execCommand("mceInsertContent",!1,content)},isDirty:function(){return!this.isNotDirty},setDirty:function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!=oldState&&this.fire("dirty")},setMode:function(mode){Mode.setMode(this,mode)},getContainer:function(){return this.container||(this.container=DOM.get(this.editorContainer||this.id+"_parent")),this.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return this.targetElm||(this.targetElm=DOM.get(this.id)),this.targetElm},getWin:function(){var elm;return this.contentWindow||(elm=this.iframeElement)&&(this.contentWindow=elm.contentWindow),this.contentWindow},getDoc:function(){var win;return this.contentDocument||(win=this.getWin())&&(this.contentDocument=win.document),this.contentDocument},getBody:function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null)},convertURL:function(url,name,elm){var settings=this.settings;return settings.urlconverter_callback?this.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"==elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?this.documentBaseURI.toRelative(url):url=this.documentBaseURI.toAbsolute(url,settings.remove_script_host)},addVisual:function(elm){var cls,self=this,settings=self.settings,dom=self.dom;elm=elm||self.getBody(),self.hasVisual===undefined&&(self.hasVisual=settings.visual),each(dom.select("table,a",elm),function(elm){var value;switch(elm.nodeName){case"TABLE":return cls=settings.visual_table_class||"mce-item-table",void((value=dom.getAttrib(elm,"border"))&&"0"!=value||!self.hasVisual?dom.removeClass(elm,cls):dom.addClass(elm,cls));case"A":return void(dom.getAttrib(elm,"href",!1)||(value=dom.getAttrib(elm,"name")||elm.id,cls=settings.visual_anchor_class||"mce-item-anchor",value&&self.hasVisual?dom.addClass(elm,cls):dom.removeClass(elm,cls)))}}),self.fire("VisualAid",{element:elm,hasVisual:self.hasVisual})},remove:function(){this.removed||(this.save(),this.removed=1,this.unbindAllNativeEvents(),this.hasHiddenInput&&DOM.remove(this.getElement().nextSibling),this.inline||(ie&&ie<10&&this.getDoc().execCommand("SelectAll",!1,null),DOM.setStyle(this.id,"display",this.orgDisplay),this.getBody().onload=null),this.fire("remove"),this.editorManager.remove(this),DOM.remove(this.getContainer()),this._selectionOverrides.destroy(),this.editorUpload.destroy(),this.destroy())},destroy:function(automatic){var form;this.destroyed||(automatic||this.removed?(automatic||(this.editorManager.off("beforeunload",this._beforeUnload),this.theme&&this.theme.destroy&&this.theme.destroy(),this.selection.destroy(),this.dom.destroy()),(form=this.formElement)&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM.unbind(form,"submit reset",this.formEventDelegate)),this.contentAreaContainer=this.formElement=this.container=this.editorContainer=null,this.bodyElement=this.contentDocument=this.contentWindow=null,this.iframeElement=this.targetElm=null,this.selection&&(this.selection=this.selection.win=this.selection.dom=this.selection.dom.doc=null),this.destroyed=1):this.remove())},uploadImages:function(callback){return this.editorUpload.uploadImages(callback)},_scanForImages:function(){return this.editorUpload.scanForImages()}},extend(Editor.prototype,EditorObservable),Editor}),define("tinymce.core.util.I18n",["tinymce.core.util.Tools"],function(Tools){"use strict";var data={},code="en";return{setCode:function(newCode){newCode&&(code=newCode,this.rtl=!!this.data[newCode]&&"rtl"===this.data[newCode]._dir)},getCode:function(){return code},rtl:!1,add:function(code,items){var langData=data[code];for(var name in langData||(data[code]=langData={}),items)langData[name]=items[name];this.setCode(code)},translate:function(text){var langData=data[code]||{};function toString(obj){return Tools.is(obj,"function")?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj}function isEmpty(text){return""===text||null===text||Tools.is(text,"undefined")}function getLangData(text){return text=toString(text),Tools.hasOwn(langData,text)?toString(langData[text]):text}if(isEmpty(text))return"";if(Tools.is(text,"object")&&Tools.hasOwn(text,"raw"))return toString(text.raw);if(Tools.is(text,"array")){var values=text.slice(1);text=getLangData(text[0]).replace(/\{([0-9]+)\}/g,function($1,$2){return Tools.hasOwn(values,$2)?toString(values[$2]):$1})}return getLangData(text).replace(/{context:\w+}$/,"")},data:data}}),define("tinymce.core.FocusManager",["tinymce.core.dom.DOMUtils","tinymce.core.util.Delay","tinymce.core.Env"],function(DOMUtils,Delay,Env){var selectionChangeHandler,documentFocusInHandler,documentMouseUpHandler,DOM=DOMUtils.DOM,isUIElement=function(editor,elm){var customSelector=editor?editor.settings.custom_ui_selector:"";return null!==DOM.getParent(elm,function(elm){return FocusManager.isEditorUIElement(elm)||!!customSelector&&editor.dom.is(elm,customSelector)})},isElementOursideInlineEditor=function(editor,target){return!1===function(editor){return!0===editor.inline}(editor)||!1===editor.dom.isChildOf(target,editor.getBody())};function FocusManager(editorManager){function getActiveElement(){try{return document.activeElement}catch(ex){return document.body}}editorManager.on("AddEditor",function registerEvents(e){var editor=e.editor;editor.on("init",function(){(editor.inline||Env.ie)&&("onbeforedeactivate"in document&&Env.ie<9?editor.dom.bind(editor.getBody(),"beforedeactivate",function(e){if(e.target==editor.getBody())try{editor.lastRng=editor.selection.getRng()}catch(ex){}}):editor.on("nodechange mouseup keyup",function(e){var node=getActiveElement();"nodechange"==e.type&&e.selectionChange||(node&&node.id==editor.id+"_ifr"&&(node=editor.getBody()),editor.dom.isChildOf(node,editor.getBody())&&(editor.lastRng=editor.selection.getRng()))}),Env.webkit&&!selectionChangeHandler&&(selectionChangeHandler=function(){var activeEditor=editorManager.activeEditor;if(activeEditor&&activeEditor.selection){var rng=activeEditor.selection.getRng();rng&&!rng.collapsed&&(editor.lastRng=rng)}},DOM.bind(document,"selectionchange",selectionChangeHandler)))}),editor.on("setcontent",function(){editor.lastRng=null}),editor.on("mousedown",function(){editor.selection.lastFocusBookmark=null}),editor.on("focusin",function(){var lastRng,focusedEditor=editorManager.focusedEditor;editor.selection.lastFocusBookmark&&(lastRng=function bookmarkToRng(editor,bookmark){var rng;return bookmark.startContainer?((rng=editor.getDoc().createRange()).setStart(bookmark.startContainer,bookmark.startOffset),rng.setEnd(bookmark.endContainer,bookmark.endOffset)):rng=bookmark,rng}(editor,editor.selection.lastFocusBookmark),editor.selection.lastFocusBookmark=null,editor.selection.setRng(lastRng)),focusedEditor!=editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),(editorManager.focusedEditor=editor).fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0)),editor.lastRng=null}),editor.on("focusout",function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;isUIElement(editor,getActiveElement())||focusedEditor!=editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null,editor.selection&&(editor.selection.lastFocusBookmark=null))})}),documentFocusInHandler||(documentFocusInHandler=function(e){var target,activeEditor=editorManager.activeEditor;target=e.target,activeEditor&&target.ownerDocument===document&&(activeEditor.selection&&target!==activeEditor.getBody()&&isElementOursideInlineEditor(editor,target)&&(activeEditor.selection.lastFocusBookmark=function createBookmark(dom,rng){if(rng&&rng.startContainer){if(!dom.isChildOf(rng.startContainer,dom.getRoot())||!dom.isChildOf(rng.endContainer,dom.getRoot()))return;return{startContainer:rng.startContainer,startOffset:rng.startOffset,endContainer:rng.endContainer,endOffset:rng.endOffset}}return rng}(activeEditor.dom,activeEditor.lastRng)),target===document.body||isUIElement(activeEditor,target)||editorManager.focusedEditor!==activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null))},DOM.bind(document,"focusin",documentFocusInHandler)),editor.inline&&!documentMouseUpHandler&&(documentMouseUpHandler=function(e){var activeEditor=editorManager.activeEditor,dom=activeEditor.dom;if(activeEditor.inline&&dom&&!dom.isChildOf(e.target,activeEditor.getBody())){var rng=activeEditor.selection.getRng();rng.collapsed||(activeEditor.lastRng=rng)}},DOM.bind(document,"mouseup",documentMouseUpHandler))}),editorManager.on("RemoveEditor",function unregisterDocumentEvents(e){editorManager.focusedEditor==e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM.unbind(document,"selectionchange",selectionChangeHandler),DOM.unbind(document,"focusin",documentFocusInHandler),DOM.unbind(document,"mouseup",documentMouseUpHandler),selectionChangeHandler=documentFocusInHandler=documentMouseUpHandler=null)})}return FocusManager.isEditorUIElement=function(elm){return-1!==elm.className.toString().indexOf("mce-")},FocusManager._isUIElement=isUIElement,FocusManager}),define("tinymce.core.LegacyInput",["tinymce.core.util.Tools"],function(Tools){var each=Tools.each,explode=Tools.explode;return{register:function(EditorManager){EditorManager.on("AddEditor",function(e){var editor=e.editor;editor.on("preInit",function(){var filters,fontSizes,dom,settings=editor.settings;function replaceWithSpan(node,styles){each(styles,function(value,name){value&&dom.setStyle(node,name,value)}),dom.rename(node,"span")}settings.inline_styles&&(fontSizes=explode(settings.font_size_legacy_values),filters={font:function(dom,node){replaceWithSpan(node,{backgroundColor:node.style.backgroundColor,color:node.color,fontFamily:node.face,fontSize:fontSizes[parseInt(node.size,10)-1]})},u:function(dom,node){"html4"===editor.settings.schema&&replaceWithSpan(node,{textDecoration:"underline"})},strike:function(dom,node){replaceWithSpan(node,{textDecoration:"line-through"})}},editor.on("PreProcess SetContent",function convert(e){dom=editor.dom,settings.convert_fonts_to_spans&&each(dom.select("font,u,strike",e.node),function(node){filters[node.nodeName.toLowerCase()](dom,node)})}))})})}}}),define("tinymce.core.EditorManager",["tinymce.core.AddOnManager","tinymce.core.dom.DomQuery","tinymce.core.dom.DOMUtils","tinymce.core.Editor","tinymce.core.Env","tinymce.core.ErrorReporter","tinymce.core.FocusManager","tinymce.core.LegacyInput","tinymce.core.util.I18n","tinymce.core.util.Observable","tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.core.util.URI"],function(AddOnManager,DomQuery,DOMUtils,Editor,Env,ErrorReporter,FocusManager,LegacyInput,I18n,Observable,Promise,Tools,URI){var beforeUnloadDelegate,EditorManager,DOM=DOMUtils.DOM,explode=Tools.explode,each=Tools.each,extend=Tools.extend,instanceCounter=0,boundGlobalEvents=!1;function globalEventDelegate(e){each(EditorManager.editors,function(editor){"scroll"===e.type?editor.fire("ScrollWindow",e):editor.fire("ResizeWindow",e)})}function toggleGlobalEvents(editors,state){state!==boundGlobalEvents&&(state?DomQuery(window).on("resize scroll",globalEventDelegate):DomQuery(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)}function removeEditorFromList(editor){var removedFromList,editors=EditorManager.editors;delete editors[editor.id];for(var i=0;i<editors.length;i++)if(editors[i]==editor){editors.splice(i,1),removedFromList=!0;break}return EditorManager.activeEditor==editor&&(EditorManager.activeEditor=editors[0]),EditorManager.focusedEditor==editor&&(EditorManager.focusedEditor=null),removedFromList}return EditorManager={$:DomQuery,majorVersion:"4",minorVersion:"6.2",releaseDate:"2017-05-23",editors:[],i18n:I18n,activeEditor:null,setup:function(){var baseURL,documentBaseURL,preInit,src,suffix="";if(documentBaseURL=URI.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/")),preInit=window.tinymce||window.tinyMCEPreInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++){var srcScript=(src=scripts[i].src).substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!=srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}!baseURL&&document.currentScript&&(-1!=(src=document.currentScript.src).indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/")))}this.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),this.documentBaseURL=documentBaseURL,this.baseURI=new URI(this.baseURL),this.suffix=suffix,this.focusManager=new FocusManager(this)},overrideDefaults:function(defaultSettings){var baseUrl,suffix;(baseUrl=defaultSettings.base_url)&&(this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)),suffix=defaultSettings.suffix,defaultSettings.suffix&&(this.suffix=suffix);var pluginBaseUrls=(this.defaultSettings=defaultSettings).plugin_base_urls;for(var name in pluginBaseUrls)AddOnManager.PluginManager.urls[name]=pluginBaseUrls[name]},init:function(settings){var result,invalidInlineTargets,self=this;function createId(elm){var id=elm.id;return id||(id=(id=elm.name)&&!DOM.get(id)?elm.name:DOM.uniqueId(),elm.setAttribute("id",id)),id}function hasClass(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)}invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu"," ");var provideResults=function(editors){result=editors};return self.settings=settings,DOM.bind(window,"ready",function initEditors(){var targets,initCount=0,editors=[];function createEditor(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor),editor.on("init",function(){++initCount===targets.length&&provideResults(editors)}),editor.targetElm=editor.targetElm||targetElm,editor.render()}DOM.unbind(window,"ready",initEditors),function execCallback(name){var callback=settings[name];if(callback)return callback.apply(self,Array.prototype.slice.call(arguments,2))}("onpageload"),targets=DomQuery.unique(function findTargets(settings){var l,targets=[];if(Env.ie&&Env.ie<11)return ErrorReporter.initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(settings.types)return each(settings.types,function(type){targets=targets.concat(DOM.select(type.selector))}),targets;if(settings.selector)return DOM.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":0<(l=settings.elements||"").length&&each(explode(l),function(id){var elm;(elm=DOM.get(id))?targets.push(elm):each(document.forms,function(f){each(f.elements,function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM.setAttrib(e,"id",id),targets.push(e))})})});break;case"textareas":case"specific_textareas":each(DOM.select("textarea"),function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)})}return targets}(settings)),settings.types?each(settings.types,function(type){Tools.each(targets,function(elm){return!DOM.is(elm,type.selector)||(createEditor(createId(elm),extend({},settings,type),elm),!1)})}):(Tools.each(targets,function(elm){!function purgeDestroyedEditor(editor){return editor&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0,editor=null),editor}(self.get(elm.id))}),0===(targets=Tools.grep(targets,function(elm){return!self.get(elm.id)})).length?provideResults([]):each(targets,function(elm){!function isInvalidInlineTarget(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets}(settings,elm)?createEditor(createId(elm),settings,elm):ErrorReporter.initError("Could not initialize inline editor on invalid inline target element",elm)}))}),new Promise(function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}})},get:function(id){return arguments.length?id in this.editors?this.editors[id]:null:this.editors},add:function(editor){var self=this,editors=self.editors;return editors[editor.id]=editor,editors.push(editor),toggleGlobalEvents(0,!0),self.activeEditor=editor,self.fire("AddEditor",{editor:editor}),beforeUnloadDelegate||(beforeUnloadDelegate=function(){self.fire("BeforeUnload")},DOM.bind(window,"beforeunload",beforeUnloadDelegate)),editor},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var i,editor,self=this,editors=self.editors;if(selector)return"string"==typeof selector?(selector=selector.selector||selector,void each(DOM.select(selector),function(elm){(editor=editors[elm.id])&&self.remove(editor)})):editors[(editor=selector).id]?(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor:editor}),editors.length||DOM.unbind(window,"beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(0,0<editors.length),editor):null;for(i=editors.length-1;0<=i;i--)self.remove(editors[i])},execCommand:function(cmd,ui,value){var editor=this.get(value);switch(cmd){case"mceAddEditor":return this.get(value)||new Editor(value,this.settings,this).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?editor.isHidden()?editor.show():editor.hide():this.execCommand("mceAddEditor",0,value),!0}return!!this.activeEditor&&this.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each(this.editors,function(editor){editor.save()})},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!=editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor}},extend(EditorManager,Observable),EditorManager.setup(),LegacyInput.register(EditorManager),EditorManager}),define("tinymce.core.util.XHR",["tinymce.core.util.Observable","tinymce.core.util.Tools"],function(Observable,Tools){var XHR={send:function(settings){var xhr,count=0;function ready(){!settings.async||4==xhr.readyState||1e4<count++?(settings.success&&count<1e4&&200==xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,1e4<count?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):setTimeout(ready,10)}if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=!1!==settings.async,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings:settings}),xhr=new XMLHttpRequest){if(xhr.overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value)}),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),(xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr).send(settings.data),!settings.async)return ready();setTimeout(ready,10)}}};return Tools.extend(XHR,Observable),XHR}),define("tinymce.core.util.JSON",[],function(){return{serialize:function serialize(o,quote){var i,v,t,name;if(quote=quote||'"',null===o)return"null";if("string"==(t=typeof o))return v="\bb\tt\nn\ff\rr\"\"''\\\\",quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){return'"'===quote&&"'"===a?a:(i=v.indexOf(b))+1?"\\"+v.charAt(i+1):(a=b.charCodeAt().toString(16),"\\u"+"0000".substring(a.length)+a)})+quote;if("object"!=t)return""+o;if(o.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(o)){for(i=0,v="[";i<o.length;i++)v+=(0<i?",":"")+serialize(o[i],quote);return v+"]"}for(name in v="{",o)o.hasOwnProperty(name)&&(v+="function"!=typeof o[name]?(1<v.length?","+quote:quote)+name+quote+":"+serialize(o[name],quote):"");return v+"}"},parse:function(text){try{return window[String.fromCharCode(101)+"val"]("("+text+")")}catch(ex){}}}}),define("tinymce.core.util.JSONRequest",["tinymce.core.util.JSON","tinymce.core.util.XHR","tinymce.core.util.Tools"],function(JSON,XHR,Tools){var extend=Tools.extend;function JSONRequest(settings){this.settings=extend({},settings),this.count=0}return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype={send:function(args){var ecb=args.error,scb=args.success;(args=extend(this.settings,args)).success=function(c,x){void 0===(c=JSON.parse(c))&&(c={error:"JSON Parse error."}),c.error?ecb.call(args.error_scope||args.scope,c.error,x):scb.call(args.success_scope||args.scope,c.result)},args.error=function(ty,x){ecb&&ecb.call(args.error_scope||args.scope,ty,x)},args.data=JSON.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),args.content_type="application/json",XHR.send(args)}},JSONRequest}),define("tinymce.core.util.JSONP",["tinymce.core.dom.DOMUtils"],function(DOMUtils){return{callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=settings.count!==undefined?settings.count:self.count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"}),self.count++}}}),define("tinymce.core.util.LocalStorage",[],function(){var LocalStorage,storageElm,items,keys,hasOldIEDataSupport;try{if(window.localStorage)return localStorage}catch(ex){}function updateKeys(){for(var key in keys=[],items)keys.push(key);LocalStorage.length=keys.length}function save(){var value,data="";if(hasOldIEDataSupport){for(var key in items)value=items[key],data+=(data?",":"")+key.length.toString(32)+","+key+","+value.length.toString(32)+","+value;storageElm.setAttribute("tinymce",data);try{storageElm.save("tinymce")}catch(ex){}updateKeys()}}return storageElm=document.documentElement,(hasOldIEDataSupport=!!storageElm.addBehavior)&&storageElm.addBehavior("#default#userData"),LocalStorage={key:function(index){return keys[index]},getItem:function(key){return key in items?items[key]:null},setItem:function(key,value){items[key]=""+value,save()},removeItem:function(key){delete items[key],save()},clear:function(){items={},save()}},function load(){var key,data,value,pos=0;if(items={},hasOldIEDataSupport){storageElm.load("tinymce"),data=storageElm.getAttribute("tinymce")||"";do{var offset=next();if(null===offset)break;if(null!==(key=next(parseInt(offset,32)||0))){if(null===(offset=next()))break;value=next(parseInt(offset,32)||0),key&&(items[key]=value)}}while(null!==key);updateKeys()}function next(end){var value,nextPos;return-1===(nextPos=end!==undefined?pos+end:data.indexOf(",",pos))||nextPos>data.length?null:(value=data.substring(pos,nextPos),pos=nextPos+1,value)}}(),LocalStorage}),define("tinymce.core.api.Compat",["tinymce.core.dom.DOMUtils","tinymce.core.dom.EventUtils","tinymce.core.dom.ScriptLoader","tinymce.core.AddOnManager","tinymce.core.util.Tools","tinymce.core.Env"],function(DOMUtils,EventUtils,ScriptLoader,AddOnManager,Tools,Env){return{register:function(tinymce){tinymce.DOM=DOMUtils.DOM,tinymce.ScriptLoader=ScriptLoader.ScriptLoader,tinymce.PluginManager=AddOnManager.PluginManager,tinymce.ThemeManager=AddOnManager.ThemeManager,tinymce.dom=tinymce.dom||{},tinymce.dom.Event=EventUtils.Event,Tools.each("trim isArray is toArray makeMap each map grep inArray extend create walk createNS resolve explode _addCacheSuffix".split(" "),function(key){tinymce[key]=Tools[key]}),Tools.each("isOpera isWebKit isIE isGecko isMac".split(" "),function(name){tinymce[name]=Env[name.substr(2).toLowerCase()]})}}}),define("tinymce.core.util.Color",[],function(){var min=Math.min,max=Math.max,round=Math.round;return function Color(value){var self=this,r=0,g=0,b=0;function parse(value){var matches;return"object"==typeof value?"r"in value?(r=value.r,g=value.g,b=value.b):"v"in value&&function hsvToRgb(hue,saturation,brightness){var side,chroma,x,match;if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0!==saturation){switch(side=hue/60,x=(chroma=brightness*saturation)*(1-Math.abs(side%2-1)),match=brightness-chroma,Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round(255*(r+match)),g=round(255*(g+match)),b=round(255*(b+match))}else r=g=b=round(255*brightness)}(value.h,value.s,value.v):(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16)),r=r<0?0:255<r?255:r,g=g<0?0:255<g?255:g,b=b<0?0:255<b?255:b,self}value&&parse(value),self.toRgb=function toRgb(){return{r:r,g:g,b:b}},self.toHsv=function toHsv(){return function rgb2hsv(r,g,b){var s,v,minRGB,maxRGB;return v=0,(minRGB=min(r/=255,min(g/=255,b/=255)))==(maxRGB=max(r,max(g,b)))?{h:0,s:0,v:100*(v=minRGB)}:(s=(maxRGB-minRGB)/maxRGB,{h:round(60*((r==minRGB?3:b==minRGB?1:5)-(r==minRGB?g-b:b==minRGB?r-g:b-r)/((v=maxRGB)-minRGB))),s:round(100*s),v:round(100*v)})}(r,g,b)},self.toHex=function toHex(){function hex(val){return 1<(val=parseInt(val,10).toString(16)).length?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)},self.parse=parse}}),define("tinymce.core.ui.Layout",["tinymce.core.util.Class","tinymce.core.util.Tools"],function(Class,Tools){"use strict";return Class.extend({Defaults:{firstControlClass:"first",lastControlClass:"last"},init:function(settings){this.settings=Tools.extend({},this.Defaults,settings)},preRender:function(container){container.bodyClasses.add(this.settings.containerClass)},applyClasses:function(items){var firstClass,lastClass,firstItem,lastItem,settings=this.settings;firstClass=settings.firstControlClass,lastClass=settings.lastControlClass,items.each(function(item){item.classes.remove(firstClass).remove(lastClass).add(settings.controlClass),item.visible()&&(firstItem=firstItem||item,lastItem=item)}),firstItem&&firstItem.classes.add(firstClass),lastItem&&lastItem.classes.add(lastClass)},renderHtml:function(container){var html="";return this.applyClasses(container.items()),container.items().each(function(item){html+=item.renderHtml()}),html},recalc:function(){},postRender:function(){},isNative:function(){return!1}})}),define("tinymce.core.ui.AbsoluteLayout",["tinymce.core.ui.Layout"],function(Layout){"use strict";return Layout.extend({Defaults:{containerClass:"abs-layout",controlClass:"abs-layout-item"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){var settings=ctrl.settings;ctrl.layoutRect({x:settings.x,y:settings.y,w:settings.w,h:settings.h}),ctrl.recalc&&ctrl.recalc()})},renderHtml:function(container){return'<div id="'+container._id+'-absend" class="'+container.classPrefix+'abs-end"></div>'+this._super(container)}})}),define("tinymce.core.ui.Button",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{classes:"widget btn",role:"button"},init:function(settings){var size,self=this;self._super(settings),settings=self.settings,size=self.settings.size,self.on("click mousedown",function(e){e.preventDefault()}),self.on("touchstart",function(e){self.fire("click",e),e.preventDefault()}),settings.subtype&&self.classes.add(settings.subtype),size&&self.classes.add("btn-"+size),settings.icon&&self.icon(settings.icon)},icon:function(icon){return arguments.length?(this.state.set("icon",icon),this):this.state.get("icon")},repaint:function(){var btnStyle,btnElm=this.getEl().firstChild;btnElm&&((btnStyle=btnElm.style).width=btnStyle.height="100%"),this._super()},renderHtml:function(){var image,id=this._id,prefix=this.classPrefix,icon=this.state.get("icon"),text=this.state.get("text"),textHtml="";return image=(image=this.settings.image)?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1])," style=\"background-image: url('"+image+"')\""):"",text&&(this.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+this.encode(text)+"</span>"),icon=icon?prefix+"ico "+prefix+"i-"+icon:"",'<div id="'+id+'" class="'+this.classes+'" tabindex="-1"><button role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+"</button></div>"},bindStates:function(){var self=this,$=self.$,textCls=self.classPrefix+"txt";function setButtonText(text){var $span=$("span."+textCls,self.getEl());text?($span[0]||($("button:first",self.getEl()).append('<span class="'+textCls+'"></span>'),$span=$("span."+textCls,self.getEl())),$span.html(self.encode(text))):$span.remove(),self.classes.toggle("btn-has-text",!!text)}return self.state.on("change:text",function(e){setButtonText(e.value)}),self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;icon=(self.settings.icon=icon)?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];icon?(iconElm&&iconElm==btnElm.firstChild||(iconElm=document.createElement("i"),btnElm.insertBefore(iconElm,btnElm.firstChild)),iconElm.className=icon):iconElm&&btnElm.removeChild(iconElm),setButtonText(self.state.get("text"))}),self._super()}})}),define("tinymce.core.ui.ButtonGroup",["tinymce.core.ui.Container"],function(Container){"use strict";return Container.extend({Defaults:{defaultType:"button",role:"group"},renderHtml:function(){var layout=this._layout;return this.classes.add("btn-group"),this.preRender(),layout.preRender(this),'<div id="'+this._id+'" class="'+this.classes+'"><div id="'+this._id+'-body">'+(this.settings.html||"")+layout.renderHtml(this)+"</div></div>"}})}),define("tinymce.core.ui.Checkbox",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{classes:"checkbox",role:"checkbox",checked:!1},init:function(settings){var self=this;self._super(settings),self.on("click mousedown",function(e){e.preventDefault()}),self.on("click",function(e){e.preventDefault(),self.disabled()||self.checked(!self.checked())}),self.checked(self.settings.checked)},checked:function(state){return arguments.length?(this.state.set("checked",state),this):this.state.get("checked")},value:function(state){return arguments.length?this.checked(state):this.checked()},renderHtml:function(){var id=this._id,prefix=this.classPrefix;return'<div id="'+id+'" class="'+this.classes+'" unselectable="on" aria-labelledby="'+id+'-al" tabindex="-1"><i class="'+prefix+"ico "+prefix+'i-checkbox"></i><span id="'+id+'-al" class="'+prefix+'label">'+this.encode(this.state.get("text"))+"</span></div>"},bindStates:function(){var self=this;function checked(state){self.classes.toggle("checked",state),self.aria("checked",state)}return self.state.on("change:text",function(e){self.getEl("al").firstChild.data=self.translate(e.value)}),self.state.on("change:checked change:value",function(e){self.fire("change"),checked(e.value)}),self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;if(void 0===icon)return self.settings.icon;icon=(self.settings.icon=icon)?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];icon?(iconElm&&iconElm==btnElm.firstChild||(iconElm=document.createElement("i"),btnElm.insertBefore(iconElm,btnElm.firstChild)),iconElm.className=icon):iconElm&&btnElm.removeChild(iconElm)}),self.state.get("checked")&&checked(!0),self._super()}})}),define("tinymce.core.ui.ComboBox",["tinymce.core.ui.Widget","tinymce.core.ui.Factory","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery","tinymce.core.util.VK","tinymce.core.util.Tools"],function(Widget,Factory,DomUtils,$,VK,Tools){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,self.classes.add("combobox"),self.subinput=!0,self.ariaTarget="inp",settings.menu=settings.menu||settings.values,settings.menu&&(settings.icon="caret"),self.on("click",function(e){var elm=e.target,root=self.getEl();if($.contains(root,elm)||elm==root)for(;elm&&elm!=root;)elm.id&&-1!=elm.id.indexOf("-open")&&(self.fire("action"),settings.menu&&(self.showMenu(),e.aria&&self.menu.items()[0].focus())),elm=elm.parentNode}),self.on("keydown",function(e){var rootControl;13==e.keyCode&&"INPUT"===e.target.nodeName&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))}),self.on("keyup",function(e){if("INPUT"==e.target.nodeName){var oldValue=self.state.get("value"),newValue=e.target.value;newValue!==oldValue&&(self.state.set("value",newValue),self.fire("autocomplete",e))}}),self.on("mouseover",function(e){var tooltip=self.tooltip().moveTo(-65535);if(self.statusLevel()&&-1!==e.target.className.indexOf(self.classPrefix+"status")){var statusMessage=self.statusMessage()||"Ok",rel=tooltip.text(statusMessage).show().testMoveRel(e.target,["bc-tc","bc-tl","bc-tr"]);tooltip.classes.toggle("tooltip-n","bc-tc"==rel),tooltip.classes.toggle("tooltip-nw","bc-tl"==rel),tooltip.classes.toggle("tooltip-ne","bc-tr"==rel),tooltip.moveRel(e.target,rel)}})},statusLevel:function(value){return 0<arguments.length&&this.state.set("statusLevel",value),this.state.get("statusLevel")},statusMessage:function(value){return 0<arguments.length&&this.state.set("statusMessage",value),this.state.get("statusMessage")},showMenu:function(){var menu,self=this,settings=self.settings;self.menu||((menu=settings.menu||[]).length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",self.menu=Factory.create(menu).parent(self).renderTo(self.getContainerElm()),self.fire("createmenu"),self.menu.reflow(),self.menu.on("cancel",function(e){e.control===self.menu&&self.focus()}),self.menu.on("show hide",function(e){e.control.items().each(function(ctrl){ctrl.active(ctrl.value()==self.value())})}).fire("show"),self.menu.on("select",function(e){self.value(e.control.value())}),self.on("focusin",function(e){"INPUT"==e.target.tagName.toUpperCase()&&self.menu.hide()}),self.aria("expanded",!0)),self.menu.show(),self.menu.layoutRect({w:self.layoutRect().w}),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])},focus:function(){this.getEl("inp").focus()},repaint:function(){var width,lineHeight,elm=this.getEl(),openElm=this.getEl("open"),rect=this.layoutRect(),innerPadding=0,inputElm=elm.firstChild;this.statusLevel()&&"none"!==this.statusLevel()&&(innerPadding=parseInt(DomUtils.getRuntimeStyle(inputElm,"padding-right"),10)-parseInt(DomUtils.getRuntimeStyle(inputElm,"padding-left"),10)),width=openElm?rect.w-DomUtils.getSize(openElm).width-10:rect.w-10;var doc=document;return doc.all&&(!doc.documentMode||doc.documentMode<=8)&&(lineHeight=this.layoutRect().h-2+"px"),$(inputElm).css({width:width-innerPadding,lineHeight:lineHeight}),this._super(),this},postRender:function(){var self=this;return $(this.getEl("inp")).on("change",function(e){self.state.set("value",e.target.value),self.fire("change",e)}),self._super()},renderHtml:function(){var icon,text,statusHtml,id=this._id,settings=this.settings,prefix=this.classPrefix,value=this.state.get("value")||"",openBtnHtml="",extraAttrs="";return"spellcheck"in settings&&(extraAttrs+=' spellcheck="'+settings.spellcheck+'"'),settings.maxLength&&(extraAttrs+=' maxlength="'+settings.maxLength+'"'),settings.size&&(extraAttrs+=' size="'+settings.size+'"'),settings.subtype&&(extraAttrs+=' type="'+settings.subtype+'"'),statusHtml='<i id="'+id+'-status" class="mce-status mce-ico" style="display: none"></i>',this.disabled()&&(extraAttrs+=' disabled="disabled"'),(icon=settings.icon)&&"caret"!=icon&&(icon=prefix+"ico "+prefix+"i-"+settings.icon),text=this.state.get("text"),(icon||text)&&(openBtnHtml='<div id="'+id+'-open" class="'+prefix+"btn "+prefix+'open" tabIndex="-1" role="button"><button id="'+id+'-action" type="button" hidefocus="1" tabindex="-1">'+("caret"!=icon?'<i class="'+icon+'"></i>':'<i class="'+prefix+'caret"></i>')+(text?(icon?" ":"")+text:"")+"</button></div>",this.classes.add("has-open")),'<div id="'+id+'" class="'+this.classes+'"><input id="'+id+'-inp" class="'+prefix+'textbox" value="'+this.encode(value,!1)+'" hidefocus="1"'+extraAttrs+' placeholder="'+this.encode(settings.placeholder)+'" />'+statusHtml+openBtnHtml+"</div>"},value:function(value){return arguments.length?(this.state.set("value",value),this):(this.state.get("rendered")&&this.state.set("value",this.getEl("inp").value),this.state.get("value"))},showAutoComplete:function(items,term){var self=this;if(0!==items.length){self.menu?self.menu.items().remove():self.menu=Factory.create({type:"menu",classes:"combobox-menu",layout:"flow"}).parent(self).renderTo(),Tools.each(items,function(item){var value,title;self.menu.add({text:item.title,url:item.previewUrl,match:term,classes:"menu-item-ellipsis",onclick:(value=item.value,title=item.title,function(){self.fire("selectitem",{title:title,value:value})})})}),self.menu.renderNew(),self.hideMenu(),self.menu.on("cancel",function(e){e.control.parent()===self.menu&&(e.stopPropagation(),self.focus(),self.hideMenu())}),self.menu.on("select",function(){self.focus()});var maxW=self.layoutRect().w;self.menu.layoutRect({w:maxW,minW:0,maxW:maxW}),self.menu.reflow(),self.menu.show(),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])}else self.hideMenu()},hideMenu:function(){this.menu&&this.menu.hide()},bindStates:function(){var self=this;self.state.on("change:value",function(e){self.getEl("inp").value!=e.value&&(self.getEl("inp").value=e.value)}),self.state.on("change:disabled",function(e){self.getEl("inp").disabled=e.value}),self.state.on("change:statusLevel",function(e){var statusIconElm=self.getEl("status"),prefix=self.classPrefix,value=e.value;DomUtils.css(statusIconElm,"display","none"===value?"none":""),DomUtils.toggleClass(statusIconElm,prefix+"i-checkmark","ok"===value),DomUtils.toggleClass(statusIconElm,prefix+"i-warning","warn"===value),DomUtils.toggleClass(statusIconElm,prefix+"i-error","error"===value),self.classes.toggle("has-status","none"!==value),self.repaint()}),DomUtils.on(self.getEl("status"),"mouseleave",function(){self.tooltip().hide()}),self.on("cancel",function(e){self.menu&&self.menu.visible()&&(e.stopPropagation(),self.hideMenu())});var focusIdx=function(idx,menu){menu&&0<menu.items().length&&menu.items().eq(idx)[0].focus()};return self.on("keydown",function(e){var keyCode=e.keyCode;"INPUT"===e.target.nodeName&&(keyCode===VK.DOWN?(e.preventDefault(),self.fire("autocomplete"),focusIdx(0,self.menu)):keyCode===VK.UP&&(e.preventDefault(),focusIdx(-1,self.menu)))}),self._super()},remove:function(){$(this.getEl("inp")).off(),this.menu&&this.menu.remove(),this._super()}})}),define("tinymce.core.ui.ColorBox",["tinymce.core.ui.ComboBox"],function(ComboBox){"use strict";return ComboBox.extend({init:function(settings){var self=this;settings.spellcheck=!1,settings.onaction&&(settings.icon="none"),self._super(settings),self.classes.add("colorbox"),self.on("change keyup postrender",function(){self.repaintColor(self.value())})},repaintColor:function(value){var openElm=this.getEl("open"),elm=openElm?openElm.getElementsByTagName("i")[0]:null;if(elm)try{elm.style.background=value}catch(ex){}},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.state.get("rendered")&&self.repaintColor(e.value)}),self._super()}})}),define("tinymce.core.ui.PanelButton",["tinymce.core.ui.Button","tinymce.core.ui.FloatPanel"],function(Button,FloatPanel){"use strict";return Button.extend({showPanel:function(){var self=this,settings=self.settings;if(self.active(!0),self.panel)self.panel.show();else{var panelSettings=settings.panel;panelSettings.type&&(panelSettings={layout:"grid",items:panelSettings}),panelSettings.role=panelSettings.role||"dialog",panelSettings.popover=!0,panelSettings.autohide=!0,panelSettings.ariaRoot=!0,self.panel=new FloatPanel(panelSettings).on("hide",function(){self.active(!1)}).on("cancel",function(e){e.stopPropagation(),self.focus(),self.hidePanel()}).parent(self).renderTo(self.getContainerElm()),self.panel.fire("show"),self.panel.reflow()}self.panel.moveRel(self.getEl(),settings.popoverAlign||(self.isRtl()?["bc-tr","bc-tc"]:["bc-tl","bc-tc"]))},hidePanel:function(){this.panel&&this.panel.hide()},postRender:function(){var self=this;return self.aria("haspopup",!0),self.on("click",function(e){e.control===self&&(self.panel&&self.panel.visible()?self.hidePanel():(self.showPanel(),self.panel.focus(!!e.aria)))}),self._super()},remove:function(){return this.panel&&(this.panel.remove(),this.panel=null),this._super()}})}),define("tinymce.core.ui.ColorButton",["tinymce.core.ui.PanelButton","tinymce.core.dom.DOMUtils"],function(PanelButton,DomUtils){"use strict";var DOM=DomUtils.DOM;return PanelButton.extend({init:function(settings){this._super(settings),this.classes.add("colorbutton")},color:function(color){return color?(this._color=color,this.getEl("preview").style.backgroundColor=color,this):this._color},resetColor:function(){return this._color=null,this.getEl("preview").style.backgroundColor=null,this},renderHtml:function(){var id=this._id,prefix=this.classPrefix,text=this.state.get("text"),icon=this.settings.icon?prefix+"ico "+prefix+"i-"+this.settings.icon:"",image=this.settings.image?" style=\"background-image: url('"+this.settings.image+"')\"":"",textHtml="";return text&&(this.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+this.encode(text)+"</span>"),'<div id="'+id+'" class="'+this.classes+'" role="button" tabindex="-1" aria-haspopup="true"><button role="presentation" hidefocus="1" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+'<span id="'+id+'-preview" class="'+prefix+'preview"></span>'+textHtml+'</button><button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1"> <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this,onClickHandler=self.settings.onclick;return self.on("click",function(e){e.aria&&"down"==e.aria.key||e.control!=self||DOM.getParent(e.target,"."+self.classPrefix+"open")||(e.stopImmediatePropagation(),onClickHandler.call(self,e))}),delete self.settings.onclick,self._super()}})}),define("tinymce.core.ui.ColorPicker",["tinymce.core.ui.Widget","tinymce.core.ui.DragHelper","tinymce.core.ui.DomUtils","tinymce.core.util.Color"],function(Widget,DragHelper,DomUtils,Color){"use strict";return Widget.extend({Defaults:{classes:"widget colorpicker"},init:function(settings){this._super(settings)},postRender:function(){var hsv,hueRootElm,huePointElm,svRootElm,svPointElm,self=this,color=self.color();function getPos(elm,event){var x,y,pos=DomUtils.getPos(elm);return x=event.pageX-pos.x,y=event.pageY-pos.y,{x:x=Math.max(0,Math.min(x/elm.clientWidth,1)),y:y=Math.max(0,Math.min(y/elm.clientHeight,1))}}function updateColor(hsv,hueUpdate){var hue=(360-hsv.h)/360;DomUtils.css(huePointElm,{top:100*hue+"%"}),hueUpdate||DomUtils.css(svPointElm,{left:hsv.s+"%",top:100-hsv.v+"%"}),svRootElm.style.background=new Color({s:100,v:100,h:hsv.h}).toHex(),self.color().parse({s:hsv.s,v:hsv.v,h:hsv.h})}function updateSaturationAndValue(e){var pos;pos=getPos(svRootElm,e),hsv.s=100*pos.x,hsv.v=100*(1-pos.y),updateColor(hsv),self.fire("change")}function updateHue(e){var pos;pos=getPos(hueRootElm,e),(hsv=color.toHsv()).h=360*(1-pos.y),updateColor(hsv,!0),self.fire("change")}hueRootElm=self.getEl("h"),huePointElm=self.getEl("hp"),svRootElm=self.getEl("sv"),svPointElm=self.getEl("svp"),self._repaint=function(){updateColor(hsv=color.toHsv())},self._super(),self._svdraghelper=new DragHelper(self._id+"-sv",{start:updateSaturationAndValue,drag:updateSaturationAndValue}),self._hdraghelper=new DragHelper(self._id+"-h",{start:updateHue,drag:updateHue}),self._repaint()},rgb:function(){return this.color().toRgb()},value:function(value){if(!arguments.length)return this.color().toHex();this.color().parse(value),this._rendered&&this._repaint()},color:function(){return this._color||(this._color=new Color),this._color},renderHtml:function(){var hueHtml,id=this._id,prefix=this.classPrefix,stops="#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000";return hueHtml='<div id="'+id+'-h" class="'+prefix+'colorpicker-h" style="'+("background: -ms-linear-gradient(top,"+stops+");background: linear-gradient(to bottom,"+stops+");")+'">'+function getOldIeFallbackHtml(){var i,l,gradientPrefix,stopsList,html="";for(gradientPrefix="filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=",i=0,l=(stopsList=stops.split(",")).length-1;i<l;i++)html+='<div class="'+prefix+'colorpicker-h-chunk" style="height:'+100/l+"%;"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+");-ms-"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+')"></div>';return html}()+'<div id="'+id+'-hp" class="'+prefix+'colorpicker-h-marker"></div></div>','<div id="'+id+'" class="'+this.classes+'"><div id="'+id+'-sv" class="'+prefix+'colorpicker-sv"><div class="'+prefix+'colorpicker-overlay1"><div class="'+prefix+'colorpicker-overlay2"><div id="'+id+'-svp" class="'+prefix+'colorpicker-selector1"><div class="'+prefix+'colorpicker-selector2"></div></div></div></div></div>'+hueHtml+"</div>"}})}),define("tinymce.core.ui.Path",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({init:function(settings){var self=this;settings.delimiter||(settings.delimiter="»"),self._super(settings),self.classes.add("path"),self.canFocus=!0,self.on("click",function(e){var index;(index=e.target.getAttribute("data-index"))&&self.fire("select",{value:self.row()[index],index:index})}),self.row(self.settings.row)},focus:function(){return this.getEl().firstChild.focus(),this},row:function(row){return arguments.length?(this.state.set("row",row),this):this.state.get("row")},renderHtml:function(){return'<div id="'+this._id+'" class="'+this.classes+'">'+this._getDataPathHtml(this.state.get("row"))+"</div>"},bindStates:function(){var self=this;return self.state.on("change:row",function(e){self.innerHtml(self._getDataPathHtml(e.value))}),self._super()},_getDataPathHtml:function(data){var i,l,parts=data||[],html="",prefix=this.classPrefix;for(i=0,l=parts.length;i<l;i++)html+=(0<i?'<div class="'+prefix+'divider" aria-hidden="true"> '+this.settings.delimiter+" </div>":"")+'<div role="button" class="'+prefix+"path-item"+(i==l-1?" "+prefix+"last":"")+'" data-index="'+i+'" tabindex="-1" id="'+this._id+"-"+i+'" aria-level="'+(i+1)+'">'+parts[i].name+"</div>";return html=html||'<div class="'+prefix+'path-item"> </div>'}})}),define("tinymce.core.ui.ElementPath",["tinymce.core.ui.Path"],function(Path){return Path.extend({postRender:function(){var self=this,editor=self.settings.editor;function isHidden(elm){if(1===elm.nodeType){if("BR"==elm.nodeName||elm.getAttribute("data-mce-bogus"))return!0;if("bookmark"===elm.getAttribute("data-mce-type"))return!0}return!1}return!1!==editor.settings.elementpath&&(self.on("select",function(e){editor.focus(),editor.selection.select(this.row()[e.index].element),editor.nodeChanged()}),editor.on("nodeChange",function(e){for(var outParents=[],parents=e.parents,i=parents.length;i--;)if(1==parents[i].nodeType&&!isHidden(parents[i])){var args=editor.fire("ResolveName",{name:parents[i].nodeName.toLowerCase(),target:parents[i]});if(args.isDefaultPrevented()||outParents.push({name:args.name,element:parents[i]}),args.isPropagationStopped())break}self.row(outParents)})),self._super()}})}),define("tinymce.core.ui.FormItem",["tinymce.core.ui.Container"],function(Container){"use strict";return Container.extend({Defaults:{layout:"flex",align:"center",defaults:{flex:1}},renderHtml:function(){var layout=this._layout,prefix=this.classPrefix;return this.classes.add("formitem"),layout.preRender(this),'<div id="'+this._id+'" class="'+this.classes+'" hidefocus="1" tabindex="-1">'+(this.settings.title?'<div id="'+this._id+'-title" class="'+prefix+'title">'+this.settings.title+"</div>":"")+'<div id="'+this._id+'-body" class="'+this.bodyClasses+'">'+(this.settings.html||"")+layout.renderHtml(this)+"</div></div>"}})}),define("tinymce.core.ui.Form",["tinymce.core.ui.Container","tinymce.core.ui.FormItem","tinymce.core.util.Tools"],function(Container,FormItem,Tools){"use strict";return Container.extend({Defaults:{containerCls:"form",layout:"flex",direction:"column",align:"stretch",flex:1,padding:20,labelGap:30,spacing:10,callbacks:{submit:function(){this.submit()}}},preRender:function(){var self=this,items=self.items();self.settings.formItemDefaults||(self.settings.formItemDefaults={layout:"flex",autoResize:"overflow",defaults:{flex:1}}),items.each(function(ctrl){var formItem,label=ctrl.settings.label;label&&((formItem=new FormItem(Tools.extend({items:{type:"label",id:ctrl._id+"-l",text:label,flex:0,forId:ctrl._id,disabled:ctrl.disabled()}},self.settings.formItemDefaults))).type="formitem",ctrl.aria("labelledby",ctrl._id+"-l"),"undefined"==typeof ctrl.settings.flex&&(ctrl.settings.flex=1),self.replace(ctrl,formItem),formItem.add(ctrl))})},submit:function(){return this.fire("submit",{data:this.toJSON()})},postRender:function(){this._super(),this.fromJSON(this.settings.data)},bindStates:function(){var self=this;function recalcLabels(){var i,labelGap,maxLabelWidth=0,labels=[];if(!1!==self.settings.labelGapCalc)for(("children"==self.settings.labelGapCalc?self.find("formitem"):self.items()).filter("formitem").each(function(item){var labelCtrl=item.items()[0],labelWidth=labelCtrl.getEl().clientWidth;maxLabelWidth=maxLabelWidth<labelWidth?labelWidth:maxLabelWidth,labels.push(labelCtrl)}),labelGap=self.settings.labelGap||0,i=labels.length;i--;)labels[i].settings.minWidth=maxLabelWidth+labelGap}self._super(),self.on("show",recalcLabels),recalcLabels()}})}),define("tinymce.core.ui.FieldSet",["tinymce.core.ui.Form"],function(Form){"use strict";return Form.extend({Defaults:{containerCls:"fieldset",layout:"flex",direction:"column",align:"stretch",flex:1,padding:"25 15 5 15",labelGap:30,spacing:10,border:1},renderHtml:function(){var layout=this._layout,prefix=this.classPrefix;return this.preRender(),layout.preRender(this),'<fieldset id="'+this._id+'" class="'+this.classes+'" hidefocus="1" tabindex="-1">'+(this.settings.title?'<legend id="'+this._id+'-title" class="'+prefix+'fieldset-title">'+this.settings.title+"</legend>":"")+'<div id="'+this._id+'-body" class="'+this.bodyClasses+'">'+(this.settings.html||"")+layout.renderHtml(this)+"</div></fieldset>"}})}),define("tinymce.core.content.LinkTargets",["tinymce.core.dom.DOMUtils","tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Tools","tinymce.core.util.Uuid"],function(DOMUtils,NodeType,Arr,Fun,Tools,Uuid){var trim=Tools.trim,create=function(type,title,url,level,attach){return{type:type,title:title,url:url,level:level,attach:attach}},getElementText=function(elm){return elm.innerText||elm.textContent},isValidAnchor=function(elm){return function(elm){return elm&&"A"===elm.nodeName&&(elm.id||elm.name)}(elm)&&isEditable(elm)},isHeader=function(elm){return elm&&/^(H[1-6])$/.test(elm.nodeName)},isEditable=function(elm){return function(node){for(;node=node.parentNode;){var value=node.contentEditable;if(value&&"inherit"!==value)return NodeType.isContentEditableTrue(node)}return!1}(elm)&&!NodeType.isContentEditableFalse(elm)},isValidHeader=function(elm){return isHeader(elm)&&isEditable(elm)},headerTarget=function(elm){var headerId=function(elm){return elm.id?elm.id:Uuid.uuid("h")}(elm);return create("header",getElementText(elm),"#"+headerId,function(elm){return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0}(elm),function(){elm.id=headerId})},anchorTarget=function(elm){var anchorId=elm.id||elm.name,anchorText=getElementText(elm);return create("anchor",anchorText||"#"+anchorId,"#"+anchorId,0,Fun.noop)},getTargetElements=function(elm){var selector,root;return selector="h1,h2,h3,h4,h5,h6,a:not([href])",root=elm,DOMUtils.DOM.select(selector,root)},hasTitle=function(target){return 0<trim(target.title).length};return{find:function(elm){var elms=getTargetElements(elm);return Arr.filter(function(elms){return Arr.map(Arr.filter(elms,isValidHeader),headerTarget)}(elms).concat(function(elms){return Arr.map(Arr.filter(elms,isValidAnchor),anchorTarget)}(elms)),hasTitle)}}}),define("tinymce.core.ui.FilePicker",["global!window","tinymce.core.content.LinkTargets","tinymce.core.EditorManager","tinymce.core.ui.ComboBox","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.util.Tools"],function(window,LinkTargets,EditorManager,ComboBox,Arr,Fun,Tools){"use strict";var history={},toMenuItem=function(target){return{title:target.title,value:{title:{raw:target.title},url:target.url,attach:target.attach}}},staticMenuItem=function(title,url){return{title:title,value:{title:title,url:url,attach:Fun.noop}}},getSetting=function(editorSettings,name,defaultValue){var value=name in editorSettings?editorSettings[name]:defaultValue;return!1===value?null:value},createMenuItems=function(term,targets,fileType,editorSettings){var items,separator={title:"-"},fromHistoryMenuItems=function(history){var uniqueHistory=Arr.filter(history[fileType],function(url){return function(url,targets){return!Arr.find(targets,function(target){return target.url===url})}(url,targets)});return Tools.map(uniqueHistory,function(url){return{title:url,value:{title:url,url:url,attach:Fun.noop}}})},fromMenuItems=function(type){return function(targets){return Tools.map(targets,toMenuItem)}(Arr.filter(targets,function(target){return target.type==type}))};return!1===editorSettings.typeahead_urls?[]:"file"===fileType?(items=[filterByQuery(term,fromHistoryMenuItems(history)),filterByQuery(term,fromMenuItems("header")),filterByQuery(term,function(){var anchorMenuItems=fromMenuItems("anchor"),topAnchor=getSetting(editorSettings,"anchor_top","#top"),bottomAchor=getSetting(editorSettings,"anchor_bottom","#bottom");return null!==topAnchor&&anchorMenuItems.unshift(staticMenuItem("<top>",topAnchor)),null!==bottomAchor&&anchorMenuItems.push(staticMenuItem("<bottom>",bottomAchor)),anchorMenuItems}())],Arr.reduce(items,function(a,b){return 0===a.length||0===b.length?a.concat(b):a.concat(separator,b)},[])):filterByQuery(term,fromHistoryMenuItems(history))},filterByQuery=function(term,menuItems){var lowerCaseTerm=term.toLowerCase(),result=Tools.grep(menuItems,function(item){return-1!==item.title.toLowerCase().indexOf(lowerCaseTerm)});return 1===result.length&&result[0].title===term?[]:result},setupAutoCompleteHandler=function(ctrl,editorSettings,bodyElm,fileType){var autocomplete=function(term){var linkTargets=LinkTargets.find(bodyElm),menuItems=createMenuItems(term,linkTargets,fileType,editorSettings);ctrl.showAutoComplete(menuItems,term)};ctrl.on("autocomplete",function(){autocomplete(ctrl.value())}),ctrl.on("selectitem",function(e){var linkDetails=e.value;ctrl.value(linkDetails.url);var title=function(linkDetails){var title=linkDetails.title;return title.raw?title.raw:title}(linkDetails);"image"===fileType?ctrl.fire("change",{meta:{alt:title,attach:linkDetails.attach}}):ctrl.fire("change",{meta:{text:title,attach:linkDetails.attach}}),ctrl.focus()}),ctrl.on("click",function(e){0===ctrl.value().length&&"INPUT"===e.target.nodeName&&autocomplete("")}),ctrl.on("PostRender",function(){ctrl.getRoot().on("submit",function(e){e.isDefaultPrevented()||function(url,fileType){var items=history[fileType];/^https?/.test(url)&&(items?-1===Arr.indexOf(items,url)&&(history[fileType]=items.slice(0,5).concat(url)):history[fileType]=[url])}(ctrl.value(),fileType)})})},setupLinkValidatorHandler=function(ctrl,editorSettings,fileType){var validatorHandler=editorSettings.filepicker_validator_handler;if(validatorHandler){ctrl.state.on("change:value",function(e){var url;0!==(url=e.value).length?validatorHandler({url:url,type:fileType},function(result){var uiState=function(result){var status=result.status,message=result.message;return"valid"===status?{status:"ok",message:message}:"unknown"===status?{status:"warn",message:message}:"invalid"===status?{status:"warn",message:message}:{status:"none",message:""}}(result);ctrl.statusMessage(uiState.message),ctrl.statusLevel(uiState.status)}):ctrl.statusLevel("none")})}};return ComboBox.extend({init:function(settings){var actionCallback,fileBrowserCallback,fileBrowserCallbackTypes,self=this,editor=window.tinymce?window.tinymce.activeEditor:EditorManager.activeEditor,editorSettings=editor.settings,fileType=settings.filetype;settings.spellcheck=!1,(fileBrowserCallbackTypes=(fileBrowserCallbackTypes=editorSettings.file_picker_types||editorSettings.file_browser_callback_types)&&Tools.makeMap(fileBrowserCallbackTypes,/[, ]/))&&!fileBrowserCallbackTypes[fileType]||(!(fileBrowserCallback=editorSettings.file_picker_callback)||fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[fileType]?!(fileBrowserCallback=editorSettings.file_browser_callback)||fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[fileType]||(actionCallback=function(){fileBrowserCallback(self.getEl("inp").id,self.value(),fileType,window)}):actionCallback=function(){var meta=self.fire("beforecall").meta;meta=Tools.extend({filetype:fileType},meta),fileBrowserCallback.call(editor,function(value,meta){self.value(value).fire("change",{meta:meta})},self.value(),meta)}),actionCallback&&(settings.icon="browse",settings.onaction=actionCallback),self._super(settings),setupAutoCompleteHandler(self,editorSettings,editor.getBody(),fileType),setupLinkValidatorHandler(self,editorSettings,fileType)}})}),define("tinymce.core.ui.FitLayout",["tinymce.core.ui.AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var contLayoutRect=container.layoutRect(),paddingBox=container.paddingBox;container.items().filter(":visible").each(function(ctrl){ctrl.layoutRect({x:paddingBox.left,y:paddingBox.top,w:contLayoutRect.innerW-paddingBox.right-paddingBox.left,h:contLayoutRect.innerH-paddingBox.top-paddingBox.bottom}),ctrl.recalc&&ctrl.recalc()})}})}),define("tinymce.core.ui.FlexLayout",["tinymce.core.ui.AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var i,l,items,contLayoutRect,contPaddingBox,contSettings,align,pack,spacing,totalFlex,availableSpace,direction,ctrl,ctrlLayoutRect,flex,size,maxSize,ratio,rect,pos,maxAlignEndPos,sizeName,minSizeName,posName,maxSizeName,beforeName,innerSizeName,deltaSizeName,contentSizeName,alignAxisName,alignInnerSizeName,alignSizeName,alignMinSizeName,alignBeforeName,alignAfterName,alignDeltaSizeName,alignContentSizeName,maxSizeItems=[],max=Math.max,min=Math.min;for(items=container.items().filter(":visible"),contLayoutRect=container.layoutRect(),contPaddingBox=container.paddingBox,contSettings=container.settings,direction=container.isRtl()?contSettings.direction||"row-reversed":contSettings.direction,align=contSettings.align,pack=container.isRtl()?contSettings.pack||"end":contSettings.pack,spacing=contSettings.spacing||0,"row-reversed"!=direction&&"column-reverse"!=direction||(items=items.set(items.toArray().reverse()),direction=direction.split("-")[0]),alignContentSizeName="column"==direction?(posName="y",sizeName="h",minSizeName="minH",maxSizeName="maxH",innerSizeName="innerH",beforeName="top",deltaSizeName="deltaH",contentSizeName="contentH",alignBeforeName="left",alignSizeName="w",alignAxisName="x",alignInnerSizeName="innerW",alignMinSizeName="minW",alignAfterName="right",alignDeltaSizeName="deltaW","contentW"):(posName="x",sizeName="w",minSizeName="minW",maxSizeName="maxW",innerSizeName="innerW",beforeName="left",deltaSizeName="deltaW",contentSizeName="contentW",alignBeforeName="top",alignSizeName="h",alignAxisName="y",alignInnerSizeName="innerH",alignMinSizeName="minH",alignAfterName="bottom",alignDeltaSizeName="deltaH","contentH"),availableSpace=contLayoutRect[innerSizeName]-contPaddingBox[beforeName]-contPaddingBox[beforeName],maxAlignEndPos=totalFlex=0,i=0,l=items.length;i<l;i++)ctrlLayoutRect=(ctrl=items[i]).layoutRect(),availableSpace-=i<l-1?spacing:0,0<(flex=ctrl.settings.flex)&&(totalFlex+=flex,ctrlLayoutRect[maxSizeName]&&maxSizeItems.push(ctrl),ctrlLayoutRect.flex=flex),availableSpace-=ctrlLayoutRect[minSizeName],maxAlignEndPos<(size=contPaddingBox[alignBeforeName]+ctrlLayoutRect[alignMinSizeName]+contPaddingBox[alignAfterName])&&(maxAlignEndPos=size);if((rect={})[minSizeName]=availableSpace<0?contLayoutRect[minSizeName]-availableSpace+contLayoutRect[deltaSizeName]:contLayoutRect[innerSizeName]-availableSpace+contLayoutRect[deltaSizeName],rect[alignMinSizeName]=maxAlignEndPos+contLayoutRect[alignDeltaSizeName],rect[contentSizeName]=contLayoutRect[innerSizeName]-availableSpace,rect[alignContentSizeName]=maxAlignEndPos,rect.minW=min(rect.minW,contLayoutRect.maxW),rect.minH=min(rect.minH,contLayoutRect.maxH),rect.minW=max(rect.minW,contLayoutRect.startMinWidth),rect.minH=max(rect.minH,contLayoutRect.startMinHeight),!contLayoutRect.autoResize||rect.minW==contLayoutRect.minW&&rect.minH==contLayoutRect.minH){for(ratio=availableSpace/totalFlex,i=0,l=maxSizeItems.length;i<l;i++)(maxSize=(ctrlLayoutRect=(ctrl=maxSizeItems[i]).layoutRect())[maxSizeName])<(size=ctrlLayoutRect[minSizeName]+ctrlLayoutRect.flex*ratio)?(availableSpace-=ctrlLayoutRect[maxSizeName]-ctrlLayoutRect[minSizeName],totalFlex-=ctrlLayoutRect.flex,ctrlLayoutRect.flex=0,ctrlLayoutRect.maxFlexSize=maxSize):ctrlLayoutRect.maxFlexSize=0;for(ratio=availableSpace/totalFlex,pos=contPaddingBox[beforeName],rect={},0===totalFlex&&("end"==pack?pos=availableSpace+contPaddingBox[beforeName]:"center"==pack?(pos=Math.round(contLayoutRect[innerSizeName]/2-(contLayoutRect[innerSizeName]-availableSpace)/2)+contPaddingBox[beforeName])<0&&(pos=contPaddingBox[beforeName]):"justify"==pack&&(pos=contPaddingBox[beforeName],spacing=Math.floor(availableSpace/(items.length-1)))),rect[alignAxisName]=contPaddingBox[alignBeforeName],i=0,l=items.length;i<l;i++)size=(ctrlLayoutRect=(ctrl=items[i]).layoutRect()).maxFlexSize||ctrlLayoutRect[minSizeName],"center"===align?rect[alignAxisName]=Math.round(contLayoutRect[alignInnerSizeName]/2-ctrlLayoutRect[alignSizeName]/2):"stretch"===align?(rect[alignSizeName]=max(ctrlLayoutRect[alignMinSizeName]||0,contLayoutRect[alignInnerSizeName]-contPaddingBox[alignBeforeName]-contPaddingBox[alignAfterName]),rect[alignAxisName]=contPaddingBox[alignBeforeName]):"end"===align&&(rect[alignAxisName]=contLayoutRect[alignInnerSizeName]-ctrlLayoutRect[alignSizeName]-contPaddingBox.top),0<ctrlLayoutRect.flex&&(size+=ctrlLayoutRect.flex*ratio),rect[sizeName]=size,rect[posName]=pos,ctrl.layoutRect(rect),ctrl.recalc&&ctrl.recalc(),pos+=size+spacing}else if(rect.w=rect.minW,rect.h=rect.minH,container.layoutRect(rect),this.recalc(container),null===container._lastRect){var parentCtrl=container.parent();parentCtrl&&(parentCtrl._lastRect=null,parentCtrl.recalc())}}})}),define("tinymce.core.ui.FlowLayout",["tinymce.core.ui.Layout"],function(Layout){return Layout.extend({Defaults:{containerClass:"flow-layout",controlClass:"flow-layout-item",endClass:"break"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){ctrl.recalc&&ctrl.recalc()})},isNative:function(){return!0}})}),define("tinymce.core.fmt.FontInfo",["ephox.katamari.api.Fun","ephox.katamari.api.Option","ephox.sugar.api.node.Element","ephox.sugar.api.node.Node","tinymce.core.dom.DOMUtils"],function(Fun,Option,Element,Node,DOMUtils){var getFontProp=function(propName){return function(rootElm,elm){return Option.from(elm).map(Element.fromDom).filter(Node.isElement).bind(function(element){return function(propName,rootElm,elm){for(;elm!==rootElm;){if(elm.style[propName]){var foundStyle=elm.style[propName];return""!==foundStyle?Option.some(foundStyle):Option.none()}elm=elm.parentNode}return Option.none()}(propName,rootElm,element.dom()).or(function(propName,elm){return Option.from(DOMUtils.DOM.getStyle(elm,propName,!0))}(propName,element.dom()))}).getOr("")}};return{getFontSize:getFontProp("fontSize"),getFontFamily:Fun.compose(function(fontFamily){return fontFamily.replace(/[\'\"]/g,"").replace(/,\s+/g,",")},getFontProp("fontFamily")),toPt:function(fontSize){return/[0-9.]+px$/.test(fontSize)?Math.round(72*parseInt(fontSize,10)/96)+"pt":fontSize}}}),define("tinymce.core.ui.FormatControls",["tinymce.core.ui.Control","tinymce.core.ui.Widget","tinymce.core.ui.FloatPanel","tinymce.core.util.Tools","tinymce.core.util.Arr","tinymce.core.dom.DOMUtils","tinymce.core.EditorManager","tinymce.core.Env","tinymce.core.fmt.FontInfo"],function(Control,Widget,FloatPanel,Tools,Arr,DOMUtils,EditorManager,Env,FontInfo){var each=Tools.each;return EditorManager.on("AddEditor",function(e){var editor=e.editor;!function setupRtlMode(editor){editor.on("ScriptsLoaded",function(){editor.rtl&&(Control.rtl=!0)})}(editor),function registerControls(editor){var formatMenu;function createFormats(formats){for(var i=(formats=formats.replace(/;$/,"").split(";")).length;i--;)formats[i]=formats[i].split("=");return formats}function initOnPostRender(name){return function(){var self=this;editor.formatter?editor.formatter.formatChanged(name,function(state){self.active(state)}):editor.on("init",function(){editor.formatter.formatChanged(name,function(state){self.active(state)})})}}function toggleUndoRedoState(type){return function(){var self=this;function checkState(){var typeFn="redo"==type?"hasRedo":"hasUndo";return!!editor.undoManager&&editor.undoManager[typeFn]()}self.disabled(!checkState()),editor.on("Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",function(){self.disabled(editor.readonly||!checkState())})}}formatMenu=function createFormatMenu(){var count=0,newFormats=[],defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}];function createMenu(formats){var menu=[];if(formats)return each(formats,function(format){var menuItem={text:format.title,icon:format.icon};if(format.items)menuItem.menu=createMenu(format.items);else{var formatName=format.format||"custom"+count++;format.format||(format.name=formatName,newFormats.push(format)),menuItem.format=formatName,menuItem.cmd=format.cmd}menu.push(menuItem)}),menu}return editor.on("init",function(){each(newFormats,function(format){editor.formatter.register(format.name,format)})}),{type:"menu",items:function createStylesMenu(){return editor.settings.style_formats_merge?editor.settings.style_formats?createMenu(defaultStyleFormats.concat(editor.settings.style_formats)):createMenu(defaultStyleFormats):createMenu(editor.settings.style_formats||defaultStyleFormats)}(),onPostRender:function(e){editor.fire("renderFormatsMenu",{control:e.control})},itemDefaults:{preview:!0,textStyle:function(){if(this.settings.format)return editor.formatter.getCssText(this.settings.format)},onPostRender:function(){var self=this;self.parent().on("show",function(){var formatName,command;(formatName=self.settings.format)&&(self.disabled(!editor.formatter.canApply(formatName)),self.active(editor.formatter.match(formatName))),(command=self.settings.cmd)&&self.active(editor.queryCommandState(command))})},onclick:function(){this.settings.format&&toggleFormat(this.settings.format),this.settings.cmd&&editor.execCommand(this.settings.cmd)}}}}(),each({bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript"},function(text,name){editor.addButton(name,{tooltip:text,onPostRender:initOnPostRender(name),onclick:function(){toggleFormat(name)}})}),each({outdent:["Decrease indent","Outdent"],indent:["Increase indent","Indent"],cut:["Cut","Cut"],copy:["Copy","Copy"],paste:["Paste","Paste"],help:["Help","mceHelp"],selectall:["Select all","SelectAll"],removeformat:["Clear formatting","RemoveFormat"],visualaid:["Visual aids","mceToggleVisualAid"],newdocument:["New document","mceNewDocument"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1]})}),each({blockquote:["Blockquote","mceBlockQuote"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],alignleft:["Align left","JustifyLeft"],aligncenter:["Align center","JustifyCenter"],alignright:["Align right","JustifyRight"],alignjustify:["Justify","JustifyFull"],alignnone:["No alignment","JustifyNone"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1],onPostRender:initOnPostRender(name)})});var trimMenuItems=function(menuItems){var outputMenuItems=menuItems;return 0<outputMenuItems.length&&"-"===outputMenuItems[0].text&&(outputMenuItems=outputMenuItems.slice(1)),0<outputMenuItems.length&&"-"===outputMenuItems[outputMenuItems.length-1].text&&(outputMenuItems=outputMenuItems.slice(0,outputMenuItems.length-1)),outputMenuItems},createCustomMenuItems=function(names){var items,nameList,ar;if("string"==typeof names)nameList=names.split(" ");else if(Tools.isArray(names))return ar=Tools.map(names,createCustomMenuItems),Arr.reduce(ar,function(result,item){return result.concat(item)},[]);return items=Tools.grep(nameList,function(name){return"|"===name||name in editor.menuItems}),Tools.map(items,function(name){return"|"===name?{text:"-"}:editor.menuItems[name]})},createInsertMenu=function(editorSettings){return editorSettings.insert_button_items?trimMenuItems(createCustomMenuItems(editorSettings.insert_button_items)):trimMenuItems((context="insert",outputMenuItems=[{text:"-"}],menuItems=Tools.grep(editor.menuItems,function(menuItem){return menuItem.context===context}),Tools.each(menuItems,function(menuItem){"before"==menuItem.separator&&outputMenuItems.push({text:"|"}),menuItem.prependToContext?outputMenuItems.unshift(menuItem):outputMenuItems.push(menuItem),"after"==menuItem.separator&&outputMenuItems.push({text:"|"})}),outputMenuItems));var context,outputMenuItems,menuItems};function toggleFormat(fmt){fmt.control&&(fmt=fmt.control.value()),fmt&&editor.execCommand("mceToggleFormat",!1,fmt)}function hideFormatMenuItems(menu){var count=menu.items().length;return menu.items().each(function(item){item.menu&&item.visible(0<hideFormatMenuItems(item.menu)),!item.menu&&item.settings.menu&&item.visible(0<function hideMenuObjects(menu){var count=menu.length;return Tools.each(menu,function(item){item.menu&&(item.hidden=0===hideMenuObjects(item.menu));var formatName=item.format;formatName&&(item.hidden=!editor.formatter.canApply(formatName)),item.hidden&&count--}),count}(item.settings.menu));var formatName=item.settings.format;formatName&&item.visible(editor.formatter.canApply(formatName)),item.visible()||count--}),count}editor.addButton("undo",{tooltip:"Undo",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"}),editor.addButton("redo",{tooltip:"Redo",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"}),editor.addMenuItem("newdocument",{text:"New document",icon:"newdocument",cmd:"mceNewDocument"}),editor.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"}),editor.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"}),editor.addMenuItem("visualaid",{text:"Visual aids",selectable:!0,onPostRender:function toggleVisualAidState(){var self=this;editor.on("VisualAid",function(e){self.active(e.hasVisual)}),self.active(editor.hasVisual)},cmd:"mceToggleVisualAid"}),editor.addButton("remove",{tooltip:"Remove",icon:"remove",cmd:"Delete"}),editor.addButton("insert",{type:"menubutton",icon:"insert",menu:[],oncreatemenu:function(){this.menu.add(createInsertMenu(editor.settings)),this.menu.renderNew()}}),each({cut:["Cut","Cut","Meta+X"],copy:["Copy","Copy","Meta+C"],paste:["Paste","Paste","Meta+V"],selectall:["Select all","SelectAll","Meta+A"],bold:["Bold","Bold","Meta+B"],italic:["Italic","Italic","Meta+I"],underline:["Underline","Underline","Meta+U"],strikethrough:["Strikethrough","Strikethrough"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],removeformat:["Clear formatting","RemoveFormat"]},function(item,name){editor.addMenuItem(name,{text:item[0],icon:name,shortcut:item[2],cmd:item[1]})}),editor.on("mousedown",function(){FloatPanel.hideAll()}),editor.addButton("styleselect",{type:"menubutton",text:"Formats",menu:formatMenu,onShowMenu:function(){editor.settings.style_formats_autohide&&hideFormatMenuItems(this.menu)}}),editor.addButton("formatselect",function(){var items=[],blocks=createFormats(editor.settings.block_formats||"Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre");return each(blocks,function(block){items.push({text:block[0],value:block[1],textStyle:function(){return editor.formatter.getCssText(block[1])}})}),{type:"listbox",text:blocks[0][0],values:items,fixedWidth:!0,onselect:toggleFormat,onPostRender:function createListBoxChangeHandler(items,formatName){return function(){var self=this;editor.on("nodeChange",function(e){var formatter=editor.formatter,value=null;each(e.parents,function(node){if(each(items,function(item){if(formatName?formatter.matchNode(node,formatName,{value:item.value})&&(value=item.value):formatter.matchNode(node,item.value)&&(value=item.value),value)return!1}),value)return!1}),self.value(value)})}}(items)}}),editor.addButton("fontselect",function(){var items=[],fonts=createFormats(editor.settings.font_formats||"Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats");return each(fonts,function(font){items.push({text:{raw:font[0]},value:font[1],textStyle:-1==font[1].indexOf("dings")?"font-family:"+font[1]:""})}),{type:"listbox",text:"Font Family",tooltip:"Font Family",values:items,fixedWidth:!0,onPostRender:function createFontNameListBoxChangeHandler(items){return function(){var self=this,getFirstFont=function(fontFamily){return fontFamily?fontFamily.split(",")[0]:""};editor.on("nodeChange",function(e){var fontFamily,value=null;fontFamily=FontInfo.getFontFamily(editor.getBody(),e.element),each(items,function(item){item.value.toLowerCase()===fontFamily.toLowerCase()&&(value=item.value)}),each(items,function(item){value||getFirstFont(item.value).toLowerCase()!==getFirstFont(fontFamily).toLowerCase()||(value=item.value)}),self.value(value),!value&&fontFamily&&self.text(getFirstFont(fontFamily))})}}(items),onselect:function(e){e.control.settings.value&&editor.execCommand("FontName",!1,e.control.settings.value)}}}),editor.addButton("fontsizeselect",function(){var items=[],fontsizeFormats=editor.settings.fontsize_formats||"8pt 10pt 12pt 14pt 18pt 24pt 36pt";return each(fontsizeFormats.split(" "),function(item){var text=item,value=item,values=item.split("=");1<values.length&&(text=values[0],value=values[1]),items.push({text:text,value:value})}),{type:"listbox",text:"Font Sizes",tooltip:"Font Sizes",values:items,fixedWidth:!0,onPostRender:function createFontSizeListBoxChangeHandler(items){return function(){var self=this;editor.on("nodeChange",function(e){var px,pt,value=null;px=FontInfo.getFontSize(editor.getBody(),e.element),pt=FontInfo.toPt(px),each(items,function(item){item.value===px?value=px:item.value===pt&&(value=pt)}),self.value(value),value||self.text(pt)})}}(items),onclick:function(e){e.control.settings.value&&editor.execCommand("FontSize",!1,e.control.settings.value)}}}),editor.addMenuItem("formats",{text:"Formats",menu:formatMenu})}(editor),function setupContainer(editor){editor.settings.ui_container&&(Env.container=DOMUtils.DOM.select(editor.settings.ui_container)[0])}(editor)}),Control.translate=function(text){return EditorManager.translate(text)},Widget.tooltips=!Env.iOS,{}}),define("tinymce.core.ui.GridLayout",["tinymce.core.ui.AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var settings,rows,cols,items,contLayoutRect,width,height,rect,ctrlLayoutRect,ctrl,x,y,posX,posY,ctrlSettings,contPaddingBox,align,spacingH,spacingV,alignH,alignV,maxX,maxY,ctrlMinWidth,ctrlMinHeight,availableWidth,availableHeight,reverseRows,colWidths=[],rowHeights=[];settings=container.settings,items=container.items().filter(":visible"),contLayoutRect=container.layoutRect(),cols=settings.columns||Math.ceil(Math.sqrt(items.length)),rows=Math.ceil(items.length/cols),spacingH=settings.spacingH||settings.spacing||0,spacingV=settings.spacingV||settings.spacing||0,alignH=settings.alignH||settings.align,alignV=settings.alignV||settings.align,contPaddingBox=container.paddingBox,reverseRows="reverseRows"in settings?settings.reverseRows:container.isRtl(),alignH&&"string"==typeof alignH&&(alignH=[alignH]),alignV&&"string"==typeof alignV&&(alignV=[alignV]);for(x=0;x<cols;x++)colWidths.push(0);for(y=0;y<rows;y++)rowHeights.push(0);for(y=0;y<rows;y++)for(x=0;x<cols&&(ctrl=items[y*cols+x]);x++)ctrlMinWidth=(ctrlLayoutRect=ctrl.layoutRect()).minW,ctrlMinHeight=ctrlLayoutRect.minH,colWidths[x]=ctrlMinWidth>colWidths[x]?ctrlMinWidth:colWidths[x],rowHeights[y]=ctrlMinHeight>rowHeights[y]?ctrlMinHeight:rowHeights[y];for(availableWidth=contLayoutRect.innerW-contPaddingBox.left-contPaddingBox.right,x=maxX=0;x<cols;x++)maxX+=colWidths[x]+(0<x?spacingH:0),availableWidth-=(0<x?spacingH:0)+colWidths[x];for(availableHeight=contLayoutRect.innerH-contPaddingBox.top-contPaddingBox.bottom,y=maxY=0;y<rows;y++)maxY+=rowHeights[y]+(0<y?spacingV:0),availableHeight-=(0<y?spacingV:0)+rowHeights[y];if(maxX+=contPaddingBox.left+contPaddingBox.right,maxY+=contPaddingBox.top+contPaddingBox.bottom,(rect={}).minW=maxX+(contLayoutRect.w-contLayoutRect.innerW),rect.minH=maxY+(contLayoutRect.h-contLayoutRect.innerH),rect.contentW=rect.minW-contLayoutRect.deltaW,rect.contentH=rect.minH-contLayoutRect.deltaH,rect.minW=Math.min(rect.minW,contLayoutRect.maxW),rect.minH=Math.min(rect.minH,contLayoutRect.maxH),rect.minW=Math.max(rect.minW,contLayoutRect.startMinWidth),rect.minH=Math.max(rect.minH,contLayoutRect.startMinHeight),!contLayoutRect.autoResize||rect.minW==contLayoutRect.minW&&rect.minH==contLayoutRect.minH){var flexV;contLayoutRect.autoResize&&((rect=container.layoutRect(rect)).contentW=rect.minW-contLayoutRect.deltaW,rect.contentH=rect.minH-contLayoutRect.deltaH),flexV="start"==settings.packV?0:0<availableHeight?Math.floor(availableHeight/rows):0;var totalFlex=0,flexWidths=settings.flexWidths;if(flexWidths)for(x=0;x<flexWidths.length;x++)totalFlex+=flexWidths[x];else totalFlex=cols;var ratio=availableWidth/totalFlex;for(x=0;x<cols;x++)colWidths[x]+=flexWidths?flexWidths[x]*ratio:ratio;for(posY=contPaddingBox.top,y=0;y<rows;y++){for(posX=contPaddingBox.left,height=rowHeights[y]+flexV,x=0;x<cols&&(ctrl=items[reverseRows?y*cols+cols-1-x:y*cols+x]);x++)ctrlSettings=ctrl.settings,ctrlLayoutRect=ctrl.layoutRect(),width=Math.max(colWidths[x],ctrlLayoutRect.startMinWidth),ctrlLayoutRect.x=posX,ctrlLayoutRect.y=posY,"center"==(align=ctrlSettings.alignH||(alignH?alignH[x]||alignH[0]:null))?ctrlLayoutRect.x=posX+width/2-ctrlLayoutRect.w/2:"right"==align?ctrlLayoutRect.x=posX+width-ctrlLayoutRect.w:"stretch"==align&&(ctrlLayoutRect.w=width),"center"==(align=ctrlSettings.alignV||(alignV?alignV[x]||alignV[0]:null))?ctrlLayoutRect.y=posY+height/2-ctrlLayoutRect.h/2:"bottom"==align?ctrlLayoutRect.y=posY+height-ctrlLayoutRect.h:"stretch"==align&&(ctrlLayoutRect.h=height),ctrl.layoutRect(ctrlLayoutRect),posX+=width+spacingH,ctrl.recalc&&ctrl.recalc();posY+=height+spacingV}}else if(rect.w=rect.minW,rect.h=rect.minH,container.layoutRect(rect),this.recalc(container),null===container._lastRect){var parentCtrl=container.parent();parentCtrl&&(parentCtrl._lastRect=null,parentCtrl.recalc())}}})}),define("tinymce.core.ui.Iframe",["tinymce.core.ui.Widget","tinymce.core.util.Delay"],function(Widget,Delay){"use strict";return Widget.extend({renderHtml:function(){return this.classes.add("iframe"),this.canFocus=!1,'<iframe id="'+this._id+'" class="'+this.classes+'" tabindex="-1" src="'+(this.settings.url||"javascript:''")+'" frameborder="0"></iframe>'},src:function(src){this.getEl().src=src},html:function(html,callback){var self=this,body=this.getEl().contentWindow.document.body;return body?(body.innerHTML=html,callback&&callback()):Delay.setTimeout(function(){self.html(html)}),this}})}),define("tinymce.core.ui.InfoBox",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({init:function(settings){this._super(settings),this.classes.add("widget").add("infobox"),this.canFocus=!1},severity:function(level){this.classes.remove("error"),this.classes.remove("warning"),this.classes.remove("success"),this.classes.add(level)},help:function(state){this.state.set("help",state)},renderHtml:function(){var prefix=this.classPrefix;return'<div id="'+this._id+'" class="'+this.classes+'"><div id="'+this._id+'-body">'+this.encode(this.state.get("text"))+'<button role="button" tabindex="-1"><i class="'+prefix+"ico "+prefix+'i-help"></i></button></div></div>'},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl("body").firstChild.data=self.encode(e.value),self.state.get("rendered")&&self.updateLayoutRect()}),self.state.on("change:help",function(e){self.classes.toggle("has-help",e.value),self.state.get("rendered")&&self.updateLayoutRect()}),self._super()}})}),define("tinymce.core.ui.Label",["tinymce.core.ui.Widget","tinymce.core.ui.DomUtils"],function(Widget,DomUtils){"use strict";return Widget.extend({init:function(settings){this._super(settings),this.classes.add("widget").add("label"),this.canFocus=!1,settings.multiline&&this.classes.add("autoscroll"),settings.strong&&this.classes.add("strong")},initLayoutRect:function(){var layoutRect=this._super();this.settings.multiline&&(DomUtils.getSize(this.getEl()).width>layoutRect.maxW&&(layoutRect.minW=layoutRect.maxW,this.classes.add("multiline")),this.getEl().style.width=layoutRect.minW+"px",layoutRect.startMinH=layoutRect.h=layoutRect.minH=Math.min(layoutRect.maxH,DomUtils.getSize(this.getEl()).height));return layoutRect},repaint:function(){return this.settings.multiline||(this.getEl().style.lineHeight=this.layoutRect().h+"px"),this._super()},severity:function(level){this.classes.remove("error"),this.classes.remove("warning"),this.classes.remove("success"),this.classes.add(level)},renderHtml:function(){var targetCtrl,forName,forId=this.settings.forId,text=this.settings.html?this.settings.html:this.encode(this.state.get("text"));return!forId&&(forName=this.settings.forName)&&(targetCtrl=this.getRoot().find("#"+forName)[0])&&(forId=targetCtrl._id),forId?'<label id="'+this._id+'" class="'+this.classes+'"'+(forId?' for="'+forId+'"':"")+">"+text+"</label>":'<span id="'+this._id+'" class="'+this.classes+'">'+text+"</span>"},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.innerHtml(self.encode(e.value)),self.state.get("rendered")&&self.updateLayoutRect()}),self._super()}})}),define("tinymce.core.ui.Toolbar",["tinymce.core.ui.Container"],function(Container){"use strict";return Container.extend({Defaults:{role:"toolbar",layout:"flow"},init:function(settings){this._super(settings),this.classes.add("toolbar")},postRender:function(){return this.items().each(function(ctrl){ctrl.classes.add("toolbar-item")}),this._super()}})}),define("tinymce.core.ui.MenuBar",["tinymce.core.ui.Toolbar"],function(Toolbar){"use strict";return Toolbar.extend({Defaults:{role:"menubar",containerCls:"menubar",ariaRoot:!0,defaults:{type:"menubutton"}}})}),define("tinymce.core.ui.MenuButton",["tinymce.core.ui.Button","tinymce.core.ui.Factory","tinymce.core.ui.MenuBar"],function(Button,Factory,MenuBar){"use strict";var MenuButton=Button.extend({init:function(settings){this._renderOpen=!0,this._super(settings),settings=this.settings,this.classes.add("menubtn"),settings.fixedWidth&&this.classes.add("fixed-width"),this.aria("haspopup",!0),this.state.set("menu",settings.menu||this.render())},showMenu:function(toggle){var menu,self=this;if(self.menu&&self.menu.visible()&&!1!==toggle)return self.hideMenu();self.menu||((menu=self.state.get("menu")||[]).length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",menu.renderTo?self.menu=menu.parent(self).show().renderTo():self.menu=Factory.create(menu).parent(self).renderTo(),self.fire("createmenu"),self.menu.reflow(),self.menu.on("cancel",function(e){e.control.parent()===self.menu&&(e.stopPropagation(),self.focus(),self.hideMenu())}),self.menu.on("select",function(){self.focus()}),self.menu.on("show hide",function(e){e.control==self.menu&&self.activeMenu("show"==e.type),self.aria("expanded","show"==e.type)}).fire("show")),self.menu.show(),self.menu.layoutRect({w:self.layoutRect().w}),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"]),self.fire("showmenu")},hideMenu:function(){this.menu&&(this.menu.items().each(function(item){item.hideMenu&&item.hideMenu()}),this.menu.hide())},activeMenu:function(state){this.classes.toggle("active",state)},renderHtml:function(){var image,id=this._id,prefix=this.classPrefix,icon=this.settings.icon,text=this.state.get("text"),textHtml="";return image=(image=this.settings.image)?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1])," style=\"background-image: url('"+image+"')\""):"",text&&(this.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+this.encode(text)+"</span>"),icon=this.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",this.aria("role",this.parent()instanceof MenuBar?"menuitem":"button"),'<div id="'+id+'" class="'+this.classes+'" tabindex="-1" aria-labelledby="'+id+'"><button id="'+id+'-open" role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+' <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this;return self.on("click",function(e){e.control===self&&function isChildOf(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1}(e.target,self.getEl())&&(self.focus(),self.showMenu(!e.aria),e.aria&&self.menu.items().filter(":visible")[0].focus())}),self.on("mouseenter",function(e){var hasVisibleSiblingMenu,overCtrl=e.control,parent=self.parent();overCtrl&&parent&&overCtrl instanceof MenuButton&&overCtrl.parent()==parent&&(parent.items().filter("MenuButton").each(function(ctrl){ctrl.hideMenu&&ctrl!=overCtrl&&(ctrl.menu&&ctrl.menu.visible()&&(hasVisibleSiblingMenu=!0),ctrl.hideMenu())}),hasVisibleSiblingMenu&&(overCtrl.focus(),overCtrl.showMenu()))}),self._super()},bindStates:function(){var self=this;return self.state.on("change:menu",function(){self.menu&&self.menu.remove(),self.menu=null}),self._super()},remove:function(){this._super(),this.menu&&this.menu.remove()}});return MenuButton}),define("tinymce.core.ui.MenuItem",["tinymce.core.ui.Widget","tinymce.core.ui.Factory","tinymce.core.Env","tinymce.core.util.Delay"],function(Widget,Factory,Env,Delay){"use strict";return Widget.extend({Defaults:{border:0,role:"menuitem"},init:function(settings){var text;this._super(settings),settings=this.settings,this.classes.add("menu-item"),settings.menu&&this.classes.add("menu-item-expand"),settings.preview&&this.classes.add("menu-item-preview"),"-"!==(text=this.state.get("text"))&&"|"!==text||(this.classes.add("menu-item-sep"),this.aria("role","separator"),this.state.set("text","-")),settings.selectable&&(this.aria("role","menuitemcheckbox"),this.classes.add("menu-item-checkbox"),settings.icon="selected"),settings.preview||settings.selectable||this.classes.add("menu-item-normal"),this.on("mousedown",function(e){e.preventDefault()}),settings.menu&&!settings.ariaHideMenu&&this.aria("haspopup",!0)},hasMenus:function(){return!!this.settings.menu},showMenu:function(){var menu,self=this,settings=self.settings,parent=self.parent();if(parent.items().each(function(ctrl){ctrl!==self&&ctrl.hideMenu()}),settings.menu){(menu=self.menu)?menu.show():((menu=settings.menu).length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",parent.settings.itemDefaults&&(menu.itemDefaults=parent.settings.itemDefaults),(menu=self.menu=Factory.create(menu).parent(self).renderTo()).reflow(),menu.on("cancel",function(e){e.stopPropagation(),self.focus(),menu.hide()}),menu.on("show hide",function(e){e.control.items&&e.control.items().each(function(ctrl){ctrl.active(ctrl.settings.selected)})}).fire("show"),menu.on("hide",function(e){e.control===menu&&self.classes.remove("selected")}),menu.submenu=!0),menu._parentMenu=parent,menu.classes.add("menu-sub");var rel=menu.testMoveRel(self.getEl(),self.isRtl()?["tl-tr","bl-br","tr-tl","br-bl"]:["tr-tl","br-bl","tl-tr","bl-br"]);menu.moveRel(self.getEl(),rel),rel="menu-sub-"+(menu.rel=rel),menu.classes.remove(menu._lastRel).add(rel),menu._lastRel=rel,self.classes.add("selected"),self.aria("expanded",!0)}},hideMenu:function(){return this.menu&&(this.menu.items().each(function(item){item.hideMenu&&item.hideMenu()}),this.menu.hide(),this.aria("expanded",!1)),this},renderHtml:function(){var iconHtml,id=this._id,settings=this.settings,prefix=this.classPrefix,text=this.state.get("text"),icon=this.settings.icon,image="",shortcut=settings.shortcut,url=this.encode(settings.url);function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function markMatches(text){var match=settings.match||"";return match?text.replace(new RegExp(escapeRegExp(match),"gi"),function(match){return"!mce~match["+match+"]mce~match!"}):text}function boldMatches(text){return text.replace(new RegExp(escapeRegExp("!mce~match["),"g"),"<b>").replace(new RegExp(escapeRegExp("]mce~match!"),"g"),"</b>")}return icon&&this.parent().classes.add("menu-has-icons"),settings.image&&(image=" style=\"background-image: url('"+settings.image+"')\""),shortcut=shortcut&&function convertShortcut(shortcut){var i,value,replace={};for(replace=Env.mac?{alt:"&#x2325;",ctrl:"&#x2318;",shift:"&#x21E7;",meta:"&#x2318;"}:{meta:"Ctrl"},shortcut=shortcut.split("+"),i=0;i<shortcut.length;i++)(value=replace[shortcut[i].toLowerCase()])&&(shortcut[i]=value);return shortcut.join("+")}(shortcut),icon=prefix+"ico "+prefix+"i-"+(this.settings.icon||"none"),iconHtml="-"!==text?'<i class="'+icon+'"'+image+"></i> ":"",text=boldMatches(this.encode(markMatches(text))),url=boldMatches(this.encode(markMatches(url))),'<div id="'+id+'" class="'+this.classes+'" tabindex="-1">'+iconHtml+("-"!==text?'<span id="'+id+'-text" class="'+prefix+'text">'+text+"</span>":"")+(shortcut?'<div id="'+id+'-shortcut" class="'+prefix+'menu-shortcut">'+shortcut+"</div>":"")+(settings.menu?'<div class="'+prefix+'caret"></div>':"")+(url?'<div class="'+prefix+'menu-item-link">'+url+"</div>":"")+"</div>"},postRender:function(){var self=this,settings=self.settings,textStyle=settings.textStyle;if("function"==typeof textStyle&&(textStyle=textStyle.call(this)),textStyle){var textElm=self.getEl("text");textElm&&textElm.setAttribute("style",textStyle)}return self.on("mouseenter click",function(e){e.control===self&&(settings.menu||"click"!==e.type?(self.showMenu(),e.aria&&self.menu.focus(!0)):(self.fire("select"),Delay.requestAnimationFrame(function(){self.parent().hideAll()})))}),self._super(),self},hover:function(){return this.parent().items().each(function(ctrl){ctrl.classes.remove("selected")}),this.classes.toggle("selected",!0),this},active:function(state){return void 0!==state&&this.aria("checked",state),this._super(state)},remove:function(){this._super(),this.menu&&this.menu.remove()}})}),define("tinymce.core.ui.Throbber",["tinymce.core.dom.DomQuery","tinymce.core.ui.Control","tinymce.core.util.Delay"],function($,Control,Delay){"use strict";return function(elm,inline){var state,timer,self=this,classPrefix=Control.classPrefix;self.show=function(time,callback){function render(){state&&($(elm).append('<div class="'+classPrefix+"throbber"+(inline?" "+classPrefix+"throbber-inline":"")+'"></div>'),callback&&callback())}return self.hide(),state=!0,time?timer=Delay.setTimeout(render,time):render(),self},self.hide=function(){var child=elm.lastChild;return Delay.clearTimeout(timer),child&&-1!=child.className.indexOf("throbber")&&child.parentNode.removeChild(child),state=!1,self}}}),define("tinymce.core.ui.Menu",["tinymce.core.ui.FloatPanel","tinymce.core.ui.MenuItem","tinymce.core.ui.Throbber","tinymce.core.util.Tools"],function(FloatPanel,MenuItem,Throbber,Tools){"use strict";return FloatPanel.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"application",bodyRole:"menu",ariaRoot:!0},init:function(settings){if(settings.autohide=!0,settings.constrainToViewport=!0,"function"==typeof settings.items&&(settings.itemsFactory=settings.items,settings.items=[]),settings.itemDefaults)for(var items=settings.items,i=items.length;i--;)items[i]=Tools.extend({},settings.itemDefaults,items[i]);this._super(settings),this.classes.add("menu")},repaint:function(){return this.classes.toggle("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){this.hideAll(),this.fire("select")},load:function(){var time,self=this;function hideThrobber(){self.throbber&&(self.throbber.hide(),self.throbber=null)}self.settings.itemsFactory&&(self.throbber||(self.throbber=new Throbber(self.getEl("body"),!0),0===self.items().length?(self.throbber.show(),self.fire("loading")):self.throbber.show(100,function(){self.items().remove(),self.fire("loading")}),self.on("hide close",hideThrobber)),self.requestTime=time=(new Date).getTime(),self.settings.itemsFactory(function(items){0!==items.length?self.requestTime===time&&(self.getEl().style.width="",self.getEl("body").style.width="",hideThrobber(),self.items().remove(),self.getEl("body").innerHTML="",self.add(items),self.renderNew(),self.fire("loaded")):self.hide()}))},hideAll:function(){return this.find("menuitem").exec("hideMenu"),this._super()},preRender:function(){var self=this;return self.items().each(function(ctrl){var settings=ctrl.settings;if(settings.icon||settings.image||settings.selectable)return!(self._hasIcons=!0)}),self.settings.itemsFactory&&self.on("postrender",function(){self.settings.itemsFactory&&self.load()}),self._super()}})}),define("tinymce.core.ui.ListBox",["tinymce.core.ui.MenuButton","tinymce.core.ui.Menu"],function(MenuButton,Menu){"use strict";return MenuButton.extend({init:function(settings){var values,selected,selectedText,lastItemCtrl,self=this;self._super(settings),settings=self.settings,self._values=values=settings.values,values&&("undefined"!=typeof settings.value&&function setSelected(menuValues){for(var i=0;i<menuValues.length;i++){if(selected=menuValues[i].selected||settings.value===menuValues[i].value)return selectedText=selectedText||menuValues[i].text,self.state.set("value",menuValues[i].value),!0;if(menuValues[i].menu&&setSelected(menuValues[i].menu))return!0}}(values),!selected&&0<values.length&&(selectedText=values[0].text,self.state.set("value",values[0].value)),self.state.set("menu",values)),self.state.set("text",settings.text||selectedText),self.classes.add("listbox"),self.on("select",function(e){var ctrl=e.control;lastItemCtrl&&(e.lastControl=lastItemCtrl),settings.multiple?ctrl.active(!ctrl.active()):self.value(e.control.value()),lastItemCtrl=ctrl})},bindStates:function(){var self=this;return self.on("show",function(e){!function activateMenuItemsByValue(menu,value){menu instanceof Menu&&menu.items().each(function(ctrl){ctrl.hasMenus()||ctrl.active(ctrl.value()===value)})}(e.control,self.value())}),self.state.on("change:value",function(e){var selectedItem=function getSelectedItem(menuValues,value){var selectedItem;if(menuValues)for(var i=0;i<menuValues.length;i++){if(menuValues[i].value===value)return menuValues[i];if(menuValues[i].menu&&(selectedItem=getSelectedItem(menuValues[i].menu,value)))return selectedItem}}(self.state.get("menu"),e.value);selectedItem?self.text(selectedItem.text):self.text(self.settings.text)}),self._super()}})}),define("tinymce.core.ui.Radio",["tinymce.core.ui.Checkbox"],function(Checkbox){"use strict";return Checkbox.extend({Defaults:{classes:"radio",role:"radio"}})}),define("tinymce.core.ui.ResizeHandle",["tinymce.core.ui.Widget","tinymce.core.ui.DragHelper"],function(Widget,DragHelper){"use strict";return Widget.extend({renderHtml:function(){var prefix=this.classPrefix;return this.classes.add("resizehandle"),"both"==this.settings.direction&&this.classes.add("resizehandle-both"),this.canFocus=!1,'<div id="'+this._id+'" class="'+this.classes+'"><i class="'+prefix+"ico "+prefix+'i-resize"></i></div>'},postRender:function(){var self=this;self._super(),self.resizeDragHelper=new DragHelper(this._id,{start:function(){self.fire("ResizeStart")},drag:function(e){"both"!=self.settings.direction&&(e.deltaX=0),self.fire("Resize",e)},stop:function(){self.fire("ResizeEnd")}})},remove:function(){return this.resizeDragHelper&&this.resizeDragHelper.destroy(),this._super()}})}),define("tinymce.core.ui.SelectBox",["tinymce.core.ui.Widget"],function(Widget){"use strict";function createOptions(options){var strOptions="";if(options)for(var i=0;i<options.length;i++)strOptions+='<option value="'+options[i]+'">'+options[i]+"</option>";return strOptions}return Widget.extend({Defaults:{classes:"selectbox",role:"selectbox",options:[]},init:function(settings){var self=this;self._super(settings),self.settings.size&&(self.size=self.settings.size),self.settings.options&&(self._options=self.settings.options),self.on("keydown",function(e){var rootControl;13==e.keyCode&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))})},options:function(state){return arguments.length?(this.state.set("options",state),this):this.state.get("options")},renderHtml:function(){var options,size="";return options=createOptions(this._options),this.size&&(size=' size = "'+this.size+'"'),'<select id="'+this._id+'" class="'+this.classes+'"'+size+">"+options+"</select>"},bindStates:function(){var self=this;return self.state.on("change:options",function(e){self.getEl().innerHTML=createOptions(e.value)}),self._super()}})}),define("tinymce.core.ui.Slider",["tinymce.core.ui.Widget","tinymce.core.ui.DragHelper","tinymce.core.ui.DomUtils"],function(Widget,DragHelper,DomUtils){"use strict";function constrain(value,minVal,maxVal){return value<minVal&&(value=minVal),maxVal<value&&(value=maxVal),value}function setAriaProp(el,name,value){el.setAttribute("aria-"+name,value)}function updateSliderHandle(ctrl,value){var shortSizeName,sizeName,stylePosName,styleValue,handleEl;shortSizeName="v"==ctrl.settings.orientation?(stylePosName="top",sizeName="height","h"):(stylePosName="left",sizeName="width","w"),handleEl=ctrl.getEl("handle"),styleValue=((ctrl.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName])*((value-ctrl._minValue)/(ctrl._maxValue-ctrl._minValue))+"px",handleEl.style[stylePosName]=styleValue,handleEl.style.height=ctrl.layoutRect().h+"px",setAriaProp(handleEl,"valuenow",value),setAriaProp(handleEl,"valuetext",""+ctrl.settings.previewFilter(value)),setAriaProp(handleEl,"valuemin",ctrl._minValue),setAriaProp(handleEl,"valuemax",ctrl._maxValue)}return Widget.extend({init:function(settings){settings.previewFilter||(settings.previewFilter=function(value){return Math.round(100*value)/100}),this._super(settings),this.classes.add("slider"),"v"==settings.orientation&&this.classes.add("vertical"),this._minValue=settings.minValue||0,this._maxValue=settings.maxValue||100,this._initValue=this.state.get("value")},renderHtml:function(){var id=this._id,prefix=this.classPrefix;return'<div id="'+id+'" class="'+this.classes+'"><div id="'+id+'-handle" class="'+prefix+'slider-handle" role="slider" tabindex="-1"></div></div>'},reset:function(){this.value(this._initValue).repaint()},postRender:function(){var minValue,maxValue,screenCordName,stylePosName,sizeName,shortSizeName,self=this;minValue=self._minValue,maxValue=self._maxValue,shortSizeName="v"==self.settings.orientation?(screenCordName="screenY",stylePosName="top",sizeName="height","h"):(screenCordName="screenX",stylePosName="left",sizeName="width","w"),self._super(),function handleKeyboard(minValue,maxValue){function alter(delta){var value;value=self.value(),value=constrain(value=function fromFraction(min,max,val){return val*(max-min)-min}(minValue,maxValue,function toFraction(min,max,val){return(val+min)/(max-min)}(minValue,maxValue,value)+.05*delta),minValue,maxValue),self.value(value),self.fire("dragstart",{value:value}),self.fire("drag",{value:value}),self.fire("dragend",{value:value})}self.on("keydown",function(e){switch(e.keyCode){case 37:case 38:alter(-1);break;case 39:case 40:alter(1)}})}(minValue,maxValue,self.getEl("handle")),function handleDrag(minValue,maxValue,handleEl){var startPos,startHandlePos,maxHandlePos,handlePos,value;self._dragHelper=new DragHelper(self._id,{handle:self._id+"-handle",start:function(e){startPos=e[screenCordName],startHandlePos=parseInt(self.getEl("handle").style[stylePosName],10),maxHandlePos=(self.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName],self.fire("dragstart",{value:value})},drag:function(e){var delta=e[screenCordName]-startPos;handlePos=constrain(startHandlePos+delta,0,maxHandlePos),handleEl.style[stylePosName]=handlePos+"px",value=minValue+handlePos/maxHandlePos*(maxValue-minValue),self.value(value),self.tooltip().text(""+self.settings.previewFilter(value)).show().moveRel(handleEl,"bc tc"),self.fire("drag",{value:value})},stop:function(){self.tooltip().hide(),self.fire("dragend",{value:value})}})}(minValue,maxValue,self.getEl("handle"))},repaint:function(){this._super(),updateSliderHandle(this,this.value())},bindStates:function(){var self=this;return self.state.on("change:value",function(e){updateSliderHandle(self,e.value)}),self._super()}})}),define("tinymce.core.ui.Spacer",["tinymce.core.ui.Widget"],function(Widget){"use strict";return Widget.extend({renderHtml:function(){return this.classes.add("spacer"),this.canFocus=!1,'<div id="'+this._id+'" class="'+this.classes+'"></div>'}})}),define("tinymce.core.ui.SplitButton",["tinymce.core.ui.MenuButton","tinymce.core.ui.DomUtils","tinymce.core.dom.DomQuery"],function(MenuButton,DomUtils,$){return MenuButton.extend({Defaults:{classes:"widget btn splitbtn",role:"button"},repaint:function(){var mainButtonElm,menuButtonElm,elm=this.getEl(),rect=this.layoutRect();return this._super(),mainButtonElm=elm.firstChild,menuButtonElm=elm.lastChild,$(mainButtonElm).css({width:rect.w-DomUtils.getSize(menuButtonElm).width,height:rect.h-2}),$(menuButtonElm).css({height:rect.h-2}),this},activeMenu:function(state){$(this.getEl().lastChild).toggleClass(this.classPrefix+"active",state)},renderHtml:function(){var image,id=this._id,prefix=this.classPrefix,icon=this.state.get("icon"),text=this.state.get("text"),textHtml="";return image=(image=this.settings.image)?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1])," style=\"background-image: url('"+image+"')\""):"",icon=this.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",text&&(this.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+this.encode(text)+"</span>"),'<div id="'+id+'" class="'+this.classes+'" role="button" tabindex="-1"><button type="button" hidefocus="1" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+'</button><button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1">'+(this._menuBtnText?(icon?" ":"")+this._menuBtnText:"")+' <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var onClickHandler=this.settings.onclick;return this.on("click",function(e){var node=e.target;if(e.control==this)for(;node;){if(e.aria&&"down"!=e.aria.key||"BUTTON"==node.nodeName&&-1==node.className.indexOf("open"))return e.stopImmediatePropagation(),void(onClickHandler&&onClickHandler.call(this,e));node=node.parentNode}}),delete this.settings.onclick,this._super()}})}),define("tinymce.core.ui.StackLayout",["tinymce.core.ui.FlowLayout"],function(FlowLayout){"use strict";return FlowLayout.extend({Defaults:{containerClass:"stack-layout",controlClass:"stack-layout-item",endClass:"break"},isNative:function(){return!0}})}),define("tinymce.core.ui.TabPanel",["tinymce.core.ui.Panel","tinymce.core.dom.DomQuery","tinymce.core.ui.DomUtils"],function(Panel,$,DomUtils){"use strict";return Panel.extend({Defaults:{layout:"absolute",defaults:{type:"panel"}},activateTab:function(idx){var activeTabElm;this.activeTabId&&(activeTabElm=this.getEl(this.activeTabId),$(activeTabElm).removeClass(this.classPrefix+"active"),activeTabElm.setAttribute("aria-selected","false")),this.activeTabId="t"+idx,(activeTabElm=this.getEl("t"+idx)).setAttribute("aria-selected","true"),$(activeTabElm).addClass(this.classPrefix+"active"),this.items()[idx].show().fire("showtab"),this.reflow(),this.items().each(function(item,i){idx!=i&&item.hide()})},renderHtml:function(){var self=this,layout=self._layout,tabsHtml="",prefix=self.classPrefix;return self.preRender(),layout.preRender(self),self.items().each(function(ctrl,i){var id=self._id+"-t"+i;ctrl.aria("role","tabpanel"),ctrl.aria("labelledby",id),tabsHtml+='<div id="'+id+'" class="'+prefix+'tab" unselectable="on" role="tab" aria-controls="'+ctrl._id+'" aria-selected="false" tabIndex="-1">'+self.encode(ctrl.settings.title)+"</div>"}),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1"><div id="'+self._id+'-head" class="'+prefix+'tabs" role="tablist">'+tabsHtml+'</div><div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div></div>"},postRender:function(){var self=this;self._super(),self.settings.activeTab=self.settings.activeTab||0,self.activateTab(self.settings.activeTab),this.on("click",function(e){var targetParent=e.target.parentNode;if(targetParent&&targetParent.id==self._id+"-head")for(var i=targetParent.childNodes.length;i--;)targetParent.childNodes[i]==e.target&&self.activateTab(i)})},initLayoutRect:function(){var rect,minW,minH;minW=(minW=DomUtils.getSize(this.getEl("head")).width)<0?0:minW,minH=0,this.items().each(function(item){minW=Math.max(minW,item.layoutRect().minW),minH=Math.max(minH,item.layoutRect().minH)}),this.items().each(function(ctrl){ctrl.settings.x=0,ctrl.settings.y=0,ctrl.settings.w=minW,ctrl.settings.h=minH,ctrl.layoutRect({x:0,y:0,w:minW,h:minH})});var headH=DomUtils.getSize(this.getEl("head")).height;return this.settings.minWidth=minW,this.settings.minHeight=minH+headH,(rect=this._super()).deltaH+=headH,rect.innerH=rect.h-rect.deltaH,rect}})}),define("tinymce.core.ui.TextBox",["tinymce.core.ui.Widget","tinymce.core.util.Tools","tinymce.core.ui.DomUtils"],function(Widget,Tools,DomUtils){return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("textbox"),settings.multiline?self.classes.add("multiline"):(self.on("keydown",function(e){var rootControl;13==e.keyCode&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))}),self.on("keyup",function(e){self.state.set("value",e.target.value)}))},repaint:function(){var style,rect,borderBox,borderW,lastRepaintRect,borderH=0;style=this.getEl().style,rect=this._layoutRect,lastRepaintRect=this._lastRepaintRect||{};var doc=document;return!this.settings.multiline&&doc.all&&(!doc.documentMode||doc.documentMode<=8)&&(style.lineHeight=rect.h-borderH+"px"),borderW=(borderBox=this.borderBox).left+borderBox.right+8,borderH=borderBox.top+borderBox.bottom+(this.settings.multiline?8:0),rect.x!==lastRepaintRect.x&&(style.left=rect.x+"px",lastRepaintRect.x=rect.x),rect.y!==lastRepaintRect.y&&(style.top=rect.y+"px",lastRepaintRect.y=rect.y),rect.w!==lastRepaintRect.w&&(style.width=rect.w-borderW+"px",lastRepaintRect.w=rect.w),rect.h!==lastRepaintRect.h&&(style.height=rect.h-borderH+"px",lastRepaintRect.h=rect.h),this._lastRepaintRect=lastRepaintRect,this.fire("repaint",{},!1),this},renderHtml:function(){var attrs,elm,settings=this.settings;return attrs={id:this._id,hidefocus:"1"},Tools.each(["rows","spellcheck","maxLength","size","readonly","min","max","step","list","pattern","placeholder","required","multiple"],function(name){attrs[name]=settings[name]}),this.disabled()&&(attrs.disabled="disabled"),settings.subtype&&(attrs.type=settings.subtype),(elm=DomUtils.create(settings.multiline?"textarea":"input",attrs)).value=this.state.get("value"),elm.className=this.classes,elm.outerHTML},value:function(value){return arguments.length?(this.state.set("value",value),this):(this.state.get("rendered")&&this.state.set("value",this.getEl().value),this.state.get("value"))},postRender:function(){var self=this;self.getEl().value=self.state.get("value"),self._super(),self.$el.on("change",function(e){self.state.set("value",e.target.value),self.fire("change",e)})},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.getEl().value!=e.value&&(self.getEl().value=e.value)}),self.state.on("change:disabled",function(e){self.getEl().disabled=e.value}),self._super()},remove:function(){this.$el.off(),this._super()}})}),define("tinymce.core.ui.Api",["tinymce.core.ui.Selector","tinymce.core.ui.Collection","tinymce.core.ui.ReflowQueue","tinymce.core.ui.Control","tinymce.core.ui.Factory","tinymce.core.ui.KeyboardNavigation","tinymce.core.ui.Container","tinymce.core.ui.DragHelper","tinymce.core.ui.Scrollable","tinymce.core.ui.Panel","tinymce.core.ui.Movable","tinymce.core.ui.Resizable","tinymce.core.ui.FloatPanel","tinymce.core.ui.Window","tinymce.core.ui.MessageBox","tinymce.core.ui.Tooltip","tinymce.core.ui.Widget","tinymce.core.ui.Progress","tinymce.core.ui.Notification","tinymce.core.ui.Layout","tinymce.core.ui.AbsoluteLayout","tinymce.core.ui.Button","tinymce.core.ui.ButtonGroup","tinymce.core.ui.Checkbox","tinymce.core.ui.ComboBox","tinymce.core.ui.ColorBox","tinymce.core.ui.PanelButton","tinymce.core.ui.ColorButton","tinymce.core.ui.ColorPicker","tinymce.core.ui.Path","tinymce.core.ui.ElementPath","tinymce.core.ui.FormItem","tinymce.core.ui.Form","tinymce.core.ui.FieldSet","tinymce.core.ui.FilePicker","tinymce.core.ui.FitLayout","tinymce.core.ui.FlexLayout","tinymce.core.ui.FlowLayout","tinymce.core.ui.FormatControls","tinymce.core.ui.GridLayout","tinymce.core.ui.Iframe","tinymce.core.ui.InfoBox","tinymce.core.ui.Label","tinymce.core.ui.Toolbar","tinymce.core.ui.MenuBar","tinymce.core.ui.MenuButton","tinymce.core.ui.MenuItem","tinymce.core.ui.Throbber","tinymce.core.ui.Menu","tinymce.core.ui.ListBox","tinymce.core.ui.Radio","tinymce.core.ui.ResizeHandle","tinymce.core.ui.SelectBox","tinymce.core.ui.Slider","tinymce.core.ui.Spacer","tinymce.core.ui.SplitButton","tinymce.core.ui.StackLayout","tinymce.core.ui.TabPanel","tinymce.core.ui.TextBox"],function(Selector,Collection,ReflowQueue,Control,Factory,KeyboardNavigation,Container,DragHelper,Scrollable,Panel,Movable,Resizable,FloatPanel,Window,MessageBox,Tooltip,Widget,Progress,Notification,Layout,AbsoluteLayout,Button,ButtonGroup,Checkbox,ComboBox,ColorBox,PanelButton,ColorButton,ColorPicker,Path,ElementPath,FormItem,Form,FieldSet,FilePicker,FitLayout,FlexLayout,FlowLayout,FormatControls,GridLayout,Iframe,InfoBox,Label,Toolbar,MenuBar,MenuButton,MenuItem,Throbber,Menu,ListBox,Radio,ResizeHandle,SelectBox,Slider,Spacer,SplitButton,StackLayout,TabPanel,TextBox){"use strict";var expose=function(target,id,ref){var i,fragments;for(fragments=id.split(/[.\/]/),i=0;i<fragments.length-1;++i)target[fragments[i]]===undefined&&(target[fragments[i]]={}),target=target[fragments[i]];!function(id,ref){Factory.add(id.split(".").pop(),ref)}(id,target[fragments[fragments.length-1]]=ref)},Api={appendTo:function(target){expose(target,"ui.Selector",Selector),expose(target,"ui.Collection",Collection),expose(target,"ui.ReflowQueue",ReflowQueue),expose(target,"ui.Control",Control),expose(target,"ui.Factory",Factory),expose(target,"ui.KeyboardNavigation",KeyboardNavigation),expose(target,"ui.Container",Container),expose(target,"ui.DragHelper",DragHelper),expose(target,"ui.Scrollable",Scrollable),expose(target,"ui.Panel",Panel),expose(target,"ui.Movable",Movable),expose(target,"ui.Resizable",Resizable),expose(target,"ui.FloatPanel",FloatPanel),expose(target,"ui.Window",Window),expose(target,"ui.MessageBox",MessageBox),expose(target,"ui.Tooltip",Tooltip),expose(target,"ui.Widget",Widget),expose(target,"ui.Progress",Progress),expose(target,"ui.Notification",Notification),expose(target,"ui.Layout",Layout),expose(target,"ui.AbsoluteLayout",AbsoluteLayout),expose(target,"ui.Button",Button),expose(target,"ui.ButtonGroup",ButtonGroup),expose(target,"ui.Checkbox",Checkbox),expose(target,"ui.ComboBox",ComboBox),expose(target,"ui.ColorBox",ColorBox),expose(target,"ui.PanelButton",PanelButton),expose(target,"ui.ColorButton",ColorButton),expose(target,"ui.ColorPicker",ColorPicker),expose(target,"ui.Path",Path),expose(target,"ui.ElementPath",ElementPath),expose(target,"ui.FormItem",FormItem),expose(target,"ui.Form",Form),expose(target,"ui.FieldSet",FieldSet),expose(target,"ui.FilePicker",FilePicker),expose(target,"ui.FitLayout",FitLayout),expose(target,"ui.FlexLayout",FlexLayout),expose(target,"ui.FlowLayout",FlowLayout),expose(target,"ui.FormatControls",FormatControls),expose(target,"ui.GridLayout",GridLayout),expose(target,"ui.Iframe",Iframe),expose(target,"ui.InfoBox",InfoBox),expose(target,"ui.Label",Label),expose(target,"ui.Toolbar",Toolbar),expose(target,"ui.MenuBar",MenuBar),expose(target,"ui.MenuButton",MenuButton),expose(target,"ui.MenuItem",MenuItem),expose(target,"ui.Throbber",Throbber),expose(target,"ui.Menu",Menu),expose(target,"ui.ListBox",ListBox),expose(target,"ui.Radio",Radio),expose(target,"ui.ResizeHandle",ResizeHandle),expose(target,"ui.SelectBox",SelectBox),expose(target,"ui.Slider",Slider),expose(target,"ui.Spacer",Spacer),expose(target,"ui.SplitButton",SplitButton),expose(target,"ui.StackLayout",StackLayout),expose(target,"ui.TabPanel",TabPanel),expose(target,"ui.TextBox",TextBox),expose(target,"ui.Api",Api)}};return Api}),define("tinymce.core.api.Tinymce",["tinymce.core.geom.Rect","tinymce.core.util.Promise","tinymce.core.util.Delay","tinymce.core.Env","tinymce.core.dom.EventUtils","tinymce.core.dom.Sizzle","tinymce.core.util.Tools","tinymce.core.dom.DomQuery","tinymce.core.html.Styles","tinymce.core.dom.TreeWalker","tinymce.core.html.Entities","tinymce.core.dom.DOMUtils","tinymce.core.dom.ScriptLoader","tinymce.core.AddOnManager","tinymce.core.dom.RangeUtils","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.html.SaxParser","tinymce.core.html.DomParser","tinymce.core.html.Writer","tinymce.core.html.Serializer","tinymce.core.dom.Serializer","tinymce.core.util.VK","tinymce.core.dom.ControlSelection","tinymce.core.dom.BookmarkManager","tinymce.core.dom.Selection","tinymce.core.Formatter","tinymce.core.UndoManager","tinymce.core.EditorCommands","tinymce.core.util.URI","tinymce.core.util.Class","tinymce.core.util.EventDispatcher","tinymce.core.util.Observable","tinymce.core.WindowManager","tinymce.core.NotificationManager","tinymce.core.EditorObservable","tinymce.core.Shortcuts","tinymce.core.Editor","tinymce.core.util.I18n","tinymce.core.FocusManager","tinymce.core.EditorManager","tinymce.core.util.XHR","tinymce.core.util.JSON","tinymce.core.util.JSONRequest","tinymce.core.util.JSONP","tinymce.core.util.LocalStorage","tinymce.core.api.Compat","tinymce.core.util.Color","tinymce.core.ui.Api"],function(Rect,Promise,Delay,Env,EventUtils,Sizzle,Tools,DomQuery,Styles,TreeWalker,Entities,DOMUtils,ScriptLoader,AddOnManager,RangeUtils,Node,Schema,SaxParser,DomParser,Writer,HtmlSerializer,DomSerializer,VK,ControlSelection,BookmarkManager,Selection,Formatter,UndoManager,EditorCommands,URI,Class,EventDispatcher,Observable,WindowManager,NotificationManager,EditorObservable,Shortcuts,Editor,I18n,FocusManager,EditorManager,XHR,JSON,JSONRequest,JSONP,LocalStorage,Compat,Color,Api){var tinymce=EditorManager,expose=function(target,id,ref){var i,fragments;for(fragments=id.split(/[.\/]/),i=0;i<fragments.length-1;++i)target[fragments[i]]===undefined&&(target[fragments[i]]={}),target=target[fragments[i]];target[fragments[fragments.length-1]]=ref};return expose(tinymce,"geom.Rect",Rect),expose(tinymce,"util.Promise",Promise),expose(tinymce,"util.Delay",Delay),expose(tinymce,"Env",Env),expose(tinymce,"dom.EventUtils",EventUtils),expose(tinymce,"dom.Sizzle",Sizzle),expose(tinymce,"util.Tools",Tools),expose(tinymce,"dom.DomQuery",DomQuery),expose(tinymce,"html.Styles",Styles),expose(tinymce,"dom.TreeWalker",TreeWalker),expose(tinymce,"html.Entities",Entities),expose(tinymce,"dom.DOMUtils",DOMUtils),expose(tinymce,"dom.ScriptLoader",ScriptLoader),expose(tinymce,"AddOnManager",AddOnManager),expose(tinymce,"dom.RangeUtils",RangeUtils),expose(tinymce,"html.Node",Node),expose(tinymce,"html.Schema",Schema),expose(tinymce,"html.SaxParser",SaxParser),expose(tinymce,"html.DomParser",DomParser),expose(tinymce,"html.Writer",Writer),expose(tinymce,"html.Serializer",HtmlSerializer),expose(tinymce,"dom.Serializer",DomSerializer),expose(tinymce,"util.VK",VK),expose(tinymce,"dom.ControlSelection",ControlSelection),expose(tinymce,"dom.BookmarkManager",BookmarkManager),expose(tinymce,"dom.Selection",Selection),expose(tinymce,"Formatter",Formatter),expose(tinymce,"UndoManager",UndoManager),expose(tinymce,"EditorCommands",EditorCommands),expose(tinymce,"util.URI",URI),expose(tinymce,"util.Class",Class),expose(tinymce,"util.EventDispatcher",EventDispatcher),expose(tinymce,"util.Observable",Observable),expose(tinymce,"WindowManager",WindowManager),expose(tinymce,"NotificationManager",NotificationManager),expose(tinymce,"EditorObservable",EditorObservable),expose(tinymce,"Shortcuts",Shortcuts),expose(tinymce,"Editor",Editor),expose(tinymce,"util.I18n",I18n),expose(tinymce,"FocusManager",FocusManager),expose(tinymce,"EditorManager",EditorManager),expose(tinymce,"util.XHR",XHR),expose(tinymce,"util.JSON",JSON),expose(tinymce,"util.JSONRequest",JSONRequest),expose(tinymce,"util.JSONP",JSONP),expose(tinymce,"util.LocalStorage",LocalStorage),expose(tinymce,"Compat",Compat),expose(tinymce,"util.Color",Color),Api.appendTo(tinymce),Compat.register(tinymce),tinymce}),define("tinymce.core.Register",[],function(){var context=this||window;return{exposeToModuleLoaders:function(tinymce){"function"==typeof context.define&&(context.define.amd||(context.define("ephox/tinymce",[],function(){return tinymce}),context.define("tinymce.core.EditorManager",[],function(){return tinymce}))),"object"==typeof module&&(module.exports=tinymce)}}}),define("tinymce.core.api.Main",["tinymce.core.api.Tinymce","tinymce.core.Register"],function(tinymce,Register){return function(){return window.tinymce=tinymce,window.tinyMCE=tinymce,Register.exposeToModuleLoaders(tinymce),tinymce}}),dem("tinymce.core.api.Main")()}();
